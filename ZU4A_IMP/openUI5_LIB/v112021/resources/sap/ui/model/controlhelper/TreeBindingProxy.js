sap.ui.define(["sap/base/assert","sap/base/Log"],(function(e,t){"use strict";var n=function(e,t){this._oControl=e,this._sAggregation=t;var n=new URLSearchParams(window.location.search);this._bEnableV4="true"===n.get("sap-ui-xx-v4tree")};function i(e){var t=e.indices.filter((function(t){return t>=0&&t<e.binding.getLength()&&!e.proxy.isLeaf(t)&&e.expanded!==e.proxy.isExpanded(t)})).sort((function(e,t){return e-t}));if(0!==t.length){for(var n=t.length-1;n>0;n--)e.expanded?e.binding.expand(t[n],!0):e.binding.collapse(t[n],!0);e.expanded?e.binding.expand(t[0],!1):e.binding.collapse(t[0],!1)}}function o(e){for(var t=0;t<e.indices.length;t++){var n=e.proxy.getContextByIndex(e.indices[t]);n&&(e.expanded?n.expand():n.collapse())}}function r(e,t){if(e)return t?e.level+1:e.getProperty("@$ui5.node.level")}function a(e,t){var n=Object.assign(e.getAggregation(),{expandTo:t});e.setAggregation(n)}return n.prototype.isTreeBinding=function(){return!this._oControl.getModel(this._oControl.getBindingInfo(this._sAggregation).model).isA("sap.ui.model.odata.v4.ODataModel")},n.prototype.isLeaf=function(e){var n=this._oControl.getBinding();switch(this._getBindingName(n)){case void 0:return!0;case"sap.ui.model.odata.v4.ODataListBinding":if(!this._bEnableV4)return t.error("UnsupportedOperationException: OData V4 is not supported"),!1;var i=this.getContextByIndex(e);return!i||void 0===i.getProperty("@$ui5.node.isExpanded");default:var o=this.getNodeByIndex(e);return!n.nodeHasChildren(o)}},n.prototype.getNodeByIndex=function(e){var n=this._oControl.getBinding(),i=this._getBindingName(n),o=null;if(e<0)return o;switch(i){case void 0:break;case"sap.ui.model.odata.v4.ODataListBinding":this._bEnableV4?o=this.getContextByIndex(e):t.error("UnsupportedOperationException: OData V4 is not supported");break;default:o=n.getNodeByIndex(e)}return o||null},n.prototype.getContextByIndex=function(e){var n=this._oControl.getBinding(),i=this._getBindingName(n),o=null;if(e<0)return o;switch(i){case void 0:break;case"sap.ui.model.odata.v4.ODataListBinding":this._bEnableV4?o=n.getContexts(e,1,0,!0)[0]:t.error("UnsupportedOperationException: OData V4 is not supported");break;default:o=n.getContextByIndex(e)}return o||null},n.prototype.isExpanded=function(e){var n=this._oControl.getBinding();switch(this._getBindingName(n)){case void 0:return!1;case"sap.ui.model.odata.v4.ODataListBinding":if(!this._bEnableV4)return t.error("UnsupportedOperationException: OData V4 is not supported"),!1;var i=this.getContextByIndex(e);return!!i&&!!i.getProperty("@$ui5.node.isExpanded");default:return!!n&&n.isExpanded(e)}},n.prototype.expand=function(e){var n=this._oControl.getBinding(),r=this._getBindingName(n),a={proxy:this,binding:n,indices:e,expanded:!0};switch("number"==typeof a.indices&&(a.indices=[e]),r){case void 0:break;case"sap.ui.model.odata.v4.ODataListBinding":if(!this._bEnableV4)return void t.error("UnsupportedOperationException: OData V4 is not supported");o(a);break;default:i(a)}},n.prototype.collapse=function(e){var n=this._oControl.getBinding(),r=this._getBindingName(n),a={proxy:this,binding:n,indices:e,expanded:!1};switch("number"==typeof a.indices&&(a.indices=[e]),r){case void 0:break;case"sap.ui.model.odata.v4.ODataListBinding":if(!this._bEnableV4)return void t.error("UnsupportedOperationException: OData V4 is not supported");o(a);break;default:i(a)}},n.prototype.toggleExpandedState=function(e){this.isExpanded(e)?this.collapse(e):this.expand(e)},n.prototype.getContexts=function(e,n,i,o){var a=this._oControl.getBinding(),s=this._getBindingName(a),d=[];switch(s){case void 0:break;case"sap.ui.model.odata.v4.ODataListBinding":if(!this._bEnableV4)return t.error("UnsupportedOperationException: OData V4 is not supported"),[];(d=a.getContexts(e,n,i,o)).forEach((function(e){e&&(e._mProxyInfo={},e._mProxyInfo.level=r(e,!1),e._mProxyInfo.isLeaf=void 0===e.getProperty("@$ui5.node.isExpanded"),e._mProxyInfo.isExpanded=!!e.getProperty("@$ui5.node.isExpanded"))}),this);break;default:(a?a.getNodes(e,n,i):[]).forEach((function(t,n){if(t){var i=n+e,o=t.context;o&&(o._mProxyInfo={},t.nodeState&&(o._mProxyInfo.nodeState=t.nodeState),o._mProxyInfo.level=r(t,!0),o._mProxyInfo.isLeaf=!a.nodeHasChildren(t),o._mProxyInfo.isExpanded=a.isExpanded(i),d.push(t.context))}}),this)}return d},n.prototype.collapseAll=function(){var e=this._oControl.getBinding();switch(this._getBindingName(e)){case void 0:break;case"sap.ui.model.odata.v4.ODataListBinding":if(!this._bEnableV4)return void t.error("UnsupportedOperationException: OData V4 is not supported");a(e,1);break;default:e.collapseToLevel(0)}},n.prototype.expandToLevel=function(n){var i=this._oControl.getBinding();switch(this._getBindingName(i)){case void 0:break;case"sap.ui.model.odata.v4.ODataListBinding":if(!this._bEnableV4)return void t.error("UnsupportedOperationException: OData V4 is not supported");a(i,n);break;default:i.expandToLevel?i.expandToLevel(n):e(i.expandToLevel,"Expanding all nodes to a certain level is not supported with your current binding.")}},n.prototype.setRootLevel=function(n){var i=this._oControl.getBinding();switch(this._getBindingName(i)){case void 0:break;case"sap.ui.model.odata.v4.ODataListBinding":if(!this._bEnableV4)return void t.error("UnsupportedOperationException: OData V4 is not supported");throw Error("Setting the root level is not supported with your current binding.");default:i.setRootLevel?i.setRootLevel(n):e(i.setRootLevel,"Setting the root level is not supported with your current binding.")}},n.prototype.setCollapseRecursive=function(n){var i=this._oControl.getBinding();switch(this._getBindingName(i)){case void 0:break;case"sap.ui.model.odata.v4.ODataListBinding":if(!this._bEnableV4)return void t.error("UnsupportedOperationException: OData V4 is not supported");throw Error("Setting 'collapseRecursive' is not supported with your current binding.");default:i.setCollapseRecursive?i.setCollapseRecursive(n):e(i.setCollapseRecursive,"Setting 'collapseRecursive' is not supported with your current binding.")}},n.prototype.getLevel=function(e){var n=this._oControl.getBinding();switch(this._getBindingName(n)){case void 0:return;case"sap.ui.model.odata.v4.ODataListBinding":return this._bEnableV4?r(this.getContextByIndex(e),!1):(t.error("UnsupportedOperationException: OData V4 is not supported"),0);default:return r(this.getNodeByIndex(e),!0)}},n.prototype.getSiblingCount=function(e){var n=this._oControl.getBinding();switch(this._getBindingName(n)){case void 0:return 0;case"sap.ui.model.odata.v4.ODataListBinding":if(!this._bEnableV4)return t.error("UnsupportedOperationException: OData V4 is not supported"),0;throw Error("The number of siblings of a node cannot be determined with your current binding.");default:var i=this.getNodeByIndex(e);return i&&i.parent?i.parent.children.length:0}},n.prototype.getPositionInParent=function(e){var n=this._oControl.getBinding();switch(this._getBindingName(n)){case void 0:return-1;case"sap.ui.model.odata.v4.ODataListBinding":if(!this._bEnableV4)return t.error("UnsupportedOperationException: OData V4 is not supported"),-1;throw Error("The position of a node in its parent cannot be determined with your current binding.");default:var i=this.getNodeByIndex(e);return i?i.positionInParent:-1}},n.prototype.isSelectionSupported=function(){var e=this._oControl.getBinding();switch(this._getBindingName(e)){case void 0:case"sap.ui.model.odata.v4.ODataListBinding":return!1;default:return!0}},n.prototype.applyLegacySettingsToBindingInfo=function(e,t){e.parameters||(e.parameters={}),"rootLevel"in e.parameters||void 0===t.rootLevel||(e.parameters.rootLevel=t.rootLevel),"collapseRecursive"in e.parameters||void 0===t.collapseRecursive||(e.parameters.collapseRecursive=t.collapseRecursive),"numberOfExpandedLevels"in e.parameters||void 0===t.numberOfExpandedLevels||(e.parameters.numberOfExpandedLevels=t.numberOfExpandedLevels)},n.prototype._getBindingName=function(e){return e?e.getMetadata().getName():void 0},n}));