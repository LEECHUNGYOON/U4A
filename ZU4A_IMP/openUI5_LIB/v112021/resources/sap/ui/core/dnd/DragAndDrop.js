sap.ui.define(["../library","sap/ui/Device","sap/ui/core/Element","sap/ui/core/StaticArea","../UIArea","sap/ui/thirdparty/jquery","sap/ui/core/Configuration"],(function(t,e,n,r,o,jQuery,a){"use strict";var i,f,g,s,l,u,c,d=t.dnd.RelativeDropPosition,p={},D=null,h=null,v=null,m=[],w=[],C=null,b={};function E(t){return!t.disabled&&/^(input|textarea)$/.test(t.localName)}function y(t){var e,n={},r=t.originalEvent.dataTransfer,o=function(t,e){r.setData(t,e)};return{setData:function(t,e){e=""+e,n[t]=e,o(t,e)},getData:function(t){return n[t]},setTextData:function(t){t=""+t,n["text/plain"]=t,n.text=t,o("text/plain",t),o("text",t)},getTextData:function(){return n["text/plain"]},setComplexData:function(t,e){n[t]=e},getComplexData:function(t){return n[t]},getIndicator:function(){return i&&i[0]},setIndicatorConfig:function(t){e=t},getIndicatorConfig:function(t){return e},getDragControl:function(){return D},getDropControl:function(){return v},setDropControl:function(t){v=t},getDropInfo:function(){return w[0]||null},getDropPosition:function(){return g}}}function A(t){D=h=v=C=null,g="",c=!1,m=[],w=[]}function S(){i&&(i.removeAttr("style"),i.hide(),b={})}function O(t,e,n,o){if(e){var f,g=v.getDropAreaRect?v.getDropAreaRect(o):e.getBoundingClientRect(),s=t.dragSession&&t.dragSession.getIndicatorConfig(),l=window.pageYOffset,u=window.pageXOffset,c=i||(i=jQuery("<div class='sapUiDnDIndicator'></div>"),jQuery(r.getDomRef()).append(i),i),p={},D={top:g.top+l,bottom:g.bottom+l,left:g.left+u,right:g.right+u,width:g.width,height:g.height};if(n&&"On"!=n)if("Horizontal"==o){var h=t.pageX-D.left;p.height=D.height,p.top=D.top,"Between"==n?(p.width="",h<.5*D.width?(f=d.Before,p.left=D.left):(f=d.After,p.left=D.right)):"OnOrBetween"==n&&(h<.25*D.width?(f=d.Before,p.left=D.left,p.width=""):h>.75*D.width?(f=d.After,p.left=D.right,p.width=""):f=d.On),f!=d.On&&a.getRTL()&&(f=f==d.After?d.Before:d.After)}else{var m=t.pageY-D.top;p.width=D.width,p.left=D.left,"Between"==n?(p.height="",m<.5*D.height?(f=d.Before,p.top=D.top):(f=d.After,p.top=D.bottom)):"OnOrBetween"==n&&(m<.25*D.height?(f=d.Before,p.top=D.top,p.height=""):m>.75*D.height?(f=d.After,p.top=D.bottom,p.height=""):f=d.On)}else f=d.On,o="";return s&&"none"==s.display||(f==d.On?(p.top=D.top,p.left=D.left,p.width=D.width,p.height=D.height,n=f):n="Between",b.top==p.top&&b.left==p.left&&b.width==p.width&&b.height==p.height||(c.attr("data-drop-layout",o),c.attr("data-drop-position",n),c.css(Object.assign(p,s)),c.show(),b=p)),f}}function T(t){var e=t.getParent(),n=t.getDragDropConfig?t.getDragDropConfig():[],r=e&&e.getDragDropConfig?e.getDragDropConfig():[];return n.concat(r)}function x(t,e,n){var r=T(t);return e=e||[],r.filter((function(t){return!t.isA("sap.ui.core.dnd.IDragInfo")})).concat(e).filter((function(r){if(!r.isDroppable(t,n))return!1;var o=r.getGroupName();return!o||e.some((function(t){return t.getGroupName()==o}))}))}function I(t,e){if(t.preventDefault(),D){var n=e.getDropEffect().toLowerCase();t.originalEvent.dataTransfer.dropEffect=n}}function B(t,e,n){var r,o=e.getTargetAggregation();return o?(t.getMark("DragWithin")==o&&(r=n.getDomRefForSetting(o)),O(t,r=r||n.getDomRef(),e.getDropPosition(!0),e.getDropLayout(!0))):O(t,n.getDomRef())}return p.preprocessEvent=function(t){C&&0==t.type.indexOf("dr")&&(t.dragSession=C);var e="onbefore"+t.type;p[e]&&p[e](t)},p.postprocessEvent=function(t){var e="onafter"+t.type;p[e]&&p[e](t)},p.onbeforemousedown=function(t){e.browser.firefox&&E(t.target)&&(l=jQuery(t.target).closest("[data-sap-ui-draggable=true]").prop("draggable",!1)[0])},p.onbeforemouseup=function(t){l&&(l.draggable=!0,l=null)},p.onbeforedragstart=function(t){t.target.draggable&&(E(document.activeElement)?t.target.getAttribute("data-sap-ui-draggable")&&t.preventDefault():(D=n.closestTo(t.target,!0))&&(m=function(t){return T(t).filter((function(e){return e.isDraggable(t)}))}(D),m.length&&(e.system.desktop||t.originalEvent.dataTransfer.getData("text")||t.originalEvent.dataTransfer.setData("text"," "),t.dragSession=C=y(t))))},p.onafterdragstart=function(t){if(m.length&&!t.isDefaultPrevented()){if(!(m=t.isMarked("NonDraggable")?[]:m.filter((function(e){return e.fireDragStart(t)}))).length)return t.preventDefault(),void A();var e,n;!function(t,e){if(t&&t.getDragGhost){var n=t.getDragGhost();if(n){f||(f=jQuery('<div class="sapUiDnDGhostContainer"></div>'),jQuery(document.body).append(f)),f.append(n),window.setTimeout((function(){f.empty()}),0);var r=e.originalEvent;r.dataTransfer.setDragImage(n,r.offsetX,r.offsetY)}}}(D,t),n="sapUiDnDDragging",(e=D)&&(e.addStyleClass?e.addStyleClass(n):e.$().addClass(n)),jQuery(t.target).closest(".sapUiScrollDelegate")[0]&&jQuery("html").addClass("sapUiDnDNoScrolling")}else A()},p.onbeforedragenter=function(t){var e=n.closestTo(t.target,!0);e&&h===e?t.setMark("DragWithin","SameControl"):(s=Date.now(),h=e);var r,o=[];v=e;for(var a=0;a<20&&v&&!(o=x(v,m,t)).length;a++)r=(r=v.getDomRef())&&r.parentElement,v=n.closestTo(r,!0);"SameControl"!=t.getMark("DragWithin")&&(w=o,C&&C.setIndicatorConfig(null)),w.length?C||(c=!0,t.dragSession=C=y(t)):v=null},p.onafterdragenter=function(t){!v||t.isMarked("NonDroppable")?w=[]:"SameControl"!=t.getMark("DragWithin")&&(w=w.filter((function(e){return e.fireDragEnter(t)})));var e=w[0];e&&"None"!=e.getDropEffect()?(I(t,e),g=B(t,e,v)):(S(),g="")},p.onbeforedragover=function(t){var e=Date.now();e-s>=1e3&&(!function(t,e){var r=n.closestTo(t.target,!0);if(r&&r.getUIArea()){var o=jQuery.Event(null,t);o.type=e,r.getUIArea()._handleEvent(o)}}(t,"longdragover"),s=e)},p.onafterdragover=function(t){var e=w[0];e&&"None"!=e.getDropEffect()&&(w.forEach((function(e){e.fireDragOver(t)})),I(t,e),e&&"On"==e.getDropPosition(!0)||(g=B(t,e,v)))},p.onafterdragleave=function(t){c&&!t.relatedTarget&&(S(),A())},p.onbeforedrop=function(t){w.length&&t.preventDefault()},p.onafterdrop=function(t){w.forEach((function(e){e.fireDrop(t)})),u=requestAnimationFrame(this.onafterdragend.bind(this,t))},p.onafterdragend=function(t){var e,n;u=cancelAnimationFrame(u),m.forEach((function(e){e.fireDragEnd(t)})),n="sapUiDnDDragging",(e=D)&&(e.removeStyleClass?e.removeStyleClass(n):e.$().removeClass(n)),jQuery("html").removeClass("sapUiDnDNoScrolling"),S(),A()},o.addEventPreprocessor(p.preprocessEvent),o.addEventPostprocessor(p.postprocessEvent),p}),!0);