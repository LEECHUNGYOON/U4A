sap.ui.define(["../utils/TableUtils","../library","sap/ui/base/Object","sap/ui/Device","sap/ui/events/KeyCodes","sap/ui/thirdparty/jquery","sap/ui/core/Configuration"],(function(e,t,i,o,n,jQuery,s){"use strict";var l=e.CELLTYPE,r=t.SelectionMode,a={CTRL:1,SHIFT:2,ALT:4},f="1rem";function u(e,t){e.setMarked("sapUiTableSkipItemNavigation",!1!==t)}function g(t){e.getCellInfo(t.target).isOfType(l.ANY)&&(t.preventDefault(),t.stopPropagation())}var c=i.extend("sap.ui.table.extensions.KeyboardDelegate",{constructor:function(e){i.call(this)},destroy:function(){i.prototype.destroy.apply(this,arguments)},getInterface:function(){return this}});function d(t,i){if(h(t,i)){var o=e.getCellInfo(e.getCell(t,i.target));o.isOfType(l.ANYCOLUMNHEADER)?function(t,i,o){var n=e.getHeaderRowCount(t);if(e.isNoDataVisible(t)){e.getFocusedItemInfo(t).row-n<=1&&u(o)}else i.isOfType(l.COLUMNROWHEADER)&&n>1&&(u(o),e.focusItem(t,n*(e.getVisibleColumnCount(t)+1),o))}(t,o,i):o.isOfType(l.ANYCONTENTCELL)&&function(t,i,o){var n=t._getKeyboardExtension(),s=n.isInActionMode(),l=c._isKeyCombination(o,null,a.CTRL),r=l||s,f=e.getParentCell(t,o.target);if(!r&&f)return void f.trigger("focus");if(u(o),e.isLastScrollableRow(t,i.cell)){if(m(t,o))return void o.preventDefault()}if(i.rowIndex===t.getRows().length-1||e.isVariableRowHeightEnabled(t)&&i.rowIndex===t.getRows().length-2&&null===t.getRows()[i.rowIndex+1].getRowBindingContext()){if(!s&&f)f.trigger("focus");else{var g=t.getCreationRow();g&&g._takeOverKeyboardHandling(o)||n.setActionMode(!1)}return}D(t,i.type,i.rowIndex+1,i.columnIndex,r),o.preventDefault()}(t,o,i)}}function C(t,i){var o=e.getCellInfo(e.getCell(t,i.target));if(o.isOfType(l.ANYCONTENTCELL)&&h(t,i)){var n=c._isKeyCombination(i,null,a.CTRL),s=t._getKeyboardExtension(),r=s.isInActionMode(),f=n||r,g=e.getParentCell(t,i.target);if(f||!g){if(u(i),e.isFirstScrollableRow(t,o.cell))if(E(t,i))return void i.preventDefault();if(0===o.rowIndex)return u(i,o.isOfType(l.ROWACTION)||f),void(!r&&g?g.trigger("focus"):s.setActionMode(!1));D(t,o.type,o.rowIndex-1,o.columnIndex,f),i.preventDefault()}else g.trigger("focus")}}function h(e,t){var i=c._isKeyCombination(t,null,a.CTRL);return!t.isMarked()&&(i||!(t.target instanceof window.HTMLInputElement)&&!(t.target instanceof window.HTMLTextAreaElement))}function p(e){return new Promise((function(t){e.attachEventOnce("_rowsUpdated",t)}))}function I(e){return e._hasPendingRequests()?p(e).then((function(){return I(e)})):Promise.resolve()}function m(e,t,i,o){return e._getFirstRenderedRowIndex()===e._getMaxFirstRenderedRowIndex()?null:T(e,t,!0,i,o)}function E(e,t,i,o){return 0===e._getFirstRenderedRowIndex()?null:T(e,t,!1,i,o)}function T(t,i,o,n,s){var r=e.getCellInfo(e.getCell(t,i.target)),f=t._getKeyboardExtension().isInActionMode(),u=c._isKeyCombination(i,null,a.CTRL)||f;return f&&r.isOfType(l.DATACELL)?(t._getKeyboardExtension().setSilentFocus(t.getDomRef("focusDummy")),setTimeout((function(){t._getScrollExtension().scrollVertically(!0===o,n)}),0)):t._getScrollExtension().scrollVertically(!0===o,n),p(t).then((function(){s?s():u&&D(t,r.type,r.rowIndex,r.columnIndex,!0)}))}function R(e,t){var i=e._getRowCounts();m(e,t,!1,(function(){y(e,i.fixedTop+i.scrollable-1)}))||(i.fixedBottom>0?y(e,i.fixedTop+i.scrollable):e._getKeyboardExtension().setActionMode(!1))}function y(t,i){var o=t.getRows()[i];if(o.isGroupHeader()||e.isRowSelectorSelectionAllowed(t))D(t,l.ROWHEADER,i);else{var n=c._getFirstInteractiveElement(o);n?c._focusElement(t,n[0]):(D(t,l.DATACELL,i,0,!1,!0),o.getIndex()===t._getTotalRowCount()-1&&t._getKeyboardExtension().setActionMode(!1))}}function A(e,t){var i=e._getRowCounts();E(e,t,!1,(function(){v(e,i.fixedTop)}))||(i.fixedTop>0?v(e,i.fixedTop-1):e._getKeyboardExtension().setActionMode(!1))}function v(t,i){var o=t.getRows()[i],n=o.isGroupHeader()||e.isRowSelectorSelectionAllowed(t),s=c._getLastInteractiveElement(o);s?c._focusElement(t,s[0]):n?D(t,l.ROWHEADER,i):(D(t,l.DATACELL,i,0,!1,!0),0===o.getIndex()&&t._getKeyboardExtension().setActionMode(!1))}function O(t,i){var o=e.getFocusedItemInfo(t),n=t._getKeyboardExtension().getLastFocusedCellInfo();e.focusItem(t,o.cellInRow+o.columnCount*n.row,i)}function x(t,i){var o=e.getFocusedItemInfo(t);e.focusItem(t,o.cellInRow,i)}function _(e,t){e._getKeyboardExtension().setSilentFocus(e.$().find("."+t))}function w(t,i){var o=e.getCell(t,i),n=e.getCellInfo(o);return t.getRows()[n.rowIndex]}function b(t,i){var o=e.getCellInfo(i.target);if(o.isOfType(l.COLUMNROWHEADER))t._getSelectionPlugin().onHeaderSelectorPress();else if(c._allowsToggleExpandedState(t,i.target))w(t,i.target).toggleExpandedState();else if(o.isOfType(l.ROWHEADER))s();else if(o.isOfType(l.DATACELL|l.ROWACTION)){var n=!t.hasListeners("cellClick");if(t._findAndfireCellEvent(t.fireCellClick,i)||e.isRowSelectionAllowed(t)&&(s(),n=!1),n)e.getInteractiveElements(i.target)&&t._getKeyboardExtension().setActionMode(!0)}function s(){var o=null;t._legacyMultiSelection&&(o=function(e){t._legacyMultiSelection(e.getIndex(),i)}),e.toggleRowSelection(t,i.target,null,o)}}function L(t,i){var o,n=t.getParent(),s=n._getVisibleColumns(),l=s.indexOf(t);i&&l<s.length-1?o=n.indexOfColumn(s[l+1])+1:!i&&l>0&&(o=n.indexOfColumn(s[l-1])),null!=o&&e.Column.moveColumnTo(t,o)}function N(e,t){for(var i=e.getColumns().filter((function(e){return e.getVisible()||!!e.getGrouped&&e.getGrouped()})),o=0;o<i.length;o++){if(i[o]===t)return o}return-1}function S(t,i,o){o?e.toggleRowSelection(t,i,!1):t._oRangeSelection.selected?e.toggleRowSelection(t,i,!0):e.toggleRowSelection(t,i,!1)}function D(t,i,o,n,s,r){if(!(!t||null==i||null==o||o<0||o>=t.getRows().length)){var a,f=t.getRows()[o];if(i!==l.ROWHEADER){if(i===l.ROWACTION)a=t.getDomRef("rowact"+o);else if(i===l.DATACELL&&null!=n&&n>=0){var u=t.getColumns()[n],g=N(t,u);g>=0&&(a=f.getDomRef("col"+g))}if(a){if(s){var d=e.getInteractiveElements(a);if(d)return void c._focusElement(t,d[0])}r&&(t._getKeyboardExtension()._bStayInActionMode=!0),a.focus()}}else t._getKeyboardExtension().setFocus(t.getDomRef("rowsel"+o))}}function M(e){return e.classList.contains("sapUiTableTreeIconNodeOpen")||e.classList.contains("sapUiTableTreeIconNodeClosed")}function K(t){var i=e.getRowIndexOfFocusedCell(t);if(-1!==i){var o=t.getRows()[i];if(void 0!==o){var n=o.getIndex(),s=t._getSelectionPlugin();t._oRangeSelection={startIndex:n,selected:s.isSelected(o)}}}}return c._isKeyCombination=function(e,t,i){null==i&&(i=0);var s="string"==typeof t?String.fromCharCode(e.charCode):e.keyCode,l=0;return l|=(o.os.macintosh?e.metaKey:e.ctrlKey)&&t!==n.CONTROL?a.CTRL:0,l|=e.shiftKey&&t!==n.SHIFT?a.SHIFT:0,l|=e.altKey&&t!==n.ALT?a.ALT:0,(null==t||s===t)&&i===l},c._focusElement=function(e,t,i){e&&t&&(null==i&&(i=!1),i?e._getKeyboardExtension().setSilentFocus(t):t.focus(),t instanceof window.HTMLInputElement&&t.select())},c._allowsToggleExpandedState=function(t,i){return e.Grouping.isInGroupHeaderRow(i)||e.Grouping.isInTreeMode(t)&&i.classList.contains("sapUiTableCellFirst")&&(i.querySelector(".sapUiTableTreeIconNodeOpen")||i.querySelector(".sapUiTableTreeIconNodeClosed"))||M(i)},c._isElementInteractive=function(t){return!!t&&jQuery(t).is(e.INTERACTIVE_ELEMENT_SELECTORS)},c._getFirstInteractiveElement=function(t){var i=e.getFirstInteractiveElement(t,!0);return i?jQuery(i):null},c._getLastInteractiveElement=function(t){if(!t)return null;var i,o,n=t.getParent(),s=t.getCells();e.hasRowActions(n)&&s.push(t.getRowAction());for(var l=s.length-1;l>=0;l--)if(i=e.getParentCell(n,s[l].getDomRef()),o=e.getInteractiveElements(i))return o.last();return null},c._getPreviousInteractiveElement=function(t,i){if(!t||!i)return null;var o=jQuery(i);if(!this._isElementInteractive(o))return null;var n,s,r,a,f,u,g=e.getParentCell(t,i);if((n=e.getInteractiveElements(g))[0]!==o[0])return n.eq(n.index(i)-1);s=e.getCellInfo(g),a=t.getRows()[s.rowIndex].getCells(),s.isOfType(l.ROWACTION)?u=a.length-1:(f=t.getColumns()[s.columnIndex],u=N(t,f)-1);for(var c=u;c>=0;c--)if(r=a[c].getDomRef(),g=e.getParentCell(t,r),n=e.getInteractiveElements(g))return n.last();return null},c._getNextInteractiveElement=function(t,i){if(!t||!i)return null;var o=jQuery(i);if(!this._isElementInteractive(o))return null;var n,s,r,a,f,u,g=e.getParentCell(t,i);if((n=e.getInteractiveElements(g)).get(-1)!==o[0])return n.eq(n.index(i)+1);if((s=e.getCellInfo(g)).isOfType(l.ROWACTION))return null;a=(u=t.getRows()[s.rowIndex]).getCells(),f=t.getColumns()[s.columnIndex];for(var c=N(t,f)+1;c<a.length;c++)if(r=a[c].getDomRef(),g=e.getParentCell(t,r),n=e.getInteractiveElements(g))return n.first();return e.hasRowActions(t)&&(g=e.getParentCell(t,u.getRowAction().getDomRef()),(n=e.getInteractiveElements(g)).get(-1)!==o[0])?n.eq(n.index(i)+1):null},c.prototype.enterActionMode=function(){var t=this._getKeyboardExtension(),i=document.activeElement,o=e.getInteractiveElements(i),n=e.getParentCell(this,i);return!e.getCellInfo(n).isOfType(l.ANYCOLUMNHEADER)&&(o?(t.suspendItemNavigation(),i.tabIndex=-1,c._focusElement(this,o[0],!0),!0):!!n&&(this._getKeyboardExtension().suspendItemNavigation(),!0))},c.prototype.leaveActionMode=function(t){t=null==t||t;var i=this._getKeyboardExtension(),o=document.activeElement,n=e.getParentCell(this,o);if(i.resumeItemNavigation(),t)if(n)c._focusElement(this,n[0],!0);else{var s=this._getItemNavigation();if(s){var l=s.aItemDomRefs.indexOf(o);l>-1&&s.setFocusedIndex(l)}i.setSilentFocus(o)}},c.prototype.onfocusin=function(t){if(!t.isMarked("sapUiTableIgnoreFocusIn")){var i=jQuery(t.target);if(i.hasClass("sapUiTableOuterBefore")||i.hasClass("sapUiTableOuterAfter")||t.target!=this.getDomRef("overlay")&&this.getShowOverlay())this.$("overlay").trigger("focus");else if(i.hasClass("sapUiTableCtrlBefore")){var o=e.isNoDataVisible(this);!o||o&&this.getColumnHeaderVisible()?x(this,t):this._getKeyboardExtension().setSilentFocus(this.$("noDataCnt"))}else i.hasClass("sapUiTableCtrlAfter")&&(e.isNoDataVisible(this)||O(this,t));var n=e.getCellInfo(t.target),s=n.isOfType(l.ROWHEADER)&&e.Grouping.isInGroupHeaderRow(t.target),r=n.isOfType(l.ROWHEADER)&&!s&&e.isRowSelectorSelectionAllowed(this),a=n.isOfType(l.DATACELL)&&this._getKeyboardExtension()._bStayInActionMode,f=e.getCellInfo(e.getParentCell(this,t.target)).isOfType(l.ANYCONTENTCELL),u=c._isElementInteractive(t.target),g=this._getKeyboardExtension().isInActionMode()&&(s||r||a)||u&&f;a&&(this._getKeyboardExtension()._bStayInActionMode=!1),this._getKeyboardExtension().setActionMode(g,!1)}},c.prototype.onkeydown=function(t){if(!t.isMarked()){var i=this._getKeyboardExtension(),o=e.getCellInfo(t.target),s=this.getSelectionMode(),f=this._getSelectionPlugin();if(c._isKeyCombination(t,n.F2)){var u=i.isInActionMode(),g=e.getCell(this,t.target),d=null!=e.getParentCell(this,t.target);if(o=e.getCellInfo(g),!u&&d)g.trigger("focus");else if(o.isOfType(l.ANYCOLUMNHEADER)){var C=e.getInteractiveElements(g);C&&C[0].focus()}else i.setActionMode(!u)}else c._isKeyCombination(t,n.F4)&&c._allowsToggleExpandedState(this,t.target)?w(this,t.target).toggleExpandedState():c._isKeyCombination(t,n.SPACE)&&M(t.target)?t.preventDefault():!this._getKeyboardExtension().isInActionMode()&&o.isOfType(l.ANY)&&(c._isKeyCombination(t,n.SPACE)&&t.preventDefault(),c._isKeyCombination(t,n.SHIFT)&&s===r.MultiToggle&&(o.isOfType(l.ROWHEADER)&&e.isRowSelectorSelectionAllowed(this)||o.isOfType(l.DATACELL|l.ROWACTION))?K(this):c._isKeyCombination(t,n.A,a.CTRL)?(t.preventDefault(),o.isOfType(l.ANYCONTENTCELL|l.COLUMNROWHEADER)&&s===r.MultiToggle&&f.onKeyboardShortcut("toggle",t)):c._isKeyCombination(t,n.A,a.CTRL+a.SHIFT)?o.isOfType(l.ANYCONTENTCELL|l.COLUMNROWHEADER)&&f.onKeyboardShortcut("clear",t):c._isKeyCombination(t,n.F4)&&o.isOfType(l.DATACELL)&&i.setActionMode(!0))}},c.prototype.onkeypress=function(t){if(!t.isMarked()){var i=this._getKeyboardExtension(),o=e.getCellInfo(t.target);c._isKeyCombination(t,"+")?c._allowsToggleExpandedState(this,t.target)?w(this,t.target).expand():o.isOfType(l.DATACELL|l.ROWACTION)&&i.setActionMode(!0):c._isKeyCombination(t,"-")&&(c._allowsToggleExpandedState(this,t.target)?w(this,t.target).collapse():o.isOfType(l.DATACELL|l.ROWACTION)&&i.setActionMode(!0))}},c.prototype.oncontextmenu=function(t){t.isMarked("sapUiTableHandledByPointerExtension")||e.getCellInfo(document.activeElement).isOfType(l.ANY)&&(t.preventDefault(),e.Menu.openContextMenu(this,t))},c.prototype.onkeyup=function(t){if(!t.isMarked()){var i=jQuery(t.target).closest(".sapUiTableDataCell").attr("id");if("function"!=typeof i.startsWith||!1!==i.startsWith(this.getId())){var o=e.getCellInfo(t.target);c._isKeyCombination(t,n.SHIFT)&&delete this._oRangeSelection,o.isOfType(l.COLUMNHEADER)?(c._isKeyCombination(t,n.SPACE)||c._isKeyCombination(t,n.ENTER))&&e.Menu.openContextMenu(this,t):c._isKeyCombination(t,n.SPACE)?b(this,t):c._isKeyCombination(t,n.SPACE,a.SHIFT)?(e.toggleRowSelection(this,o.rowIndex),K(this)):this._legacyMultiSelection&&!o.isOfType(l.COLUMNROWHEADER)&&(c._isKeyCombination(t,n.SPACE,a.CTRL)||c._isKeyCombination(t,n.ENTER,a.CTRL))&&b(this,t)}}},c.prototype.onsaptabnext=function(t){var i,o=this._getKeyboardExtension(),n=e.getCellInfo(t.target);if(o.isInActionMode()){var s;if(i=e.getCell(this,t.target),!(n=e.getCellInfo(i)).isOfType(l.ANYCONTENTCELL))return;var r=this.getRows()[n.rowIndex],a=c._getLastInteractiveElement(r);if(null===a||a[0]===t.target){var f=r.getIndex(),u=e.isLastScrollableRow(this,i),g=this._getTotalRowCount()-1===f,d=e.isRowSelectorSelectionAllowed(this);if(t.preventDefault(),g)o.setActionMode(!1);else if(u)R(this,t);else{var C=n.rowIndex;if(d)D(this,l.ROWHEADER,C+1);else{for(var h=this.getRows().length,p=!1,I=n.rowIndex+1;I<h&&(C=I,r=this.getRows()[C],s=c._getFirstInteractiveElement(r),p=r.isGroupHeader(),!s&&!p);I++);s?c._focusElement(this,s[0]):p?D(this,l.ROWHEADER,C):R(this,t)}}}else n.isOfType(l.ROWHEADER)?(t.preventDefault(),s=c._getFirstInteractiveElement(r),c._focusElement(this,s[0])):(t.preventDefault(),s=c._getNextInteractiveElement(this,t.target),c._focusElement(this,s[0]))}else n.isOfType(l.ANYCOLUMNHEADER)?this.getCreationRow()&&this.getCreationRow().getVisible()&&!e.hasData(this)?_(this,"sapUiTableCtrlAfter"):e.isNoDataVisible(this)?(this.$("noDataCnt").trigger("focus"),t.preventDefault()):this.getRows().length>0&&(O(this,t),t.preventDefault()):n.isOfType(l.ANYCONTENTCELL)?_(this,"sapUiTableCtrlAfter"):t.target===this.getDomRef("overlay")?o.setSilentFocus(this.$().find(".sapUiTableOuterAfter")):n.isOfType(l.ANY)||(i=e.getParentCell(this,t.target))&&(t.preventDefault(),i.trigger("focus"))},c.prototype.onsaptabprevious=function(t){var i,o=this._getKeyboardExtension(),n=e.getCellInfo(t.target);if(o.isInActionMode()){var s;if(i=e.getCell(this,t.target),!(n=e.getCellInfo(i)).isOfType(l.ANYCONTENTCELL))return;var r=this.getRows()[n.rowIndex],a=r.getIndex(),f=c._getFirstInteractiveElement(r),u=null!==f&&f[0]===t.target,g=e.isRowSelectorSelectionAllowed(this)||r.isGroupHeader();if(u&&g)t.preventDefault(),D(this,l.ROWHEADER,n.rowIndex);else if(u&&!g||n.isOfType(l.ROWHEADER)||null===f){var d=e.isFirstScrollableRow(this,i),C=0===a;if(t.preventDefault(),C)o.setActionMode(!1);else if(d)A(this,t);else{for(var h=n.rowIndex,p=!1,I=n.rowIndex-1;I>=0&&(h=I,r=this.getRows()[h],s=c._getLastInteractiveElement(r),p=r.isGroupHeader(),!(s||g||p));I--);s?c._focusElement(this,s[0]):p||g?D(this,l.ROWHEADER,h):A(this,t)}}else t.preventDefault(),s=c._getPreviousInteractiveElement(this,t.target),c._focusElement(this,s[0])}else n.isOfType(l.ANYCONTENTCELL)||t.target===this.getDomRef("noDataCnt")?this.getColumnHeaderVisible()&&!n.isOfType(l.ROWACTION)?(x(this,t),t.preventDefault()):_(this,"sapUiTableCtrlBefore"):t.target===this.getDomRef("overlay")?this._getKeyboardExtension().setSilentFocus(this.$().find(".sapUiTableOuterBefore")):n.isOfType(l.ANY)||(i=e.getParentCell(this,t.target))&&(t.preventDefault(),i.trigger("focus"))},c.prototype.onsapdown=function(e){g(e),d(this,e)},c.prototype.onsapdownmodifiers=function(t){if(t.isMarked())u(t);else if(g(t),c._isKeyCombination(t,null,a.CTRL))d(this,t);else{var i=this._getKeyboardExtension();if(c._isKeyCombination(t,null,a.ALT)&&c._allowsToggleExpandedState(this,t.target))return u(t),void w(this,t.target).expand();if(!i.isInActionMode()){var o=e.getCellInfo(t.target);if(c._isKeyCombination(t,null,a.SHIFT))if(o.isOfType(l.ANYCONTENTCELL)){if(!this._oRangeSelection)return void u(t);var n,s=e.getRowIndexOfFocusedCell(this),r=this.getRows()[s].getIndex(),f=this._oRangeSelection.startIndex>r;if(r===this._getTotalRowCount()-1)return;if(e.isLastScrollableRow(this,t.target)){if(this._oRangeSelection.pScroll)return void u(t);n=m(this,t),this._oRangeSelection.pScroll=n}n?(u(t),n.then(function(){return I(this)}.bind(this)).then(function(){S(this,s-(f?1:0),f),delete this._oRangeSelection.pScroll}.bind(this))):S(this,s+(f?0:1),f)}else u(t);c._isKeyCombination(t,null,a.ALT)&&(o.isOfType(l.DATACELL)&&i.setActionMode(!0),u(t))}}},c.prototype.onsapup=function(e){g(e),C(this,e)},c.prototype.onsapupmodifiers=function(t){if(t.isMarked())u(t);else if(g(t),c._isKeyCombination(t,null,a.CTRL))C(this,t);else{if(c._isKeyCombination(t,null,a.ALT)&&c._allowsToggleExpandedState(this,t.target))return u(t),void w(this,t.target).collapse();var i=this._getKeyboardExtension();if(!i.isInActionMode()){var o=e.getCellInfo(t.target);if(c._isKeyCombination(t,null,a.SHIFT))if(o.isOfType(l.ANYCONTENTCELL)){if(!this._oRangeSelection)return void u(t);var n,s=e.getRowIndexOfFocusedCell(this),r=this.getRows()[s].getIndex(),f=this._oRangeSelection.startIndex<r;if(0===r)return void u(t);if(e.isFirstScrollableRow(this,t.target)){if(this._oRangeSelection.pScroll)return void u(t);n=E(this,t),this._oRangeSelection.pScroll=n}n?(u(t),n.then(function(){return I(this)}.bind(this)).then(function(){S(this,f?1:0,f),delete this._oRangeSelection.pScroll}.bind(this))):S(this,s-(f?0:1),f)}else u(t);c._isKeyCombination(t,null,a.ALT)&&(o.isOfType(l.DATACELL)&&i.setActionMode(!0),u(t))}}},c.prototype.onsapleft=function(t){g(t),function(t,i){if(!i.isMarked()){var o=e.getCellInfo(e.getCell(t,i.target)),n=s.getRTL();if(o.isOfType(l.COLUMNHEADER)&&n){var r=e.getFocusedItemInfo(t).cellInRow-(e.hasRowHeader(t)?1:0),a=e.getVisibleColumnCount(t);e.hasRowActions(t)&&r===a-1&&u(i)}}}(this,t)},c.prototype.onsapleftmodifiers=function(t){if(t.isMarked())u(t);else if(g(t),!this._getKeyboardExtension().isInActionMode()){var i=e.getCellInfo(t.target),o=s.getRTL();if(c._isKeyCombination(t,null,a.SHIFT)){if(i.isOfType(l.DATACELL)){if(!this._oRangeSelection)return void u(t);var n=e.getFocusedItemInfo(this);e.hasRowHeader(this)&&1===n.cellInRow&&!e.isRowSelectorSelectionAllowed(this)&&u(t)}else if(i.isOfType(l.ROWACTION))this._oRangeSelection||u(t);else if(i.isOfType(l.ROWHEADER)&&o)e.isRowSelectionAllowed(this)||u(t);else if(i.isOfType(l.COLUMNROWHEADER)&&o)u(t);else if(i.isOfType(l.COLUMNHEADER)){var r=-e.convertCSSSizeToPixel(f),d=0;o&&(r*=-1);for(var C=i.columnIndex;C<i.columnIndex+i.columnSpan;C++)d+=e.Column.getColumnWidth(this,C);e.Column.resizeColumn(this,i.columnIndex,d+r,!0,i.columnSpan),u(t)}}else c._isKeyCombination(t,null,a.CTRL)?i.isOfType(l.COLUMNHEADER)&&(u(t),L(this.getColumns()[i.columnIndex],o)):c._isKeyCombination(t,null,a.ALT)&&u(t)}},c.prototype.onsaprightmodifiers=function(t){if(t.isMarked())u(t);else if(g(t),!this._getKeyboardExtension().isInActionMode()){var i=e.getCellInfo(t.target),o=s.getRTL();if(c._isKeyCombination(t,null,a.SHIFT))if(i.isOfType(l.DATACELL))this._oRangeSelection||u(t);else if(i.isOfType(l.ROWHEADER))e.isRowSelectionAllowed(this)||u(t);else if(i.isOfType(l.ROWACTION)&&o)this._oRangeSelection||u(t);else if(i.isOfType(l.COLUMNHEADER)){var n=e.convertCSSSizeToPixel(f),r=0;o&&(n*=-1);for(var d=i.columnIndex;d<i.columnIndex+i.columnSpan;d++)r+=e.Column.getColumnWidth(this,d);e.Column.resizeColumn(this,i.columnIndex,r+n,!0,i.columnSpan),u(t)}else i.isOfType(l.COLUMNROWHEADER)&&u(t);else c._isKeyCombination(t,null,a.CTRL)?i.isOfType(l.COLUMNHEADER)&&(u(t),L(this.getColumns()[i.columnIndex],!o)):c._isKeyCombination(t,null,a.ALT)&&u(t)}},c.prototype.onsaphome=function(t){if(g(t),!this._getKeyboardExtension().isInActionMode())if(e.Grouping.isInGroupHeaderRow(t.target))u(t);else if(e.getCellInfo(t.target).isOfType(l.DATACELL|l.ROWACTION|l.COLUMNHEADER)){var i=e.getFocusedItemInfo(this),o=i.cell,n=i.cellInRow,s=this.getComputedFixedColumnCount(),r=e.hasRowHeader(this),a=r?1:0;e.hasFixedColumns(this)&&n>s+a?(u(t),e.focusItem(this,o-n+s+a,null)):r&&n>1&&(u(t),e.focusItem(this,o-n+a,null))}},c.prototype.onsapend=function(t){if(g(t),!this._getKeyboardExtension().isInActionMode())if(e.Grouping.isInGroupHeaderRow(t.target))u(t);else{var i=e.getCellInfo(t.target);if(i.isOfType(l.ANY)){var o=e.getFocusedItemInfo(this),n=o.cell,s=o.columnCount,r=this.getComputedFixedColumnCount(),a=o.cellInRow,f=e.hasRowHeader(this),c=f?1:0,d=!1;if(i.isOfType(l.COLUMNHEADER)&&e.hasFixedColumns(this)){var C=parseInt(i.cell.attr("colspan")||1);C>1&&a+C-c===r&&(d=!0)}f&&0===a?(u(t),e.focusItem(this,n+1,null)):e.hasFixedColumns(this)&&a<r-1+c&&!d?(u(t),e.focusItem(this,n+r-a,null)):e.hasRowActions(this)&&i.isOfType(l.DATACELL)&&a<s-2&&(u(t),e.focusItem(this,n-a+s-2,null))}}},c.prototype.onsaphomemodifiers=function(t){if(g(t),!this._getKeyboardExtension().isInActionMode()&&c._isKeyCombination(t,null,a.CTRL)){var i=e.getCellInfo(t.target);if(i.isOfType(l.ANYCONTENTCELL|l.COLUMNHEADER)){u(t);var o=e.getFocusedItemInfo(this),n=o.row;if(n>0){var s=o.cell,r=o.columnCount,f=e.getHeaderRowCount(this),d=this._getRowCounts();n<f+d.fixedTop?i.isOfType(l.ROWACTION)?e.focusItem(this,s-r*(n-f),t):e.focusItem(this,s-r*n,t):n>=f+d.fixedTop&&n<f+e.getNonEmptyRowCount(this)-d.fixedBottom?(this._getScrollExtension().scrollVerticallyMax(!1),d.fixedTop>0||i.isOfType(l.ROWACTION)?e.focusItem(this,s-r*(n-f),t):e.focusItem(this,s-r*n,t)):(this._getScrollExtension().scrollVerticallyMax(!1),e.focusItem(this,s-r*(n-f-d.fixedTop),t))}}}},c.prototype.onsapendmodifiers=function(t){if((g(t),!this._getKeyboardExtension().isInActionMode())&&(c._isKeyCombination(t,null,a.CTRL)&&e.getCellInfo(t.target).isOfType(l.ANY))){var i=e.getFocusedItemInfo(this),o=i.row,n=e.getHeaderRowCount(this),s=e.getNonEmptyRowCount(this),r=this._getRowCounts();if(u(t),0===r.fixedBottom||o<n+s-1||e.isNoDataVisible(this)&&o<n-1){var f=i.cell,d=i.columnCount;e.isNoDataVisible(this)?e.focusItem(this,f+d*(n-o-1),t):o<n?r.fixedTop>0?e.focusItem(this,f+d*(n+r.fixedTop-o-1),t):(this._getScrollExtension().scrollVerticallyMax(!0),e.focusItem(this,f+d*(n+s-r.fixedBottom-o-1),t)):o>=n&&o<n+r.fixedTop?(this._getScrollExtension().scrollVerticallyMax(!0),e.focusItem(this,f+d*(n+s-r.fixedBottom-o-1),t)):o>=n+r.fixedTop&&o<n+s-r.fixedBottom?(this._getScrollExtension().scrollVerticallyMax(!0),e.focusItem(this,f+d*(n+s-o-1),t)):e.focusItem(this,f+d*(n+s-o-1),t)}}},c.prototype.onsappageup=function(t){if(g(t),!this._getKeyboardExtension().isInActionMode()){var i=e.getCellInfo(t.target);if(i.isOfType(l.ANYCONTENTCELL|l.COLUMNHEADER)){var o=e.getFocusedItemInfo(this),n=o.row,s=e.getHeaderRowCount(this),r=this._getRowCounts();if(0===r.fixedTop&&n>=s||r.fixedTop>0&&n>s){u(t);var a=o.cell,f=o.columnCount;if(n<s+r.fixedTop)e.focusItem(this,a-f*(n-s),t);else if(n===s+r.fixedTop){var c=e.getNonEmptyRowCount(this)-r.fixedTop-r.fixedBottom,d=this.getFirstVisibleRow();E(this,t,!0),d<c&&(r.fixedTop>0||i.isOfType(l.ROWACTION)?e.focusItem(this,a-f*(n-s),t):e.focusItem(this,a-f*s,t))}else n>s+r.fixedTop&&n<s+e.getNonEmptyRowCount(this)?e.focusItem(this,a-f*(n-s-r.fixedTop),t):e.focusItem(this,a-f*(n-s-e.getNonEmptyRowCount(this)+1),t)}i.isOfType(l.ROWACTION)&&n===s&&r.fixedTop>0&&u(t)}}},c.prototype.onsappagedown=function(t){if(g(t),!this._getKeyboardExtension().isInActionMode()){var i=e.getCellInfo(t.target);if(i.isOfType(l.ANY)){var o=e.getFocusedItemInfo(this),n=o.row,s=e.getHeaderRowCount(this),r=e.getNonEmptyRowCount(this),a=this._getRowCounts();if(u(t),e.isNoDataVisible(this)&&n<s-1||0===a.fixedBottom||n<s+r-1){var f=o.cell,c=o.columnCount;if(n<s-1&&!i.isOfType(l.COLUMNROWHEADER))e.focusItem(this,f+c*(s-n-1),t);else if(n<s)e.isNoDataVisible(this)||e.focusItem(this,f+c*(s-n),t);else if(n>=s&&n<s+r-a.fixedBottom-1)e.focusItem(this,f+c*(s+r-a.fixedBottom-n-1),t);else if(n===s+r-a.fixedBottom-1){var d=e.getNonEmptyRowCount(this)-a.fixedTop-a.fixedBottom,C=this._getTotalRowCount()-a.fixedBottom-this.getFirstVisibleRow()-2*d;m(this,t,!0),C<d&&a.fixedBottom>0&&e.focusItem(this,f+c*(s+r-n-1),t)}else e.focusItem(this,f+c*(s+r-n-1),t)}}}},c.prototype.onsappageupmodifiers=function(t){if(g(t),!this._getKeyboardExtension().isInActionMode()&&c._isKeyCombination(t,null,a.ALT)){var i=e.getCellInfo(t.target),o=e.getFocusedItemInfo(this);if(i.isOfType(l.DATACELL|l.COLUMNHEADER)){var n=o.cell,s=o.cellInRow,r=e.hasRowHeader(this),f=r?1:0;u(t),r&&(e.Grouping.isInGroupHeaderRow(t.target)||1===s)?e.focusItem(this,n-s,null):s-f<5?e.focusItem(this,n-s+f,null):e.focusItem(this,n-5,null)}else i.isOfType(l.ROWACTION)&&e.focusItem(this,o.cell-1,null)}},c.prototype.onsappagedownmodifiers=function(t){if(g(t),!this._getKeyboardExtension().isInActionMode()&&c._isKeyCombination(t,null,a.ALT)){var i=e.getCellInfo(t.target);if(i.isOfType(l.DATACELL|l.ROWHEADER|l.ANYCOLUMNHEADER)){var o=e.getFocusedItemInfo(this),n=o.cellInRow,s=e.hasRowHeader(this),r=s?1:0,f=e.getVisibleColumnCount(this),d=parseInt(i.cell.attr("colspan")||1);if(u(t),n+d-r<f){var C=o.cell;s&&0===n?e.focusItem(this,C+1,null):d>5?e.focusItem(this,C+d,null):n+d-r+5>f?e.focusItem(this,C+f-n-1+r,null):e.Grouping.isInGroupHeaderRow(t.target)||e.focusItem(this,C+5,null)}else i.isOfType(l.DATACELL)&&e.hasRowActions(this)&&n===o.columnCount-2&&e.focusItem(this,o.cell+1,null)}}},c.prototype.onsapenter=function(e){b(this,e)},c}));