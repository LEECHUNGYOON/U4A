sap.ui.define(["./library","./Core","./DrawerToolbarRenderer","sap/ui/core/Control","sap/ui/core/IconPool","sap/ui/core/ResizeHandler","sap/ui/Device","sap/m/VBox","sap/m/FlexItemData","sap/m/OverflowToolbar","sap/ui/core/Icon","sap/m/Button","sap/m/ToolbarSeparator","sap/m/OverflowToolbarToggleButton","sap/m/ToggleButton","sap/m/MenuButton","./tools/RectSelectTool","./tools/CrossSectionTool","sap/m/Menu","sap/m/MenuItem","./NavigationMode","./ZoomTo","./getResourceBundle","./ToggleMenuButton","./ToggleMenuItem","./Viewport","./DrawerToolbarButton","sap/ui/base/ManagedObjectObserver","sap/ui/core/Core","./tools/HighlightMeasurementTool","./tools/CalibrateDistanceMeasurementTool","./tools/DeleteMeasurementTool","./tools/DistanceMeasurementTool","./tools/AngleMeasurementTool","./tools/AreaMeasurementTool","./thirdparty/three"],(function(e,t,n,i,s,o,a,r,l,c,u,m,d,h,_,g,p,T,v,w,b,I,M,f,S,y,E,x,V,R,B,C,P,A,O,D){"use strict";var F=i.extend("sap.ui.vk.DrawerToolbar",{metadata:{library:"sap.ui.vk",properties:{expanded:{type:"boolean",defaultValue:!0},navigationMode:{type:"sap.ui.vk.NavigationMode",defaultValue:b.Turntable}},aggregations:{content:{type:"sap.ui.core.Control",multiple:!0,forwarding:{getter:"_getToolbar",aggregation:"content",forwardBinding:!0}},_container:{type:"sap.m.VBox",multiple:!1,visibility:"hidden"}},associations:{viewport:{type:"sap.ui.vk.ViewportBase",multiple:!1}},events:{expanded:{parameters:{expand:{type:"boolean"}}}}},constructor:function(e,t){i.apply(this,arguments)}});[{name:"show",unicode:"e900"},{name:"hide",unicode:"e901"},{name:"turntable",unicode:"e902"},{name:"orbit",unicode:"e903"},{name:"pan",unicode:"e904"},{name:"zoom",unicode:"e905"},{name:"fit-to-view",unicode:"e906"},{name:"rectangular-selection",unicode:"e907"},{name:"predefined-views",unicode:"e93c"},{name:"predefined-views-left",unicode:"e94b"},{name:"predefined-views-right",unicode:"e94c"},{name:"predefined-views-top",unicode:"e94d"},{name:"predefined-views-bottom",unicode:"e949"},{name:"predefined-views-front",unicode:"e948"},{name:"predefined-views-back",unicode:"e94a"},{name:"cross-section",unicode:"e913"},{name:"cross-section-x",unicode:"e914"},{name:"cross-section-y",unicode:"e916"},{name:"cross-section-z",unicode:"e915"},{name:"reverse-direction",unicode:"e917"},{name:"distance-measurement",unicode:"e92b"},{name:"angle-measurement",unicode:"e926"},{name:"area-measurement",unicode:"e963"},{name:"settings",unicode:"e909"},{name:"calibrate-distance",unicode:"e968"},{name:"toggle-pmi",unicode:"e96d"}].forEach((function(e){s.addIcon(e.name,"vk-icons","vk-icons",e.unicode)}));var N="sap-icon://vk-icons/";function L(e){return!!e&&"sap.ui.vk.threejs.Viewport"===e.getMetadata().getName()}function k(e){return!!e&&"sap.ui.vk.NativeViewport"===e.getMetadata().getName()}function H(e){var t=e.getCurrentView&&e.getCurrentView(),n=t&&t.getDimension();return L(e)&&!e._redlineHandler&&!e._isPlanarActivated()&&2!==n}F.prototype.init=function(){i.prototype.init&&i.prototype.init.apply(this),this._measurementsToggleButton=null,this._distanceMeasurementItem=null,this._angleMeasurementItem=null,this._areaMeasurementItem=null,this._deleteMeasurementItem=null,this._measurementSettingsItem=null,this._calibrateDistanceMeasurementItem=null,this._itemsVisibility=new Map,this._itemsVisibilityObserver=new x(this._itemVisibilityChanged.bind(this)),this._toolbar=new c({width:"auto",design:sap.m.ToolbarDesign.Solid,layoutData:new l({growFactor:0,shrinkFactor:0}),content:this.createButtons()}).addStyleClass("drawerToolbarMaxWidth").data("help-id","sapUiVkToolbar",!0),this._toolbar.ontouchstart=function(e){e.setMarked()},this._toolbarObserver=new x(this._toolbarContentChanged.bind(this)),this._toolbarObserver.observe(this._toolbar,{aggregations:["content"]}),this._container=new r({renderType:sap.m.FlexRendertype.Bare,alignContent:sap.m.FlexAlignContent.Center,alignItems:sap.m.FlexAlignItems.Center,items:[this._toolbar,new u({src:"sap-icon://navigation-up-arrow",noTabStop:!0,press:function(e){this._toggleExpanded()}.bind(this),layoutData:new l({growFactor:0,shrinkFactor:0})}).addStyleClass("drawerToolbarIcon")]}).data("help-id","sapUiVkToolbarContainer",!0),this.setAggregation("_container",this._container),this._rectSelectTool=new p,this._distanceMeasurementTool=new P({enabled:[function(e){this._measurementsToggleButton.getDefaultItem()===this._distanceMeasurementItem.getId()&&this._measurementsToggleButton.setPressed(e.getParameter("enabled"))},this]}),this._angleMeasurementTool=new A({enabled:[function(e){this._measurementsToggleButton.getDefaultItem()===this._angleMeasurementItem.getId()&&this._measurementsToggleButton.setPressed(e.getParameter("enabled"))},this]}),this._areaMeasurementTool=new O({enabled:[function(e){this._measurementsToggleButton.getDefaultItem()===this._areaMeasurementItem.getId()&&this._measurementsToggleButton.setPressed(e.getParameter("enabled"))},this]}),this._deleteMeasurementTool=new C({enabled:[function(e){this._measurementsToggleButton.getDefaultItem()===this._deleteMeasurementItem.getId()&&(this._measurementsToggleButton.setPressed(e.getParameter("enabled")),0===this._getViewport().getMeasurementSurface().getMeasurements().length&&this._measurementsToggleButton.setDefaultItem(this._distanceMeasurementItem))},this]}),this._calibrateDistanceMeasurementTool=new B({enabled:[function(e){if(this._measurementsToggleButton.getDefaultItem()===this._calibrateDistanceMeasurementItem.getId()){var t=e.getParameter("enabled");this._measurementsToggleButton.setPressed(t),t||this._measurementsToggleButton.setDefaultItem(this._distanceMeasurementItem)}},this]}),this._highlightMeasurementTool=new R;var e=[this._distanceMeasurementTool,this._angleMeasurementTool,this._areaMeasurementTool,this._deleteMeasurementTool,this._calibrateDistanceMeasurementTool];function n(t){var n=e.find((function(e){return e.getActive()}));this._highlightMeasurementTool.setActive(null==n,this._getViewport())}e.forEach((function(e){e.attachEnabled(n,this)}),this);var s=t.getEventBus();s.subscribe("sap.ui.vk","viewActivated",this._onViewActivated,this),s.subscribe("sap.ui.vk","readyForAnimation",this._onReadyForAnimation,this)},F.prototype.exit=function(){V.getElementById(this.getViewport())?.detachResize(this._onViewportResize,this);var e=t.getEventBus();e.unsubscribe("sap.ui.vk","readyForAnimation",this._onReadyForAnimation,this),e.unsubscribe("sap.ui.vk","viewActivated",this._onViewActivated,this),this._distanceMeasurementTool.destroy(),this._distanceMeasurementTool=null,this._angleMeasurementTool.destroy(),this._angleMeasurementTool=null,this._highlightMeasurementTool.destroy(),this._highlightMeasurementTool=null,this._areaMeasurementTool.destroy(),this._areaMeasurementTool=null,this._deleteMeasurementTool.destroy(),this._deleteMeasurementTool=null,this._calibrateDistanceMeasurementTool.destroy(),this._calibrateDistanceMeasurementTool=null,this._measurementsToggleButton=null,this._distanceMeasurementItem=null,this._angleMeasurementItem=null,this._areaMeasurementItem=null,this._deleteMeasurementItem=null,this._measurementSettingsItem=null,this._calibrateDistanceMeasurementItem=null,this._toolbarObserver.disconnect(),this._toolbarObserver=null,this._toolbar.destroy(),this._toolbar=null},F.prototype._onViewportResize=function(e){this._toolbar.onLayoutDataChange()},F.prototype.setViewport=function(e){V.getElementById(this.getViewport())?.dettachResize(this._onViewportResize,this),this.setAssociation("viewport",e),e?.attachResize(this._onViewportResize,this)},F.prototype._toolbarContentChanged=function(){for(var e=this._toolbar.getContent(),t=0;t<e.length;t++)"sap.m.ToolbarSeparator"==e[t].getMetadata().getName()&&(null!=e[t-1]&&null!=e[t+1]&&"sap.m.ToolbarSeparator"!=e[t-1].getMetadata().getName()||this._toolbar.removeContent(t))},F.prototype._itemVisibilityChanged=function(e){this._ignoreVisiblityChange||this._itemsVisibility.set(e.object,e.current)},F.prototype._getViewport=function(){var e=V.byId(this.getViewport());return(e=e instanceof y&&e.getImplementation()||e)&&(L(e)||function(e){return!!e&&"sap.ui.vk.svg.Viewport"===e.getMetadata().getName()}(e)||k(e))?e:null},F.prototype._getViewStateManager=function(){var e=V.byId(this.getViewport()).getViewStateManager();return e?V.byId(e):null};var z=[null,(new D.Quaternion).setFromAxisAngle(new D.Vector3(0,1,0),0),(new D.Quaternion).setFromAxisAngle(new D.Vector3(0,1,0),Math.PI),(new D.Quaternion).setFromAxisAngle(new D.Vector3(0,1,0),-Math.PI/2),(new D.Quaternion).setFromAxisAngle(new D.Vector3(0,1,0),Math.PI/2),(new D.Quaternion).setFromAxisAngle(new D.Vector3(1,0,0),-Math.PI/2),(new D.Quaternion).setFromAxisAngle(new D.Vector3(1,0,0),Math.PI/2)];F.prototype.createButtons=function(){var e=this,t=M(),n=new f({type:sap.m.ButtonType.Transparent,tooltip:t.getText("CROSS_SECTION_TOOLTIP"),items:[new S({icon:N+"cross-section-x",text:t.getText("CROSS_SECTION_X"),key:0}),new S({icon:N+"cross-section-y",text:t.getText("CROSS_SECTION_Y"),key:1}),new S({icon:N+"cross-section-z",text:t.getText("CROSS_SECTION_Z"),key:2}),new S({icon:N+"reverse-direction",text:t.getText("CROSS_SECTION_REVERSE"),startsSection:!0,toggleable:!1,press:function(t){e._getViewport()&&e._crossSectionTool&&e._crossSectionTool.getActive()&&e._crossSectionTool.setFlip(!e._crossSectionTool.getFlip())}})],itemToggled:function(t){var n=e._getViewport();if(n&&e._crossSectionTool){var i=t.getParameter("newItem");if(e._crossSectionTool.setActive(null!=i,n),i){var s=parseInt(i.getKey(),10);s>=0&&s<3&&e._crossSectionTool.setAxis(s)}}}});n.vitId=E.CrossSection;var i=new _({icon:N+"turntable",type:sap.m.ButtonType.Transparent,tooltip:t.getText("TURNTABLE_TOOLTIP"),press:function(t){e.setNavigationMode(b.Turntable)}});i.vitId=E.Turntable;var s=new _({icon:N+"orbit",type:sap.m.ButtonType.Transparent,tooltip:t.getText("ORBIT_TOOLTIP"),pressed:!1,press:function(t){e.setNavigationMode(b.Orbit)}});s.vitId=E.Orbit;var o=new _({icon:N+"pan",type:sap.m.ButtonType.Transparent,tooltip:t.getText("PAN_TOOLTIP"),press:function(t){e.setNavigationMode(b.Pan)}});o.vitId=E.Pan;var a=new _({icon:N+"zoom",type:sap.m.ButtonType.Transparent,tooltip:t.getText("ZOOM_TOOLTIP"),press:function(){e.setNavigationMode(b.Zoom)}});a.vitId=E.Zoom,this._gestureButtons=[i,s,o,a];var r=new m({icon:N+"show",type:sap.m.ButtonType.Transparent,tooltip:t.getText("SHOW_TOOLTIP"),press:function(){var t=e._getViewStateManager();if(t){var n=[];t.enumerateSelection((function(e){n.push(e)})),t.setVisibilityState(n,!0,!1)}}});r.vitId=E.Show;var l=new m({icon:N+"hide",type:sap.m.ButtonType.Transparent,tooltip:t.getText("HIDE_TOOLTIP"),press:function(){var t=e._getViewStateManager();if(t){var n=[];t.enumerateSelection((function(e){n.push(e)})),t.setVisibilityState(n,!1,!1)}}});l.vitId=E.Hide;var c=new m({icon:N+"fit-to-view",type:sap.m.ButtonType.Transparent,tooltip:t.getText("FIT_TO_VIEW"),press:function(){var t=V.byId(e.getViewport());(t=t instanceof y&&t.getImplementation()||t)&&t.zoomTo(I.All,null,.5,0)}});c.vitId=E.FitToView,this._rectSelectionButton=new _({icon:N+"rectangular-selection",type:sap.m.ButtonType.Transparent,tooltip:t.getText("RECTANGULAR_SELECTION_TOOLTIP")}),this._rectSelectionButton.vitId=E.RectangularSelection;var u=new g({icon:N+"predefined-views",activeIcon:N+"predefined-views",type:sap.m.ButtonType.Transparent,tooltip:t.getText("PREDEFINED_VIEW_MENUBUTTONTOOLTIP"),menu:new v({items:[new w({icon:N+"predefined-views",text:t.getText("PREDEFINED_VIEW_INITIAL")}),new w({icon:N+"predefined-views-front",text:t.getText("PREDEFINED_VIEW_FRONT"),startsSection:!0}),new w({icon:N+"predefined-views-back",text:t.getText("PREDEFINED_VIEW_BACK")}),new w({icon:N+"predefined-views-left",text:t.getText("PREDEFINED_VIEW_LEFT")}),new w({icon:N+"predefined-views-right",text:t.getText("PREDEFINED_VIEW_RIGHT")}),new w({icon:N+"predefined-views-top",text:t.getText("PREDEFINED_VIEW_TOP")}),new w({icon:N+"predefined-views-bottom",text:t.getText("PREDEFINED_VIEW_BOTTOM")})]}).attachItemSelected((function(t){var n=e._getViewport();if(n){var i=t.getParameters("item").item,s=this.indexOfItem(i);n._viewportGestureHandler.setView(z[s],1e3)}}))});u.vitId=E.PredefinedViews;var p=new _({icon:"sap-icon://full-screen",type:sap.m.ButtonType.Transparent,tooltip:t.getText("VIEWER_FULLSCREENBUTTONTOOLTIP"),press:function(t){var n=e._getViewport(),i=function(e){return!!(e.fullScreen||e.webkitIsFullScreen||e.mozFullScreen||e.msFullscreenElement)};if(this.getPressed()){if(!i(document)){e._fullScreenHandler||(e._fullScreenHandler=function(t){i(document)||(document.removeEventListener("fullscreenchange",e._fullScreenHandler),document.removeEventListener("mozfullscreenchange",e._fullScreenHandler),document.removeEventListener("webkitfullscreenchange",e._fullScreenHandler),document.removeEventListener("MSFullscreenChange",e._fullScreenHandler),this.setPressed(!1),n.removeStyleClass("sapVizKitViewerFullScreen"))}.bind(this));var s=document.getElementsByTagName("body")[0];s.requestFullscreen?(document.addEventListener("fullscreenchange",e._fullScreenHandler),s.requestFullscreen()):s.webkitRequestFullScreen?(document.addEventListener("webkitfullscreenchange",e._fullScreenHandler),s.webkitRequestFullscreen()):s.mozRequestFullScreen?(document.addEventListener("mozfullscreenchange",e._fullScreenHandler),s.mozRequestFullScreen()):s.msRequestFullscreen&&(document.addEventListener("MSFullscreenChange",e._fullScreenHandler),s.msRequestFullscreen())}n.addStyleClass("sapVizKitViewerFullScreen")}else i(document)&&(document.cancelFullScreen?document.cancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()),n.removeStyleClass("sapVizKitViewerFullScreen")}});p.vitId=E.FullScreen,this._distanceMeasurementItem=new S({icon:N+"distance-measurement",text:t.getText("MEASUREMENTS_DISTANCE_MENUITEM")}),this._angleMeasurementItem=new S({icon:N+"angle-measurement",text:t.getText("MEASUREMENTS_ANGLE_MENUITEM")}),this._areaMeasurementItem=new S({icon:N+"area-measurement",text:t.getText("MEASUREMENTS_AREA_MENUITEM")}),this._deleteMeasurementItem=new S({icon:"sap-icon://delete",text:t.getText("MEASUREMENTS_DELETE_MENUITEM")}),this._calibrateDistanceMeasurementItem=new S({icon:N+"calibrate-distance",text:t.getText("MEASUREMENTS_CALIBRATE_DISTANCE_MENUITEM")}),this._measurementSettingsItem=new S({startsSection:!0,icon:N+"settings",text:t.getText("MEASUREMENTS_SETTINGS_MENUITEM"),toggleable:!1}),this._measurementsToggleButton=new f({type:sap.m.ButtonType.Transparent,tooltip:t.getText("MEASUREMENTS_TOOLTIP"),items:[this._distanceMeasurementItem,this._angleMeasurementItem,this._areaMeasurementItem,this._deleteMeasurementItem,this._calibrateDistanceMeasurementItem,this._measurementSettingsItem],itemToggled:function(t){var n=e._getViewport(),i=t.getParameter("oldItem"),s=t.getParameter("newItem");i===e._distanceMeasurementItem?e._distanceMeasurementTool.setActive(!1,n):i===e._angleMeasurementItem?e._angleMeasurementTool.setActive(!1,n):i===e._areaMeasurementItem?e._areaMeasurementTool.setActive(!1,n):i===e._deleteMeasurementItem?e._deleteMeasurementTool.setActive(!1,n):i===e._calibrateDistanceMeasurementItem&&e._calibrateDistanceMeasurementTool.setActive(!1,n);var o,a=n.getTools();s===e._distanceMeasurementItem?o=e._distanceMeasurementTool:s===e._angleMeasurementItem?o=e._angleMeasurementTool:s===e._areaMeasurementItem?o=e._areaMeasurementTool:s===e._deleteMeasurementItem?o=e._deleteMeasurementTool:s===e._calibrateDistanceMeasurementItem&&(o=e._calibrateDistanceMeasurementTool),null!=o&&(a.indexOf(o.getId())<0&&n.addTool(o),o.setActive(!0,n))},itemSelected:function(t){var n=e._getViewport();t.getParameter("item")===e._measurementSettingsItem&&(e._distanceMeasurementTool.setActive(!1,n),e._angleMeasurementTool.setActive(!1,n),e._areaMeasurementTool.setActive(!1,n),e._deleteMeasurementTool.setActive(!1,n),e._calibrateDistanceMeasurementTool.setActive(!1,n),e._distanceMeasurementTool.showSettingsDialog(n))},beforeMenuOpen:function(){var t=e._getViewport().getMeasurementSurface(),n=t.getMeasurements().length>0;e._deleteMeasurementItem.setEnabled(n);var i=t.getMeasurements().some((function(e){return e.isDistance}));e._calibrateDistanceMeasurementItem.setEnabled(i)}}),this._measurementsToggleButton.vitId=E.Measurements;var T=new d;T.vitId=E.MeasurementsSeparator;var x=new h({pressed:!0,icon:N+"toggle-pmi",type:sap.m.ButtonType.Transparent,text:t.getText("PMI_TOOLTIP"),tooltip:t.getText("PMI_TOOLTIP"),press:function(){var t=e._getViewport();t&&(t.setShowPMI(this.getPressed()),t.setShouldRenderFrame())}});x.vitId=E.PMI;var R=new d;R.vitId=E.PMISeparator;var B=new d,C=new d,P=new d,A=new d;this._itemsShowHideSelect=[r,l,P,this._rectSelectionButton,A],this._itemTurntable=this._gestureButtons[0],this._itemPan=this._gestureButtons[2],this._items3D=[this._gestureButtons[1],n,B,u,C];var O=[r,l,P,x,R,this._gestureButtons[0],this._gestureButtons[1],this._gestureButtons[2],this._gestureButtons[3],new d,this._measurementsToggleButton,T,c,new d,this._rectSelectionButton,A,n,B,u,C,p];return O.forEach(function(e){this._itemsVisibility.set(e,!0),this._itemsVisibilityObserver.observe(e,{properties:["visible"]})}.bind(this)),O};var U=["drawerToolbarIconTurntable","drawerToolbarIconOrbit","drawerToolbarIconPan","drawerToolbarIconZoom"],W=function(e,t){this.viewport=e,this._toolbar=t,this._mode=1,this._gesture=!1,this._x=0,this._y=0};function Z(e,t){U.forEach((function(n,i){e.hasStyleClass(n)&&i!==t?e.removeStyleClass(n):i===t&&e.addStyleClass(n)}))}return W.prototype.beginGesture=function(e){var t,n,i,s;if(this._gesture=!0,this._mode<3?(this._x=e.points[0].x,this._y=e.points[0].y):(this._x=e.x,this._y=e.y),e.scroll&&(n=(t=this).viewport,i=t._mode,s=n.hasStyleClass(U[i])?i:-1,t._isScrolling=!0,3!==s&&(Z(n,3),setTimeout((function(){t._isScrolling=!1,Z(n,s)}),500))),this._toolbar._rectSelectionButton.getPressed()||e.event&&(a.os.macintosh?e.event.metaKey:e.event.ctrlKey)){var o=this.viewport.getDomRef().getBoundingClientRect();this._selectionRect={x1:this._x-o.left,y1:this._y-o.top,x2:this._x-o.left,y2:this._y-o.top}}},W.prototype.endGesture=function(){this._gesture=!1,!this._selectionRect||this._selectionRect.x1===this._selectionRect.x2&&this._selectionRect.y1===this._selectionRect.y2?this._isScrolling||Z(this.viewport,-1):(this._toolbar._rectSelectTool._select(this._selectionRect.x1,this._selectionRect.y1,this._selectionRect.x2,this._selectionRect.y2,this.viewport,this.viewport.getScene(),this.viewport.getCamera()),this._selectionRect=null,this.viewport.setSelectionRect(null))},W.prototype.move=function(e){if(this._gesture)if(1==e.n){var t=e.points[0];if(this._selectionRect){var n=this.viewport.getDomRef().getBoundingClientRect();this._selectionRect.x2=t.x-n.left,this._selectionRect.y2=t.y-n.top,this.viewport.setSelectionRect(this._selectionRect)}else{Z(this.viewport,this._mode);var i=t.x-this._x,s=t.y-this._y;switch(this._mode){case 0:this.viewport.rotate(i,s,!0);break;case 1:this.viewport.rotate(i,s,!1);break;case 2:this.viewport.pan(i,s);break;case 3:this.viewport.zoom(1+.005*s)}this._x=t.x,this._y=t.y}e.handled=!0}else 2!=e.n||this._isScrolling||Z(this.viewport,2)},W.prototype.hover=function(){},W.prototype.getViewport=function(){return this.viewport},F.prototype.setNavigationMode=function(e){e&&e!==b.NoChange||(e=this.getNavigationMode());var t=this._getViewport();t&&(H(t)?L(t)&&t._isPanoramicActivated()&&e!==b.Turntable&&e!==b.Zoom&&(e=b.Turntable):e!==b.Pan&&e!==b.Zoom&&(e=b.Pan)),this.setProperty("navigationMode",e,!0);var n=[b.Turntable,b.Orbit,b.Pan,b.Zoom].indexOf(e);this._gestureButtons.forEach((function(e,t){e.setPressed(t===n)})),t&&(this._cameraHandler&&this._cameraHandler.getViewport()===t||(this._cameraHandler=new W(t,this),t._loco.addHandler(this._cameraHandler,0)),this._cameraHandler._mode=n)},F.prototype._getToolbar=function(){return this._toolbar},F.prototype._toggleExpanded=function(){var e=!this.getExpanded();this.setExpanded(e),this.fireExpanded({expand:e})},F.prototype.setExpanded=function(e){this.setProperty("expanded",e,!0);var t=this.getDomRef();return t&&(e?(t.classList.add("drawerToolbarExpanded"),t.classList.remove("drawerToolbarCollapsed"),this._container.removeStyleClass("vboxCollapsed")):(t.classList.add("drawerToolbarCollapsed"),t.classList.remove("drawerToolbarExpanded"),this._container.addStyleClass("vboxCollapsed"))),this},F.prototype._onViewActivated=function(e,t,n){n&&n.view&&n.source&&n.source===this._getViewport()&&this.invalidate()},F.prototype._onReadyForAnimation=function(e,t,n){var i=this._getViewport();n&&n.view&&n.source&&i._getViewStateManagerThreeJS&&n.source===i._getViewStateManagerThreeJS()&&this.invalidate()},F.prototype.onBeforeRendering=function(){var e=this._getViewport();if(this._container.setVisible(!!e),e){var t=H(e),n=L(e)&&e._isPanoramicActivated(),i=k(e);this._ignoreVisiblityChange=!0,this._itemsShowHideSelect.forEach(function(e){e.setVisible(!i&&this._itemsVisibility.get(e))}.bind(this)),this._itemTurntable.setVisible(t&&this._itemsVisibility.get(this._itemTurntable)),this._itemPan.setVisible(!n&&this._itemsVisibility.get(this._itemPan)),this._items3D.forEach(function(e){e.setVisible(t&&!n&&this._itemsVisibility.get(e))}.bind(this)),this._ignoreVisiblityChange=!1,t&&!n&&(this._crossSectionTool=this._crossSectionTool||new T,e.addTool(this._crossSectionTool)),this.setNavigationMode(b.NoChange)}},F}));