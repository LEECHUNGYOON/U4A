/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/m/VariantManagement","sap/ui/core/Control","sap/ui/core/library","sap/ui/model/base/ManagedObjectModel","sap/ui/base/ManagedObjectObserver","sap/base/Log"],function(e,t,a,r,i,n){"use strict";var o=a.TitleLevel;var s=t.extend("sap.ui.comp.smartvariants.SmartVariantManagementBase",{metadata:{interfaces:["sap.m.IOverflowToolbarContent"],library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smartvariants/SmartVariantManagementBase.designtime",properties:{enabled:{type:"boolean",group:"Misc",defaultValue:true},defaultVariantKey:{type:"string",group:"Misc",defaultValue:null},selectionKey:{type:"string",group:"Misc",defaultValue:null},showCreateTile:{type:"boolean",group:"Misc",defaultValue:false},showExecuteOnSelection:{type:"boolean",group:"Misc",defaultValue:false},showShare:{type:"boolean",group:"Misc",defaultValue:false},showSetAsDefault:{type:"boolean",group:"Misc",defaultValue:true},standardItemText:{type:"string",group:"Misc",defaultValue:null},useFavorites:{type:"boolean",group:"Misc",defaultValue:false},inErrorState:{type:"boolean",group:"Misc",defaultValue:false},variantCreationByUserAllowed:{type:"boolean",group:"Misc",defaultValue:true},standardItemAuthor:{type:"string",group:"Misc",defaultValue:"SAP"},displayTextForExecuteOnSelectionForStandardVariant:{type:"string",group:"Misc",defaultValue:""},headerLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:o.Auto},titleStyle:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:o.Auto},initialSelectionKey:{type:"string",group:"Misc",defaultValue:null},lifecycleSupport:{type:"boolean",group:"Misc",defaultValue:false},maxWidth:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"}},events:{save:{parameters:{name:{type:"string"},overwrite:{type:"boolean"},key:{type:"string"},exe:{type:"boolean"},def:{type:"boolean"},global:{type:"boolean"}}},manage:{parameters:{renamed:{type:"object[]"},deleted:{type:"string[]"},exe:{type:"object[]"},def:{type:"string"}}},select:{parameters:{key:{type:"string"}}}},defaultAggregation:"variantItems",aggregations:{_embeddedVM:{type:"sap.m.VariantManagement",multiple:false,visibility:"hidden"},variantItems:{type:"sap.ui.comp.variants.VariantItem",multiple:true,forwarding:{getter:"_getEmbeddedVM",aggregation:"items"}}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.style("max-width",t.getMaxWidth());e.openEnd();e.renderControl(t._oVM);e.close("div")}}});s.prototype.init=function(){t.prototype.init.apply(this);this.STANDARDVARIANTKEY="*standard*";this.addStyleClass("sapUiCompVarMngmt");this.oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this._mTranslatablePromises={};this._oVM=new e(this.getId()+"-vm");this.setAggregation("_embeddedVM",this._oVM,true);this.setStandardVariantKey(this.STANDARDVARIANTKEY);this._oManagedObjectModel=new r(this);this.setModel(this._oManagedObjectModel,"$compSmartVariants");this._oObserver=new i(this._observeChanges.bind(this));this._oObserver.observe(this,{properties:["standardItemText"]});this._oVM.attachManage(this._fireManage,this);this._oVM.attachSave(this._fireSave,this);this._oVM.attachSelect(this._fireSelect,this);this._oVM.attachCancel(this._fireCancel,this);this._oVM.attachManageCancel(this._fireManageCancel,this);this.setDefaultVariantKey(this.getStandardVariantKey());this.setPopoverTitle(this.oResourceBundle.getText("VARIANT_MANAGEMENT_VARIANTS"));this._bindProperties()};s.prototype._observeChanges=function(e){if(e.type==="property"){if(this._mTranslatablePromises[e.name]&&this._mTranslatablePromises[e.name].fnResolve){this._mTranslatablePromises[e.name].fnResolve(e.current)}else if(!this._mTranslatablePromises[e.name]){this._mTranslatablePromises[e.name]={promise:Promise.resolve(e.current)}}}};s.prototype._bindProperties=function(e){this._oVM.bindProperty("defaultKey",{path:"/defaultVariantKey",model:"$compSmartVariants"});this._oVM.bindProperty("creationAllowed",{path:"/variantCreationByUserAllowed",model:"$compSmartVariants"});this._oVM.bindProperty("selectedKey",{path:"/selectionKey",model:"$compSmartVariants"});this._oVM.bindProperty("supportPublic",{path:"/showShare",model:"$compSmartVariants"});this._oVM.bindProperty("supportDefault",{path:"/showSetAsDefault",model:"$compSmartVariants"});this._oVM.bindProperty("supportApplyAutomatically",{path:"/showExecuteOnSelection",model:"$compSmartVariants"});this._oVM.bindProperty("supportFavorites",{path:"/useFavorites",model:"$compSmartVariants"});this._oVM.bindProperty("level",{path:"/headerLevel",model:"$compSmartVariants"});this._oVM.bindProperty("titleStyle",{path:"/titleStyle",model:"$compSmartVariants"})};s.prototype._getEmbeddedVM=function(){return this._oVM};s.prototype.setDisplayTextForExecuteOnSelectionForStandardVariant=function(e){this.setProperty("displayTextForExecuteOnSelectionForStandardVariant",e);this._oVM.setDisplayTextForExecuteOnSelectionForStandardVariant(e);return this};s.prototype.setShowAsText=function(e){this._oVM.setShowAsText(e);return this};s.prototype.getShowAsText=function(){return this._oVM.getShowAsText()};s.prototype.setShowCreateTile=function(e){this.setProperty("showCreateTile",e);this._oVM._setShowCreateTile(e);return this};s.prototype.getShowCreateTile=function(){return this._oVM._getShowCreateTile()};s.prototype._assignUser=function(e,t){var a=this._oVM.getItemByKey(e);if(a){a.setAuthor(t)}};s.prototype.setEnabled=function(e){this.setProperty("enabled",e);var t=this._oVM.oVariantLayout.getContent();if(!e){t[0].removeStyleClass("sapMVarMngmtClickable");t[0].addStyleClass("sapMVarMngmtDisabled");t[1].addStyleClass("sapMVarMngmtDisabled");t[2].removeStyleClass("sapMVarMngmtClickable");t[2].addStyleClass("sapMVarMngmtDisabled");this._oVM.bPopoverOpen=true}else{t[0].removeStyleClass("sapMVarMngmtDisabled");t[0].addStyleClass("sapMVarMngmtClickable");t[1].removeStyleClass("sapMVarMngmtDisabled");t[2].removeStyleClass("sapMVarMngmtDisabled");t[2].addStyleClass("sapMVarMngmtClickable");this._oVM.bPopoverOpen=false}return this};s.prototype.setSelectionKey=function(e){this.setProperty("selectionKey",e);return this};s.prototype.setInitialSelectionKey=function(e){return this.setSelectionKey(e)};s.prototype.getInitialSelectionKey=function(){return this.getSelectionKey()};s.prototype.currentVariantGetModified=function(){return this.getModified()};s.prototype.currentVariantSetModified=function(e){this.setModified(e)};s.prototype._getIdxSorted=function(e){var t=this.getVariantItems();var a=e.toUpperCase();var r=t.findIndex(function(e,t){if(t>0){if(e.getTitle().toUpperCase()>a){return true}}return false});return r>-1?r:t.length};s.prototype._reorderList=function(e){var t=this.getItemByKey(e);if(t){this.removeVariantItem(t);var a=this._getIdxSorted(t.getTitle());this.insertVariantItem(t,a)}};s.prototype._getInternalVM=function(){return this.getAggregation("_embeddedVM")};s.prototype.getItemByKey=function(e){var t=this.getVariantItems();for(var a=0;a<t.length;a++){if(e==t[a].getKey()){return t[a]}}return null};s.prototype._waitForTranslation=function(e){if(!this._mTranslatablePromises[e]){var t=null;var a=new Promise(function(e){t=e});this._mTranslatablePromises[e]={promise:a,fnResolve:t}}return this._mTranslatablePromises[e].promise};s.prototype._getStandardVariantItemName=function(){var e="standardItemText";if(this.getBindingInfo(e)){return this._waitForTranslation(e)}else{return Promise.resolve(this._determineStandardVariantName())}};s.prototype._determineStandardVariantName=function(){var e=this.oResourceBundle.getText("VARIANT_MANAGEMENT_STANDARD");if(this.getStandardVariantKey()===this.STANDARDVARIANTKEY&&this.getStandardItemText()){e=this.getStandardItemText()}return e};s.prototype.setStandardVariantKey=function(e){this._oVM.setStandardVariantKey(e)};s.prototype.getStandardVariantKey=function(){return this._oVM.getStandardVariantKey()};s.prototype.getOverflowToolbarConfig=function(){return{canOverflow:false,invalidationEvents:["save","manage","select"]}};s.prototype._prepareSaveAsKeyUserData=function(e){try{this._getContentAsync().then(function(t){var a={default:e.def,executeOnSelection:e.execute,type:this._getPersoControllerType(),text:e.name,contexts:e.contexts,content:t};this._fGetDataForKeyUser(a);this._cleanUpSaveForKeyUser()}.bind(this))}catch(e){n.error("'_prepareSaveAsKeyUserData' throws an exception:"+e.message);this._fGetDataForKeyUser();this._cleanUpSaveForKeyUser()}};s.prototype._fireCancel=function(e){if(this._fGetDataForKeyUser){this._fGetDataForKeyUser();this._cleanUpSaveForKeyUser()}};s.prototype._fireManageCancel=function(e){if(this._fGetDataForKeyUser){this._fGetDataForKeyUser();this._cleanUpManageViewsForKeyUser()}};s.prototype._fireSelect=function(e){if(!this._fGetDataForKeyUser){this.setModified(false)}this.fireSelect(e.getParameters())};s.prototype._fireSave=function(e){var t=e.getParameters();if(this._fGetDataForKeyUser){this._prepareSaveAsKeyUserData(t);return}if(t.hasOwnProperty("execute")){t.exe=t.execute}if(t.hasOwnProperty("public")){t.global=t.public}this.fireSave(t)};s.prototype._prepareManageKeyUserData=function(e){var t={};var a=false;if(e.hasOwnProperty("def")){var r=e.def;if(r!==this._oVM._sOriginalDefaultKey){t.default=r}}if(e.hasOwnProperty("deleted")){e.deleted.forEach(function(e){if(!t[e]){t[e]={}}t[e].deleted=true;if(this.getSelectionKey()===e){a=true}}.bind(this))}if(e.hasOwnProperty("exe")){e.exe.forEach(function(e){if(!t[e.key]){t[e.key]={}}t[e.key].executeOnSelection=e.exe})}if(e.hasOwnProperty("fav")){e.fav.forEach(function(e){if(!t[e.key]){t[e.key]={}}t[e.key].favorite=e.visible})}if(e.hasOwnProperty("renamed")){e.renamed.forEach(function(e){if(!t[e.key]){t[e.key]={}}t[e.key].name=e.name})}if(e.hasOwnProperty("contexts")){e.contexts.forEach(function(e){if(!t[e.key]){t[e.key]={}}t[e.key].contexts=e.contexts})}if(a){this.activateVariant(this.getStandardVariantKey())}this._fGetDataForKeyUser(t);this._cleanUpManageViewsForKeyUser()};s.prototype._fireManage=function(e){var t=e.getParameters();if(this._fGetDataForKeyUser){this._prepareManageKeyUserData(t)}else{this.fireManage(t)}};s.prototype.getFocusDomRef=function(){if(this._oVM){return this._oVM.oVariantPopoverTrigger.getFocusDomRef()}return null};s.prototype.getManageDialog=function(){if(this._oVM){return this._oVM.oManagementDialog}return null};s.prototype.getVariants=function(){return this._oVM.getItems()};s.prototype.getTitle=function(){return this._oVM.getTitle()};s.prototype.setPopoverTitle=function(e){return this._oVM.setPopoverTitle(e)};s.prototype.setEditable=function(e){this.setProperty("editable",e);return this._oVM.setShowFooter(e)};s.prototype.setShowExecuteOnSelection=function(e){this.setProperty("showExecuteOnSelection",e);this._oVM.setSupportApplyAutomatically(e);return this};s.prototype.setShowSetAsDefault=function(e){this.setProperty("showSetAsDefault",e);this._oVM.setSupportDefault(e);return this};s.prototype.setDisplayTextForExecuteOnSelectionForStandardVariant=function(e){this.setProperty("displayTextForExecuteOnSelectionForStandardVariant",e);this._oVM.setDisplayTextForExecuteOnSelectionForStandardVariant(e);return this};s.prototype.setInErrorState=function(e){var t=this._oVM.getTitle();if(e&&t&&!t.getText()){t.setText(this._determineStandardVariantName())}this.setProperty("inErrorState",e);this._oVM.setInErrorState(e);return this};s.prototype.getInErrorState=function(){return this._oVM.getInErrorState()};s.prototype._updateLayerSpecificInformations=function(){this.getVariants().forEach(function(e){var t=this._getVariantById(e.getKey());if(t){e.setRemove(t.isDeleteEnabled(this._sLayer));e.setRename(t.isRenameEnabled(this._sLayer))}}.bind(this))};s.prototype.setEditable=function(e){this._oVM.setProperty("showFooter",e);return this};s.prototype.setCurrentVariantKey=function(e){this._oVM.setSelectedKey(e)};s.prototype.getCurrentVariantKey=function(){return this._oVM.getSelectedKey()};s.prototype.getModified=function(){return this._oVM.getModified()};s.prototype.setModified=function(e){this._oVM.setModified(e)};s.prototype.refreshTitle=function(){this._oVM.refreshTitle()};s.prototype.registerApplyAutomaticallyOnStandardVariant=function(e){this._fRegisteredApplyAutomaticallyOnStandardVariant=e;return this};s.prototype.getApplyAutomaticallyOnVariant=function(e){var t=e.executeOnSelect;if(this._fRegisteredApplyAutomaticallyOnStandardVariant&&this.getDisplayTextForExecuteOnSelectionForStandardVariant()&&e.key===this._oVM.getStandardVariantKey()){try{t=this._fRegisteredApplyAutomaticallyOnStandardVariant(e)}catch(e){n.error("callback for determination of apply automatically on standard variant failed")}}return t};s.prototype.getPersonalizableControlPersistencyKey=function(){if(this.isPageVariant()){return this.getPersistencyKey()}var e=this._getAllPersonalizableControls();if(e&&e.length===1){return this._getControlPersKey(e[0])}return null};s.prototype.addVariant=function(e,t){this._createVariantItem(e);if(t){this.setDefaultVariantId(e.getVariantId())}};s.prototype.removeVariant=function(e){if(e.variantId){var t=this.getItemByKey(e.variantId);if(t){this.removeVariantItem(t);t.destroy()}delete this._mVariants[e.variantId]}if(e.previousVariantId){this.activateVariant(e.previousVariantId)}if(e.previousDefault){this.setDefaultVariantId(e.previousDefault)}};s.prototype.removeWeakVariant=function(e){if(e.variantId){var t=this.getItemByKey(e.variantId);if(t){this.removeVariantItem(t);t.destroy()}delete this._mVariants[e.variantId]}if(e.previousVariantId){this.setInitialSelectionKey(e.previousVariantId)}if(e.previousDirtyFlag){this.setModified(e.previousDirtyFlag)}if(e.previousDefault){this.setDefaultVariantId(e.previousDefault)}};s.prototype.updateVariant=function(e){var t;if(e){t=this.getItemByKey(e.getVariantId());if(t){t.setExecuteOnSelection(e.getExecuteOnSelection());t.setExecuteOnSelect(e.getExecuteOnSelection());t._setOriginalExecuteOnSelect(e.getExecuteOnSelection());t.setFavorite(e.getFavorite());t._setOriginalFavorite(e.getFavorite());t.setTitle(e.getText("variantName"));t._setOriginalTitle(e.getText("variantName"));t.setText(e.getText("variantName"));if(e.getContexts){t.setContexts(e.getContexts());t._setOriginalContexts(e.getContexts())}}}};s.prototype.activateVariant=function(e){this.setCurrentVariantKey(e);this.setModified(false);this.fireSelect({key:e})};s.prototype.getAllVariants=function(){var e=this._oVM.getItems();if(!e||e.length<1){return[]}var t=[];e.forEach(function(e){if(e.getVisible()){t.push(this._getVariantById(e.getKey()))}}.bind(this));return t};s.prototype.getDefaultVariantId=function(){return this.getDefaultVariantKey()};s.prototype.setDefaultVariantId=function(e){this.setDefaultVariantKey(e)};s.prototype.getPresentVariantId=function(){return this.getCurrentVariantId()?this.getCurrentVariantId():this.STANDARDVARIANTKEY};s.prototype.getPresentVariantText=function(){return this._oVM.getSelectedVariantText(this.getPresentVariantId())};s.prototype.getPresentVariantContent=function(){return this._getContentAsync()};s.prototype._getPersoController=function(){return this._oPersoControl};s.prototype._getPersoControllerType=function(){if(this.isPageVariant()){return"page"}var e=this._getAllPersonalizableControls();if(e&&e.length===1){return e[0].type}return null};s.prototype._getViewByName=function(e){var t,a=e.trim();var r=this.getVariants();for(var i=0;i<r.length;i++){t=r[i].getText().trim();if(t===a){return r[i]}}return null};s.prototype.getViewIdByName=function(e){var t=this._getViewByName(e);return t?t.getKey():null};s.prototype._isDuplicateSaveAs=function(e){var t=e.trim();if(!t){return true}var a=this._determineStandardVariantName();if(a===t){return true}return this._getViewByName(t)?true:false};s.prototype.isNameDuplicate=function(e){var t=e.trim();return this._isDuplicateSaveAs(t)};s.prototype.isNameTooLong=function(t){var a=t.trim();return a.length>e.MAX_NAME_LEN};s.prototype.setStandardItemText=function(e){this.setProperty("standardItemText",e);return this};s.prototype._executeOnSelectForStandardVariantByXML=function(e){this.bExecuteOnSelectForStandardViaXML=e};s.prototype.getExecuteOnSelectForStandardVariant=function(){var e=false;var t=this.getItemByKey(this.getStandardVariantKey());if(t){e=t.getExecuteOnSelect()}return e||this.bExecuteOnSelectForStandardViaXML};s.prototype._reapplyExecuteOnSelectForStandardVariantItem=function(e){var t=this.getStandardVariantKey();if(this._oVM){var a=this._oVM.getItemByKey(t);if(a){a.setExecuteOnSelect(e);a._setOriginalExecuteOnSelect(e)}}};s.prototype.openManageViewsDialogForKeyUser=function(e,t,a){this._sLayer=e.layer;this._fGetDataForKeyUser=t;this._updateLayerSpecificInformations();var r=true;if(a){r=false}this._oVM.openManagementDialog(r,e.rtaStyleClass,e.contextSharingComponentContainer)};s.prototype.openSaveAsDialogForKeyUser=function(e,t,a){this._fGetDataForKeyUser=t;this._oVM.openSaveAsDialog(e,a)};s.prototype._cleanUpSaveForKeyUser=function(){if(this._oRolesComponentContainer){this.oSaveDialog.removeContent(this._oRolesComponentContainer)}this._cleanUpKeyUser()};s.prototype._destroyManageDialog=function(){if(this._oVM){this._oVM.destroyManageDialog()}};s.prototype._cleanUpManageViewsForKeyUser=function(){this._destroyManageDialog();this._cleanUpKeyUser()};s.prototype._cleanUpKeyUser=function(){this.setShowShare(this._bShowShare);this._fGetDataForKeyUser=null;this._sLayer=null;this._oRolesComponentContainer=null};s.prototype._getContentAsync=function(){return Promise.resolve(this._fetchContentAsync())};s.prototype._checkUpdate=function(){this._oVM.getModel("$mVariants").checkUpdate(true)};s.prototype.enteringDesignMode=function(){this.setDesignTimeMode(true)};s.prototype.leavingDesignMode=function(){this.setDesignTimeMode(false)};s.prototype.setDesignTimeMode=function(e){this._oVM.setDesignMode(e);return this._oVM.setShowFooter(!e)};s.prototype.exit=function(){this._oVM.detachManage(this._fireManage,this);this._oVM.detachSelect(this._fireSelect,this);this._oVM.detachSave(this._fireSave,this);this._oVM.detachCancel(this._fireCancel,this);this._oVM.detachManageCancel(this._fireManageCancel,this);this._oObserver.disconnect();this._oObserver=undefined;if(this._oManagedObjectModel){this._oManagedObjectModel.destroy();this._oManagedObjectModel=undefined}this._mTranslatablePromises=null;t.prototype.exit.apply(this,arguments);this._oVM=undefined;this._fRegisteredApplyAutomaticallyOnStandardVariant=null;this.oResourceBundle=undefined};return s});
//# sourceMappingURL=SmartVariantManagementBase.js.map