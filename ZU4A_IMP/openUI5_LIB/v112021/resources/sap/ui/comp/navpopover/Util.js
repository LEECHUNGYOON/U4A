/*!
 * SAPUI5
 * (c) Copyright 2009-2023 SAP SE. All rights reserved.
 */
sap.ui.define(["sap/ui/comp/library","./Factory","./LinkData","sap/base/Log","sap/ui/core/Lib"],function(t,e,n,i,r){"use strict";var a={getContactAnnotationPath:function(t,e){var n=t?t.getContactAnnotationPath():undefined;if(n===undefined&&e&&e.getContactAnnotationPaths()&&e.getContactAnnotationPaths()[t.getFieldName()]!==undefined){n=e.getContactAnnotationPaths()[t.getFieldName()]}return n},getForceLinkRendering:function(t,e){if(!t){return undefined}return t.getForceLinkRendering()||!!(e&&e.getForceLinkRendering()&&e.getForceLinkRendering()[t.getFieldName()])},getStorableAvailableActions:function(t){return t?t.filter(function(t){return t&&t.key!==undefined}):[]},sortArrayAlphabetical:function(t){var e;try{e=sap.ui.getCore().getConfiguration().getLocale().toString();if(typeof window.Intl!=="undefined"){var n=window.Intl.Collator(e,{numeric:true});t.sort(function(t,e){return n.compare(t,e)})}else{t.sort(function(t,n){return t.localeCompare(n,e,{numeric:true})})}}catch(t){}},retrieveNavigationTargets:async function(t,a,o,c,s,u,l,f,v,p){const m={mainNavigation:undefined,ownNavigation:undefined,availableActions:[]};const[g,b]=await Promise.all([e.getServiceAsync("CrossApplicationNavigation"),e.getServiceAsync("URLParsing")]);if(!g||!b){i.error("Service 'CrossApplicationNavigation' or 'URLParsing' could not be obtained");return m}const h=[t].concat(a.filter(e=>e!==t));const d=h.map(function(t){return[{semanticObject:t,params:s?s[t]:undefined,appStateKey:o,ui5Component:c,sortResultsBy:"text"}]});const y=await g.getLinks(d);if(!y||!y.length){return m}const P=await g.getPrimaryIntent(t,d[0]);const O=P?b.parseShellHash(P.intent):null;const A=await this.retrieveSemanticObjectUnavailableActions(l,f,v);let S=await g.hrefForExternalAsync();if(S&&S.indexOf("?")!==-1){S=S.split("?")[0]}if(S){S+="?"}const j=function(t,e){return!!A&&!!A[t]&&A[t].indexOf(e)>-1};y[0][0].forEach(t=>{const e=b.parseShellHash(t.intent);const i=this._getKey(e);const a=t.intent.indexOf(S)===0;const o=j(e.semanticObject,e.action);if(!a&&o){return}const c=new n({key:i,href:t.intent,visible:true,isSuperiorAction:this._isSuperiorAction(t)});c.setText(t.text);if(a){m.ownNavigation=c;return}if(O?.action&&e?.action&&e.action===O.action){c.setText(r.getResourceBundleFor("sap.ui.comp").getText("POPOVER_FACTSHEET"));m.mainNavigation=c}else{m.availableActions.push(c)}if(p){p.addSemanticObjectIntent(e.semanticObject,{text:c.text,intent:c.intent})}});if(!m.mainNavigation&&typeof u==="string"){var C=new n({visible:true});C.setText(u);m.mainNavigation=C}var x=[];for(var _=1;_<h.length;_++){x=x.concat(y[_][0])}x.forEach(t=>{var e=b.parseShellHash(t.intent);if(j(e.semanticObject,e.action)){return}var i=new n({key:this._getKey(e),href:t.intent,visible:true,isSuperiorAction:this._isSuperiorAction(t)});i.setText(t.text);m.availableActions.push(i);if(p){p.addSemanticObjectIntent(e.semanticObject,{text:t.text,intent:t.intent})}});return m},_getKey:t=>t.semanticObject&&t.action?t.semanticObject+"-"+t.action:undefined,_isSuperiorAction:t=>t.tags&&t.tags.indexOf("superiorAction")>-1,retrieveSemanticObjectMapping:function(t,e,n){return this._getEntityTypeAnnotationOfProperty(t,e,n).then(function(t){if(!t){return Promise.resolve(null)}if(!t[0]["com.sap.vocabularies.Common.v1.SemanticObjectMapping"]){return Promise.resolve(null)}var i=this._getSemanticObjectMappingsOfProperty(t[0],this._getSemanticObjectsOfProperty(t[0],e,n));var r={};for(var a in i){r[i[a].name]=i[a].mapping}return Promise.resolve(r)}.bind(this))},retrieveSemanticObjectUnavailableActions:function(t,e,n){return this._getEntityTypeAnnotationOfProperty(t,e,n).then(function(t){if(!t){return Promise.resolve(null)}if(!t[0]["com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"]){return Promise.resolve(null)}var i=this._getSemanticObjectUnavailableActionsOfProperty(t[0],this._getSemanticObjectsOfProperty(t[0],e,n));var r={};for(var a in i){r[i[a].name]=i[a].unavailableActions}return Promise.resolve(r)}.bind(this))},oNavigationPromise:undefined,navigate:function(t){if(t.indexOf("#")===0&&e.getUShellContainer()){var n=this;if(!n.oNavigationPromise){n.oNavigationPromise=e.getService("CrossApplicationNavigation",true).then(function(e){e.toExternal({target:{shellHash:t.substring(1)}});n.oNavigationPromise=undefined})}}else{window.location.href=t}},_getEntityTypeAnnotationOfProperty:function(t,e,n){if(!t){return Promise.resolve(null)}if(!e||!e.getMetaModel()){return Promise.resolve(null)}var r=e.getMetaModel();return r.loaded().then(function(){var e;try{e=r.getMetaContext(n)}catch(t){i.error("sap.ui.comp.navpopover.Util._getEntityTypeAnnotationOfProperty: binding path '"+n+"' is not valid. Error has been caught: "+t);return Promise.resolve(null)}if(!e){return Promise.resolve(null)}var a=e.getProperty(e.getPath());if(!a.property){return Promise.resolve(null)}var o=a.property.filter(function(e){return e.name===t});if(o.length!==1){return Promise.resolve(null)}return Promise.resolve(o)})},_getSemanticObjectsOfProperty:function(t,e,n){var i={};for(var r in t){var a=r.split("#")[0];var o=r.split("#")[1]||"";if(a.startsWith("com.sap.vocabularies.Common.v1.SemanticObject")&&a.endsWith("com.sap.vocabularies.Common.v1.SemanticObject")){i[o]={name:t[r]["Path"]?e.getProperty(n+"/"+t[r]["Path"]):t[r]["String"],mapping:undefined}}}return i},_getSemanticObjectMappingsOfProperty:function(t,e){var n=function(t){var e={};if(Array.isArray(t)){t.forEach(function(t){e[t.LocalProperty.PropertyPath]=t.SemanticObjectProperty.String})}return e};for(var i in t){var r=i.split("#")[0];var a=i.split("#")[1]||"";if(r.startsWith("com.sap.vocabularies.Common.v1.SemanticObjectMapping")&&r.endsWith("com.sap.vocabularies.Common.v1.SemanticObjectMapping")){if(e[a]){e[a].mapping=n(t[i])}}}return e},_getSemanticObjectUnavailableActionsOfProperty:function(t,e){var n=function(t){var e=[];if(Array.isArray(t)){t.forEach(function(t){e.push(t.String)})}return e};for(var i in t){var r=i.split("#")[0];var a=i.split("#")[1]||"";if(r.startsWith("com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions")&&r.endsWith("com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions")){if(e[a]){e[a].unavailableActions=n(t[i])}}}return e}};return a},true);
//# sourceMappingURL=Util.js.map