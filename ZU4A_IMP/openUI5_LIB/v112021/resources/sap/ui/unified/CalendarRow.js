sap.ui.define(["sap/ui/core/Control","sap/ui/Device","sap/ui/core/LocaleData","sap/ui/unified/calendar/CalendarUtils","sap/ui/core/format/TimezoneUtil","sap/ui/core/Core","sap/ui/core/date/UniversalDate","./library","sap/ui/core/InvisibleText","sap/ui/core/format/DateFormat","sap/ui/core/ResizeHandler","sap/ui/core/Locale","./CalendarRowRenderer","sap/ui/dom/containsOrEquals","sap/ui/thirdparty/jquery","sap/ui/unified/CalendarAppointment","sap/ui/core/InvisibleMessage","sap/ui/core/library","sap/ui/core/Configuration","sap/ui/core/date/UI5Date"],(function(e,t,i,n,a,s,o,r,p,l,g,u,h,d,jQuery,c,m,T,f,C){"use strict";var v=r.CalendarDayType,A=r.CalendarAppointmentVisualization,_=r.GroupAppointmentsMode,U=r.CalendarIntervalType,y=r.CalendarAppointmentHeight,D=r.CalendarAppointmentRoundWidth,S=T.InvisibleMessageMode,b=e.extend("sap.ui.unified.CalendarRow",{metadata:{library:"sap.ui.unified",properties:{startDate:{type:"object",group:"Data"},intervals:{type:"int",group:"Appearance",defaultValue:12},intervalSize:{type:"int",group:"Appearance",defaultValue:1},intervalType:{type:"sap.ui.unified.CalendarIntervalType",group:"Appearance",defaultValue:U.Hour},showSubIntervals:{type:"boolean",group:"Appearance",defaultValue:!1},showIntervalHeaders:{type:"boolean",group:"Appearance",defaultValue:!0},showEmptyIntervalHeaders:{type:"boolean",group:"Appearance",defaultValue:!0},nonWorkingDays:{type:"int[]",group:"Misc",defaultValue:null},nonWorkingHours:{type:"int[]",group:"Misc",defaultValue:null},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},checkResize:{type:"boolean",group:"Behavior",defaultValue:!0},updateCurrentTime:{type:"boolean",group:"Behavior",defaultValue:!0},groupAppointmentsMode:{type:"sap.ui.unified.GroupAppointmentsMode",group:"Appearance",defaultValue:_.Collapsed},appointmentsReducedHeight:{type:"boolean",group:"Appearance",defaultValue:!1,deprecated:!0},appointmentsVisualization:{type:"sap.ui.unified.CalendarAppointmentVisualization",group:"Appearance",defaultValue:A.Standard},appointmentHeight:{type:"sap.ui.unified.CalendarAppointmentHeight",group:"Appearance",defaultValue:y.Regular},appointmentRoundWidth:{type:"sap.ui.unified.CalendarAppointmentRoundWidth",group:"Appearance",defaultValue:D.None},multipleAppointmentsSelection:{type:"boolean",group:"Data",defaultValue:!1}},aggregations:{appointments:{type:"sap.ui.unified.CalendarAppointment",multiple:!0,singularName:"appointment"},intervalHeaders:{type:"sap.ui.unified.CalendarAppointment",multiple:!0,singularName:"intervalHeader"},groupAppointments:{type:"sap.ui.unified.CalendarAppointment",multiple:!0,singularName:"groupAppointment",visibility:"hidden"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:!0,singularName:"ariaLabelledBy"},legend:{type:"sap.ui.unified.CalendarLegend",multiple:!1}},events:{select:{parameters:{appointment:{type:"sap.ui.unified.CalendarAppointment"},appointments:{type:"sap.ui.unified.CalendarAppointment[]"},multiSelect:{type:"boolean"},domRefId:{type:"string"}}},startDateChange:{},leaveRow:{parameters:{type:{type:"string"}}},intervalSelect:{parameters:{startDate:{type:"object"},endDate:{type:"object"},subInterval:{type:"boolean"}}}}},renderer:h});function I(){return this._sLocale||(this._sLocale=f.getFormatSettings().getFormatLocale().toString()),this._sLocale}function M(){if(!this._oLocaleData){var e=I.call(this),t=new u(e);this._oLocaleData=i.getInstance(t)}return this._oLocaleData}function w(){var e,t=this.getStartDate(),i=this.getIntervals(),n=this.getIntervalType();switch(this._oUTCStartDate=H.call(this,t),n){case U.Hour:(e=new o(this._oUTCStartDate.getTime())).setUTCHours(e.getUTCHours()+i);break;case U.Day:case U.Week:case U.OneMonth:case"OneMonth":(e=new o(this._oUTCStartDate.getTime())).setUTCDate(e.getUTCDate()+i*this.getIntervalSize());break;case U.Month:(e=new o(this._oUTCStartDate.getTime())).setUTCMonth(e.getUTCMonth()+i);break;default:throw new Error("Unknown IntervalType: "+n+"; "+this)}e.setUTCMilliseconds(-1),this._iRowSize=e.getTime()-this._oUTCStartDate.getTime(),this._iIntervalSize=Math.floor(this._iRowSize/i),this._oUTCEndDate=e}function H(e){var t=this.getIntervalType(),i=n._createUniversalUTCDate(e,void 0,!0);switch(t){case U.Hour:i.setUTCMinutes(0),i.setUTCSeconds(0),i.setUTCMilliseconds(0);break;case U.Day:case U.Week:case U.OneMonth:case"OneMonth":i.setUTCHours(0),i.setUTCMinutes(0),i.setUTCSeconds(0),i.setUTCMilliseconds(0);break;case U.Month:i.setUTCDate(1),i.setUTCHours(0),i.setUTCMinutes(0),i.setUTCSeconds(0),i.setUTCMilliseconds(0);break;default:throw new Error("Unknown IntervalType: "+t+"; "+this)}return i}function R(){return t.system.phone||this.getGroupAppointmentsMode()===_.Collapsed}function k(){var e,t,i,a=this._getAppointmentsSorted(),s=this.getIntervals(),r=this.getIntervalType(),p=this._getStartDate(),l=p.getTime(),g=this._oUTCEndDate,u=g.getTime(),h=[],d=!1,c=0,m=0,T=R.call(this),f=this._needAppointmentHorizontalFit();for(this.destroyAggregation("groupAppointments",!0),c=0;c<a.length;c++)if((e=a[c])&&e.getStartDate()){var v=n._createUniversalUTCDate(e.getStartDate(),void 0,!0),A=v.getTime();v.setUTCSeconds(0),v.setUTCMilliseconds(0);var _=e.getEndDate()?n._createUniversalUTCDate(e.getEndDate(),void 0,!0):n._createUniversalUTCDate(C.getInstance(864e12),void 0,!0),y=_.getTime();_.setUTCSeconds(0),_.setUTCMilliseconds(0);var D=!1;v.getTime()<l&&_.getTime()>=l&&(v=new o(l),D=!0),_.getTime()>u&&v.getTime()<=u&&(_=new o(u),D=!0);var S=(_.getTime()-v.getTime())/6e4;if(!D||0!=S){var b=0,I=0;if(t=void 0,i=void 0,v&&v.getTime()<=u&&_&&_.getTime()>=l&&A<=y){if(T&&r==U.Month&&_.getTime()-v.getTime()<6048e5){t=E.call(this,v,e,r,s,p,g,l,h);var M=n._createUniversalUTCDate(t.getEndDate(),void 0,!0);_.getTime()>M.getTime()&&(i=E.call(this,_,e,r,s,p,g,l,h))}if(f&&this._setHorizontalRoundingWidth(e,v,_),b=V.call(this,r,s,p,g,l,v),I=L.call(this,r,s,p,g,l,_),t){t._iBegin=b,t._iEnd=I,t._iLevel=-1,i&&(i._iBegin=b,i._iEnd=I,i._iLevel=-1);continue}h.push({appointment:e,begin:b,end:I,calculatedEnd:I,level:-1,size:this.getProperty("appointmentHeight")}),this._sFocusedAppointmentId&&this._sFocusedAppointmentId==e.getId()&&(d=!0)}}}var w=this.getAggregation("groupAppointments",[]);if(w.length>0)for(c=0;c<h.length;c++)if((e=h[c]).appointment._aAppointments&&e.appointment._aAppointments.length<=1){var H=!1;if(0==(t=e.appointment)._aAppointments.length)H=!0;else for(m=0;m<h.length;m++)if(h[m].appointment==t._aAppointments[0]){H=!0;break}if(H)h.splice(c,1),c--;else{for(m=0;m<w.length;m++)if(t!=(i=w[m]))for(var k=0;k<i._aAppointments.length;k++)if(t._aAppointments[0]==i._aAppointments[k]){i._aAppointments.splice(k,1),1==i._aAppointments.length?(this.removeAggregation("groupAppointments",i),i.destroy(),w=this.getAggregation("groupAppointments",[])):i.setProperty("title",i._aAppointments.length,!0);break}e.begin=t._iBegin,e.end=t._iEnd,e.calculatedEnd=t._iEnd,e.level=t._iLevel,e.appointment=t._aAppointments[0]}this.removeAggregation("groupAppointments",t),t.destroy(),w=this.getAggregation("groupAppointments",[])}return d||(h.length>0?this._sFocusedAppointmentId=h[0].appointment.getId():this._sFocusedAppointmentId=void 0),this._aVisibleAppointments=h,this._aVisibleAppointments}function E(e,t,i,a,s,r,p,l){var g,u=this.getAggregation("groupAppointments",[]),h=M.call(this).getFirstDayOfWeek(),d=e.getUTCDay(),m=new o(e.getTime());m.setUTCHours(0),m.setUTCMinutes(0),m.setUTCSeconds(0),m.setUTCMilliseconds(0),h<=d?m.setDate(m.getDate()-(d-h)):m.setDate(m.getDate()-(7-d-h));for(var T=0;T<u.length;T++){if(g=u[T],n._createUniversalUTCDate(g.getStartDate(),void 0,!0).getTime()==m.getTime())break;g=void 0}if(!g){var f=new o(m.getTime());f.setDate(f.getDate()+7),f.setMilliseconds(-1),(g=new c(this.getId()+"-Group"+u.length,{type:t.getType(),startDate:n._createLocalDate(C.getInstance(m.getTime()),!0),endDate:n._createLocalDate(C.getInstance(f.getTime()),!0)}))._aAppointments=[],this.addAggregation("groupAppointments",g,!0);var A=V.call(this,i,a,s,r,p,m),_=L.call(this,i,a,s,r,p,f);l.push({appointment:g,begin:A,end:_,calculatedEnd:_,level:-1,size:this.getProperty("appointmentHeight")})}return g._aAppointments.push(t),g.getType()!=v.None&&g.getType()!=t.getType()&&g.setType(v.None),g.setProperty("title",g._aAppointments.length,!0),g}function V(e,t,i,n,a,s){var r=0;if(e!=U.Month)r=100*(s.getTime()-a)/this._iRowSize;else{var p=new o(s.getTime());p.setUTCDate(1),p.setUTCHours(0),p.setUTCMinutes(0),p.setUTCSeconds(0),p.setUTCMilliseconds(0);var l=new o(p.getTime());l.setUTCMonth(l.getUTCMonth()+1),l.setMilliseconds(-1);var g=l.getTime()-p.getTime();r=100*(12*(p.getUTCFullYear()-i.getUTCFullYear())+p.getUTCMonth()-i.getUTCMonth())/t+100*(s.getTime()-p.getTime())/g/t}return r<0&&(r=0),r=Math.round(1e5*r)/1e5}function L(e,t,i,n,a,s){var r=0;if(e!=U.Month)r=100-100*(s.getTime()-a)/this._iRowSize;else{var p=new o(s.getTime());p.setUTCDate(1),p.setUTCHours(0),p.setUTCMinutes(0),p.setUTCSeconds(0),p.setUTCMilliseconds(0);var l=new o(p.getTime());l.setUTCMonth(l.getUTCMonth()+1),l.setMilliseconds(-1);var g=l.getTime()-p.getTime();r=100-(100*(12*(p.getUTCFullYear()-i.getUTCFullYear())+p.getUTCMonth()-i.getUTCMonth())/t+100*(s.getTime()-p.getTime())/g/t)}return r<0&&(r=0),r=Math.round(1e5*r)/1e5}function z(){var e=[];if(this.getShowIntervalHeaders()){var t,i=this.getIntervalHeaders(),a=this.getIntervals(),s=this.getIntervalType(),r=this._getStartDate(),p=r.getTime(),l=this._oUTCEndDate.getTime(),g=0,u=0;for(g=0;g<i.length;g++){t=i[g];var h=n._createUniversalUTCDate(t.getStartDate(),void 0,!0);h.setUTCSeconds(0),h.setUTCMilliseconds(0);var d=t.getEndDate()?n._createUniversalUTCDate(t.getEndDate(),void 0,!0):n._createUniversalUTCDate(C.getInstance(864e12),void 0,!0);if(d.setUTCSeconds(0),d.setUTCMilliseconds(0),h&&h.getTime()<=l&&d&&d.getTime()>=p){var c=new o(r.getTime()),m=new o(r.getTime());m.setUTCMinutes(m.getUTCMinutes()-1);var T=-1,f=-1;for(u=0;u<a;u++){switch(s){case U.Hour:m.setUTCHours(m.getUTCHours()+1),u>0&&c.setUTCHours(c.getUTCHours()+1);break;case U.Day:case U.Week:case U.OneMonth:case"OneMonth":m.setUTCDate(m.getUTCDate()+1),u>0&&c.setUTCDate(c.getUTCDate()+1);break;case U.Month:m.setUTCDate(1),m.setUTCMonth(m.getUTCMonth()+2),m.setUTCDate(0),u>0&&c.setUTCMonth(c.getUTCMonth()+1);break;default:throw new Error("Unknown IntervalType: "+s+"; "+this)}h&&h.getTime()<=c.getTime()&&d&&d.getTime()>=m.getTime()&&(T<0&&(T=u),f=u)}T>=0&&e.push({interval:T,appointment:t,last:f})}}}return this._aVisibleIntervalHeaders=e,this._aVisibleIntervalHeaders}function F(){if(!this._isOneMonthsRowOnSmallSizes()){var e=this.$("Apps"),t=e.innerWidth();if(!(t<=0)){var i=this.$("DummyApp"),n=i.outerHeight(!0);if(!(n<=0)){var a,s,o,r=i.outerWidth()/t*100,p=Math.ceil(1e3*r)/1e3,l=0,g=0,u=0,h=!1,d=this._needAppointmentHorizontalFit();for(this.getShowIntervalHeaders()&&(this.getShowEmptyIntervalHeaders()||this._getVisibleIntervalHeaders().length>0)&&(l=jQuery(this.$("AppsInt0").children(".sapUiCalendarRowAppsIntHead")[0]).outerHeight(!0),h=!0),u=0;u<this._aVisibleAppointments.length;u++){s=(a=this._aVisibleAppointments[u]).appointment.$();var c=!1;Math.floor(1e3*(100-a.calculatedEnd-a.begin))/1e3<p?(a.end=100-a.begin-r,a.end<0&&(a.end=0),c=!0,s.addClass("sapUiCalendarAppSmall")):s.hasClass("sapUiCalendarAppSmall")&&(a.end=a.calculatedEnd,c=!0,s.removeClass("sapUiCalendarAppSmall")),c&&(a.level=-1),c&&!d&&(this._bRTL?s.css("left",a.end+"%"):s.css("right",a.end+"%")),d&&(a.end=a.calculatedEnd)}for(u=0;u<this._aVisibleAppointments.length;u++){s=(a=this._aVisibleAppointments[u]).appointment.$();var m={};if(a.level<0){for(var T=0;T<this._aVisibleAppointments.length;T++){var f=this._aVisibleAppointments[T];a!=f&&a.begin<Math.floor(1e3*(100-f.end))/1e3&&Math.floor(1e3*(100-a.end))/1e3>f.begin&&f.level>=0&&this._setBlockedLevelsForAppointment(f,m)}a.level=this._getAppointmetLevel(m,a),s.attr("data-sap-level",a.level)}o=n*a.level+l,h||(o+=4),s.css("top",o+"px");var C=a.level;g<(C+=this._getAppointmentRowCount(a)-1)&&(g=C)}if(n=n*++g+l,h||(n+=4),this.getHeight()){var v=this.$("Apps").children(".sapUiCalendarRowAppsInt");for(u=0;u<v.length;u++){jQuery(v[u]).outerHeight(n)}}else e.outerHeight(n);i.css("display","none")}}}}function P(e,t){var i,n,a,s,o=0,r=p.getStaticId("sap.ui.unified","APPOINTMENT_SELECTED"),l=p.getStaticId("sap.ui.unified","APPOINTMENT_UNSELECTED"),g=!e.getSelected();if(t){var u=this.getAppointments(),h=this.getAggregation("groupAppointments",[]);for(jQuery.merge(u,h),o=0;o<u.length;o++)if((i=u[o]).getId()!==e.getId()&&i.getSelected()){i.setProperty("selected",!1,!0),i.$().removeClass("sapUiCalendarAppSel");for(o=0;o<this.aSelectedAppointments.length;o++)this.aSelectedAppointments[o]!==i.getId()&&this.aSelectedAppointments.splice(o);a=(n=i.$().attr("aria-labelledby"))?n.replace(r,l):"",i.$().attr("aria-labelledby",a)}}if((((s=e.$().attr("aria-describedby"))?s.replace(r,""):"").trim()+" "+r).trim(),e.getSelected()?(e.setProperty("selected",!1,!0),e.$().removeClass("sapUiCalendarAppSel"),e.$().attr("aria-labelledby",a),N(this,t)):(e.setProperty("selected",!0,!0),e.$().addClass("sapUiCalendarAppSel"),e.$().attr("aria-labelledby",undefined),N(this,t)),this._updateSelectedAppointmentsArray(e),e._aAppointments){for(o=0;o<e._aAppointments.length;o++)(i=e._aAppointments[o]).setProperty("selected",g,!0);this.fireSelect({appointments:e._aAppointments,multiSelect:!t,domRefId:e.getId()})}else this.fireSelect({appointment:e,multiSelect:!t,domRefId:e.getId()})}function O(e){var t=this._getPlanningCalendar();t&&t["_onRow"+e]()}function N(e,t){t&&O.call(e,"DeselectAppointment")}function W(e){for(var t,i=this.getAggregation("groupAppointments",[]),n=!1,a=0;a<i.length;a++){for(var s=i[a]._aAppointments,o=0;o<s.length;o++)if(s[o].getId()==e){t=i[a],n=!0;break}if(n)break}return t}function Y(e){if(this._sFocusedAppointmentId!=e){var t,i=this._getAppointmentsSorted(),a=this._aVisibleAppointments,s=0;for((t=W.call(this,e))&&(e=t.getId(),t=void 0),s=0;s<a.length;s++)if(a[s].appointment.getId()==e){t=a[s].appointment;break}if(t){var o=this.getFocusedAppointment().$(),r=t.$();this._sFocusedAppointmentId=t.getId(),o.attr("tabindex","-1"),r.attr("tabindex","0"),r.trigger("focus")}else{for(s=0;s<i.length;s++)if(i[s].getId()==e){t=i[s];break}if(t){this._sFocusedAppointmentId=t.getId();var p=H.call(this,t.getStartDate());this.setStartDate(n._createLocalDate(p,!0)),d(this.getDomRef(),document.activeElement)||setTimeout(function(){this.getFocusedAppointment().focus()}.bind(this),0),this.fireStartDateChange()}}}}function x(e,t){var i,n=this._sFocusedAppointmentId,a=this._getAppointmentsSorted(),s=this.getAggregation("groupAppointments",[]),o=0,r=0;for(r=0;r<s.length;r++)if(s[r].getId()==n){var p=s[r]._aAppointments;n=e?p[p.length-1].getId():p[0].getId();break}for(r=0;r<a.length;r++)if(a[r].getId()==n){o=r;break}e?o+=t:o-=t,o<0?o=0:o>=a.length&&(o=a.length-1),i=a[o],Y.call(this,i.getId())}function B(e){var t,i,a,s=this._getAppointmentsSorted(),r=new o(this._getStartDate()),p=new o(this._oUTCEndDate),l=this.getIntervalType();switch(r.setUTCHours(0),p.setUTCHours(0),p.setUTCMinutes(0),p.setUTCSeconds(0),l){case U.Hour:p.setUTCDate(p.getUTCDate()+1),p.setUTCMilliseconds(-1);break;case U.Day:case U.Week:case U.OneMonth:case"OneMonth":r.setUTCDate(1),p.setUTCMonth(p.getUTCMonth()+1),p.setUTCDate(1),p.setUTCMilliseconds(-1);break;case U.Month:r.setUTCMonth(0),r.setUTCDate(1),p.setUTCFullYear(p.getUTCFullYear()+1),p.setUTCMonth(1),p.setUTCDate(1),p.setUTCMilliseconds(-1);break;default:throw new Error("Unknown IntervalType: "+l+"; "+this)}for(var g=n._createLocalDate(r,!0),u=n._createLocalDate(p,!0),h=0;h<s.length;h++)if(s[h].getStartDate()>=g&&s[h].getStartDate()<=u){if(i=(t=s[h]).getId(),"saphome"==e.type)break}else if(s[h].getStartDate()>u)break;(a=W.call(this,i))&&(i=(t=a).getId()),i&&i!=this._sFocusedAppointmentId?Y.call(this,i):e._bPlanningCalendar&&t?t.focus():this.fireLeaveRow({type:e.type})}function j(e,t){var i,a=this.getIntervalType(),s=this._getStartDate(),r=new o(s.getTime()),p=!1,l=0,g=0;if(jQuery(t).hasClass("sapUiCalendarRowAppsSubInt")){p=!0;var u=jQuery(jQuery(t).parent()).children(".sapUiCalendarRowAppsSubInt");for(g=u.length,l=0;l<g;l++){if(u[l]==t)break}}switch(a){case U.Hour:r.setUTCHours(r.getUTCHours()+e),p?(r.setUTCMinutes(r.getUTCMinutes()+60*l/g),(i=new o(r.getTime())).setUTCMinutes(i.getUTCMinutes()+60/g)):(i=new o(r.getTime())).setUTCHours(i.getUTCHours()+1);break;case U.Day:case U.Week:case U.OneMonth:case"OneMonth":r.setUTCDate(r.getUTCDate()+e),p?(r.setUTCHours(r.getUTCHours()+24*l/g),(i=new o(r.getTime())).setUTCHours(i.getUTCHours()+24/g)):(i=new o(r.getTime())).setUTCDate(i.getUTCDate()+1);break;case U.Month:r.setUTCMonth(r.getUTCMonth()+e),p?(r.setUTCDate(r.getUTCDate()+l),(i=new o(r.getTime())).setUTCDate(i.getUTCDate()+1)):(i=new o(r.getTime())).setUTCMonth(i.getUTCMonth()+1);break;default:throw new Error("Unknown IntervalType: "+a+"; "+this)}i.setUTCMilliseconds(i.getUTCMilliseconds()-1),r=n._createLocalDate(r,!0),i=n._createLocalDate(i,!0),this.fireIntervalSelect({startDate:r,endDate:i,subInterval:p})}function G(e,t){var i=e.getStartDate()-t.getStartDate();return 0==i&&(i=t.getEndDate()-e.getEndDate()),i}return b.prototype.init=function(){this._bRTL=f.getRTL(),this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.unified");var e=this._oRb.getText("APPOINTMENT_DATE_TIME_DESCRIPTION",[M.call(this).getDatePattern("long"),M.call(this).getTimePattern("medium")]);this._oFormatAria=l.getDateTimeInstance({pattern:"EEEE "+e}),this._aVisibleAppointments=[],this._aVisibleIntervalHeaders=[],this.setStartDate(C.getInstance()),this._resizeProxy=jQuery.proxy(this.handleResize,this),this.aSelectedAppointments=[],this._fnCustomSortedAppointments=void 0},b.prototype.exit=function(){this._sResizeListener&&(g.deregister(this._sResizeListener),this._sResizeListener=void 0),this._sUpdateCurrentTime&&(clearTimeout(this._sUpdateCurrentTime),this._sUpdateCurrentTime=void 0),this._fnCustomSortedAppointments=void 0},b.prototype.onBeforeRendering=function(){this._aVisibleAppointments=[],w.call(this),k.call(this),z.call(this),this._sUpdateCurrentTime&&(clearTimeout(this._sUpdateCurrentTime),this._sUpdateCurrentTime=void 0),this.getAppointments().length?this.getAppointments().forEach(function(e){this._updateSelectedAppointmentsArray(e)}.bind(this)):this.aSelectedAppointments=[],this._oInvisibleMessage=m.getInstance()},b.prototype.onAfterRendering=function(){F.call(this),this.updateCurrentTimeVisualization(),this.getCheckResize()&&!this._sResizeListener&&(this._sResizeListener=g.register(this,this._resizeProxy))},b.prototype.onThemeChanged=function(e){if(this.getDomRef()){for(var t=0;t<this._aVisibleAppointments.length;t++){this._aVisibleAppointments[t].level=-1}this.handleResize(e)}},b.prototype.invalidate=function(t){if(t&&t instanceof c){for(var i=!1,n=0;n<this._aVisibleAppointments.length;n++)if(this._aVisibleAppointments[n].appointment==t){i=!0;break}i&&(this._aVisibleAppointments=[]),this._updateSelectedAppointmentsArray(t)}e.prototype.invalidate.apply(this,arguments)},b.prototype.setStartDate=function(e){e||(e=C.getInstance()),n._checkJSDateObject(e);var t=e.getFullYear();return n._checkYearInValidRange(t),this._oUTCStartDate=n._createUniversalUTCDate(e,void 0,!0),this.setProperty("startDate",e),this},b.prototype._getStartDate=function(){return this._oUTCStartDate||(this._oUTCStartDate=n._createUniversalUTCDate(this.getStartDate(),void 0,!0)),this._oUTCStartDate},b.prototype.setIntervalType=function(e){return this.setProperty("intervalType",e),this._aVisibleAppointments=[],this},b.prototype._getAppointmentReducedHeight=function(e){return!t.system.phone&&this.getAppointmentsReducedHeight()&&e.size===y.Regular},b.prototype.onfocusin=function(e){if(jQuery(e.target).hasClass("sapUiCalendarApp"))Y.call(this,e.target.id);else{for(var t,i=this._getVisibleAppointments(),n=!1,a=0;a<i.length;a++)if(t=i[a].appointment,d(t.getDomRef(),e.target)){n=!0,t.focus();break}n||(t=this.getFocusedAppointment())&&t.focus()}},b.prototype.applyFocusInfo=function(e){return this._sFocusedAppointmentId&&this.getFocusedAppointment().focus(),this},b.prototype.onsapleft=function(e){jQuery(e.target).hasClass("sapUiCalendarApp")&&x.call(this,this._bRTL,1),e.preventDefault(),e.stopPropagation()},b.prototype.onsapright=function(e){jQuery(e.target).hasClass("sapUiCalendarApp")&&x.call(this,!this._bRTL,1),e.preventDefault(),e.stopPropagation()},b.prototype.onsapup=function(e){this.fireLeaveRow({type:e.type})},b.prototype.onsapdown=function(e){this.fireLeaveRow({type:e.type})},b.prototype.onsaphome=function(e){B.call(this,e),e.preventDefault(),e.stopPropagation()},b.prototype.onsapend=function(e){B.call(this,e),e.preventDefault(),e.stopPropagation()},b.prototype.onsapselect=function(e){for(var t,i,n=this._getVisibleAppointments(),a=0;a<n.length;a++)if(t=n[a].appointment,d(t.getDomRef(),e.target)){var s=!(this.getMultipleAppointmentsSelection()||e.ctrlKey||e.metaKey);P.call(this,t,s);break}(i=t.getSelected()?"APPOINTMENT_SELECTED":"APPOINTMENT_UNSELECTED")&&this._oInvisibleMessage.announce(this._oRb.getText(i),S.Polite),e.stopPropagation(),e.preventDefault()},b.prototype.ontap=function(e){var t=this.$("Apps").children(".sapUiCalendarRowAppsInt"),i=0,n=!1;for(i=0;i<t.length;i++){var a=t[i];if(!this._isOneMonthsRowOnSmallSizes()&&d(a,e.target)){n=!0;break}}n?j.call(this,i,e.target):this.onsapselect(e)},b.prototype.onsapselectmodifiers=function(e){this.onsapselect(e)},b.prototype.handleResize=function(e){return e&&e.size&&e.size.width<=0||(this.$("DummyApp").css("display",""),F.call(this)),this},b.prototype.updateCurrentTimeVisualization=function(){var e=this.$("Now"),t=n._createUniversalUTCDate(C.getInstance(),void 0,!0),i=this.getIntervals(),a=this.getIntervalType(),s=this._getStartDate(),o=s.getTime(),r=this._oUTCEndDate,p=r.getTime();if(this._sUpdateCurrentTime=void 0,t.getTime()<=p&&t.getTime()>=o){var l=V.call(this,a,i,s,r,o,t),g=0;if(this._bRTL?e.css("right",l+"%"):e.css("left",l+"%"),e.css("display",""),this.getUpdateCurrentTime()){switch(a){case U.Hour:g=6e4;break;case U.Day:case U.Week:case U.OneMonth:case"OneMonth":g=18e5;break;default:g=-1}g>0&&(this._sUpdateCurrentTime=setTimeout(this.updateCurrentTimeVisualization.bind(this),g))}}else e.css("display","none");return this},b.prototype.getFocusedAppointment=function(){var e,t=this._getAppointmentsSorted(),i=this.getAggregation("groupAppointments",[]),n=0;for(n=0;n<i.length;n++)if(i[n].getId()==this._sFocusedAppointmentId){e=i[n];break}if(!e)for(n=0;n<t.length;n++)if(t[n].getId()==this._sFocusedAppointmentId){e=t[n];break}return e},b.prototype.focusAppointment=function(e){if(!(e&&e instanceof c))throw new Error("Appointment must be a CalendarAppointment; "+this);var t=e.getId();return this._sFocusedAppointmentId!=t?Y.call(this,t):e.focus(),this},b.prototype.focusNearestAppointment=function(e){n._checkJSDateObject(e);for(var t,i,a,s=this._getAppointmentsSorted(),o=0;o<s.length;o++)if((t=s[o]).getStartDate()>e){i=o>0?s[o-1]:t;break}return t&&(a=i&&Math.abs(t.getStartDate()-e)>=Math.abs(i.getStartDate()-e)?i:t,this.focusAppointment(a)),this},b.prototype._getVisibleAppointments=function(){return this._aVisibleAppointments},b.prototype._getVisibleIntervalHeaders=function(){return this._aVisibleIntervalHeaders},b.prototype._getNonWorkingDays=function(){if(1!==this.getIntervalSize())return[];var e=this.getNonWorkingDays();if(e)Array.isArray(e)||(e=[]);else{var t=M.call(this),i=t.getWeekendStart(),n=t.getWeekendEnd();e=[];for(var a=0;a<=6;a++)(i<=n&&a>=i&&a<=n||i>n&&(a>=i||a<=n))&&e.push(a)}return e},b.prototype._isOneMonthsRowOnSmallSizes=function(){return(this.getIntervalType()===U.OneMonth||"OneMonth"===this.getIntervalType())&&1===this.getIntervals()},b.prototype._getAppointmentsSorted=function(){var e=this.getAppointments(),t=G;return e.sort(this._fnCustomSortedAppointments?this._fnCustomSortedAppointments:t),e},b.prototype._setCustomAppointmentsSorterCallback=function(e){this._fnCustomSortedAppointments=e,this.invalidate()},b.prototype._calculateAppoitnmentVisualCue=function(e){if(function(e,t){var i,n=e.getAggregation("groupAppointments",[]);for(i=0;i<n.length;++i)if(t===n[i])return!0;return!1}(this,e))return{appTimeUnitsDifRowStart:0,appTimeUnitsDifRowEnd:0};var t,i=e.getStartDate(),n=e.getEndDate(),a=new o(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes()),s=new o(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes()),r=this.getIntervalType(),p=this.getStartDate(),l="Hour"===r?new o(p.getFullYear(),p.getMonth(),p.getDate(),p.getHours()):new o(p.getFullYear(),p.getMonth(),p.getDate()),g=this.getIntervals();switch(r){case"Hour":t=new o(p.getFullYear(),p.getMonth(),p.getDate(),p.getHours()+g);break;case"Day":case"Week":case"One Month":t=new o(p.getFullYear(),p.getMonth(),p.getDate()+g);break;case"Month":t=new o(p.getFullYear(),p.getMonth()+g,p.getDate())}return{appTimeUnitsDifRowStart:l.getTime()-a.getTime(),appTimeUnitsDifRowEnd:s.getTime()-t.getTime()}},b.prototype._updateSelectedAppointmentsArray=function(e){e.getSelected()?-1===this.aSelectedAppointments.indexOf(e.getId())&&this.aSelectedAppointments.push(e.getId()):this.aSelectedAppointments=this.aSelectedAppointments.filter((function(t){return t!==e.getId()}))},b.prototype._needAppointmentHorizontalFit=function(){var e,t,i=this._getPlanningCalendar();return!(!i||this.getAppointmentRoundWidth()===D.None)&&(e=i.getViewKey(),t=i._getView(e),i._getIntervals(t)>=20)},b.prototype._setHorizontalRoundingWidth=function(e,t,i){var n;if(this.getAppointmentRoundWidth()===D.HalfColumn)n=12;this._roundAppointment(e,t,i,n)},b.prototype._roundAppointment=function(e,t,i,n){var a,s;a=e.getStartDate().getHours()-e.getStartDate().getHours()%n,t.setUTCHours(a),t.setUTCMinutes(0),t.setUTCSeconds(0),t.setUTCMilliseconds(0),s=e.getEndDate().getHours()-e.getEndDate().getHours()%n+n,i.setUTCHours(s),i.setUTCMinutes(0),i.setUTCSeconds(0),i.setUTCMilliseconds(0)},b.prototype._setBlockedLevelsForAppointment=function(e,t){for(var i=this._getAppointmentRowCount(e),n=0;n<i;n++)t[e.level+n]=!0;return t},b.prototype._getAppointmentRowCount=function(e){var t,i=this._getAppointmentReducedHeight(e);switch(e.size){case y.HalfSize:t=1;break;case y.Regular:t=2,!i||e.appointment.getText()||e.appointment.getDescription()||(t=1);break;case y.Large:t=3;break;case y.Automatic:t=1,e.appointment.getText()&&(t+=1),e.appointment.getDescription()&&(t+=1)}return t},b.prototype._getAppointmetLevel=function(e,t){for(var i=0,n=this._getAppointmentRowCount(t),a=!0;a;)(a=this._isPosibleToPositionAppointment(i,e,n))?a=!1:(a=!0,i+=1);return i},b.prototype._isPosibleToPositionAppointment=function(e,t,i){for(var n=e;n<i+e;n++)if(t[n])return!1;return!0},b.prototype._getPlanningCalendar=function(){for(var e=this;null!==e.getParent();){if(e.isA("sap.m.PlanningCalendar"))return e;e=e.getParent()}},b}));