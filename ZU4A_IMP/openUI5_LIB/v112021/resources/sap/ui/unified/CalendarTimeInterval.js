sap.ui.define(["sap/m/Popover","sap/ui/core/Core","sap/ui/core/Control","sap/ui/core/LocaleData","sap/ui/unified/calendar/CalendarUtils","./calendar/Header","./calendar/TimesRow","./calendar/DatesRow","./calendar/MonthPicker","./calendar/YearPicker","sap/ui/core/date/UniversalDate","./library","sap/ui/core/format/DateFormat","sap/ui/Device","sap/ui/core/Locale","./CalendarTimeIntervalRenderer","sap/ui/dom/containsOrEquals","sap/base/util/deepEqual","sap/base/Log","sap/ui/unified/DateRange","sap/ui/core/date/UI5Date","sap/ui/unified/Calendar"],(function(e,t,a,i,s,o,r,n,h,g,c,l,u,D,_,d,p,T,C,M,m,v){"use strict";var U=a.extend("sap.ui.unified.CalendarTimeInterval",{metadata:{library:"sap.ui.unified",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},startDate:{type:"object",group:"Data"},intervalSelection:{type:"boolean",group:"Behavior",defaultValue:!1},singleSelection:{type:"boolean",group:"Behavior",defaultValue:!0},items:{type:"int",group:"Appearance",defaultValue:12},intervalMinutes:{type:"int",group:"Appearance",defaultValue:60},pickerPopup:{type:"boolean",group:"Appearance",defaultValue:!1},minDate:{type:"object",group:"Misc",defaultValue:null},maxDate:{type:"object",group:"Misc",defaultValue:null},_currentPicker:{type:"string",group:"Appearance",defaultValue:"timesRow",visibility:"hidden"}},aggregations:{selectedDates:{type:"sap.ui.unified.DateRange",multiple:!0,singularName:"selectedDate"},specialDates:{type:"sap.ui.unified.DateTypeRange",multiple:!0,singularName:"specialDate"},header:{type:"sap.ui.unified.calendar.Header",multiple:!1,visibility:"hidden"},timesRow:{type:"sap.ui.unified.calendar.TimesRow",multiple:!1,visibility:"hidden"},datesRow:{type:"sap.ui.unified.calendar.Month",multiple:!1,visibility:"hidden"},monthPicker:{type:"sap.ui.unified.calendar.MonthPicker",multiple:!1,visibility:"hidden"},yearPicker:{type:"sap.ui.unified.calendar.YearPicker",multiple:!1,visibility:"hidden"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:!0,singularName:"ariaLabelledBy"},legend:{type:"sap.ui.unified.CalendarLegend",multiple:!1}},events:{select:{},cancel:{},startDateChange:{}}},renderer:d}),f={TIMES_ROW:"timesRow",DATES_ROW:"datesRow",MONTH_PICKER:"monthPicker",YEAR_PICKER:"yearPicker"};function P(e,t,a){var i=new c(this._oMaxDate.getTime());i.setUTCMinutes(i.getUTCMinutes()-this.getIntervalMinutes()*(this._getItems()-1)),i.getTime()<this._oMinDate.getTime()&&(i=new c(this._oMinDate.getTime())).setUTCMinutes(i.getUTCMinutes()+this.getIntervalMinutes()*(this._getItems()-1)),e.getTime()<this._oMinDate.getTime()?e=new c(this._oMinDate.getTime()):e.getTime()>i.getTime()&&(e=i);var o=this.getAggregation("timesRow"),r=s._createLocalDate(e,!0);if(o.setStartDate(r),this._oUTCStartDate=new c(o._getStartDate().getTime()),r=s._createLocalDate(this._oUTCStartDate,!0),this.setProperty("startDate",r),x.call(this),t){var n=s._createLocalDate(this._getFocusedDate(),!0);o.checkDateFocusable(n)?o.setDate(n):(this._setFocusedDate(e),o.setDate(r))}a||this.fireStartDateChange()}function y(){if(!this._oUTCStartDate){var e=this.getAggregation("timesRow");e.setStartDate(s._createLocalDate(this._getFocusedDate(),!0)),this._oUTCStartDate=new c(e._getStartDate().getTime()),this._setFocusedDate(this._oUTCStartDate)}return this._oUTCStartDate}function w(e){var t=this._getFocusedDate(),a=this.getAggregation("timesRow");e?a.displayDate(s._createLocalDate(t,!0)):a.setDate(s._createLocalDate(t,!0)),x.call(this)}function S(){var e=this.getSelectedDates();if(e&&e[0]&&e[0].getStartDate())this._oFocusedDate=s._createUniversalUTCDate(e[0].getStartDate(),void 0,!0);else{var t=m.getInstance();this._oFocusedDate=s._createUniversalUTCDate(t,void 0,!0)}this._oFocusedDate.getTime()<this._oMinDate.getTime()?this._oFocusedDate=new c(this._oMinDate.getTime()):this._oFocusedDate.getTime()>this._oMaxDate.getTime()&&(this._oFocusedDate=new c(this._oMaxDate.getTime()))}function k(e){this._oPopup&&this._oPopup.isOpen()&&this._oPopup.close(),this._hideOverlay(),e||w.call(this),this._getCalendar()._closePickers()}function F(){var e=this._getFocusedDate(),t=this._getItems(),a=this.getAggregation("datesRow");a.getSelectedDates()[0].setStartDate(s._createLocalDate(e,!0));var i=new c(e.getTime());i.setUTCDate(1),i.setUTCMonth(i.getUTCMonth()+1),i.setUTCDate(0);var o=i.getUTCDate(),r=Math.floor(1.5*t);r>o&&(r=o),a.setDays(r),this.setProperty("_currentPicker",f.DATES_ROW),this._showOverlay(),X.call(this,e),this._iMode=1}function R(){var e=this._getFocusedDate(),t=this._getMonthPicker();this.setProperty("_currentPicker",f.MONTH_PICKER),this._showOverlay(),t.setMonth(e.getUTCMonth()),Q.call(this,e.getUTCFullYear(),t),this._iMode=2,A.call(this)}function b(){var e=this._getFocusedDate(),t=this._getYearPicker();this.setProperty("_currentPicker",f.YEAR_PICKER),this._showOverlay(),t.setDate(e.getJSDate()),I.call(this),this._iMode=3}function x(){Y.call(this),A.call(this)}function A(e){var t=new c(y.call(this).getTime()),a=this._getItems(),i=t.getJSDate().getUTCFullYear(),s=this._oMaxDate.getJSDate().getUTCFullYear(),o=this._oMinDate.getJSDate().getUTCFullYear(),r=t.getJSDate().getUTCMonth(),n=this._oMaxDate.getJSDate().getUTCMonth(),h=this._oMinDate.getJSDate().getUTCMonth(),g=t.getJSDate().getUTCDate(),l=this._oMaxDate.getJSDate().getUTCDate(),u=this._oMinDate.getJSDate().getUTCDate(),D=t.getJSDate().getUTCHours(),_=this._oMaxDate.getJSDate().getUTCHours(),d=this._oMinDate.getJSDate().getUTCHours(),p=t.getJSDate().getUTCMinutes(),T=this._oMaxDate.getJSDate().getUTCMinutes(),C=this._oMinDate.getJSDate().getUTCMinutes(),M=this.getAggregation("header");if(2==this._iMode&&!e){var m=this._getMonthPicker(),v=m.getMonths(),U=m.getStartMonth(),f=U+v-1;return 0==U||i==o&&U<=h?M.setEnabledPrevious(!1):M.setEnabledPrevious(!0),void(f>10||i==s&&f>=n?M.setEnabledNext(!1):M.setEnabledNext(!0))}if(i<o||i==o&&(e||r<h||r==h&&(g<u||g==u&&(D<d||D==d&&p<=C)))||(1==this._iMode||2==this._iMode)&&this.getPickerPopup()?M.setEnabledPrevious(!1):M.setEnabledPrevious(!0),t.setUTCMinutes(t.getUTCMinutes()+a*this.getIntervalMinutes()-1),i=t.getJSDate().getUTCFullYear(),r=t.getJSDate().getUTCMonth(),g=t.getJSDate().getUTCDate(),D=t.getJSDate().getUTCHours(),p=t.getJSDate().getUTCMinutes(),i>s||i==s&&(!e||r>n||r==n&&(g>l||g==l&&(D>_||D==_&&p>=T)))||(1==this._iMode||2==this._iMode)&&this.getPickerPopup()?M.setEnabledNext(!1):M.setEnabledNext(!0),1===this._iMode){var P=new c(t.getTime());P.setUTCDate(1),P.setUTCMonth(P.getUTCMonth()+1),P.setUTCDate(0);var w=this.getAggregation("datesRow").getDays();t.setUTCDate(1+(Math.ceil(t.getUTCDate()/w)-1)*w),P.getUTCDate()-t.getUTCDate()<w&&t.setUTCDate(P.getUTCDate()-w+1),(g=t.getUTCDate())<=1||i==o&&r==h&&g<=u?M.setEnabledPrevious(!1):M.setEnabledPrevious(!0),g+w>=P.getUTCDate()||i==s&&r==n&&g>=l?M.setEnabledNext(!1):M.setEnabledNext(!0)}}function I(){var e=this._getYearPicker(),t=e.getYears(),a=s._createUniversalUTCDate(e.getProperty("_middleDate").toLocalJSDate());a.setUTCFullYear(a.getUTCFullYear()+Math.floor(t/2));var i=this.getAggregation("header"),o=new c(this._oMaxDate);o.setUTCFullYear(o.getUTCFullYear()-Math.ceil(t/2)),o.setUTCMonth(11,31);var r=new c(this._oMinDate);r.setUTCFullYear(r.getUTCFullYear()+Math.floor(t/2)+1),r.setUTCMonth(0,1),a.getTime()>o.getTime()?i.setEnabledNext(!1):i.setEnabledNext(!0),a.getTime()<r.getTime()?i.setEnabledPrevious(!1):i.setEnabledPrevious(!0)}function Y(){var e,t,a,i=this.getAggregation("header"),o=y.call(this),r=this._getLocaleData(),n=[],h=[],g=!1;a="ja"===r.oLocale.sLanguage.toLowerCase()||"zh"===r.oLocale.sLanguage.toLowerCase()?u.getDateInstance({format:"d"}).format(o,!0):o.getUTCDate().toString(),this._bLongMonth||!this._bNamesLengthChecked?n=r.getMonthsStandAlone("wide"):(g=!0,n=r.getMonthsStandAlone("abbreviated"),h=r.getMonthsStandAlone("wide"));var c=o.getUTCMonth();e=n[c],g&&(t=h[n[c]]),this.getPickerPopup()?(t=a=u.getInstance({style:"long",strictParsing:!0,relative:!1},r.oLocale).format(s._createLocalDate(o,!0)),i.setTextButton1(a)):(i.setTextButton0(a),i.setTextButton1(e),i.setTextButton2(this._oYearFormat.format(o,!0))),g&&i.setAriaLabelButton1(t)}function E(e,t){var a,i=!1;e.getTime()<this._oMinDate.getTime()?(a=this._oMinDate,i=!0):e.getTime()>this._oMaxDate.getTime()?(a=this._oMaxDate,i=!0):a=e,this._setFocusedDate(a),(i||t)&&(q.call(this,a),w.call(this,!1),this.fireStartDateChange())}function L(e,t){if(e&&(!this._oFocusedDate||this._oFocusedDate.getTime()!=e.getTime())){s._checkJSDateObject(e);var a=(e=s._createUniversalUTCDate(e,void 0,!0)).getUTCFullYear();if(s._checkYearInValidRange(a),e.getTime()<this._oMinDate.getTime()||e.getTime()>this._oMaxDate.getTime())throw new Error("Date must not be in valid range (minDate and maxDate); "+this);this._setFocusedDate(e),this.getDomRef()&&0==this._iMode&&w.call(this,t)}}function O(e){1!=this._iMode?F.call(this):this.setProperty("_currentPicker",f.TIMES_ROW)}function J(e){var t;this.getPickerPopup()?this._showCalendarPicker():2!=this._iMode?(t=function(){var e=this._getMonthPicker();e._oItemNavigation.focusItem(e.getProperty("_focusedMonth")),e.removeDelegate(t)},R.call(this),this._getMonthPicker().addDelegate({onAfterRendering:t},this)):this.setProperty("_currentPicker",f.TIMES_ROW)}function B(e){var t;3!=this._iMode?(t=function(){var e=this._getYearPicker();e.focus(),e.removeDelegate(t)},b.call(this),this._getYearPicker().addDelegate({onAfterRendering:t},this)):this.setProperty("_currentPicker",f.TIMES_ROW)}function N(e){this.fireSelect()}function V(e){var t=s._createUniversalUTCDate(e.getParameter("date"),void 0,!0),a=e.getParameter("notVisible");E.call(this,t,a)}function H(e){var t=e.getSource().getSelectedDates()[0].getStartDate(),a=new c(this._getFocusedDate().getTime()),i=s._createUniversalUTCDate(t);a.setUTCFullYear(i.getUTCFullYear()),a.setUTCMonth(i.getUTCMonth(),i.getUTCDate()),E.call(this,a,!0),k.call(this)}function z(e){var t=new c(this._getFocusedDate().getTime()),a=e.oSource.getSelectedDates()[0],i=s._createUniversalUTCDate(a.getStartDate());this.getPickerPopup()&&i.getUTCMonth()!=t.getUTCMonth()||(t.setUTCDate(i.getUTCDate()),t.setUTCMonth(i.getUTCMonth()),t.setUTCFullYear(i.getUTCFullYear()),E.call(this,t,!0),this.setProperty("_currentPicker",f.TIMES_ROW)),this._addTimesRowFocusDelegate()}function W(e){var t=new c(this._getFocusedDate().getTime()),a=s._createUniversalUTCDate(e.getParameter("date"),void 0,!0);e.getParameter("otherMonth")&&a.getUTCMonth()==t.getUTCMonth()&&a.getUTCFullYear()==t.getUTCFullYear()&&X.call(this,a)}function j(e){var t=new c(this._getFocusedDate().getTime()),a=this._getMonthPicker().getMonth();t.setUTCMonth(a),a!=t.getUTCMonth()&&t.setUTCDate(0),E.call(this,t,!0),this.setProperty("_currentPicker",f.TIMES_ROW),this._addTimesRowFocusDelegate()}function K(e){var t=new c(this._getFocusedDate().getTime()),a=this._getYearPicker(),i=s._createUniversalUTCDate(a.getDate()),o=t.getUTCMonth();i.setUTCMonth(t.getUTCMonth(),t.getUTCDate()),i.setUTCHours(t.getUTCHours()),i.setUTCMinutes(t.getUTCMinutes()),o!=(t=i).getUTCMonth()&&t.setUTCDate(0),E.call(this,t,!0),this.setProperty("_currentPicker",f.TIMES_ROW),this._addTimesRowFocusDelegate()}function q(e){var t=this.getAggregation("timesRow"),a=y.call(this),i=t._oItemNavigation.getFocusedIndex();(a=new c(e.getTime())).setUTCMinutes(a.getUTCMinutes()-i*this.getIntervalMinutes()),P.call(this,a,!1,!0)}function X(e){var t=this.getAggregation("datesRow"),a=this.getAggregation("header");if(this.getPickerPopup())a.setEnabledPrevious(!1),a.setEnabledNext(!1);else{var i=new c(e.getTime());i.setUTCDate(1),i.setUTCMonth(i.getUTCMonth()+1),i.setUTCDate(0);var o=t.getDays(),r=new c(e.getTime());r.setUTCDate(1+(Math.ceil(e.getUTCDate()/o)-1)*o),i.getUTCDate()-r.getUTCDate()<o&&r.setUTCDate(i.getUTCDate()-o+1),t.setStartDate(s._createLocalDate(r,!0));var n=r.getJSDate().getUTCFullYear(),h=this._oMaxDate.getJSDate().getUTCFullYear(),g=this._oMinDate.getJSDate().getUTCFullYear(),l=r.getJSDate().getUTCMonth(),u=this._oMaxDate.getJSDate().getUTCMonth(),D=this._oMinDate.getJSDate().getUTCMonth(),_=r.getJSDate().getUTCDate(),d=this._oMaxDate.getJSDate().getUTCDate(),p=this._oMinDate.getJSDate().getUTCDate();_<=1||n==g&&l==D&&_<=p?a.setEnabledPrevious(!1):a.setEnabledPrevious(!0),_+o>=i.getUTCDate()||n==h&&l==u&&_>=d?a.setEnabledNext(!1):a.setEnabledNext(!0),this._oFocusDatesRowDelegate||(this._oFocusDatesRowDelegate={onAfterRendering:function(){this.focus()}},t.addDelegate(this._oFocusDatesRowDelegate,t))}t.setDate(s._createLocalDate(e,!0))}function G(a){if(!this._oPopup){var i=new e({placement:"VerticalPreferredBottom",showHeader:!1,showArrow:!1,verticalScrolling:!1});i.oPopup.setDurations(0,0),i.addEventDelegate({onsapescape:this._oCalendar.onsapescape},this._oCalendar),this._oPopup=i}this._oPopup.addContent(a),this._oPopup.attachAfterClose((function(){this._hideOverlay(),this._addTimesRowFocusDelegate()}),this),this._oPopup.attachAfterOpen((function(){var e=s.$("B1"),a=this._oPopup.$(),i=Math.floor((a.width()-e.width())/2);this._oPopup.setOffsetX(t.getConfiguration().getRTL()?i:-i);var o=e.height();this._oPopup.setOffsetY("Top"===this._oPopup._getCalculatedPlacement()?o:-o)}),this);var s=this.getAggregation("header");this._oPopup.openBy(s.getDomRef("B1"))}function Q(e,t){var a=0,i=11;e==this._oMinDate.getUTCFullYear()&&(a=this._oMinDate.getUTCMonth()),e==this._oMaxDate.getUTCFullYear()&&(i=this._oMaxDate.getUTCMonth()),t.setMinMax(a,i)}function Z(e){A.call(this)}function ee(e){I.call(this)}return U.prototype.init=function(){this._iMode=0,this._oYearFormat=u.getDateInstance({format:"y"}),this.data("sap-ui-fastnavgroup","true",!0),this._oMinDate=new c(m.getInstance(Date.UTC(1,0,1))),this._oMinDate.getJSDate().setUTCFullYear(1),this._oMaxDate=new c(m.getInstance(Date.UTC(9999,11,31,23,59,59))),this._initializeHeader(),this._initializeTimesRow(),this._initializeMonthPicker(),this._initializeYearPicker(),this.setPickerPopup(!1),this._iItemsHead=15},U.prototype._initializeHeader=function(){var e=new o(this.getId()+"--Head"),a=t.getLibraryResourceBundle("sap.m");e.attachEvent("pressPrevious",this._handlePrevious,this),e.attachEvent("pressNext",this._handleNext,this),this.setAggregation("header",e),e&&(e.setAriaLabelButton0(a.getText("DATETIMEPICKER_DATE")),e.setAriaLabelButton1(a.getText("MOBISCROLL_MONTH")),e.setAriaLabelButton2(a.getText("MOBISCROLL_YEAR")))},U.prototype._initializeTimesRow=function(){var e=new r(this.getId()+"--TimesRow");e.attachEvent("focus",V,this),e.attachEvent("select",N,this),e._bNoThemeChange=!0,this.setAggregation("timesRow",e)},U.prototype._initializeMonthPicker=function(){var e=this._createMonthPicker();this.setAggregation("monthPicker",e),e._setSelectedDatesControlOrigin(this)},U.prototype._initializeYearPicker=function(){var e=this._createYearPicker();this.setAggregation("yearPicker",e),e._setSelectedDatesControlOrigin(this)},U.prototype._createDatesRow=function(){var e=new n(this.getId()+"--DatesRow",{days:18,selectedDates:[new M(this.getId()+"--Range")]});return e.attachEvent("focus",W,this),e.attachEvent("select",z,this),e._bNoThemeChange=!0,e.getIntervalSelection=function(){return this.getProperty("intervalSelection")},e.getSingleSelection=function(){return this.getProperty("singleSelection")},e.getSelectedDates=function(){return this.getAggregation("selectedDates",[])},e.getSpecialDates=function(){return this.getAggregation("specialDates",[])},e.getAriaLabelledBy=function(){return this.getAssociation("ariaLabelledBy",[])},e},U.prototype._createMonthPicker=function(){var e=new h(this.getId()+"--MP",{columns:0,months:6});return e.attachEvent("select",j,this),e._bNoThemeChange=!0,e.attachEvent("pageChange",Z,this),e},U.prototype._createYearPicker=function(){var e=new g(this.getId()+"--YP",{columns:0,years:6});return e.attachEvent("select",K,this),e.attachEvent("pageChange",ee,this),e._oMinDate.setYear(this._oMinDate.getUTCFullYear()),e._oMaxDate.setYear(this._oMaxDate.getUTCFullYear()),e},U.prototype.exit=function(){this._oPopup&&(this._oPopup.destroy(),this._oPopup=null),this._oCalendar&&(this._oCalendar.removeDelegate(this._oFocusCalendarDelegate),this._oCalendar.destroy(),this._oCalendar=null),this._sInvalidateContent&&clearTimeout(this._sInvalidateContent)},U.prototype.onBeforeRendering=function(){var e=this.getAggregation("timesRow"),t=this._getFocusedDate();x.call(this),e.displayDate(s._createLocalDate(t,!0))},U.prototype._setAriaRole=function(e){var t=this.getAggregation("timesRow");return t._setAriaRole(e),t.invalidate(),this},U.prototype._getCalendar=function(){var e;return this._oCalendar||((e=new v(this.getId()+"--Cal",{})).attachEvent("select",H,this),e.attachEvent("cancel",(function(e){this._oPopup.close();var t=this.getAggregation("header").getDomRef("B1");t&&t.focus()}),this),this._oFocusCalendarDelegate={onAfterRendering:function(){this.focus()}},e.addDelegate(this._oFocusCalendarDelegate,e),this._oCalendar=e),this._oCalendar},U.prototype._getMonthPicker=function(){return this.getAggregation("monthPicker")},U.prototype._getYearPicker=function(){return this.getAggregation("yearPicker")},U.prototype.setStartDate=function(e){if(s._checkJSDateObject(e),T(this.getStartDate(),e))return this;var t=e.getFullYear();s._checkYearInValidRange(t);var a=this.getMinDate();a&&e.getTime()<a.getTime()&&(C.warning("startDate < minDate -> minDate as startDate set",this),e=m.getInstance(a));var i=this.getMaxDate();i&&e.getTime()>i.getTime()&&(C.warning("startDate > maxDate -> maxDate as startDate set",this),e=m.getInstance(i)),this.setProperty("startDate",e);var o=this.getAggregation("timesRow");o.setStartDate(e),this._oUTCStartDate=new c(o._getStartDate().getTime()),x.call(this);var r=s._createLocalDate(this._getFocusedDate(),!0);return o.checkDateFocusable(r)||(this._setFocusedDate(this._oUTCStartDate),o.displayDate(e)),this},U.prototype.removeAllSelectedDates=function(){return this._bDateRangeChanged=!0,this.removeAllAggregation("selectedDates")},U.prototype.destroySelectedDates=function(){return this._bDateRangeChanged=!0,this.destroyAggregation("selectedDates")},U.prototype.removeAllSpecialDates=function(){return this._bDateRangeChanged=!0,this.removeAllAggregation("specialDates")},U.prototype.destroySpecialDates=function(){return this._bDateRangeChanged=!0,this.destroyAggregation("specialDates")},U.prototype.setIntervalMinutes=function(e){if(e>=720)throw new Error("Only intervals < 720 minutes are allowed; "+this);if(1440%e>0)throw new Error("A day must be divisible by the interval size; "+this);this.setProperty("intervalMinutes",e);var t=this.getAggregation("timesRow"),a=s._createLocalDate(this._getFocusedDate(),!0);if(!t.checkDateFocusable(a)){var i=y.call(this);this._setFocusedDate(i),t.setDate(s._createLocalDate(i,!0))}return this},U.prototype.setLocale=function(e){return this._sLocale!=e&&(this._sLocale=e,this._oLocaleData=void 0,this.invalidate()),this},U.prototype.getLocale=function(){return this._sLocale||(this._sLocale=t.getConfiguration().getFormatSettings().getFormatLocale().toString()),this._sLocale},U.prototype._getFocusedDate=function(){return this._oFocusedDate||S.call(this),this._oFocusedDate},U.prototype._setFocusedDate=function(e){if(!(e instanceof c))throw new Error("Date must be a UniversalDate object "+this);this._oFocusedDate=new c(e.getTime())},U.prototype.focusDate=function(e){var t=!1;if(!this.getAggregation("timesRow").checkDateFocusable(e)){var a=s._createUniversalUTCDate(e,void 0,!0);q.call(this,a),t=!0}return L.call(this,e,!1),t&&this.fireStartDateChange(),this},U.prototype.displayDate=function(e){return L.call(this,e,!0),this},U.prototype.setItems=function(e){e=Math.max(1,e),this.setProperty("items",e),e=this._getItems();var t=this.getAggregation("timesRow");t.setItems(e);var a=s._createLocalDate(this._getFocusedDate(),!0);if(!t.checkDateFocusable(a)){var i=y.call(this);this._setFocusedDate(i),t.setDate(s._createLocalDate(i,!0))}if(!this.getPickerPopup()){var o=this.getAggregation("datesRow"),r=Math.floor(1.5*e);r>31&&(r=31),o.setDays(r);var n=this._getMonthPicker(),h=Math.floor(e/2);h>12&&(h=12),n.setMonths(h);var g=this._getYearPicker(),c=Math.floor(e/2);c>20&&(c=20),g.setYears(c)}return x.call(this),this},U.prototype._getItems=function(){var e=this.getItems();return D.system.phone&&e>6?6:e},U.prototype._getLocaleData=function(){if(!this._oLocaleData){var e=this.getLocale(),t=new _(e);this._oLocaleData=i.getInstance(t)}return this._oLocaleData},U.prototype.setPickerPopup=function(e){var t,a,i=this.getAggregation("header");return this.setProperty("pickerPopup",e),e?(i.setVisibleButton0(!1),i.setVisibleButton1(!0),i.setVisibleButton2(!1),i.detachEvent("pressButton1",J,this),i.attachEvent("pressButton1",J,this),this.getAggregation("datesRow")&&this.getAggregation("datesRow").destroy(),this._getMonthPicker()&&this._getMonthPicker().destroy(),this._getYearPicker()&&this._getYearPicker().destroy()):(i.setVisibleButton0(!0),i.setVisibleButton1(!0),i.setVisibleButton2(!0),i.detachEvent("pressButton0",O,this),i.attachEvent("pressButton0",O,this),i.detachEvent("pressButton1",J,this),i.attachEvent("pressButton1",J,this),i.detachEvent("pressButton2",B,this),i.attachEvent("pressButton2",B,this),this.getAggregation("datesRow")||this.setAggregation("datesRow",this._createDatesRow()),this._getYearPicker()||this.setAggregation("yearPicker",this._createYearPicker()),this._getMonthPicker()||this.setAggregation("monthPicker",this._createMonthPicker()),t=this._getMonthPicker(),a=this._getYearPicker(),t.setColumns(0),t.setMonths(6),a.setColumns(0),a.setYears(6)),this},U.prototype.setMinDate=function(e){var t,a;return T(e,this.getMinDate())||(e?(s._checkJSDateObject(e),this._oMinDate=s._createUniversalUTCDate(e,void 0,!0),t=this.getAggregation("timesRow"),this._oMinDate=t._getIntervalStart(this._oMinDate),a=this._oMinDate.getUTCFullYear(),s._checkYearInValidRange(a),this._oMaxDate.getTime()<this._oMinDate.getTime()&&(C.warning("minDate > maxDate -> maxDate set to end of the month",this),this._oMaxDate=s._createUniversalUTCDate(e,void 0,!0),s._updateUTCDate(this._oMaxDate,null,this._oMaxDate.getUTCMonth()+1,0,23,59,59,0),this.setProperty("maxDate",s._createLocalDate(this._oMaxDate,!0))),this._oFocusedDate&&this._oFocusedDate.getTime()<this._oMinDate.getTime()&&(C.warning("focused date < minDate -> minDate focused",this),this.focusDate(e)),this._oUTCStartDate&&this._oUTCStartDate.getTime()<this._oMinDate.getTime()&&(C.warning("start date < minDate -> minDate set as start date",this),P.call(this,new c(this._oMinDate.getTime()),!0,!0))):s._updateUTCDate(this._oMinDate.getJSDate(),1,0,1,0,0,0,0),this.setProperty("minDate",e),this.getPickerPopup()?this._getCalendar().setMinDate(e):this._getYearPicker()._oMinDate.setYear(this._oMinDate.getUTCFullYear())),this},U.prototype.setMaxDate=function(e){var t,a,i,o;return T(e,this.getMaxDate())||(e?(s._checkJSDateObject(e),this._oMaxDate=s._createUniversalUTCDate(e,void 0,!0),t=this.getAggregation("timesRow"),this._oMaxDate=t._getIntervalStart(this._oMaxDate),this._oMaxDate.setUTCMinutes(this._oMaxDate.getUTCMinutes()+this.getIntervalMinutes()),this._oMaxDate.setUTCMilliseconds(-1),a=this._oMaxDate.getUTCFullYear(),s._checkYearInValidRange(a),this._oMinDate.getTime()>this._oMaxDate.getTime()&&(C.warning("maxDate < minDate -> minDate set to begin of the month",this),this._oMinDate=s._createUniversalUTCDate(e,void 0,!0),s._updateUTCDate(this._oMinDate,null,null,1,0,0,0,0),this.setProperty("minDate",s._createLocalDate(this._oMinDate,!0))),this._oFocusedDate&&this._oFocusedDate.getTime()>this._oMaxDate.getTime()&&(C.warning("focused date > maxDate -> maxDate focused",this),this.focusDate(e)),this._oUTCStartDate&&((i=new c(this._oUTCStartDate.getTime())).setUTCMinutes(i.getUTCMinutes()+this.getIntervalMinutes()*(this._getItems()-1)),i.getTime()>this._oMaxDate.getTime()&&((o=new c(this._oMaxDate.getTime())).setUTCMinutes(o.getUTCMinutes()-this.getIntervalMinutes()*(this._getItems()-1)),o.getTime()>=this._oMinDate.getTime()&&(C.warning("end date > maxDate -> maxDate set as end date",this),P.call(this,o,!0,!0))))):s._updateUTCDate(this._oMaxDate.getJSDate(),9999,11,31,23,59,59,0),this.setProperty("maxDate",e),this.getPickerPopup()?this._getCalendar().setMaxDate(e):this._getYearPicker()._oMaxDate.setYear(this._oMaxDate.getUTCFullYear())),this},U.prototype.onclick=function(e){e.isMarked("delayedMouseEvent")||e.target.id==this.getId()+"-cancel"&&this.onsapescape(e)},U.prototype.onmousedown=function(e){e.preventDefault(),e.setMark("cancelAutoClose")},U.prototype.onsapescape=function(e){if(this.getPickerPopup())k.call(this),this.fireCancel();else switch(this._iMode){case 0:this.fireCancel();break;case 1:case 2:case 3:this.setProperty("_currentPicker",f.TIMES_ROW)}},U.prototype.setProperty=function(){var e=arguments[0],t=arguments[1];if(a.prototype.setProperty.apply(this,arguments),"_currentPicker"===e)switch(t){case"timesRow":this._iMode=0;break;case"datesRow":this._iMode=1;break;case"monthPicker":this._iMode=2;break;case"yearPicker":this._iMode=3;break;default:return}return this},U.prototype._handlePrevious=function(e){var t,a,i,o,r,n,h,g=this._getFocusedDate();switch(this._iMode){case 0:t=this._getItems(),a=new c(y.call(this).getTime()),i=this.getIntervalMinutes(),a.setUTCMinutes(a.getUTCMinutes()-t*i),g.setUTCMinutes(g.getUTCMinutes()-t*i),this._setFocusedDate(g),P.call(this,a,!0);break;case 1:this.getPickerPopup()||(o=this.getAggregation("datesRow"),r=s._createUniversalUTCDate(o.getDate()),n=o.getDays(),r.getUTCDate()<=n?r.setUTCDate(1):r.setUTCDate(r.getUTCDate()-n),X.call(this,r));break;case 2:this.getPickerPopup()||((h=this._getMonthPicker()).getMonths()<12?(h.previousPage(),A.call(this)):(g.setUTCFullYear(g.getUTCFullYear()-1),q.call(this,g),this._setFocusedDate(g),x.call(this),Q.call(this,g.getUTCFullYear(),h),this.fireStartDateChange()));break;case 3:this.getPickerPopup()||(this._getYearPicker().previousPage(),I.call(this))}},U.prototype._handleNext=function(e){var t=this._getFocusedDate();switch(this._iMode){case 0:var a=this._getItems(),i=new c(y.call(this).getTime()),o=this.getIntervalMinutes();i.setUTCMinutes(i.getUTCMinutes()+a*o),t.setUTCMinutes(t.getUTCMinutes()+a*o),this._setFocusedDate(t),P.call(this,i,!0);break;case 1:if(!this.getPickerPopup()){var r=this.getAggregation("datesRow"),n=s._createUniversalUTCDate(r.getDate()),h=new c(n.getTime());h.setUTCDate(1),h.setUTCMonth(h.getUTCMonth()+1),h.setUTCDate(0);var g=r.getDays();n.getUTCDate()+g>h.getUTCDate()?n.setUTCDate(h.getUTCDate()):n.setUTCDate(n.getUTCDate()+g),X.call(this,n)}break;case 2:if(!this.getPickerPopup()){var l=this._getMonthPicker();l.getMonths()<12?(l.nextPage(),A.call(this)):(t.setUTCFullYear(t.getUTCFullYear()+1),q.call(this,t),this._setFocusedDate(t),x.call(this),Q.call(this,t.getUTCFullYear(),l),this.fireStartDateChange())}break;case 3:if(!this.getPickerPopup())this._getYearPicker().nextPage(),I.call(this)}},U.prototype._getShowItemHeader=function(){return this.getItems()>this._iItemsHead},U.prototype._showCalendarPicker=function(){var e=s._createLocalDate(this._getFocusedDate(),!0),t=this._getCalendar(),a=new M({startDate:e});t.displayDate(e,!1),t.removeAllSelectedDates(),t.addSelectedDate(a),t.setMinDate(this.getMinDate()),t.setMaxDate(this.getMaxDate()),G.call(this,t),this._showOverlay()},U.prototype._showOverlay=function(){this.$("contentOver").css("display","")},U.prototype._hideOverlay=function(){this.$("contentOver").css("display","none")},U.prototype._addTimesRowFocusDelegate=function(){var e={onAfterRendering:function(){this._oItemNavigation.focusItem(this._oItemNavigation.getFocusedIndex()),this.removeDelegate(e)}},t=this.getAggregation("timesRow");t.addDelegate(e,t)},U}));