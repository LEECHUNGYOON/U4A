sap.ui.define(["sap/ui/unified/calendar/CalendarUtils","sap/ui/core/format/TimezoneUtil","sap/ui/core/Core","sap/ui/core/date/UniversalDate","sap/ui/unified/CalendarLegendRenderer","sap/ui/core/date/UI5Date","sap/ui/unified/library","sap/base/Log"],(function(e,t,a,s,n,i,r,l){"use strict";var o=r.CalendarDayType,d={apiVersion:2,render:function(e,t){var a=t._getStartDate(),s=t.getTooltip_AsString(),n=t.getId(),i={value:n+"-Descr",append:!0};e.openStart("div",t),e.class("sapUiCalTimesRow"),e.class("sapUiCalRow"),s&&e.attr("title",s),t._getShowHeader()&&(i.value=i.value+" "+n+"-Head"),e.accessibilityState(t,{role:"grid",readonly:"true",multiselectable:!t.getSingleSelection()||t.getIntervalSelection(),labelledby:i}),e.openEnd(),e.openStart("span",n+"-Descr"),e.style("display","none"),e.openEnd(),e.text(t._rb.getText("CALENDAR_DIALOG")),e.close("span"),t.getIntervalSelection()&&(e.openStart("span",n+"-Start"),e.style("display","none"),e.openEnd(),e.text(t._rb.getText("CALENDAR_START_TIME")),e.close("span"),e.openStart("span",n+"-End"),e.style("display","none"),e.openEnd(),e.text(t._rb.getText("CALENDAR_END_TIME")),e.close("span")),this.renderRow(e,t,a),e.close("div")},renderRow:function(e,t,a){var s=t.getId();this.renderHeader(e,t,a),e.openStart("div",s+"-times"),e.class("sapUiCalItems"),e.attr("role","row"),e.openEnd(),this.renderTimes(e,t,a),e.close("div")},renderHeader:function(e,t,a){if(t._getShowHeader()){var s=t._getLocaleData(),n=t.getId();e.openStart("div",n+"-Head"),e.openEnd(),this.renderHeaderLine(e,t,s,a),e.close("div")}},renderHeaderLine:function(e,t,a,s){var n=t._getFormatDate(),i=t.getId(),r=t.getItems(),l=t._getIntervalStart(s),o=t.getIntervalMinutes(),d="",c=0,p=[],m=0;for(m=0;m<r;m++)c=n.format(l,!0),p.length>0&&p[p.length-1].sDay==c?p[p.length-1].iItems++:p.push({sDay:c,iItems:1}),l.setUTCMinutes(l.getUTCMinutes()+o);for(m=0;m<p.length;m++){var g=p[m];d=100/r*g.iItems+"%",e.openStart("div",i+"-Head"+m),e.class("sapUiCalHeadText"),e.style("width",d),e.openEnd(),e.text(g.sDay),e.close("div")}},renderTimes:function(e,t,a){for(var s=this.getHelper(t,a),n=t.getItems(),i=100/n+"%",r=t._getIntervalStart(a),l="",o="",d=0;d<n;d++)s.oFormatTimeAmPm&&(l==(o=s.oFormatTimeAmPm.format(r,!0))?o="":l=o),this.renderTime(e,t,r,s,i,o),r.setUTCMinutes(r.getUTCMinutes()+s.iMinutes)},getHelper:function(t,a){var s={};s.sLocale=t._getLocale(),s.oLocaleData=t._getLocaleData(),s.oNow=e._createUniversalUTCDate(i.getInstance(),void 0,!0),s.sCurrentTime=t._rb.getText("CALENDAR_CURRENT_TIME"),s.sId=t.getId(),s.oFormatLong=t._getFormatLong(),s.oFormatTime=t._getFormatTime(),s.oFormatTimeAmPm=t._oFormatTimeAmPm,s.iMinutes=t.getIntervalMinutes();var n=t.getLegend();if(!n)return s;if(0===n.length)return s;if(n){var r=sap.ui.getCore().byId(n);if(r){if(!(r instanceof sap.ui.unified.CalendarLegend))throw new Error(r+" is not an sap.ui.unified.CalendarLegend. "+t);s.oLegend=r}else l.warning("CalendarLegend "+n+" does not exist!",t)}return s},renderTime:function(e,t,a,i,r,l){var d=t._getAriaRole(),c={role:d,selected:"gridcell"!==d&&null,label:"",describedby:""},p=t._oFormatYyyyMMddHHmm.format(a.getJSDate(),!0),m=t._checkDateSelected(a),g=t._getDateType(a),u=t._checkTimeEnabled(a);e.openStart("div",i.sId+"-"+p),e.class("sapUiCalItem"),r&&e.style("width",r);var T=new s(a.getTime());T.setUTCMinutes(T.getUTCMinutes()+i.iMinutes),a.getTime()<=i.oNow.getTime()&&T.getTime()>i.oNow.getTime()&&(e.class("sapUiCalItemNow"),c.label=i.sCurrentTime+" "),m>0&&(e.class("sapUiCalItemSel"),"gridcell"===d&&(c.selected=!0)),2==m?(e.class("sapUiCalItemSelStart"),c.describedby=c.describedby+" "+i.sId+"-Start"):3==m?(e.class("sapUiCalItemSelEnd"),c.describedby=c.describedby+" "+i.sId+"-End"):4==m?e.class("sapUiCalItemSelBetween"):5==m&&(e.class("sapUiCalItemSelStart"),e.class("sapUiCalItemSelEnd"),c.describedby=c.describedby+" "+i.sId+"-Start",c.describedby=c.describedby+" "+i.sId+"-End"),g&&g.type!=o.None&&(e.class("sapUiCalItem"+g.type),g.tooltip&&e.attr("title",g.tooltip)),u||(e.class("sapUiCalItemDsbl"),c.disabled=!0),e.attr("tabindex","-1"),e.attr("data-sap-time",p),c.label=c.label+i.oFormatLong.format(a,!0),g&&g.type!=o.None&&n.addCalendarTypeAccInfo(c,g.type,i.oLegend),e.accessibilityState(null,c),e.openEnd(),g&&g.type!=o.None&&(e.openStart("div"),e.class("sapUiCalSpecialDate"),g.color&&e.style("background-color",g.color),e.openEnd(),e.close("div")),e.openStart("span"),e.class("sapUiCalItemText"),e.openEnd(),e.text(i.oFormatTime.format(a,!0)),l&&(e.openStart("span"),e.class("sapUiCalItemTextAmPm"),e.openEnd(),e.text(l),e.close("span")),e.close("span"),e.close("div")}};return d}),!0);