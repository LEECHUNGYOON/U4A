sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/Device","sap/ui/core/Element","./InputBase","./DateTimeField","./Button","./ResponsivePopover","sap/ui/core/date/UniversalDate","./library","sap/ui/core/Control","sap/ui/core/library","./DatePickerRenderer","sap/base/util/deepEqual","sap/base/assert","sap/base/Log","sap/ui/core/IconPool","./InstanceManager","sap/ui/unified/Calendar","sap/ui/unified/DateRange","sap/ui/unified/DateTypeRange","sap/ui/unified/calendar/CustomMonthPicker","sap/ui/unified/calendar/CustomYearPicker","sap/ui/core/LabelEnablement","sap/ui/unified/library","sap/ui/core/Configuration","sap/ui/unified/calendar/CalendarUtils","sap/ui/core/date/UI5Date","sap/ui/core/date/CalendarWeekNumbering","sap/ui/core/Core","sap/ui/dom/jquery/cursorPos"],(function(jQuery,t,e,a,i,s,o,n,r,p,h,l,u,g,d,c,_,y,D,f,m,C,v,P,T,b,V,S,M){"use strict";var I=h.CalendarType,w=sap.ui.getCore().getLibraryResourceBundle("sap.m"),E=i.extend("sap.m.DatePicker",{metadata:{library:"sap.m",properties:{displayFormatType:{type:"string",group:"Appearance",defaultValue:""},secondaryCalendarType:{type:"sap.ui.core.CalendarType",group:"Appearance"},minDate:{type:"object",group:"Misc",defaultValue:null},maxDate:{type:"object",group:"Misc",defaultValue:null},showFooter:{type:"boolean",group:"Misc",defaultValue:!1},showCurrentDateButton:{type:"boolean",group:"Behavior",defaultValue:!1},hideInput:{type:"boolean",group:"Misc",defaultValue:!1},calendarWeekNumbering:{type:"sap.ui.core.date.CalendarWeekNumbering",group:"Appearance",defaultValue:null}},aggregations:{specialDates:{type:"sap.ui.core.Element",multiple:!0,singularName:"specialDate"},_popup:{type:"sap.m.ResponsivePopover",multiple:!1,visibility:"hidden"}},associations:{legend:{type:"sap.ui.core.Control",multiple:!1}},events:{navigate:{parameters:{dateRange:{type:"sap.ui.unified.DateRange"},afterPopupOpened:{type:"boolean"}}},afterValueHelpOpen:{},afterValueHelpClose:{}},designtime:"sap/m/designtime/DatePicker.designtime",dnd:{draggable:!1,droppable:!0}},renderer:l});function R(t){var e;this._createPopup(),this._createPopupContent();var a=this.getBinding("value");a&&a.oType&&a.oType.oOutputFormat?e=a.oType.oOutputFormat.oFormatOptions.calendarType:a&&a.oType&&a.oType.oFormat&&(e=a.oType.oFormat.oFormatOptions.calendarType),e||(e=this.getDisplayFormatType()),e&&this._getCalendar().setPrimaryCalendarType(e),(this._bValid?this._formatValue(this.getDateValue()):this.getValue())!=this._$input.val()&&this.onChange(),this._fillDateRange(),this._openPopup(t),this.fireNavigate({dateRange:this._getVisibleDatesRange(this._getCalendar()),afterPopupOpened:!0})}function F(e){this.isOpen()&&(this._oPopup.close(),!t.system.desktop&&t.support.touch||this.focus())}function x(){this.addStyleClass(a.ICON_PRESSED_CSS_CLASS),this._renderedDays=this._getCalendar().$("-Month0-days").find(".sapUiCalItem").length,_.addPopoverInstance(this._oPopup),this._oCalendar.focus(),this.fireAfterValueHelpOpen()}function O(){this.getDateValue()||this._oPopup.getBeginButton().setEnabled(!1),this.removeStyleClass(a.ICON_PRESSED_CSS_CLASS),this._getCalendar()._closePickers(),_.removePopoverInstance(this._oPopup),this.fireAfterValueHelpClose()}function A(t){var e=t.getParameter("days"),a=this._oPopup._getPopup();e>this._renderedDays&&(this._renderedDays=e,a._applyPosition(a._oLastPosition))}function B(t){var e=sap.ui.require("sap/ui/unified/DateTypeRange");if(t&&!(e&&t instanceof e))throw new Error(t+'is not valid for aggregation "specialDates" of '+this)}function k(){this.isOpen()&&(this._getCalendar()._bDateRangeChanged=!1,this._getCalendar().invalidate())}return E.prototype.init=function(){i.prototype.init.apply(this,arguments),this._bIntervalSelection=!1,this._bOnlyCalendar=!0,this._bValid=!0,this._oMinDate=V.getInstance(1,0,1),this._oMinDate.setFullYear(1),this._oMaxDate=V.getInstance(9999,11,31,23,59,59,999);var e=this.addEndIcon({id:this.getId()+"-icon",src:this.getIconSrc(),noTabStop:!0,decorative:!(t.support.touch&&!t.system.desktop),useIconTooltip:!1,alt:w.getText("OPEN_PICKER_TEXT")});this._bShouldClosePicker=!1,e.addEventDelegate({onmousedown:function(t){this._bShouldClosePicker=!!this.isOpen()}},this),e.attachPress((function(){this.toggleOpen(this._bShouldClosePicker)}),this)},E.prototype.isValidValue=function(){return this._bValid},E.prototype.isOpen=function(){return this._oPopup&&this._oPopup.isOpen()},E.prototype.toggleOpen=function(t){this.getEditable()&&this.getEnabled()&&(t?F.call(this):R.call(this))},E.prototype.getIconSrc=function(){return c.getIconURI("appointment-2")},E.prototype.exit=function(){a.prototype.exit.apply(this,arguments),this._oPopup&&(this._oPopup.isOpen()&&this._oPopup.close(),delete this._oPopup),this._getCalendar()&&(this._oCalendarAfterRenderDelegate&&this._getCalendar().removeDelegate(this._oCalendarAfterRenderDelegate),this._getCalendar().destroy(),this._getCalendar()),this._iInvalidateCalendar&&clearTimeout(this._iInvalidateCalendar),this._sUsedDisplayPattern=void 0,this._sUsedDisplayCalendarType=void 0,this._oDisplayFormat=void 0,this._sUsedValuePattern=void 0,this._sUsedValueCalendarType=void 0,this._oValueFormat=void 0},E.prototype.invalidate=function(t){t&&t==this._getCalendar()||(p.prototype.invalidate.apply(this,arguments),this._iInvalidateCalendar=setTimeout(k.bind(this),0))},E.prototype.onBeforeRendering=function(){i.prototype.onBeforeRendering.apply(this,arguments),this._checkMinMaxDate();var t=this._getValueHelpIcon();t&&t.setProperty("visible",this.getEditable())},E.prototype.setDisplayFormat=function(t){return this.setProperty("displayFormat",t),this._oCalendar&&(this._oCalendar.removeDelegate(this._oCalendarAfterRenderDelegate),this._oCalendar.destroy(),this._oCalendar=null,this._createPopupContent()),this},E.prototype.setWidth=function(t){return a.prototype.setWidth.call(this,t||"100%")},E.prototype.getWidth=function(t){return this.getProperty("width")||"100%"},E.prototype.applyFocusInfo=function(e){this._bFocusNoPopup=!0,t.support.touch&&!t.system.desktop||a.prototype.applyFocusInfo.apply(this,arguments)},E.prototype.onfocusin=function(t){jQuery(t.target).hasClass("sapUiIcon")||i.prototype.onfocusin.apply(this,arguments),this._bFocusNoPopup=void 0},E.prototype.onsapshow=function(t){this.toggleOpen(this.isOpen()),t.preventDefault()},E.prototype.onsaphide=E.prototype.onsapshow,E.prototype.onsapescape=function(t){var e=this.getLastValue(),a=this._parseValue(this._getInputValue(),!0),i=this._formatValue(a,!0);i!==e&&(t.setMarked(),t.preventDefault(),this.updateDomValue(e),this.onValueRevertedByEscape(e,i))},E.prototype.onsappageup=function(t){var e=this._getCalendarConstructor().getMetadata().getName();t.preventDefault(),"sap.ui.unified.Calendar"==e&&this._increaseDate(1,"day")},E.prototype.onsappageupmodifiers=function(t){var e=this._getCalendarConstructor().getMetadata().getName();if(t.preventDefault(),!t.ctrlKey&&t.shiftKey){if("sap.ui.unified.internal.CustomYearPicker"==e)return;this._increaseDate(1,"month")}else this._increaseDate(1,"year")},E.prototype.onsappagedown=function(t){var e=this._getCalendarConstructor().getMetadata().getName();t.preventDefault(),"sap.ui.unified.Calendar"==e&&this._increaseDate(-1,"day")},E.prototype.onsappagedownmodifiers=function(t){var e=this._getCalendarConstructor().getMetadata().getName();if(t.preventDefault(),!t.ctrlKey&&t.shiftKey){if("sap.ui.unified.internal.CustomYearPicker"==e)return;this._increaseDate(-1,"month")}else this._increaseDate(-1,"year")},E.prototype.onkeypress=function(t){if(t.charCode&&!t.metaKey&&!t.ctrlKey){var e=this._getFormatter(!0),a=String.fromCharCode(t.charCode);a&&e.sAllowedCharacters&&e.sAllowedCharacters.indexOf(a)<0&&t.preventDefault()}},E.prototype._getValueHelpIcon=function(){var t=this.getAggregation("_endIcon");return t&&t[0]},E.prototype._dateValidation=function(t){return this._bValid=!0,t&&(t.getTime()<this._oMinDate.getTime()||t.getTime()>this._oMaxDate.getTime())&&(this._bValid=!1,g(this._bValid,"Date must be in valid range")),this.setProperty("dateValue",t),t},E.prototype.setMinDate=function(t){if(!this._isValidDate(t))throw new Error("Date must be a JavaScript or UI5Date date object; "+this);if(u(this.getMinDate(),t))return this;if(t){var e=t.getFullYear();if(e<1||e>9999)throw new Error("Date must be between 0001-01-01 and 9999-12-31; "+this);this._oMinDate=V.getInstance(t.getTime());var a=this.getDateValue();a&&a.getTime()<t.getTime()&&(this._bValid=!1,this._bOutOfAllowedRange=!0,d.warning("DateValue not in valid date range",this))}else this._oMinDate=V.getInstance(1,0,1),this._oMinDate.setFullYear(1);return this.setProperty("minDate",t),this._getCalendar()&&this._getCalendar().setMinDate(t),this._oMinDate.setHours(0,0,0,0),this},E.prototype.setMaxDate=function(t){if(!this._isValidDate(t))throw new Error("Date must be a JavaScript or UI5Date date object; "+this);if(u(this.getMaxDate(),t))return this;if(t){var e=t.getFullYear();if(e<1||e>9999)throw new Error("Date must be between 0001-01-01 and 9999-12-31; "+this);this._oMaxDate=V.getInstance(t.getTime());var a=this.getDateValue();a&&a.getTime()>t.getTime()&&(this._bValid=!1,this._bOutOfAllowedRange=!0,d.warning("DateValue not in valid date",this))}else this._oMaxDate=V.getInstance(9999,11,31,23,59,59,999);return this.setProperty("maxDate",t),this._getCalendar()&&this._getCalendar().setMaxDate(t),this._oMaxDate.setHours(23,59,59,999),this},E.prototype.setCurrentDateButton=function(t){var e=this._getCalendar();return e&&e.setCurrentDateButton(t),this.setProperty("showCurrentDateButton",t)},E.prototype._checkMinMaxDate=function(){if(this._oMinDate.getTime()>this._oMaxDate.getTime()){d.warning("minDate > MaxDate -> dates switched",this);var t=V.getInstance(this._oMinDate.getTime()),e=V.getInstance(this._oMaxDate.getTime());t.setHours(23,59,59,999),e.setHours(0,0,0,0),this._oMinDate=V.getInstance(e.getTime()),this._oMaxDate=V.getInstance(t.getTime()),this.setProperty("minDate",e,!0),this.setProperty("maxDate",t,!0),this._getCalendar()&&(this._getCalendar().setMinDate(e),this._getCalendar().setMaxDate(t))}var a=this.getDateValue();a&&(a.getTime()<this._oMinDate.getTime()||a.getTime()>this._oMaxDate.getTime())&&(this._bValid=!1,d.error("dateValue "+a.toString()+"(value="+this.getValue()+") does not match min/max date range("+this._oMinDate.toString()+" - "+this._oMaxDate.toString()+"). App. developers should take care to maintain dateValue/value accordingly.",this))},E.prototype.getDisplayFormatType=function(){return this.getProperty("displayFormatType")},E.prototype._handleDateValidation=function(t){this._bValid=!0,(!t||t.getTime()<this._oMinDate.getTime()||t.getTime()>this._oMaxDate.getTime())&&(this._bValid=!1,d.warning("Value can not be converted to a valid date",this));var e=this._formatValue(t,!0);e!==this.getValue()&&this.setLastValue(e),this.setProperty("value",e),this.setProperty("dateValue",t)},E.prototype.setDisplayFormatType=function(t){if(t){var e=!1;for(var a in I)if(a==t){e=!0;break}if(!e)throw new Error(t+" is not a valid calendar type"+this)}return this.setProperty("displayFormatType",t,!0),this.setDisplayFormat(this.getDisplayFormat()),this},E.prototype.setSecondaryCalendarType=function(t){return this._bSecondaryCalendarTypeSet=!0,this.setProperty("secondaryCalendarType",t,!0),this._getCalendar()&&this._getCalendar().setSecondaryCalendarType(t),this},E.prototype.setShowFooter=function(t){var e=this._oPopup,a=this._getCalendar();return this.setProperty("showFooter",t),e&&a?(e._getButtonFooter().setVisible(t),this):this},E.prototype.addSpecialDate=function(t){return B.call(this,t),this.addAggregation("specialDates",t,!0),k.call(this),this},E.prototype.insertSpecialDate=function(t,e){return B.call(this,t),this.insertAggregation("specialDates",t,e,!0),k.call(this),this},E.prototype.removeSpecialDate=function(t){var e=this.removeAggregation("specialDates",t,!0);return k.call(this),e},E.prototype.removeAllSpecialDates=function(){var t=this.removeAllAggregation("specialDates",!0);return k.call(this),t},E.prototype.destroySpecialDates=function(){return this.destroyAggregation("specialDates",!0),k.call(this),this},E.prototype.setLegend=function(t){this.setAssociation("legend",t,!0);var e=this.getLegend();if(e){var a=sap.ui.require("sap/ui/unified/CalendarLegend");if((t=sap.ui.getCore().byId(e))&&!("function"==typeof a&&t instanceof a))throw new Error(t+" is not an sap.ui.unified.CalendarLegend. "+this)}return this._getCalendar()&&this._getCalendar().setLegend(e),this},E.prototype.onChange=function(t){if(this.getEditable()&&this.getEnabled()){var e,a=this._$input.val();if((a!=this._formatValue(this.getDateValue())||!this._bValid)&&(this.getShowFooter()&&this._oPopup&&!a&&this._oPopup.getBeginButton().setEnabled(!1),this._bValid=!0,""!=a&&(!(e=this._parseValue(a,!0))||e.getTime()<this._oMinDate.getTime()||e.getTime()>this._oMaxDate.getTime()?(this._bValid=!1,e=void 0):a=this._formatValue(e)),this.getDomRef()&&this._$input.val()!==a&&(this._$input.val(a),this._curpos=this._$input.cursorPos()),e&&(a=this._formatValue(e,!0)),this.getLastValue()!==a||e&&this.getDateValue()&&e.getFullYear()!==this.getDateValue().getFullYear())){this.setLastValue(a),this.setProperty("value",a,!0);var i=this.getValue();if(this._bValid&&a==i&&this.setProperty("dateValue",e,!0),a=i,this.isOpen()){this._bValid&&(e=this.getDateValue()),this._getCalendar().focusDate(e);var s=this._oDateRange.getStartDate();!s&&e||s&&e&&s.getTime()!=e.getTime()?this._oDateRange.setStartDate(V.getInstance(e.getTime())):s&&!e&&this._oDateRange.setStartDate(void 0)}this.fireChangeEvent(a,{valid:this._bValid})}}},E.prototype.updateDomValue=function(t){if(this.isActive()&&this._$input.val()!==t){this._bCheckDomValue=!0,t=void 0===t?this._$input.val():t.toString(),this._curpos=this._$input.cursorPos();var e=this._parseValue(t,!0);t=this._formatValue(e),this._bPreferUserInteraction?this.handleInputValueConcurrency(t):(this._$input.val(t),document.activeElement===this._$input[0]&&this._$input.cursorPos(this._curpos))}return this},E.prototype._createPopup=function(){var a="";this._oPopup||(this._oPopup=new o(this.getId()+"-RP",{showCloseButton:!1,showArrow:!1,showHeader:!1,placement:r.PlacementType.VerticalPreferredBottom,contentWidth:this.$().closest(".sapUiSizeCompact").length>0?"18rem":"21rem",beginButton:new s({type:r.ButtonType.Emphasized,text:w.getText("DATEPICKER_SELECTION_CONFIRM"),press:this._handleOKButton.bind(this)}),afterOpen:x.bind(this),afterClose:O.bind(this)}).addStyleClass("sapMRPCalendar"),this.getShowFooter()&&this._oPopup.addStyleClass("sapMLandscapePadding"),this._oPopup._getPopup().setAutoClose(!0),t.system.phone?(a=v.getReferencingLabels(this).concat(this.getAriaLabelledBy()).reduce((function(t,a){var i=e.registry.get(a);return t+" "+(i.getText?i.getText():"")}),"").trim(),this._oPopup.setTitle(a),this._oPopup.setShowHeader(!0),this._oPopup.setShowCloseButton(!0)):(this._oPopup._getPopup().setDurations(0,0),this._oPopup.setEndButton(new s({text:w.getText("DATEPICKER_SELECTION_CANCEL"),press:this._handleCancelButton.bind(this)}))),this.setAggregation("_popup",this._oPopup,!0))},E.prototype._openPopup=function(t){this._oPopup&&(t||(t=this.getDomRef()),this._oPopup._getPopup().setExtraContent([t]),this._oPopup.openBy(t||this))},E.prototype.openBy=function(t){R.call(this,t)},E.prototype._getVisibleDatesRange=function(t){var e=t._getVisibleDays();return new D({startDate:e[0].toLocalJSDate(),endDate:e[e.length-1].toLocalJSDate()})},E.prototype._createPopupContent=function(){var t=this._getCalendarConstructor();if(!this._getCalendar()){if(this._oCalendar=new t(this.getId()+"-cal",{intervalSelection:this._bIntervalSelection,minDate:this.getMinDate(),maxDate:this.getMaxDate(),legend:this.getLegend(),calendarWeekNumbering:this.getCalendarWeekNumbering(),startDateChange:function(){this.fireNavigate({dateRange:this._getVisibleDatesRange(this._getCalendar())})}.bind(this)}),this._oCalendar.setShowWeekNumbers(!1),this._oCalendar.setShowCurrentDateButton(this.getShowCurrentDateButton()),this._oDateRange=new D,this._getCalendar().addSelectedDate(this._oDateRange),this._getCalendar()._setSpecialDatesControlOrigin(this),this._getCalendar().attachCancel(F,this),this.$().closest(".sapUiSizeCompact").length>0&&this._getCalendar().addStyleClass("sapUiSizeCompact"),this._bSecondaryCalendarTypeSet&&this._getCalendar().setSecondaryCalendarType(this.getSecondaryCalendarType()),this._bOnlyCalendar){if(this._getCalendar().attachSelect(this._handleCalendarSelect,this),this._getCalendar().attachEvent("_renderMonth",A,this),this._oPopup._getButtonFooter().setVisible(this.getShowFooter()),this._getCalendar()._bSkipCancelButtonRendering=!0,!this._oPopup.getContent().length){var e=this._getValueStateHeader();this._oPopup.addContent(this._getValueStateHeader()),e.setPopup(this._oPopup._oControl)}this._oPopup.addContent(this._getCalendar()),this.getDateValue()||this._oPopup.getBeginButton().setEnabled(!1)}this._attachAfterRenderingDelegate()}if(this._oCalendar){var a=!1,i=this.getCustomData();if(0!==i.length)for(var s=0,o=i.length;s<o;s++)if("showPopupWeekNum"===i[s].getKey()){"X"!==i[s].getValue()&&!0!==i[s].getValue()||(a=!0);break}this._oCalendar.setShowWeekNumbers(a)}if(this._oCalendar&&this._oPopup){var n=this.getDateValue(),r=this._oCalendar.getSelectedDates();r&&0!==r.length&&(r[0].setStartDate(n),this._oCalendar.focusDate(n),this._oPopup.setInitialFocus(r[0].sId))}},E.prototype._attachAfterRenderingDelegate=function(){this._oCalendarAfterRenderDelegate={onAfterRendering:function(){var t=this._oPopup&&this._oPopup._getPopup();t&&t._oLastPosition&&t._applyPosition(t._oLastPosition),this._oPopup.isOpen()&&this._oCalendar.focus()}.bind(this)},this._oCalendar.addDelegate(this._oCalendarAfterRenderDelegate)},E.prototype._getCalendarConstructor=function(){var t=this._getFormatter(!0).aFormatArray.map((function(t){return t.type.toLowerCase()})),e=t.indexOf("day")>=0,a=t.indexOf("month")>=0||t.indexOf("monthstandalone")>=0,i=t.indexOf("year")>=0;return e&&a&&i?y:a&&i?m:i?C:(d.warning("Not valid date pattern! Default Calendar constructor function is returned",this),y)},E.prototype._fillDateRange=function(){var t=this.getDateValue();if(t&&t.getTime()>=this._oMinDate.getTime()&&t.getTime()<=this._oMaxDate.getTime())this._getCalendar().focusDate(V.getInstance(t.getTime())),this._oDateRange.getStartDate()&&this._oDateRange.getStartDate().getTime()==t.getTime()||this._oDateRange.setStartDate(V.getInstance(t.getTime()));else{var e=this.getInitialFocusedDateValue(),a=e||V.getInstance();a.getTime()<this._oMinDate.getTime()?a=this._oMinDate:a.getTime()>this._oMaxDate.getTime()&&(a=this._oMaxDate),this._getCalendar().focusDate(a),this._oDateRange.getStartDate()&&this._oDateRange.setStartDate(void 0)}},E.prototype.getAccessibilityInfo=function(){var t=this.getRenderer(),e=a.prototype.getAccessibilityInfo.apply(this,arguments),i=this.getValue()||"",s=this.getRequired()?M.getLibraryResourceBundle("sap.m").getText("ELEMENT_REQUIRED"):"";if(this._bValid){var o=this.getDateValue();o&&(i=this._formatValue(o))}return e.type=w.getText("ACC_CTR_TYPE_DATEINPUT"),e.description=[i||this._getPlaceholder(),t.getLabelledByAnnouncement(this),t.getDescribedByAnnouncement(this),s].join(" ").trim(),e},E.prototype._selectDate=function(){var e=this.getDateValue(),a=this._getSelectedDate(),i="";u(a,e)?this._bValid?!t.system.desktop&&t.support.touch||this.focus():(i=this._formatValue(a))!=this._$input.val()&&(this._bValid=!0,this.getDomRef()&&(this._$input.val(i),this.setLastValue(i)),i=this._formatValue(a,!0),this.setProperty("value",i,!0),this.fireChangeEvent(i,{valid:!0}),this._focusInput()):(this.setDateValue(V.getInstance(a.getTime())),i=this.getValue(),this.fireChangeEvent(i,{valid:!0}),this._focusInput()),this._oPopup.close()},E.prototype._handleCalendarSelect=function(){this.getShowFooter()?this._oPopup.getBeginButton().setEnabled(!0):this._selectDate()},E.prototype._getTimezone=function(t){return T.getTimezone()},E.prototype._focusInput=function(){return!this.getDomRef()||!t.system.desktop&&t.support.touch||(this._curpos=this._$input.val().length,this._$input.cursorPos(this._curpos)),this},E.prototype._getCalendar=function(){return this._oCalendar},E.prototype._getSelectedDate=function(){var t,e=this._getCalendar().getSelectedDates();return e.length>0&&(t=e[0].getStartDate()),t},E.prototype._handleOKButton=function(){this._selectDate()},E.prototype._handleCancelButton=function(){this.getDateValue()||this._oPopup.getBeginButton().setEnabled(!1),this._oPopup.close()},E.prototype._increaseDate=function(t,e){var a=this.getDateValue(),i=this._$input.cursorPos();if(a&&this.getEditable()&&this.getEnabled()){var s,o=this.getBinding("value");o&&o.oType&&o.oType.oOutputFormat?s=o.oType.oOutputFormat.oFormatOptions.calendarType:o&&o.oType&&o.oType.oFormat&&(s=o.oType.oFormat.oFormatOptions.calendarType),s||(s=this.getDisplayFormatType());var r=n.getInstance(V.getInstance(a.getTime()),s);switch(a=n.getInstance(V.getInstance(a.getTime()),s),e){case"day":r.setDate(r.getDate()+t);break;case"month":r.setMonth(r.getMonth()+t);var p=(a.getMonth()+t)%12;for(p<0&&(p=12+p);r.getMonth()!=p;)r.setDate(r.getDate()-1);break;case"year":for(r.setFullYear(r.getFullYear()+t);r.getMonth()!=a.getMonth();)r.setDate(r.getDate()-1)}if(r.getTime()<this._oMinDate.getTime()?r=new n(this._oMinDate.getTime()):r.getTime()>this._oMaxDate.getTime()&&(r=new n(this._oMaxDate.getTime())),!u(this.getDateValue(),r.getJSDate())){this.setDateValue(V.getInstance(r.getTime())),this._curpos=i,this._$input.cursorPos(this._curpos);var h=this.getValue();this.fireChangeEvent(h,{valid:!0})}}},E.prototype._getSpecialDates=function(){for(var t=this.getSpecialDates(),e=0;e<t.length;e++){if(t[e].getSecondaryType()===P.CalendarDayType.NonWorking&&t[e].getType()!==P.CalendarDayType.NonWorking){var a=new f;a.setType(t[e].getSecondaryType()),a.setStartDate(t[e].getStartDate()),t[e].getEndDate()&&a.setEndDate(t[e].getEndDate()),t.push(a)}}return t},E}));