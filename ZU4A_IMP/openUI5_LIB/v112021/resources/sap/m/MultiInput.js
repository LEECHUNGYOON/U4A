sap.ui.define(["./Input","./Tokenizer","./Token","./library","sap/ui/core/Element","sap/ui/core/EnabledPropagator","sap/ui/base/ManagedObject","sap/ui/base/ManagedObjectMetadata","sap/ui/base/ManagedObjectObserver","sap/ui/core/ResizeHandler","sap/ui/core/IconPool","sap/ui/Device","./MultiInputRenderer","sap/ui/dom/containsOrEquals","sap/m/inputUtils/completeTextSelected","sap/ui/events/KeyCodes","sap/ui/core/InvisibleText","sap/ui/dom/jquery/cursorPos"],(function(e,t,i,o,n,s,a,r,g,p,l,h,u,d,c,k,f){"use strict";var T=o.TokenizerRenderMode,y=e.extend("sap.m.MultiInput",{metadata:{interfaces:["sap.ui.core.ISemanticFormContent"],library:"sap.m",designtime:"sap/m/designtime/MultiInput.designtime",properties:{enableMultiLineMode:{type:"boolean",group:"Behavior",defaultValue:!1,deprecated:!0},maxTokens:{type:"int",group:"Behavior"},showSuggestion:{type:"boolean",group:"Behavior",defaultValue:!0},_semanticFormValue:{type:"string",group:"Behavior",defaultValue:"",visibility:"hidden"}},aggregations:{tokens:{type:"sap.m.Token",multiple:!0,singularName:"token"},tokenizer:{type:"sap.m.Tokenizer",multiple:!1,visibility:"hidden"}},events:{tokenChange:{parameters:{type:{type:"string"},token:{type:"sap.m.Token"},tokens:{type:"sap.m.Token[]"},addedTokens:{type:"sap.m.Token[]"},removedTokens:{type:"sap.m.Token[]"}},deprecated:!0},tokenUpdate:{allowPreventDefault:!0,parameters:{type:{type:"string"},addedTokens:{type:"sap.m.Token[]"},removedTokens:{type:"sap.m.Token[]"}}}},dnd:{draggable:!1,droppable:!0}},renderer:u});s.apply(y.prototype,[!0]);var _=sap.ui.getCore().getLibraryResourceBundle("sap.m");return y.prototype.init=function(){var i=this;this._bShowListWithTokens=!1,e.prototype.init.call(this),this._getClearIcon(),this._bIsValidating=!1;var o=new t({renderMode:T.Narrow,tokenDelete:this._tokenDelete.bind(this)});o.updateTokens=function(){var e=i.getDomRef();this.destroyTokens(),this.updateAggregation("tokens"),e&&e.contains(document.activeElement)&&(i.bTokensUpdated=!0)},o.setShouldRenderTabIndex(!1),this.setAggregation("tokenizer",o),o.getTokensPopup().attachBeforeOpen(this._onBeforeOpenTokensPicker.bind(this)).attachAfterClose(this._onAfterCloseTokensPicker.bind(this))._getPopup().setExtraContent([o,this]),o.getTokensPopup().addEventDelegate({onAfterRendering:function(){var e=this.getDomRef().getBoundingClientRect().width,t=getComputedStyle(this.getDomRef()).getPropertyValue("--sPopoverMaxWidth");e<=parseInt(t)&&!h.system.phone?o.getTokensPopup().getDomRef().style.setProperty("max-width","40rem"):o.getTokensPopup().getDomRef().style.setProperty("max-width",e+"px"),o.getTokensPopup().getDomRef().style.setProperty("min-width",e+"px")}},this),this.setAggregation("tokenizer",o),this._oTokenizerObserver=new g(function(e){var i=e.mutation,o=e.child;switch(i){case"insert":o.attachEvent("_change",this.invalidate,this),this.fireTokenChange({type:t.TokenChangeType.Added,token:o,tokens:[o],removedTokens:[]});break;case"remove":var n=e.object.getTokens().length?t.TokenChangeType.Removed:t.TokenChangeType.RemovedAll;o.detachEvent("_change",this.invalidate,this),this.fireTokenChange({type:n,token:o,removedTokens:[o]})}this.updateFormValueProperty(),this.invalidate()}.bind(this)),this._oTokenizerObserver.observe(o,{aggregations:["tokens"]}),this._bShowListWithTokens=!1,this._bIsValidating=!1,o.addEventDelegate({onThemeChanged:this._handleInnerVisibility.bind(this),onAfterRendering:function(){this.isMobileDevice()&&this.getEditable()?o.addStyleClass("sapMTokenizerIndicatorDisabled"):o.removeStyleClass("sapMTokenizerIndicatorDisabled"),this._syncInputWidth(o),this.getTokens().length&&(this._handleInnerVisibility(),this._handleNMoreAccessibility(),this._registerTokenizerResizeHandler())}.bind(this)},this),this._aTokenValidators=[],this.setShowValueHelp(!0),this._getSuggestionsPopover().getPopover().attachBeforeOpen((function(){if(!0===i.isMobileDevice()){var e=o._getTokensList();o._fillTokensList(e),this.addContent(e),i._manageListsVisibility(!!o.getTokens().length)}})).attachAfterOpen((function(){var e=i.getTokens().length?_.getText("MULTIINPUT_NAVIGATION_POPUP_AND_TOKENS"):_.getText("MULTIINPUT_NAVIGATION_POPUP");i._oInvisibleMessage.announce(e)})),this.attachSuggestionItemSelected(this._onSuggestionItemSelected,this),this.attachLiveChange(this._onLiveChange,this),this.attachValueHelpRequest(this._onValueHelpRequested,this),this._getValueHelpIcon().setProperty("visible",!0,!0),this._onResize=this._onResize.bind(this)},y.prototype.exit=function(){this._deregisterResizeHandler(),this._deregisterTokenizerResizeHandler(),this._oTokenizerObserver.disconnect(),this._oTokenizerObserver.destroy(),this._oTokenizerObserver=null,e.prototype.exit.call(this)},y.prototype.onAfterRendering=function(){var t=this.getAggregation("tokenizer");if(this._bTokenIsValidated=!1,t.setMaxWidth(this._calculateSpaceForTokenizer()),t.scrollToEnd(),this._registerResizeHandler(),e.prototype.onAfterRendering.apply(this,arguments),this.bTokensUpdated&&this.bDeletePressed){var i=t.getTokens();i[this.iFocusedIndexBeforeUpdate]?i[this.iFocusedIndexBeforeUpdate].focus():this.focus()}this.bTokensUpdated=!1},y.prototype._tokenDelete=function(e){this.getEditable()&&this.getEnabled()&&this._deleteTokens(e.getParameter("tokens"),e.getParameters())},y.prototype._deleteTokens=function(e,i){var o,n=this.getAggregation("tokenizer"),s=i.keyCode===k.BACKSPACE,a=e[e.length-1],r=e[0];o=this.getTokens().indexOf(s?r:a),this.iFocusedIndexBeforeUpdate=o,this.bDeletePressed=!s,n.focusToken(o,i,function(){this.focus()}.bind(this)),this.fireTokenUpdate({type:t.TokenUpdateType.Removed,addedTokens:[],removedTokens:e}),e.filter(function(e){return this.getEditable()&&this.getEnabled()&&e.getEditable()}.bind(this)).forEach((function(e){e.destroy()})),0===this.getTokens().length&&n.getTokensPopup().close(),i.keyCode||this.focus()},y.prototype._handleInnerVisibility=function(){var e=!!this.getAggregation("tokenizer").getHiddenTokensCount();this._setValueVisible(!e)},y.prototype.oninput=function(t){this.setProperty("selectedKey","",!0),e.prototype.oninput.call(this,t),!t.isMarked("invalid")&&this.getEditable()&&(this._setValueVisible(!0),this._manageListsVisibility(!1),this.getAggregation("tokenizer").getTokensPopup().close())},y.prototype._registerResizeHandler=function(){this._iResizeHandlerId||(this._iResizeHandlerId=p.register(this,this._onResize))},y.prototype._deregisterResizeHandler=function(){this._iResizeHandlerId&&(p.deregister(this._iResizeHandlerId),this._iResizeHandlerId=null)},y.prototype._registerTokenizerResizeHandler=function(){this._iTokenizerResizeHandler||(this._iTokenizerResizeHandler=p.register(this.getAggregation("tokenizer"),this._onResize))},y.prototype._deregisterTokenizerResizeHandler=function(){this._iTokenizerResizeHandler&&(p.deregister(this._iTokenizerResizeHandler),this._iTokenizerResizeHandler=null)},y.prototype._onResize=function(){this.getAggregation("tokenizer").setMaxWidth(this._calculateSpaceForTokenizer())},y.prototype._onSuggestionItemSelected=function(e){var t=this.getAggregation("tokenizer"),o=null,n=null,s=t.getTokens().length;if(!(this.getMaxTokens()&&s>=this.getMaxTokens()||this._bValueHelpOpen)){if(this._hasTabularSuggestions()?o=e.getParameter("selectedRow"):(o=e.getParameter("selectedItem"))&&(n=new i({text:a.escapeSettingsValue(o.getText()),key:a.escapeSettingsValue(o.getKey())})),o&&!this._bTokenIsAdded){var r=this.getValue();this.addValidateToken({text:r,token:n,suggestionObject:o,validationCallback:this._validationCallback.bind(this,s)})}if(this.isMobileDevice()){s<t.getTokens().length&&this.setValue(""),this._getSuggestionsList().isA("sap.m.Table")?this._getSuggestionsList().addStyleClass("sapMInputSuggestionTableHidden"):this._getSuggestionsList().destroyItems();var g=this.getAggregation("tokenizer").getScrollDelegate();g&&g.scrollTo(0,0,0),this._getSuggestionsPopover().getInput().focus()}this._bTokenIsAdded=!1}},y.prototype._onValueHelpRequested=function(){this._bValueHelpOpen=!0},y.prototype._onLiveChange=function(e){this.getAggregation("tokenizer").getTokens().every((function(e){return e.getSelected()}))&&(0!==this.getTokens().length&&this._deleteTokens(this.getTokens(),{keyCode:k.BACKSPACE}))},y.prototype._setValueVisible=function(e){var t=e?"1":"0";this.$("inner").css("opacity",t)},y.prototype.onmousedown=function(e){e.target==this.getDomRef("content")&&(e.preventDefault(),e.stopPropagation())},y.prototype.openMultiLine=function(){},y.prototype.closeMultiLine=function(){},y.prototype.showItems=function(){e.prototype.showItems.apply(this,arguments),this._manageListsVisibility(!1)},y.prototype.onBeforeRendering=function(){var t=this.getAggregation("tokenizer"),i=t._getTokensList();e.prototype.onBeforeRendering.apply(this,arguments),this._hideTokensOverLimit(),t.setEnabled(this.getEnabled()),t._fillTokensList(i)},y.prototype._hideTokensOverLimit=function(){this.getMaxTokens()&&this.getTokens().forEach((function(e,t){return t>=this.getMaxTokens()?e.setVisible(!1):e.setVisible(!0)}),this)},y.prototype.onsapnext=function(e){var t=this.getAggregation("tokenizer");if(!e.isMarked()){var i=n.closestTo(document.activeElement);i&&(t===i||t.$().find(i.$()).length>0)&&(t.scrollToEnd(),this.$().find("input").trigger("focus"))}},y.prototype.onsapbackspace=function(e){var t=this.getValue(),i=this.getFocusDomRef()===document.activeElement,o=this.getTokens(),n=o[o.length-1];if(this.getEnabled()&&this.getEditable()){var s=o.filter((function(e){return e.getSelected()})).length===o.length;if((""===t||!0===s)&&i&&n&&e.srcControl===this){if(s)return this._deleteTokens(o,{keyCode:k.BACKSPACE});n.focus(),e.preventDefault()}}else e.preventDefault()},y.prototype.onsapdelete=function(e){this.getEditable()&&(this.getValue()&&!c(this.getFocusDomRef())||e.isMarked("forwardFocusToParent")&&this.focus())},y.prototype.onkeydown=function(t){var i=this.getAggregation("tokenizer");e.prototype.onkeydown.apply(this,arguments),this.getEnabled()&&(t.which===k.TAB&&i.selectAllTokens(!1),(t.ctrlKey||t.metaKey)&&t.which===k.A&&i.getTokens().length>0&&(i.focus(),i.selectAllTokens(!0),t.preventDefault()),!t.ctrlKey&&!t.metaKey||t.which!==k.C&&t.which!==k.INSERT||i._copy(),((t.ctrlKey||t.metaKey)&&t.which===k.X||t.shiftKey&&t.which===k.DELETE)&&(this.getEditable()?i._cut():i._copy()),(t.ctrlKey||t.metaKey)&&t.which===k.I&&i.getTokens().length&&(i._togglePopup(i.getTokensPopup()),t.preventDefault()))},y.prototype.onpaste=function(e){var i,o,n,s=[];this.getValueHelpOnly()||((i=e.originalEvent.clipboardData.getData("text/plain")).length&&i.endsWith("\r\n")&&(i=i.substring(0,i.lastIndexOf("\r\n"))),(n=i.split(/\r\n|\r|\n|\t/g)).length<=1||setTimeout(function(){if(n){if(this.fireEvent("_validateOnPaste",{texts:n},!0)){var e="";for(o=0;o<n.length;o++)if(n[o]){var i=this._convertTextToToken(n[o],!0);this._addUniqueToken(i)?s.push(i):e=n[o]}this.updateDomValue(e),s.length>0&&(this.fireTokenUpdate({addedTokens:s,removedTokens:[],type:t.TokenUpdateType.Added}),this.fireTokenChange({addedTokens:s,removedTokens:[],type:t.TokenChangeType.TokensChanged}))}s.length&&this.cancelPendingSuggest()}}.bind(this),0))},y.prototype._validationCallback=function(e,t){var i=this.getAggregation("tokenizer").getTokens().length,o=this._getSuggestionsPopover();this._bIsValidating=!1,t&&(this.setValue(""),this._bTokenIsValidated=!0,this.isMobileDevice()&&o&&o.getInput()&&e<i&&o.getInput().setValue(""))},y.prototype.onsapprevious=function(e){this._getIsSuggestionPopupOpen()||(0===this._$input.cursorPos()&&e.srcControl===this&&t.prototype.onsapprevious.apply(this.getAggregation("tokenizer"),arguments),e.keyCode===k.ARROW_UP&&e.preventDefault())},y.prototype.onsaphome=function(i){this.getFocusDomRef().selectionStart||t.prototype.onsaphome.apply(this.getAggregation("tokenizer"),arguments),e.prototype.onsaphome.apply(this,arguments)},y.prototype.onsapend=function(t){t.isMarked("forwardFocusToParent")&&this.focus(),e.prototype.onsapend.apply(this,arguments)},y.prototype.onsapenter=function(t){var i=this.getDOMValue();e.prototype.onsapenter.apply(this,arguments);var o=!0,n=this.getAggregation("tokenizer");this._getIsSuggestionPopupOpen()&&(o=this._hasTabularSuggestions()?!this._getSuggestionsTable().getSelectedItem():!this._getSuggestionsList().getSelectedItem()),o&&this._validateCurrentText(),t&&t.setMarked&&(this._bTokenIsValidated||i)&&t.setMarked(),!this.getEditable()&&n.getHiddenTokensCount()&&t.target===this.getFocusDomRef()&&n._togglePopup(n.getTokensPopup()),this.focus()},y.prototype.onsapfocusleave=function(t){var i,o,n=this._getSuggestionsPopoverPopup(),s=this.getAggregation("tokenizer"),a=s.getTokensPopup(),r=!1,g=!1,p=this.getDomRef()&&d(this.getDomRef(),document.activeElement);n&&n.isA("sap.m.Popover")&&t.relatedControlId&&(i=sap.ui.getCore().byId(t.relatedControlId).getFocusDomRef(),r=d(n.getFocusDomRef(),i),g=d(s.getFocusDomRef(),i),a&&(o=d(a.getFocusDomRef(),i))),e.prototype.onsapfocusleave.apply(this,arguments),this._bIsValidating||this._bValueHelpOpen||(!r&&t.relatedControlId!==this.getId()&&!g&&(this.isMobileDevice()&&!this.getShowSuggestion()||!this.isMobileDevice())&&this._validateCurrentText(!0),!this.isMobileDevice()&&this.getEditable()&&(p||r)||(o||g||(a.isOpen()&&!this.isMobileDevice()&&s._togglePopup(a),s.setRenderMode(T.Narrow)),this._handleInnerVisibility()))},y.prototype.ontap=function(t){var i=this.getAggregation("tokenizer");document.activeElement!==this._$input[0]&&document.activeElement!==i.getDomRef()||i.selectAllTokens(!1),t&&t.isMarked("tokenDeletePress")||e.prototype.ontap.apply(this,arguments)},y.prototype.onfocusin=function(t){var i=this.getAggregation("tokenizer");this._deregisterTokenizerResizeHandler(),this._bValueHelpOpen=!1,t.target===this.getFocusDomRef()&&(e.prototype.onfocusin.apply(this,arguments),i.hasOneTruncatedToken()&&this.getEnabled()&&this.getEditable()&&(i.getTokens()[0].setSelected(!1),!this.isMobileDevice()&&i.setFirstTokenTruncated(!1))),this.isMobileDevice()||!this.getEditable()||t.target!==this.getDomRef("inner")||this._getIsSuggestionPopupOpen()||(i.setRenderMode(T.Loose),this._setValueVisible(!0)),this._registerResizeHandler()},y.prototype.onsapescape=function(t){var i=this.getAggregation("tokenizer"),o=i.getTokensPopup();this.getAggregation("tokenizer").selectAllTokens(!1),this.selectText(0,0),o.isOpen()&&i._togglePopup(o),e.prototype.onsapescape.apply(this,arguments)},y.prototype._getIsSuggestionPopupOpen=function(){var e=this._getSuggestionsPopover(),t=this._getSuggestionsPopoverPopup();return e&&t&&t.isOpen()},y.prototype.setEditable=function(t){var i=this.getAggregation("tokenizer");return(t=this.validateProperty("editable",t))===this.getEditable()||(e.prototype.setEditable&&e.prototype.setEditable.apply(this,arguments),i.setEditable(t)),this},y.prototype._findItem=function(e,t,i,o){if(e&&t&&t.length){e=e.toLowerCase();for(var n=t.length,s=0;s<n;s++){var a=t[s],r=o(a);if(r){if((r=r.toLowerCase())===e)return a;if(!i&&0===r.indexOf(e))return a}}}},y.prototype._getSuggestionItem=function(e,t){var i=null,o=null;return this._hasTabularSuggestions()?(i=this.getSuggestionRows(),o=this._findItem(e,i,t,(function(e){var t,i=e.getCells(),o=null;if(i)for(t=0;t<i.length;t++)if(i[t].getText){o=i[t].getText();break}return o}))):(i=this.getSuggestionItems(),o=this._findItem(e,i,t,(function(e){return e.getText()}))),o},y.prototype.clone=function(){var t;return this.detachSuggestionItemSelected(this._onSuggestionItemSelected,this),this.detachLiveChange(this._onLiveChange,this),this.detachValueHelpRequest(this._onValueHelpRequested,this),t=e.prototype.clone.apply(this,arguments),this.attachSuggestionItemSelected(this._onSuggestionItemSelected,this),this.attachLiveChange(this._onLiveChange,this),this.attachValueHelpRequest(this._onValueHelpRequested,this),t},y.getMetadata().forwardAggregation("tokens",{getter:function(){return this.getAggregation("tokenizer")},aggregation:"tokens",forwardBinding:!0}),y.prototype.getPopupAnchorDomRef=function(){return this.getDomRef("content")},y.prototype.setTokens=function(e){if(Array.isArray(e))return this.removeAllTokens(),e.forEach((function(e){r.addAPIParentInfoBegin(e,this,"tokens")}),this),e.forEach((function(e){this.addToken(e)}),this),e.forEach((function(e){r.addAPIParentInfoEnd(e)}),this),this.fireTokenChange({type:t.TokenChangeType.TokensChanged,addedTokens:e,removedTokens:[]}),this},y.TokenChangeType={Added:"added",Removed:"removed",RemovedAll:"removedAll",TokensChanged:"tokensChanged"},y.prototype.getWaitForAsyncValidation=function(){return y.WaitForAsyncValidation},y.WaitForAsyncValidation="sap.m.MultiInput.WaitForAsyncValidation",y.prototype.getDomRefForValueStateMessage=y.prototype.getPopupAnchorDomRef,y.prototype.updateInputField=function(t){e.prototype.updateInputField.call(this,t);var i=this._getSuggestionsPopover();this.setDOMValue(""),i.getInput()&&i.getInput().setDOMValue("")},y.prototype.onChange=function(e,t,i){if(t=t||this.getChangeEventParams(),this.getEditable()&&this.getEnabled()){var o=this._getInputValue(i);if(o!==this.getLastValue())return this._bTokenIsValidated||(this.setValue(o),o=this.getValue(),this.setLastValue(o)),this.fireChangeEvent(o,t),!0;this._bCheckDomValue=!1}},y.prototype.getAccessibilityInfo=function(){var t=this.getTokens().map((function(e){return e.getText()})).join(" "),i=e.prototype.getAccessibilityInfo.apply(this,arguments);return i.type=_.getText("ACC_CTR_TYPE_MULTIINPUT"),i.description=(this.getValueDescriptionInfo()+" "+t).trim(),i},y.prototype.getValueDescriptionInfo=function(){var e=this.getTokens().length,t=this.getDescription()||"",i=this.getValue();return i||(e>0?t:t||sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("INPUTBASE_VALUE_EMPTY"))},y.prototype._decoratePopupInput=function(t){if(e.prototype._decoratePopupInput.apply(this,arguments),t)return this._oPopupInputDelegate||(this._oPopupInputDelegate={oninput:this._manageListsVisibility.bind(this,!1),onsapenter:this._handleConfirmation.bind(this,!1)}),t.addEventDelegate(this._oPopupInputDelegate,this),t},y.prototype._hasShowSelectedButton=function(){return!0},y.prototype.forwardEventHandlersToSuggPopover=function(e){e.setShowSelectedPressHandler(this._handleShowSelectedPress.bind(this)),e.setOkPressHandler(this._handleConfirmation.bind(this,!0)),e.setCancelPressHandler(this._revertPopupSelection.bind(this))},y.prototype._handleConfirmation=function(e,t){var i=this._getSuggestionsPopover().getInput();(e||!e&&i.getValue())&&this._closeSuggestionPopup(),this._validateCurrentText(),this._setValueVisible(!1),this.onChange(t,null,i.getValue())},y.prototype._handleShowSelectedPress=function(e){this._bShowListWithTokens=e.getSource().getPressed(),this._manageListsVisibility(this._bShowListWithTokens)},y.prototype._onBeforeOpenTokensPicker=function(){this._setValueVisible(!1),this._manageListsVisibility(!0)},y.prototype._onAfterCloseTokensPicker=function(){document.activeElement!==this.getDomRef("inner")&&this.getAggregation("tokenizer").setRenderMode(T.Narrow)},y.prototype.getDialogTitle=function(){var e=this._getSuggestionsPopoverPopup(),t=e&&e.getCustomHeader();return t?t.getContentMiddle()[0]:null},y.prototype._updatePickerHeaderTitle=function(){var e,t;(t=this.getLabels()).length?(e=t[0])&&"function"==typeof e.getText&&this.getDialogTitle().setText(e.getText()):this.getDialogTitle().setText(_.getText("COMBOBOX_PICKER_TITLE"))},y.prototype._getSuggestionsList=function(){var e=this._getSuggestionsPopover();return e&&e.getItemsContainer()},y.prototype._getSuggestionsPopoverPopup=function(){return this._oSuggestionPopup},y.prototype._manageListsVisibility=function(e){this.isMobileDevice()&&(this.getAggregation("tokenizer")._getTokensList().setVisible(e),this._getSuggestionsList()&&this._getSuggestionsList().setVisible(!e),this._getSuggestionsPopover().getFilterSelectedButton().setPressed(e))},y.prototype._handleNMoreAccessibility=function(){var e=f.getStaticId("sap.m","MULTICOMBOBOX_OPEN_NMORE_POPOVER"),t=this.getFocusDomRef(),i=t&&t.getAttribute("aria-describedby"),o=i?i.split(" "):[],n=o.indexOf(e),s=this.getEnabled(),a=!this.getEditable()&&this.getAggregation("tokenizer").getHiddenTokensCount();a&&-1===n?(o.push(e),s&&this.getFocusDomRef().setAttribute("aria-keyshortcuts","Enter")):-1===n||a||(o.splice(n,1),this.getFocusDomRef().removeAttribute("aria-keyshortcuts")),t&&o.length&&t.setAttribute("aria-describedby",o.join(" ").trim())},y.prototype._calculateSpaceForTokenizer=function(){var e=this.getDomRef();if(e){var t,i=this.$().find(".sapMInputDescriptionWrapper"),o=this.$().find(".sapMInputBaseInner"),n=e.offsetWidth||0,s=i.width()||0;return(t=(t=n-(this._calculateIconsSpace()+["min-width","padding-right","padding-left"].reduce((function(e,t){return e+(parseInt(o.css(t))||0)}),0)+s))<0?0:t)+"px"}return null},y.prototype._syncInputWidth=function(e){var t,i,o=this.getDomRef("inner");!o||e&&!e.getDomRef()||(t=this._calculateIconsSpace(),i=e.getDomRef().scrollWidth,o.style.width="calc(100% - "+Math.floor(t+i)+"px")},y.prototype.isValueHelpOnlyOpener=function(e){return[this._$input[0],this._getValueHelpIcon().getDomRef()].indexOf(e)>-1},y.prototype._shouldTriggerSuggest=function(){return e.prototype._shouldTriggerSuggest.apply(this,arguments)&&!this._bShowListWithTokens},y.prototype.addValidator=function(e){"function"==typeof e&&this._aTokenValidators.push(e)},y.prototype.removeValidator=function(e){var t=this._aTokenValidators.indexOf(e);-1!==t&&this._aTokenValidators.splice(t,1)},y.prototype.removeAllValidators=function(){this._aTokenValidators=[]},y.prototype.getValidators=function(){return this._aTokenValidators},y.prototype.addValidateToken=function(e,i){var o=this._validateToken(e,i);this._addUniqueToken(o,e.validationCallback)&&(this.fireTokenUpdate({addedTokens:[o],removedTokens:[],type:t.TokenUpdateType.Added}),this.fireTokenChange({addedTokens:[o],removedTokens:[],type:t.TokenChangeType.TokensChanged}))},y.prototype._validateToken=function(e,t){var i,o=e.token,n=e.validationCallback,s=e.suggestionObject,a=o&&o.getText(),r=a||e.text;if(!(i=(t=t||this._aTokenValidators).length))return!o&&n&&n(!1),o;for(var g=0;g<i;g++){if(!(o=t[g]({text:r,suggestedToken:o,suggestionObject:s,asyncCallback:this._getAsyncValidationCallback(t,g,r,s,n)})))return n&&n(!1),null;if(o===this.getWaitForAsyncValidation())return null}return o},y.prototype._addUniqueToken=function(e,t){if(!e)return!1;var i=!this._tokenExists(e);return i&&this.addToken(e),t&&t(i),i},y.prototype._tokenExists=function(e){var t=this.getTokens(),i=t.length,o=e&&e.getKey();if(!o)return!1;for(var n=0;n<i;n++)if(t[n].getKey()===o)return!0;return!1},y.prototype._convertTextToToken=function(e,t){var i=this.getAggregation("tokenizer").getTokens().length,o=this._configureTokenOptions(e,!1,t),n=o.text,s=o.item,a=o.token;return n?this._validateToken({text:n,token:a,suggestionObject:s,validationCallback:this._validationCallback.bind(this,i)}):null},y.prototype._validateCurrentText=function(e){var t=this.getAggregation("tokenizer").getTokens().length,i=this._configureTokenOptions(this.getValue(),e),o=i.text,n=i.item,s=i.token;if(!o)return null;n&&(this._bTokenIsAdded=!0),(!this.getMaxTokens()||this.getTokens().length<this.getMaxTokens())&&(this._bIsValidating=!0,this.addValidateToken({text:a.escapeSettingsValue(o),token:s,suggestionObject:n,validationCallback:this._validationCallback.bind(this,t)}))},y.prototype._configureTokenOptions=function(e,t,o){var n,s;return e&&this.getEditable()&&(e=e.trim()),e&&(t||o||this._getIsSuggestionPopupOpen())&&(n=this._hasTabularSuggestions()?this._getSuggestionsTable().getSelectedItem():this._getSuggestionItem(e,t)),n&&n.getText&&n.getKey&&(s=new i({text:a.escapeSettingsValue(n.getText()),key:n.getKey()})),{text:e,item:n,token:s}},y.prototype._getAsyncValidationCallback=function(e,t,i,o,n){var s=this;return function(a){a?a=s.addValidateToken({text:i,token:a,suggestionObject:o,validationCallback:n},e.slice(t+1)):n&&n(!1)}},y.prototype.getFormFormattedValue=function(){return this.getTokens().map((function(e){return e.getText()})).join(", ")},y.prototype.getFormValueProperty=function(){return"_semanticFormValue"},y.prototype.updateFormValueProperty=function(){this.setProperty("_semanticFormValue",this.getFormFormattedValue(),!0)},y}));