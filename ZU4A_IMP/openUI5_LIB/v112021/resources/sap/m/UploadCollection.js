sap.ui.define(["./library","sap/m/library","sap/m/MessageBox","sap/m/Dialog","sap/ui/core/Control","sap/ui/core/Icon","sap/ui/core/IconPool","sap/m/Image","sap/m/Text","sap/m/Title","sap/m/Button","sap/m/List","sap/m/BusyIndicator","sap/m/StandardListItem","sap/ui/unified/FileUploaderParameter","sap/ui/unified/FileUploader","sap/ui/core/format/FileSizeFormat","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/ObjectAttribute","sap/m/UploadCollectionItem","sap/m/UploadCollectionParameter","sap/m/UploadCollectionToolbarPlaceholder","sap/ui/core/HTML","sap/ui/core/InvisibleText","sap/m/CustomListItem","sap/ui/core/ResizeHandler","sap/ui/Device","./UploadCollectionRenderer","sap/ui/thirdparty/jquery","sap/ui/events/KeyCodes","sap/base/Log","sap/ui/core/Configuration","sap/ui/dom/jquery/selectText"],(function(e,t,a,i,o,r,s,n,l,d,p,h,g,m,u,_,c,I,f,U,y,F,D,C,b,T,v,L,P,jQuery,E,A,N){"use strict";var S=o.extend("sap.m.UploadCollection",{constructor:function(t,a){var i;a&&void 0!==a.instantUpload?(!1===a.instantUpload&&(i=a.instantUpload),delete a.instantUpload):t&&void 0!==t.instantUpload&&(!1===t.instantUpload&&(i=t.instantUpload),delete t.instantUpload),a&&a.mode===e.ListMode.MultiSelect&&!1===i?(a.mode=e.ListMode.None,A.info("sap.m.ListMode.MultiSelect is not supported by UploadCollection for Upload Pending scenario. Value has been resetted to 'None'")):t&&t.mode===e.ListMode.MultiSelect&&!1===i&&(t.mode=e.ListMode.None,A.info("sap.m.ListMode.MultiSelect is not supported by UploadCollection for Upload Pending scenario. Value has been resetted to 'None'"));try{o.apply(this,arguments),!1===i&&(this.bInstantUpload=i,this._oFormatDecimal=c.getInstance({binaryFilesize:!1,maxFractionDigits:1,maxIntegerDigits:4}))}catch(e){throw this.destroy(),e}},metadata:{library:"sap.m",properties:{fileType:{type:"string[]",group:"Data",defaultValue:null},maximumFilenameLength:{type:"int",group:"Data",defaultValue:null},maximumFileSize:{type:"float",group:"Data",defaultValue:null},mimeType:{type:"string[]",group:"Data",defaultValue:null},multiple:{type:"boolean",group:"Behavior",defaultValue:!1},noDataText:{type:"string",group:"Appearance",defaultValue:null},noDataDescription:{type:"string",group:"Appearance",defaultValue:null},sameFilenameAllowed:{type:"boolean",group:"Behavior",defaultValue:!1},showSeparators:{type:"sap.m.ListSeparators",group:"Appearance",defaultValue:"All"},uploadEnabled:{type:"boolean",group:"Behavior",defaultValue:!0},uploadUrl:{type:"string",group:"Data",defaultValue:"../../../upload"},instantUpload:{type:"boolean",group:"Behavior",defaultValue:!0},numberOfAttachmentsText:{type:"string",group:"Appearance",defaultValue:null},mode:{type:"sap.m.ListMode",group:"Behavior",defaultValue:"None"},uploadButtonInvisible:{type:"boolean",group:"Appearance",defaultValue:!1},terminationEnabled:{type:"boolean",group:"Behavior",defaultValue:!0}},defaultAggregation:"items",aggregations:{items:{type:"sap.m.UploadCollectionItem",multiple:!0,singularName:"item",bindable:"bindable"},headerParameters:{type:"sap.m.UploadCollectionParameter",multiple:!0,singularName:"headerParameter"},parameters:{type:"sap.m.UploadCollectionParameter",multiple:!0,singularName:"parameter"},toolbar:{type:"sap.m.OverflowToolbar",multiple:!1},infoToolbar:{type:"sap.m.Toolbar",multiple:!1,forwarding:{idSuffix:"-list",aggregation:"infoToolbar"}},_list:{type:"sap.m.List",multiple:!1,visibility:"hidden"},_noDataIcon:{type:"sap.ui.core.Icon",multiple:!1,visibility:"hidden"},_dragDropIcon:{type:"sap.ui.core.Icon",multiple:!1,visibility:"hidden"},_dragDropText:{type:"sap.m.Text",multiple:!1,visibility:"hidden"}},events:{change:{parameters:{documentId:{type:"string"},files:{type:"object[]"}}},fileDeleted:{parameters:{documentId:{type:"string"},item:{type:"sap.m.UploadCollectionItem"}}},filenameLengthExceed:{parameters:{documentId:{type:"string"},files:{type:"object[]"}}},fileRenamed:{parameters:{documentId:{type:"string"},fileName:{type:"string"},item:{type:"sap.m.UploadCollectionItem"}}},fileSizeExceed:{parameters:{documentId:{type:"string"},fileSize:{type:"string"},files:{type:"object[]"}}},typeMissmatch:{parameters:{documentId:{type:"string"},fileType:{type:"string"},mimeType:{type:"string"},files:{type:"object[]"}}},uploadComplete:{parameters:{readyStateXHR:{type:"string"},response:{type:"string"},status:{type:"string"},files:{type:"object[]"}}},uploadTerminated:{parameters:{fileName:{type:"string"},getHeaderParameter:{type:"function"}}},beforeUploadStarts:{parameters:{fileName:{type:"string"},addHeaderParameter:{type:"function"},getHeaderParameter:{type:"function"}}},selectionChange:{parameters:{selectedItem:{type:"sap.m.UploadCollectionItem"},selectedItems:{type:"sap.m.UploadCollectionItem[]"},selected:{type:"boolean"}}}}},renderer:P});return S._uploadingStatus="uploading",S._displayStatus="display",S._toBeDeletedStatus="toBeDeleted",S._pendingUploadStatus="pendingUploadStatus",S._placeholderCamera="sap-icon://card",S._markerMargin=8,L.system.phone?S._resizeTimeoutInterval=500:S._resizeTimeoutInterval=100,S.prototype.init=function(){S.prototype._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.m"),this._headerParamConst={requestIdName:"requestId"+jQuery.now(),fileNameRequestIdName:"fileNameRequestId"+jQuery.now(),acceptLanguage:"accept-language"},this._requestIdValue=0,this._iFUCounter=0;var e=this.getNoDataText()+" "+this.getNoDataDescription();this._oList=new h(this.getId()+"-list",{selectionChange:[this._handleSelectionChange,this],noDataText:e}),this.setAggregation("_list",this._oList,!0),this._oList.addStyleClass("sapMUCList"),this.setAggregation("_noDataIcon",new r(this.getId()+"-no-data-icon",{src:"sap-icon://document",size:"6rem",noTabStop:!0}),!0),this.setAggregation("_dragDropIcon",new r(this.getId()+"-drag-drop-icon",{src:"sap-icon://upload-to-cloud",size:"4rem",noTabStop:!0}),!0),this.setAggregation("_dragDropText",new l(this.getId()+"-drag-drop-text",{text:this._oRb.getText("UPLOADCOLLECTION_DRAG_FILE_INDICATOR")}),!0),this._iUploadStartCallCounter=0,this.aItems=[],this._aDeletedItemForPendingUpload=[],this._aFileUploadersForPendingUpload=[],this._aFilesFromDragAndDropForPendingUpload=[],this._iFileUploaderPH=null,this._oListEventDelegate=null,this._oItemToUpdate=null,this._sReziseHandlerId=null,this.oInvisibleText=(new b).toStatic()},S.prototype.setFileType=function(e){if(!e)return this;if(this.getInstantUpload()){for(var t=e.length,a=0;a<t;a++)e[a]=e[a].toLowerCase();this.getFileType()!==e&&(this.setProperty("fileType",e,!0),this._getFileUploader().setFileType(e))}else A.info("As property instantUpload is false it is not allowed to change fileType at runtime.");return this},S.prototype.setMaximumFilenameLength=function(e){return this.getInstantUpload()?this.getMaximumFilenameLength()!==e&&(this.setProperty("maximumFilenameLength",e,!0),this._getFileUploader().setMaximumFilenameLength(e)):A.info("As property instantUpload is false it is not allowed to change maximumFilenameLength at runtime."),this},S.prototype.setMaximumFileSize=function(e){return this.getInstantUpload()?this.getMaximumFileSize()!==e&&(this.setProperty("maximumFileSize",e,!0),this._getFileUploader().setMaximumFileSize(e)):A.info("As property instantUpload is false it is not allowed to change maximumFileSize at runtime."),this},S.prototype.setMimeType=function(e){return this.getInstantUpload()?this.getMimeType()!==e&&(this.setProperty("mimeType",e,!0),this._getFileUploader().setMimeType(e)):A.info("As property instantUpload is false it is not allowed to change mimeType at runtime."),this},S.prototype.setMultiple=function(e){return this.getInstantUpload()?this.getMultiple()!==e&&(this.setProperty("multiple",e),this._getFileUploader().setMultiple(e)):A.info("As property instantUpload is false it is not allowed to change multiple at runtime."),this},S.prototype.setShowSeparators=function(e){return this.getShowSeparators()!==e&&(this.setProperty("showSeparators",e),this._oList.setShowSeparators(e)),this},S.prototype.setUploadEnabled=function(e){return this.getInstantUpload()?this.getUploadEnabled()!==e&&(this.setProperty("uploadEnabled",e),this._getFileUploader().setEnabled(e)):A.info("As property instantUpload is false it is not allowed to change uploadEnabled at runtime."),this},S.prototype.setUploadUrl=function(e){return this.getInstantUpload()?this.getUploadUrl()!==e&&(this.setProperty("uploadUrl",e),this._getFileUploader().setUploadUrl(e)):A.info("As property instantUpload is false it is not allowed to change uploadUrl at runtime."),this},S.prototype.setInstantUpload=function(){return A.error("It is not supported to change the behavior at runtime."),this},S.prototype.setMode=function(t){return t===e.ListMode.Delete?(this._oList.setMode(e.ListMode.None),A.info("sap.m.ListMode.Delete is not supported by UploadCollection. Value has been resetted to 'None'")):t!==e.ListMode.MultiSelect||this.getInstantUpload()?this._oList.setMode(t):(this._oList.setMode(e.ListMode.None),A.info("sap.m.ListMode.MultiSelect is not supported by UploadCollection for Pending Upload. Value has been resetted to 'None'")),this},S.prototype.getMode=function(){return this._oList.getMode()},S.prototype.getToolbar=function(){return this._oHeaderToolbar},S.prototype.getNoDataText=function(){var e=this.getProperty("noDataText");return e=e||this._oRb.getText("UPLOADCOLLECTION_NO_DATA_TEXT")},S.prototype.getNoDataDescription=function(){var e=this.getProperty("noDataDescription");return e=e||this._oRb.getText("UPLOADCOLLECTION_NO_DATA_DESCRIPTION")},S.prototype.setNoDataText=function(e){this.setProperty("noDataText",e,!0),this.$().find("#"+this.getId()+"-no-data-text").text(e);var t=e+" "+this.getNoDataDescription();return this._oList.setNoDataText(t),this},S.prototype.setNoDataDescription=function(e){this.setProperty("noDataDescription",e,!0);var t=this.getNoDataText()+" "+e;return this._oList.setNoDataText(t),this.getUploadEnabled()&&0==this._oList.getItems().length&&this.rerender(),this},S.prototype.setUploadButtonInvisible=function(e){return this.getUploadButtonInvisible()===e||(this.setProperty("uploadButtonInvisible",e,!0),this.getInstantUpload()?this._getFileUploader().setVisible(!e):this._setFileUploaderVisibility(e),this._bDragDropEnabled?(this._unbindDragEnterLeave(),this._bDragDropEnabled=!1):this._bindDragEnterLeave()),this},S.prototype.getInternalRequestHeaderNames=function(){return[this._headerParamConst.fileNameRequestIdName,this._headerParamConst.requestIdName]},S.prototype.upload=function(){this.getInstantUpload()&&A.error("Not a valid API call. 'instantUpload' should be set to 'false'.");for(var e=this._aFileUploadersForPendingUpload.length,t=0;t<e;t++)this._iUploadStartCallCounter=0,this._aFileUploadersForPendingUpload[t].getValue()&&this._aFileUploadersForPendingUpload[t].upload();this._aFilesFromDragAndDropForPendingUpload.length>0&&(this._oFileUploader._sendFilesFromDragAndDrop(this._aFilesFromDragAndDropForPendingUpload),this._aFilesFromDragAndDropForPendingUpload=[])},S.prototype.getSelectedItems=function(){var e=this._oList.getSelectedItems();return this._getUploadCollectionItemsByListItems(e)},S.prototype.getSelectedItem=function(){var e=this._oList.getSelectedItem();return e?this._getUploadCollectionItemByListItem(e):null},S.prototype.setSelectedItemById=function(e,t){return this._oList.setSelectedItemById(e+"-cli",t),this._setSelectedForItems([this._getUploadCollectionItemById(e)],t),this},S.prototype.setSelectedItem=function(e,t){return this.setSelectedItemById(e.getId(),t)},S.prototype.selectAll=function(){return this._oList.selectAll().getItems().length!==this.getItems().length&&A.info("Internal 'List' and external 'UploadCollection' are not in sync."),this._setSelectedForItems(this.getItems(),!0),this},S.prototype.downloadItem=function(e,t){return this.getInstantUpload()?e.download(t):(A.info("Download is not possible on Pending Upload mode"),!1)},S.prototype.openFileDialog=function(e){return this._oFileUploader&&(e?this._oFileUploader.getMultiple()?A.warning("Version Upload cannot be used in multiple upload mode"):(this._oItemToUpdate=e,this._oFileUploader.$().find("input[type=file]").trigger("click")):this._oFileUploader.$().find("input[type=file]").trigger("click")),this},S.prototype.removeAggregation=function(e,t,a){var i,r,s;return!this.getInstantUpload()&&"items"===e&&t&&((i=t._internalFileIdWithinDragDropArray)?-1!==(r=this._aFilesFromDragAndDropForPendingUpload.indexOf(i))&&this._aFilesFromDragAndDropForPendingUpload.splice(r,1):"number"==typeof t?(s=this.getItems(),this._aDeletedItemForPendingUpload.push(s[t])):this._aDeletedItemForPendingUpload.push(t)),o.prototype.removeAggregation.apply(this,arguments)},S.prototype.removeAllAggregation=function(e,t){if(!this.getInstantUpload()&&"items"===e&&this._aFileUploadersForPendingUpload){for(var a=0;a<this._aFileUploadersForPendingUpload.length;a++)this._aFileUploadersForPendingUpload[a].destroy(),this._aFileUploadersForPendingUpload[a]=null;this._aFileUploadersForPendingUpload=[]}return o.prototype.removeAllAggregation.apply(this,arguments)},S.prototype.onBeforeRendering=function(){var e,t;if(this._RenderManager=this._RenderManager||sap.ui.getCore().createRenderManager(),this._oListEventDelegate&&(this._oList.removeEventDelegate(this._oListEventDelegate),this._oListEventDelegate=null),this._deregisterSizeHandler(),this._unbindDragEnterLeave(),function(){!1===this.bInstantUpload&&(this.setProperty("instantUpload",this.bInstantUpload,!0),delete this.bInstantUpload)}.bind(this)(),!this.getInstantUpload())return this.aItems=this.getItems(),this._getListHeader(this.aItems.length),this._clearList(),this._fillList(this.aItems),void this._oList.setHeaderToolbar(this._oHeaderToolbar);if(this.aItems.length>0){t=this.aItems.length;var a=[];for(e=0;e<t;e++)(this.aItems[e]&&this.aItems[e]._status===S._uploadingStatus||this.aItems[e]&&this.aItems[e]._status!==S._uploadingStatus&&100===this.aItems[e]._percentUploaded&&0===this.getItems().length)&&a.push(this.aItems[e]);0!==a.length?(this.aItems=[],this.aItems=this.getItems(),this.aItems=a.concat(this.aItems)):this.aItems=this.getItems()}else this.aItems=this.getItems();this._getListHeader(this.aItems.length),this._clearList(),this._fillList(this.aItems),this._oList.setAggregation("headerToolbar",this._oHeaderToolbar,!0),"Error"!==this.sErrorState?this.getUploadEnabled()!==this._oFileUploader.getEnabled()&&this._oFileUploader.setEnabled(this.getUploadEnabled()):this._oFileUploader.setEnabled(!1),this.sDeletedItemId&&jQuery(document.activeElement).trigger("blur")},S.prototype.onAfterRendering=function(){if(this._bindDragEnterLeave(),this.getInstantUpload()){if(this.aItems||this.aItems===this.getItems())if(this.editModeItem){var e=jQuery(document.getElementById(this.editModeItem+"-ta_editFileName-inner"));if(e){var t=this.editModeItem;L.os.ios||e.on("focus",(function(){e.selectText(0,e.val().length)})),e.trigger("focus"),this.oInvisibleText.setText(""),sap.ui.getCore().byId(this.editModeItem+"-cli").removeAllAriaLabelledBy(),sap.ui.getCore().byId(this.editModeItem+"-cli").addAriaLabelledBy(this.oInvisibleText.getId()),this._oListEventDelegate={onclick:function(e){this._handleClick(e,t)}.bind(this)},this._oList.addDelegate(this._oListEventDelegate)}}else this.sFocusId?(this._setFocusToLineItem(this.sFocusId),this.sFocusId=null):this.sDeletedItemId&&this._setFocusAfterDeletion()}else this.sFocusId&&(this._setFocusToLineItem(this.sFocusId),this.sFocusId=null)},S.prototype.exit=function(){var e,t,a;if(this._unbindDragEnterLeave(),this._$RootNode&&(this._$RootNode=null),this._oFileUploader&&(this._oFileUploader.destroy(),this._oFileUploader=null),this._oHeaderToolbar&&(this._oHeaderToolbar.destroy(),this._oHeaderToolbar=null),this._oNumberOfAttachmentsTitle&&(this._oNumberOfAttachmentsTitle.destroy(),this._oNumberOfAttachmentsTitle=null),this._RenderManager&&this._RenderManager.destroy(),this._aFileUploadersForPendingUpload){for(t=this._aFileUploadersForPendingUpload.length,e=0;e<t;e++)this._aFileUploadersForPendingUpload[e].destroy(),this._aFileUploadersForPendingUpload[e]=null;this._aFileUploadersForPendingUpload=null}if(this.aItems&&this.aItems.length>0)for(e=0;e<this.aItems.length;e++)this.aItems[e]._status===S._uploadingStatus&&(a=this.aItems.splice(e,1)[0]).destroy&&a.destroy();this._deregisterSizeHandler(),this.oInvisibleText&&this.oInvisibleText.destroy()},S.prototype._bindDragEnterLeave=function(){this._bDragDropEnabled=this._isDragAndDropAllowed(),this._bDragDropEnabled&&(this._oDragDropHandler||(this._oDragDropHandler={dragEnterUIArea:this._onDragEnterUIArea.bind(this),dragLeaveUIArea:this._onDragLeaveUIArea.bind(this),dragOverUIArea:this._onDragOverUIArea.bind(this),dropOnUIArea:this._onDropOnUIArea.bind(this),dragEnterUploadCollection:this._onDragEnterUploadCollection.bind(this),dragLeaveUploadCollection:this._onDragLeaveUploadCollection.bind(this),dragOverUploadCollection:this._onDragOverUploadCollection.bind(this),dropOnUploadCollection:this._onDropOnUploadCollection.bind(this)}),this._$RootNode=jQuery(document.body),this._$RootNode.on("dragenter",this._oDragDropHandler.dragEnterUIArea),this._$RootNode.on("dragleave",this._oDragDropHandler.dragLeaveUIArea),this._$RootNode.on("dragover",this._oDragDropHandler.dragOverUIArea),this._$RootNode.on("drop",this._oDragDropHandler.dropOnUIArea),this._$DragDropArea=this.$("drag-drop-area"),this.$().on("dragenter",this._oDragDropHandler.dragEnterUploadCollection),this.$().on("dragleave",this._oDragDropHandler.dragLeaveUploadCollection),this.$().on("dragover",this._oDragDropHandler.dragOverUploadCollection),this.$().on("drop",this._oDragDropHandler.dropOnUploadCollection))},S.prototype._unbindDragEnterLeave=function(){(this._bDragDropEnabled||this._oDragDropHandler)&&(this._$RootNode&&(this._$RootNode.off("dragenter",this._oDragDropHandler.dragEnterUIArea),this._$RootNode.off("dragleave",this._oDragDropHandler.dragLeaveUIArea),this._$RootNode.off("dragover",this._oDragDropHandler.dragOverUIArea),this._$RootNode.off("drop",this._oDragDropHandler.dropOnUIArea)),this.$().off("dragenter",this._oDragDropHandler.dragEnterUploadCollection),this.$().off("dragleave",this._oDragDropHandler.dragLeaveUploadCollection),this.$().off("dragover",this._oDragDropHandler.dragOverUploadCollection),this.$().off("drop",this._oDragDropHandler.dropOnUploadCollection))},S.prototype._onDragEnterUIArea=function(e){this._checkForFiles(e)&&(this._oLastEnterUIArea=e.target,this._$DragDropArea.removeClass("sapMUCDragDropOverlayHide"),this._adjustDragDropIcon())},S.prototype._onDragOverUIArea=function(e){e.preventDefault(),this._checkForFiles(e)&&this._$DragDropArea.removeClass("sapMUCDragDropOverlayHide")},S.prototype._onDragLeaveUIArea=function(e){this._oLastEnterUIArea===e.target&&this._$DragDropArea.addClass("sapMUCDragDropOverlayHide")},S.prototype._onDropOnUIArea=function(e){this._$DragDropArea.addClass("sapMUCDragDropOverlayHide")},S.prototype._onDragEnterUploadCollection=function(e){this._checkForFiles(e)&&e.target===this._$DragDropArea[0]&&(this._$DragDropArea.addClass("sapMUCDropIndicator"),this._adjustDragDropIcon(),this.getAggregation("_dragDropText").setText(this._oRb.getText("UPLOADCOLLECTION_DROP_FILE_INDICATOR")))},S.prototype._onDragOverUploadCollection=function(e){e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy"},S.prototype._onDragLeaveUploadCollection=function(e){e.target===this._$DragDropArea[0]&&(this._$DragDropArea.removeClass("sapMUCDropIndicator"),this.getAggregation("_dragDropText").setText(this._oRb.getText("UPLOADCOLLECTION_DRAG_FILE_INDICATOR")))},S.prototype._checkForFiles=function(e){var t=e.originalEvent.dataTransfer.types;if(t)for(var a=0;a<t.length;a++)if("Files"===t[a])return!0;return!1},S.prototype._isDragAndDropAllowed=function(){return this.getUploadEnabled()&&!this.getUploadButtonInvisible()},S.prototype._onDropOnUploadCollection=function(e){if(this._checkForFiles(e)){if(e.target===this._$DragDropArea[0]){e.preventDefault(),this._$DragDropArea.removeClass("sapMUCDropIndicator"),this._$DragDropArea.addClass("sapMUCDragDropOverlayHide"),this.getAggregation("_dragDropText").setText(this._oRb.getText("UPLOADCOLLECTION_DRAG_FILE_INDICATOR"));var t=e.originalEvent.dataTransfer.files;if(t.length>1&&!this.getMultiple()){var i=this._oRb.getText("UPLOADCOLLECTION_MULTIPLE_FALSE");return void a.error(i)}if(!this._oFileUploader._areFilesAllowed(t))return;if(void 0!==window?.oU4A)return void this.fireUploadComplete({files:t});if(this.getInstantUpload())this._oFileUploader.fireChange({files:t}),this._oFileUploader._sendFilesFromDragAndDrop(t);else for(var o=0;o<t.length;o++)this._oFileUploader.fireChange({files:[t[o]],fromDragDrop:!0}),this._aFilesFromDragAndDropForPendingUpload.push(t[o])}}else e.preventDefault()},S.prototype._adjustDragDropIcon=function(){this._$DragDropArea[0].offsetHeight<160&&this.getAggregation("_dragDropIcon").$().hide()},S.prototype._deregisterSizeHandler=function(){L.orientation.detachHandler(this._onResize,this),v.deregister(this._sReziseHandlerId)},S.prototype._hideFileUploaders=function(){var e,t;if(!this.getInstantUpload()&&(e=this._oHeaderToolbar.getContent().length,this._aFileUploadersForPendingUpload.length))for(t=0;t<e;t++)this._oHeaderToolbar.getContent()[t]instanceof _&&(t===this._iFileUploaderPH&&this._bFocusFileUploader?this._oHeaderToolbar.getContent()[t].$().find("button").trigger("focus"):this._oHeaderToolbar.getContent()[t].$().hide())},S.prototype._truncateFileName=function(e){if(e)if("Edit"!==e._status){for(var t,a=0,i=e.getMarkers(),o=0;o<i.length;o++)a=a+i[o].$().width()+S._markerMargin;if(a>0){var r=e._oFileNameLink.$();r&&(t="max-width: calc(100% - "+a+"px)",r.attr("style")!==t&&r.attr("style",t))}}else e._oListItem.$().find(".sapMUCObjectMarkerContainer").attr("style","display: none")},S.prototype._getListHeader=function(e){var t,a,i;if(this._setNumberOfAttachmentsTitle(e),this._oHeaderToolbar){if(!this.getInstantUpload()){for(a=this._aFileUploadersForPendingUpload.length-1;a>=0;a--)if(this._aFileUploadersForPendingUpload[a].getId()===this._oFileUploader.getId()){t=this._getFileUploader();var o=this.getAggregation("headerParameters"),r=this._requestIdValue.toString();if(o){for(i=0;i<o.length;i++)t.addHeaderParameter(new u({name:o[i].getProperty("name"),value:o[i].getProperty("value")}));t.addHeaderParameter(new u({name:this._headerParamConst.requestIdName,value:r}))}this._oHeaderToolbar.insertAggregation("content",t,this._iFileUploaderPH,!0);break}}}else this._oFileUploader&&!this.getInstantUpload()&&this._oFileUploader.destroy(),t=this._getFileUploader(),this._oHeaderToolbar=this.getAggregation("toolbar"),this._oHeaderToolbar?(this._oHeaderToolbar.addEventDelegate({onAfterRendering:this._hideFileUploaders},this),this._iFileUploaderPH=this._getFileUploaderPlaceHolderPosition(this._oHeaderToolbar),this._oHeaderToolbar&&this._iFileUploaderPH>-1?this._setFileUploaderInToolbar(t):A.info("A place holder of type 'sap.m.UploadCollectionPlaceholder' needs to be provided.")):(this._oHeaderToolbar=new I(this.getId()+"-toolbar",{content:[this._oNumberOfAttachmentsTitle,new f,t]}).addEventDelegate({onAfterRendering:this._hideFileUploaders},this),this._iFileUploaderPH=2)},S.prototype._getFileUploaderPlaceHolderPosition=function(e){for(var t=0;t<e.getContent().length;t++)if(e.getContent()[t]instanceof D)return t;return-1},S.prototype._setFileUploaderInToolbar=function(e){this._oHeaderToolbar.getContent()[this._iFileUploaderPH].setVisible(!1),this._oHeaderToolbar.insertContent(e,this._iFileUploaderPH)},S.prototype._mapItemToListItem=function(e){return!e||this._oItemToUpdate&&e.getId()===this._oItemToUpdate.getId()?null:(t=e.getId(),a=e._status,i=e.getFileName(),a===S._uploadingStatus?(o=new g({id:t+"-ia_indicator"})).addStyleClass("sapMUCloadingIcon"):d=this._createIcon(e,t,i),s=t+"-container",(n=jQuery(document.getElementById(s)))&&(n.remove(),n=null),l=new C(s,{content:"<span class='sapMUCTextButtonContainer'></span>",afterRendering:this._renderContent.bind(this,e,s)}),(r=new T(t+"-cli",{content:[o,d,l],selected:e.getSelected()}))._oUploadCollectionItem=e,r._status=a,r.addStyleClass("sapMUCItem"),r.setTooltip(e.getTooltip_Text()),e._oListItem=r,r);var t,a,i,o,r,s,n,l,d},S.prototype._renderContent=function(e,t){var a,i,o,r,s,n,l,d,p,h,g;if(n=e._percentUploaded,l=e.getAllAttributes(),d=e.getStatuses(),g=e.getMarkers(),a=e.getId(),o=l.length,r=d.length,s=g.length,h=e._status,(p=this._RenderManager).openStart("div"),p.class("sapMUCTextContainer"),"Edit"===h&&p.class("sapMUCEditMode"),p.openEnd(),p.renderControl(this._getFileNameControl(e)),h===S._uploadingStatus)p.renderControl(this._createProgressLabel(e,n));else{if(s>0){for(p.openStart("div"),p.class("sapMUCObjectMarkerContainer"),p.openEnd(),i=0;i<s;i++)p.renderControl(g[i].addStyleClass("sapMUCObjectMarker"));p.close("div")}if(o>0){for(p.openStart("div"),p.class("sapMUCAttrContainer"),p.attr("tabindex","-1"),p.openEnd(),i=0;i<o;i++)l[i].addStyleClass("sapMUCAttr"),p.renderControl(l[i]),i+1<o&&(p.openStart("div"),p.class("sapMUCSeparator"),p.openEnd(),p.unsafeHtml("&nbsp&#x00B7&#160"),p.close("div"));p.close("div")}if(r>0){for(p.openStart("div"),p.class("sapMUCStatusContainer"),p.attr("tabindex","-1"),p.openEnd(),i=0;i<r;i++){d[i].detachBrowserEvent("hover"),d[i].setTooltip(d[i].getTitle()+":"+d[i].getText()),p.renderControl(d[i]);for(var m=i+1;m<r&&d[i].getVisible();m++)if(d[m]&&d[m].getVisible()){p.openStart("div"),p.class("sapMUCSeparator"),p.openEnd(),p.unsafeHtml("&nbsp&#x00B7&#160"),p.close("div");break}}p.close("div")}}p.close("div"),this._renderButtons(p,e,h,a),p.flush(jQuery(document.getElementById(t))[0],!0),this._truncateFileName(e),this._sReziseHandlerId=v.register(this,this._onResize.bind(this)),L.orientation.attachHandler(this._onResize,this)},S.prototype._renderButtons=function(e,t,a,i){var o,r;if((o=this._getButtons(t,a,i))&&(r=o.length),r>0){e.openStart("div"),e.class("sapMUCButtonContainer"),e.openEnd();for(var s=0;s<r;s++)s+1<r&&o[s].addStyleClass("sapMUCFirstButton"),e.renderControl(o[s]);e.close("div")}},S.prototype._getFileNameControl=function(t){var a,i,o,r,s,n,l,d,p,h;return r=t.getFileName(),s=t.getId(),"Edit"!==t._status?((a=t._getFileNameLink?t._getFileNameLink():t._getControl("sap.m.Link",{id:s+"-ta_filenameHL",press:[t,this._onItemPressed,this]},"FileNameLink")).setEnabled(this._getItemPressEnabled(t)),a.addStyleClass("sapMUCFileName"),a.setModel(t.getModel()),a.setText(r),t._oFileNameLink=a,a):(i=S._splitFilename(r),n=this.getMaximumFilenameLength(),l="None",d=!1,o=i.name,"Error"===t.errorState&&(d=!0,l="Error",h=0===(o=t.changedFileName).length?this._oRb.getText("UPLOADCOLLECTION_TYPE_FILENAME"):this._oRb.getText("UPLOADCOLLECTION_EXISTS")),(p=t._getFileNameEditBox?t._getFileNameEditBox():t._getControl("sap.m.Input",{id:s+"-ta_editFileName",type:e.InputType.Text},"FileNameEditBox")).addStyleClass("sapMUCEditBox"),p.setModel(t.getModel()),p.setValue(o),p.setValueState(l),p.setFieldWidth("75%"),p.setValueStateText(h),p.setDescription(i.extension),p.setShowValueStateMessage(d),n-i.extension.length>0&&p.setProperty("maxLength",n-i.extension.length,!0),p)},S.prototype._getItemPressEnabled=function(e){return e._getPressEnabled()&&"Error"!==this.sErrorState},S.prototype._onItemPressed=function(e,t){t.hasListeners("press")?t.firePress():"Error"!==this.sErrorState&&t._hasUrl()&&this._triggerLink(e,t)},S.prototype._createProgressLabel=function(e,t){var a,i=e.getId();return(a=e._getProgressLabel?e._getProgressLabel():e._getControl("sap.m.Label",{id:i+"-ta_progress"},"ProgressLabel").addStyleClass("sapMUCProgress")).setText(this._oRb.getText("UPLOADCOLLECTION_UPLOADING",[t])),a},S.prototype._createIcon=function(e,t,a){var i,o,l,d;return(i=e.getThumbnailUrl())?(l=s.createControlByURI({id:t+"-ia_imageHL",src:this._getThumbnail(i,a),decorative:!1},n).addStyleClass("sapMUCItemImage sapMUCItemIcon")).setAlt(this._getAriaLabelForPicture(e)):(o=this._getThumbnail(void 0,a),(l=new r(t+"-ia_iconHL",{src:o,decorative:!1,useIconTooltip:!1})).setAlt(this._getAriaLabelForPicture(e)),d="Error"!==this.sErrorState&&e._hasUrl()?"sapMUCItemIcon":"sapMUCItemIconInactive",o===S._placeholderCamera&&("Error"!==this.sErrorState&&e._hasUrl()?d+=" sapMUCItemPlaceholder":d+=" sapMUCItemPlaceholderInactive"),l.addStyleClass(d)),this._getItemPressEnabled(e)&&l.attachPress(e,this._onItemPressed,this),l},S.prototype._getButtons=function(t,a,i){var o,r,s,n,l,d,p;return o=[],this.getInstantUpload()?("Edit"===a?(r=t._getOkButton?t._getOkButton():t._getControl("sap.m.Button",{id:i+"-okButton",text:this._oRb.getText("UPLOADCOLLECTION_RENAMEBUTTON_TEXT"),type:e.ButtonType.Transparent},"OkButton").addStyleClass("sapMUCOkBtn"),s=t._getCancelButton?t._getCancelButton():t._getControl("sap.m.Button",{id:i+"-cancelButton",text:this._oRb.getText("UPLOADCOLLECTION_CANCELBUTTON_TEXT"),type:e.ButtonType.Transparent},"CancelButton").addStyleClass("sapMUCCancelBtn"),o.push(r),o.push(s)):a===S._uploadingStatus?(n="terminateButton",l=this._createDeleteButton(i,n,t,this.sErrorState),o.push(l)):(d=t.getEnableEdit(),"Error"===this.sErrorState&&(d=!1),t.getVisibleEdit()&&((p=t._getEditButton?t._getEditButton():t._getControl("sap.m.Button",{id:i+"-editButton",icon:"sap-icon://edit",type:e.ButtonType.Standard,tooltip:this._oRb.getText("UPLOADCOLLECTION_EDITBUTTON_TEXT"),press:[t,this._handleEdit,this]},"EditButton").addStyleClass("sapMUCEditBtn")).setEnabled(d),p.setVisible(t.getVisibleEdit()),o.push(p)),n="deleteButton",t.getVisibleDelete()&&(l=this._createDeleteButton(i,n,t,this.sErrorState),o.push(l))),o):(n="deleteButton",l=this._createDeleteButton(i,n,t,this.sErrorState),o.push(l),o)},S.prototype._createDeleteButton=function(t,a,i,o){var r,s,n,l,d,p,h;return r=i.getEnableDelete(),"Error"===o&&(r=!1),"deleteButton"===a?(n="DeleteButton",d=i._getDeleteButton,l=this._oRb.getText("UPLOADCOLLECTION_DELETEBUTTON_TEXT"),p=i.getVisibleDelete(),h=[this,this._handleDelete,this]):(n="TerminateButton",d=i._getTerminateButton,l=this._oRb.getText("UPLOADCOLLECTION_TERMINATEBUTTON_TEXT"),p=this.getTerminationEnabled(),h=[i,this._handleTerminate,this]),(s=d?d():i._getControl("sap.m.Button",{id:t+"-"+a,icon:"sap-icon://decline",type:e.ButtonType.Standard,press:h},n).addStyleClass("sapMUCDeleteBtn")).setVisible(p),s.setEnabled(r),s.setTooltip(l),s},S.prototype._fillList=function(e){var t,a=this,i=e.length-1,o=this.getBinding("items"),r=!1,s=this.getBindingInfo("items")?this.getBindingInfo("items").model:void 0,n=this.getBindingInfo("items")?this.getBindingInfo("items").groupHeaderFactory:null,l=function(e){return e.getBindingContext(s)?o.getGroup(e.getBindingContext(s)):null},d=function(e){return l(e)&&l(e).key};jQuery.each(e,(function(e,s){if(o&&o.isGrouped()&&s&&(r&&t===d(s)||(n?a._oList.addItemGroup(l(s),n(l(s)),!0):l(s)&&a._oList.addItemGroup(l(s),null,!0),r=!0,t=d(s))),s._status&&s.getVisibleEdit()){if(a.getInstantUpload()&&a._oItemForDelete&&a._oItemForDelete._status===S._toBeDeletedStatus&&s.getDocumentId()===a._oItemForDelete.documentId)return!1}else s._status=S._displayStatus;s._percentUploaded||s._status!==S._uploadingStatus||(s._percentUploaded=0);var p=a._mapItemToListItem(s);return p&&(0===e&&0===i?p.addStyleClass("sapMUCListSingleItem"):0===e?p.addStyleClass("sapMUCListFirstItem"):e===i?p.addStyleClass("sapMUCListLastItem"):p.addStyleClass("sapMUCListItem"),a._oList.addAggregation("items",p,!0),s.attachEvent("selected",a._handleItemSetSelected,a)),!0}))},S.prototype._clearList=function(){this._oList&&this._oList.destroyAggregation("items",!0)},S.prototype._setNumberOfAttachmentsTitle=function(e){var t,a=e||0;this._oItemToUpdate&&a--,t=this.getNumberOfAttachmentsText()?this.getNumberOfAttachmentsText():this._oRb.getText("UPLOADCOLLECTION_ATTACHMENTS",[a]),this._oNumberOfAttachmentsTitle?this._oNumberOfAttachmentsTitle.setText(t):this._oNumberOfAttachmentsTitle=new d(this.getId()+"-numberOfAttachmentsTitle",{text:t})},S.prototype._setFileUploaderVisibility=function(e){var t=this._oHeaderToolbar.getContent();if(t){var a=t[this._iFileUploaderPH];a instanceof _&&a.setVisible(!e)}},S.prototype._handleDelete=function(e){for(var t,i,o,r,s=e.getParameters(),n=this.getItems(),l=s.id.split("-deleteButton")[0],d="",p=0;p<n.length;p++)if(n[p].sId===l){i=p,t={documentId:n[p].getDocumentId(),_iLineNumber:i};break}n[i].hasListeners("deletePress")?n[i].fireDeletePress():(this.sDeletedItemId=l,jQuery(document.getElementById(this.sId)).hasClass("sapUiSizeCompact")&&(d="sapUiSizeCompact"),this.editModeItem&&(this._handleOk(e,this.editModeItem,!0),"Error"===this.sErrorState)||n[i]&&n[i].getEnableDelete()&&(r=(o=n[i].getFileName())?this._oRb.getText("UPLOADCOLLECTION_DELETE_TEXT",o):this._oRb.getText("UPLOADCOLLECTION_DELETE_WITHOUT_FILENAME_TEXT"),this._oItemForDelete=t,a.show(r,{title:this._oRb.getText("UPLOADCOLLECTION_DELETE_TITLE"),actions:[a.Action.OK,a.Action.CANCEL],emphasizedAction:a.Action.OK,onClose:this._onCloseMessageBoxDeleteItem.bind(this),dialogId:"messageBoxDeleteFile",styleClass:d})))},S.prototype._onCloseMessageBoxDeleteItem=function(e){var t,i=this.getItems();if(this.getInstantUpload())for(var o=0;o<i.length;o++)i[o].getDocumentId()===this._oItemForDelete.documentId&&(t=i[o]);else t=i[this._oItemForDelete._iLineNumber];e===a.Action.OK&&(this._oItemForDelete._status=S._toBeDeletedStatus,this.getInstantUpload()?(this.fireFileDeleted({documentId:this._oItemForDelete.documentId,item:t}),this._oItemForDelete=null):(1===this.aItems.length?this.getUploadButtonInvisible()||(this.sFocusId=this._oFileUploader.$().find(":button")[0].id):this._oItemForDelete._iLineNumber<this.aItems.length-1?this.sFocusId=this.aItems[this._oItemForDelete._iLineNumber+1].getId()+"-cli":this.sFocusId=this.aItems[0].getId()+"-cli",this._aDeletedItemForPendingUpload.push(t),this.aItems.splice(this._oItemForDelete._iLineNumber,1),this.removeAggregation("items",t,!1)))},S.prototype._handleTerminate=function(e,t){var a,o;(a=new h({items:[new m({icon:this._getIconFromFilename(t.getFileName())})]})).getItems()[0].setTitle(t.getFileName()),o=new i({id:this.getId()+"deleteDialog",title:this._oRb.getText("UPLOADCOLLECTION_TERMINATE_TITLE"),content:[new l({text:this._oRb.getText("UPLOADCOLLECTION_TERMINATE_TEXT")}),a],buttons:[new p({text:this._oRb.getText("UPLOADCOLLECTION_OKBUTTON_TEXT"),press:[function(){for(var e=!1,a=0;a<this.aItems.length;a++){if(this.aItems[a]._status===S._uploadingStatus&&this.aItems[a]._requestIdName===t._requestIdName){this.aItems[a]._status=S._toBeDeletedStatus,this._oItemForDelete=this.aItems[a],e=!0;break}if(t.getFileName()===this.aItems[a].getFileName()&&this.aItems[a]._status===S._displayStatus){this.aItems[a]._status=S._toBeDeletedStatus,this._oItemForDelete=this.aItems[a],this.fireFileDeleted({documentId:this.aItems[a].getDocumentId(),item:this.aItems[a]});break}}e&&this._getFileUploader().abort(this._headerParamConst.fileNameRequestIdName,this._encodeToAscii(t.getFileName())+this._oItemForDelete._requestIdName);o.close(),this.invalidate()},this]}),new p({text:this._oRb.getText("UPLOADCOLLECTION_CANCELBUTTON_TEXT"),press:function(){o.close()}})],afterClose:function(){o.destroy()}}).open()},S.prototype._handleEdit=function(e,t){var a,i=t.getId(),o=this.aItems.length;if(this.editModeItem&&this._handleOk(e,this.editModeItem,!1),"Error"!==this.sErrorState){for(a=0;a<o;a++)if(this.aItems[a].getId()===i){this.aItems[a]._status="Edit";break}t._status="Edit",this.editModeItem=e.getSource().getId().split("-editButton")[0],this.invalidate()}},S.prototype._handleClick=function(e,t){var a=jQuery(e.target).closest("button"),i="";a.length&&(i=a.prop("id")),-1===i.lastIndexOf("editButton")&&(-1!==i.lastIndexOf("cancelButton")?this._handleCancel(e,t):e.target.id.lastIndexOf("ia_imageHL")<0&&e.target.id.lastIndexOf("ia_iconHL")<0&&e.target.id.lastIndexOf("deleteButton")<0&&e.target.id.lastIndexOf("ta_editFileName-inner")<0&&(e.target.id.lastIndexOf("cli")>0&&(this.sFocusId=e.target.id),this._handleOk(e,t,!0)))},S.prototype._handleOk=function(e,t,a){var i,o=document.getElementById(t+"-ta_editFileName-inner"),r=S._findById(t,this.aItems),s=r.getProperty("fileName"),n=S._splitFilename(s),l=sap.ui.getCore().byId(t+"-ta_editFileName"),d=r.errorState,p=r.changedFileName;if(null!==o&&(i=o.value.replace(/^\s+/,"")),this.sFocusId=t+"-cli",i&&0!==i.length)return r._status=S._displayStatus,n.name===i?(this._removeErrorStateFromItem(this,r),void(a&&this.invalidate())):this.getSameFilenameAllowed()?(this._removeErrorStateFromItem(this,r),this._oItemForRename=r,void this._onEditItemOk.bind(this)(i+n.extension)):void(S._checkDoubleFileName(i+n.extension,this.aItems)?(l.setProperty("valueState","Error",!0),this._setErrorStateOnItem(this,r,i,p,d)):(l.setProperty("valueState","None",!0),r.changedFileName=null,this._removeErrorStateFromItem(this,r),a&&this.invalidate(),this._oItemForRename=r,this._onEditItemOk.bind(this)(i+n.extension)));null!==o&&this._setErrorStateOnItem(this,r,i,p,d)},S.prototype._setErrorStateOnItem=function(e,t,a,i,o){t._status="Edit",t.errorState="Error",e.sErrorState="Error",t.changedFileName=a,"Error"===o&&i===a||e.invalidate()},S.prototype._removeErrorStateFromItem=function(e,t){t.errorState=null,e.sErrorState=null,e.editModeItem=null},S.prototype._onEditItemOk=function(e){this._oItemForRename&&(this._oItemForRename.setFileName(e),this.fireFileRenamed({documentId:this._oItemForRename.getProperty("documentId"),fileName:e,item:this._oItemForRename})),delete this._oItemForRename},S.prototype._handleCancel=function(e,t){var a=S._findById(t,this.aItems);a._status=S._displayStatus,a.errorState=null,a.changedFileName=a._getFileNameEditBox().getValue(),this.sFocusId=this.editModeItem+"-cli",this.sErrorState=null,this.editModeItem=null,this.invalidate()},S.prototype._onChange=function(e){if(e){var t,a,i,o,r,s,n=e.getParameter("files").length;if(0===n)return;this._oFileUploader.removeAllAggregation("headerParameters",!0),this.removeAllAggregation("headerParameters",!0),this._oFileUploader.removeAllAggregation("parameters",!0),this.removeAllAggregation("parameters",!0),this.fireChange({getParameter:function(t){return t?e.getParameter(t):null},getParameters:function(){return e.getParameters()},mParameters:e.getParameters(),files:e.getParameter("files")});var l=this.getAggregation("parameters");l&&jQuery.each(l,function(e,t){var a=new u({name:t.getProperty("name"),value:t.getProperty("value")});this._oFileUploader.addParameter(a)}.bind(this)),this.getInstantUpload()?o=S._uploadingStatus:(this._bFocusFileUploader=!0,o=S._pendingUploadStatus),this._requestIdValue++,t=this._requestIdValue.toString();var d=this.getAggregation("headerParameters");for(this.getInstantUpload()||this._aFileUploadersForPendingUpload.push(this._oFileUploader),a=0;a<n;a++)(i=new y).setFileName(e.getParameter("files")[a].name),e.getParameter("fromDragDrop")&&(i._internalFileIdWithinDragDropArray=e.getParameter("files")[a]),i._status=o,i._internalFileIndexWithinFileUploader=a+1,i._requestIdName=t,this.getInstantUpload()?i._percentUploaded=0:(i.setAssociation("fileUploader",this._oFileUploader,!0),r=this._oFormatDecimal.format(e.getParameter("files")[a].size),s=new U({text:r}),i.insertAggregation("attributes",s,!0),this.insertItem(i)),this.aItems.unshift(i);d&&jQuery.each(d,function(e,t){this._oFileUploader.addHeaderParameter(new u({name:t.getProperty("name"),value:t.getProperty("value")}))}.bind(this)),this._oFileUploader.addHeaderParameter(new u({name:this._headerParamConst.requestIdName,value:t}))}},S.prototype._onFilenameLengthExceed=function(e){var t=[{name:e.getParameter("fileName")}];this.fireFilenameLengthExceed({getParameter:function(t){if(t)return e.getParameter(t)},getParameters:function(){return e.getParameters()},mParameters:e.getParameters(),files:t})},S.prototype._onFileSizeExceed=function(e){var t={name:e.getParameter("fileName"),fileSize:e.getParameter("fileSize")};this.fireFileSizeExceed({getParameter:function(t){if(t)return e.getParameter(t)},getParameters:function(){return e.getParameters()},mParameters:e.getParameters(),files:[t]})},S.prototype._onTypeMissmatch=function(e){var t=[{name:e.getParameter("fileName"),fileType:e.getParameter("fileType"),mimeType:e.getParameter("mimeType")}];this.fireTypeMissmatch({getParameter:function(t){if(t)return e.getParameter(t)},getParameters:function(){return e.getParameters()},mParameters:e.getParameters(),files:t})},S.prototype._onUploadTerminated=function(e){var t,a=this._getRequestId(e),i=e.getParameter("fileName"),o=this.aItems.length;for(t=0;t<o;t++)if(this.aItems[t]&&this.aItems[t].getFileName()===i&&this.aItems[t]._requestIdName===a&&(this.aItems[t]._status===S._uploadingStatus||this.aItems[t]._status===S._toBeDeletedStatus)){this.getItems()&&this.getItems()[t]===this.aItems[t]&&this.removeItem(t),this.aItems.splice(t,1);break}this.fireUploadTerminated({fileName:i,getHeaderParameter:this._getHeaderParameterWithinEvent.bind(e)})},S.prototype._onUploadComplete=function(e){if(void 0!==window?.oU4A){var t=this.getItems();for(let e=this.aItems.length-1;e>=0;e--){var a=this.aItems[e];-1===t.findIndex((e=>e===a))&&(a.destroy&&a.destroy())}return this.aItems=[],void this.fireUploadComplete({files:this?._oFileUploader?.oFileUpload?.files})}if(e){var i,o,r,s,n=this._getRequestId(e),l=e.getParameter("fileName"),d=e.getParameter("id"),p="2"===(h=e.getParameter("status").toString()||"200")[0]||"3"===h[0];for(o=this.aItems.length,s=[S._uploadingStatus,S._pendingUploadStatus],i=0;i<o;i++)if((!n||this.aItems[i]._requestIdName===n)&&this.aItems[i].getProperty("fileName")===l&&s.indexOf(this.aItems[i]._status)>=0){p&&this.aItems[i]._status!==S._pendingUploadStatus&&(this.aItems[i]._percentUploaded=100,this.aItems[i]._status=S._displayStatus),(r=this.aItems.splice(i,1)[0]).destroy&&r.destroy(),this._oItemToUpdate=null;break}for(i=0;i<this._aFileUploadersForPendingUpload.length;i++)if(this._aFileUploadersForPendingUpload[i].getId()===d){this._aFileUploadersForPendingUpload[i].clear();break}this.fireUploadComplete({getParameter:e.getParameter,getParameters:e.getParameters,mParameters:e.getParameters(),files:[{fileName:e.getParameter("fileName")||l,responseRaw:e.getParameter("responseRaw"),reponse:e.getParameter("response"),response:e.getParameter("response"),status:e.getParameter("status"),headers:e.getParameter("headers")}]})}var h;this.invalidate()},S.prototype._u4aCollectFiles=function(e,t){void 0!==window?.oU4A?.comm&&oU4A.comm.get("collectUploadFiles")(t,e)},S.prototype._u4aClearFiles=function(){null!=this?._oFileUploader?.oFileUpload&&(this._oFileUploader.oFileUpload.value="")},S.prototype._onUploadProgress=function(e){if(e&&this.getInstantUpload()){var t,a,i,o,r=e.getParameter("fileName"),s=Math.round(e.getParameter("loaded")/e.getParameter("total")*100),n=this._getRequestId(e),l=this.aItems.length;t=100===s?this._oRb.getText("UPLOADCOLLECTION_UPLOAD_COMPLETED"):this._oRb.getText("UPLOADCOLLECTION_UPLOADING",[s]);for(var d=0;d<l;d++)if((o=this.aItems[d]).getProperty("fileName")===r&&o._requestIdName===n&&o._status===S._uploadingStatus&&(a=o._getProgressLabel?o._getProgressLabel():o._getControl("sap.m.Label",{id:o.getId()+"-ta_progress"},"ProgressLabel"))){a.setText(t),a.rerender(),o._percentUploaded=s,i=o.$("ia_indicator"),100===s?i.attr("aria-label",t):i.attr("aria-valuenow",s);break}}},S.prototype._getRequestId=function(e){var t;if(!(t=e.getParameter("requestHeaders")))return null;for(var a=0;a<t.length;a++)if(t[a].name===this._headerParamConst.requestIdName)return t[a].value;return null},S.prototype._getFileUploader=function(){var e=this.getInstantUpload();if(!e||!this._oFileUploader){var t=this.getInstantUpload()?this._oRb.getText("UPLOADCOLLECTION_UPLOAD"):this._oRb.getText("UPLOADCOLLECTION_ADD");this._iFUCounter=this._iFUCounter+1,this._oFileUploader=new _(this.getId()+"-"+this._iFUCounter+"-uploader",{buttonOnly:!0,buttonText:t,iconOnly:!1,enabled:this.getUploadEnabled(),fileType:this.getFileType(),icon:"",iconFirst:!1,style:"Transparent",maximumFilenameLength:this.getMaximumFilenameLength(),maximumFileSize:this.getMaximumFileSize(),mimeType:this.getMimeType(),multiple:this.getMultiple(),name:"uploadCollection",uploadOnChange:e,sameFilenameAllowed:!0,uploadUrl:this.getUploadUrl(),useMultipart:!1,sendXHR:!0,change:[this._onChange,this],filenameLengthExceed:[this._onFilenameLengthExceed,this],fileSizeExceed:[this._onFileSizeExceed,this],typeMissmatch:[this._onTypeMissmatch,this],uploadAborted:[this._onUploadTerminated,this],uploadComplete:[this._onUploadComplete,this],uploadProgress:[this._onUploadProgress,this],uploadStart:[this._onUploadStart,this],visible:!this.getUploadButtonInvisible()})}return this._oFileUploader},S.prototype._onUploadStart=function(e){var t,a,i,o,r,s,n;if(void 0===window?.oU4A){for(this._iUploadStartCallCounter++,r=e.getParameter("requestHeaders").length,a=0;a<r;a++)if(e.getParameter("requestHeaders")[a].name===this._headerParamConst.requestIdName){i=e.getParameter("requestHeaders")[a].value;break}for(s=e.getParameter("fileName"),t={name:this._headerParamConst.fileNameRequestIdName,value:this._encodeToAscii(s)+i},e.getParameter("requestHeaders").push(t),o={name:this._headerParamConst.acceptLanguage,value:N.getLanguage()},e.getParameter("requestHeaders").push(o),a=0;a<this._aDeletedItemForPendingUpload.length;a++)if(this._aDeletedItemForPendingUpload[a].getAssociation("fileUploader")===e.oSource.sId&&this._aDeletedItemForPendingUpload[a].getFileName()===s&&this._aDeletedItemForPendingUpload[a]._internalFileIndexWithinFileUploader===this._iUploadStartCallCounter)return void e.getSource().abort(this._headerParamConst.fileNameRequestIdName,this._encodeToAscii(s)+i);if(this.fireBeforeUploadStarts({fileName:s,addHeaderParameter:function(t){var a={name:t.getName(),value:t.getValue()};e.getParameter("requestHeaders").push(a)},getHeaderParameter:function(t){return n=this._getHeaderParameterWithinEvent.bind(e)(t)}.bind(this)}),Array.isArray(n))for(a=0;a<n.length;a++)e.getParameter("requestHeaders")[a].name===n[a].getName()&&(e.getParameter("requestHeaders")[a].value=n[a].getValue());else if(n instanceof F)for(a=0;a<e.getParameter("requestHeaders").length;a++)if(e.getParameter("requestHeaders")[a].name===n.getName()){e.getParameter("requestHeaders")[a].value=n.getValue();break}}},S.prototype._getIconFromFilename=function(e){var t=S._splitFilename(e).extension;switch("string"==typeof t&&(t=t.toLowerCase()),t){case".bmp":case".jpg":case".jpeg":case".png":return S._placeholderCamera;case".csv":case".xls":case".xlsx":return"sap-icon://excel-attachment";case".doc":case".docx":case".odt":return"sap-icon://doc-attachment";case".pdf":return"sap-icon://pdf-attachment";case".ppt":case".pptx":return"sap-icon://ppt-attachment";case".txt":return"sap-icon://document-text";default:return"sap-icon://document"}},S.prototype._getThumbnail=function(e,t){return e||this._getIconFromFilename(t)},S.prototype._triggerLink=function(e,a){if(this.editModeItem){if(this._handleOk(e,this.editModeItem,!0),"Error"===this.sErrorState)return;this.sFocusId=e.getParameter("id")}t.URLHelper.redirect(a.getProperty("url"),!0)},S.prototype.onkeydown=function(e){switch(e.keyCode){case E.F2:this._handleF2(e);break;case E.ESCAPE:this._handleESC(e);break;case E.DELETE:this._handleDEL(e);break;case E.ENTER:this._handleENTER(e);break;default:return}e.setMarked()},S.prototype._setFocusAfterDeletion=function(){var e,t=this.aItems.length;0===t?this._oFileUploader.focus():(e=this.sDeletedItemId.split("-").pop()<=t-1?this.sDeletedItemId+"-cli":this.aItems[this.aItems.length-1].sId+"-cli",this._setFocusToLineItem(e));this.sDeletedItemId=null},S.prototype._setFocusToLineItem=function(e){jQuery(document.getElementById(e)).trigger("focus")},S.prototype._handleENTER=function(e){var a,i,o;switch(a=this.editModeItem?e.target.id.split(this.editModeItem).pop():e.target.id.split("-").pop()){case"-ta_editFileName-inner":case"-okButton":this._handleOk(e,this.editModeItem,!0);break;case"-cancelButton":e.preventDefault(),this._handleCancel(e,this.editModeItem);break;case"-ia_iconHL":case"-ia_imageHL":o=this.editModeItem.split("-").pop(),t.URLHelper.redirect(this.aItems[o].getProperty("url"),!0);break;case"ia_iconHL":case"ia_imageHL":case"cli":i=e.target.id.split(a)[0]+"ta_filenameHL",sap.ui.getCore().byId(i).getEnabled()&&(o=e.target.id.split("-")[2],t.URLHelper.redirect(this.aItems[o].getProperty("url"),!0))}},S.prototype._handleDEL=function(e){if(!this.editModeItem){var t=e.target.id.slice(0,-4),a=sap.ui.getCore().byId(t),i=a&&a._getDeleteButton&&a._getDeleteButton();i&&i.firePress()}},S.prototype._handleESC=function(e){this.editModeItem&&(this.sFocusId=this.editModeItem+"-cli",this.aItems[this.editModeItem.split("-").pop()]._status=S._displayStatus,this._handleCancel(e,this.editModeItem))},S.prototype._handleF2=function(e){var t=sap.ui.getCore().byId(e.target.id);if(void 0!==t)if(t._status===S._displayStatus){var a=jQuery(document.getElementById(e.target.id)).find("[id$='-editButton']"),i=sap.ui.getCore().byId(a[0].id);i.getEnabled()&&(this.editModeItem&&this._handleClick(e,this.editModeItem),"Error"!==this.sErrorState&&i.firePress())}else this._handleClick(e,this.editModeItem);else 0===e.target.id.search(this.editModeItem)&&this._handleOk(e,this.editModeItem,!0)},S._checkDoubleFileName=function(e,t){if(0===t.length||!e)return!1;var a=t.length;e=e.replace(/^\s+/,"");for(var i=0;i<a;i++)if(e===t[i].getProperty("fileName"))return!0;return!1},S._splitFilename=function(e){var t={},a=e.split(".");return 1===a.length?(t.extension="",t.name=a.pop(),t):(t.extension="."+a.pop(),t.name=a.join("."),t)},S.prototype._getAriaLabelForPicture=function(e){return e.getAriaLabelForPicture()||e.getFileName()},S.prototype._getHeaderParameterWithinEvent=function(e){var t,a=[],i=this.getParameter("requestHeaders"),o=i.length;if(i&&e){for(t=0;t<o;t++)if(i[t].name===e)return new F({name:i[t].name,value:i[t].value});return null}if(i){for(t=0;t<o;t++)a.push(new F({name:i[t].name,value:i[t].value}));return a}},S.prototype._encodeToAscii=function(e){for(var t="",a=0;a<e.length;a++)t+=e.charCodeAt(a);return t},S.prototype._onResize=function(){for(var e=this._oList.getItems(),t=0;t<e.length;t++){var a=e[t];setTimeout(function(){var e=this._truncateFileName.bind(this);("string"==typeof e||e instanceof String)&&(e=this[e]),e.apply(this,[a._oUploadCollectionItem])}.bind(this),S._resizeTimeoutInterval)}},S.prototype._getUploadCollectionItemByListItem=function(e){for(var t=this.getItems(),a=0;a<t.length;a++)if(t[a].getId()===e.getId().replace("-cli",""))return t[a];return null},S.prototype._getUploadCollectionItemById=function(e){for(var t=this.getItems(),a=0;a<t.length;a++)if(t[a].getId()===e)return t[a];return null},S.prototype._getUploadCollectionItemsByListItems=function(e){var t=[],a=this.getItems();if(e){for(var i=0;i<e.length;i++)for(var o=0;o<a.length;o++)if(e[i].getId().replace("-cli","")===a[o].getId()){t.push(a[o]);break}return t}return null},S.prototype._setSelectedForItems=function(t,a){if(this.getMode()!==e.ListMode.MultiSelect&&a)for(var i=this.getItems(),o=0;o<i.length;o++)i[o].setSelected(!1);for(var r=0;r<t.length;r++)t[r].setSelected(a)},S.prototype._handleItemSetSelected=function(e){var t=e.getSource();if(t instanceof y){var a=this._getListItemById(t.getId()+"-cli");a&&a.setSelected(t.getSelected())}},S.prototype._handleSelectionChange=function(e){var t=e.getParameter("listItem"),a=e.getParameter("selected"),i=this._getUploadCollectionItemsByListItems(e.getParameter("listItems")),o=this._getUploadCollectionItemByListItem(t);o&&t&&i&&(this.fireSelectionChange({selectedItem:o,selectedItems:i,selected:a}),o.setSelected(t.getSelected()))},S.prototype._getListItemById=function(e){var t=this._oList.getItems();return S._findById(e,t)},S._findById=function(e,t){for(var a=0;a<t.length;a++)if(t[a].getId()===e)return t[a];return null},S}));