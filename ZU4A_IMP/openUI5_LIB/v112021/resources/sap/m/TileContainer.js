sap.ui.define(["./library","sap/ui/core/Control","sap/ui/core/Core","sap/ui/core/Element","sap/ui/core/IconPool","sap/ui/Device","sap/ui/core/ResizeHandler","./TileContainerRenderer","sap/base/Log","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/Selectors"],(function(t,e,i,s,o,r,n,a,h,jQuery){"use strict";var l=e.extend("sap.m.TileContainer",{metadata:{library:"sap.m",deprecated:!0,properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"},editable:{type:"boolean",group:"Misc",defaultValue:null},allowAdd:{type:"boolean",group:"Misc",defaultValue:null}},defaultAggregation:"tiles",aggregations:{tiles:{type:"sap.m.Tile",multiple:!0,singularName:"tile"}},events:{tileMove:{parameters:{tile:{type:"sap.m.Tile"},newIndex:{type:"int"}}},tileDelete:{parameters:{tile:{type:"sap.m.Tile"}}},tileAdd:{}}},renderer:a});o.insertFontFaceStyle(),l.prototype._bRtl=i.getConfiguration().getRTL(),l.prototype.init=function(){if(this._iCurrentTileStartIndex=0,this._oDim=null,this._iScrollLeft=0,this._iScrollGap=0,r.system.desktop||(this._iScrollGap=0),this.bAllowTextSelection=!1,this._oDragSession=null,this._oTouchSession=null,this._bAvoidChildTapEvent=!1,this._iEdgeShowStart=r.system.phone?10:20,r.system.phone?this._iTriggerScrollOffset=10:r.system.desktop?this._iTriggerScrollOffset=-40:this._iTriggerScrollOffset=20,this._iCurrentFocusIndex=-1,r.system.desktop||r.system.combi){var t=jQuery.proxy((function(t){if(this._iCurrentFocusIndex>=0){var e=this._iCurrentFocusIndex-this._iCurrentFocusIndex%this._iMaxTilesX,i=this._iCurrentTileStartIndex===this._iCurrentFocusIndex?0:this._iCurrentTileStartIndex,s=t.ctrlKey?i:e,o=this._getVisibleTiles()[s];o&&(this._findTile(o.$()).trigger("focus"),t.stopPropagation()),this._handleAriaActiveDescendant()}}),this),e=jQuery.proxy((function(t){if(this._iCurrentFocusIndex>=0){var e=this._getVisibleTiles(),i=this._iCurrentFocusIndex-this._iCurrentFocusIndex%this._iMaxTilesX,s=i+this._iMaxTilesX<e.length?i+this._iMaxTilesX-1:e.length-1,o=this._iCurrentTileStartIndex+this._iMaxTiles<e.length?this._iCurrentTileStartIndex+this._iMaxTiles-1:e.length-1,r=o===this._iCurrentFocusIndex?e.length-1:o,n=t.ctrlKey?r:s;e.length>0&&(this._findTile(e[n].$()).trigger("focus"),t.stopPropagation()),this._handleAriaActiveDescendant()}}),this),s=jQuery.proxy((function(t){var e=this._getVisibleTiles();if(e.length>0){var i=this._iCurrentFocusIndex-this._iMaxTiles>=0?this._iCurrentFocusIndex-this._iMaxTiles:0,s=e[i];s&&(this._renderTilesInTheSamePage(i,e),this._findTile(s.$()).trigger("focus"),t.stopPropagation()),this._handleAriaActiveDescendant()}}),this),o=jQuery.proxy((function(t){var e=this._getVisibleTiles(),i=e.length;if(i>0){var s=this._iCurrentFocusIndex+this._iMaxTiles<i?this._iCurrentFocusIndex+this._iMaxTiles:i-1,o=e[s];o&&(this._renderTilesInTheSamePage(s,e),this._findTile(o.$()).trigger("focus"),t.stopPropagation()),this._handleAriaActiveDescendant()}}),this),n=jQuery.proxy((function(t){if(this._iCurrentFocusIndex>=0){var e=this._getVisibleTiles(),i=this._iCurrentFocusIndex+1<e.length?this._iCurrentFocusIndex+1:this._iCurrentFocusIndex;if(t.ctrlKey){if(this.getEditable()){var s=e[this._iCurrentFocusIndex];this.moveTile(s,i),s.$().trigger("focus")}}else{var o=e[i];if(o)if(i<this._iCurrentTileStartIndex+this._iMaxTiles)this._findTile(o.$()).trigger("focus");else{this._renderTilesInTheSamePage(i,e),this.scrollIntoView(o,!0,e);var r=this;setTimeout((function(){r._findTile(o.$()).trigger("focus")}),400)}}this._handleAriaActiveDescendant(),t.stopPropagation()}}),this),a=jQuery.proxy((function(t){if(this._iCurrentFocusIndex>=0){var e=this._getVisibleTiles(),i=this._iCurrentFocusIndex-1>=0?this._iCurrentFocusIndex-1:this._iCurrentFocusIndex;if(t.ctrlKey){if(this.getEditable()){var s=e[this._iCurrentFocusIndex];this.moveTile(s,i),s.$().trigger("focus")}}else{var o=e[i];if(o)if(i>=this._iCurrentTileStartIndex)this._findTile(o.$()).trigger("focus");else{this._renderTilesInTheSamePage(i,e),this.scrollIntoView(o,!0,e);var r=this;setTimeout((function(){r._findTile(o.$()).trigger("focus")}),400)}}this._handleAriaActiveDescendant(),t.stopPropagation()}}),this),h=jQuery.proxy((function(t){var e=this._getVisibleTiles();if(this._iCurrentFocusIndex>=0){var i=this._iCurrentFocusIndex%this._iMaxTiles,s=this._iCurrentFocusIndex+this._iMaxTilesX,o=s%this._iMaxTiles;if(t.ctrlKey){if(this.getEditable()){var r=e[this._iCurrentFocusIndex];this.moveTile(r,s),r.$().trigger("focus")}}else{var n=e[s];o>i&&n&&this._findTile(n.$()).trigger("focus")}this._handleAriaActiveDescendant(),t.stopPropagation()}}),this),l=jQuery.proxy((function(t){var e=this._getVisibleTiles();if(this._iCurrentFocusIndex>=0){var i=this._iCurrentFocusIndex%this._iMaxTiles,s=this._iCurrentFocusIndex-this._iMaxTilesX,o=s%this._iMaxTiles;if(t.ctrlKey){if(this.getEditable()){var r=e[this._iCurrentFocusIndex];this.moveTile(r,s),r.$().trigger("focus")}}else{var n=e[s];o<i&&n&&this._findTile(n.$()).trigger("focus")}this._handleAriaActiveDescendant(),t.stopPropagation()}}),this),f=jQuery.proxy((function(t){var e=this._getVisibleTiles();if(this._iCurrentFocusIndex>=0&&this.getEditable()){var i=e[this._iCurrentFocusIndex];i.getRemovable()&&(this.deleteTile(i),e=this._getVisibleTiles(),this._iCurrentFocusIndex===e.length?0!==e.length?e[this._iCurrentFocusIndex-1].$().trigger("focus"):this._findNextTabbable().trigger("focus"):e[this._iCurrentFocusIndex].$().trigger("focus"),this._handleAriaActiveDescendant()),t.stopPropagation()}}),this);this.onsaphome=t,this.onsaphomemodifiers=t,this.onsapend=e,this.onsapendmodifiers=e,this.onsapright=this._bRtl?a:n,this.onsaprightmodifiers=this._bRtl?a:n,this.onsapleft=this._bRtl?n:a,this.onsapleftmodifiers=this._bRtl?n:a,this.onsapup=l,this.onsapupmodifiers=l,this.onsapdown=h,this.onsapdownmodifiers=h,this.onsappageup=s,this.onsappagedown=o,this.onsapdelete=f,this.data("sap-ui-fastnavgroup","true",!0)}var _,u,d,c,p,T,m;(r.system.tablet||r.system.phone)&&(this._fnOrientationChange=function(t){this.getDomRef()&&this._oTileDimensionCalculator.calc()}.bind(this)),this._oTileDimensionCalculator=new g(this),this._bRtl=i.getConfiguration().getRTL(),this._oPagesInfo=(_=this._bRtl,T=!1,m=_,{setCurrentPage:function(t){c=u,u=t},setCount:function(t){p=d,d=t},setPagerCreated:function(t){T=t},syncOldToCurrentValues:function(){p=d,c=u},reset:function(){p=void 0,c=void 0,d=void 0,u=void 0,T=!1},getCurrentPage:function(){return u},getCount:function(){return d},getOldCurrentPage:function(){return c},getOldCount:function(){return p},isPagerCreated:function(){return T},currentPageIsLast:function(){return m?0===u:u===d-1},currentPageIsFirst:function(){return m?u===d-1:0===u},oldCurrentPageIsLast:function(){return!isNaN(c)&&(m?0===c:c===p-1)},oldCurrentPageIsFirst:function(){return!isNaN(c)&&(m?c===p-1:0===c)},currentPageIsLastChanged:function(){return this.currentPageIsLast()!==this.oldCurrentPageIsLast()},currentPageIsFirstChanged:function(){return this.currentPageIsFirst()!==this.oldCurrentPageIsFirst()},currentPageRelativePositionChanged:function(){return this.currentPageIsFirstChanged()||this.currentPageIsLastChanged()},pageCountChanged:function(){return d!==p},currentPageChanged:function(){return u!==c}}),this._iMaxTiles=1},l.prototype._findNextTabbable=function(){var t=this.$();return jQuery.merge(jQuery.merge(t.nextAll(),t.parents().nextAll()).find(":sapTabbable").addBack(":sapTabbable"),jQuery.merge(t.parents().prevAll(),t.prevAll()).find(":sapTabbable").addBack(":sapTabbable")).first()},l.prototype.onBeforeRendering=function(){var t=this.getTiles(),e=t.length;this._sResizeListenerId&&(n.deregister(this._sResizeListenerId),this._sResizeListenerId=null),this._oPagesInfo.reset();for(var i=0;i<e;i++)t[i]._rendered=!1},l.prototype.onAfterRendering=function(){var t=[];if(this._sResizeListenerId=n.register(this.getDomRef().parentElement,jQuery.proxy(this._resize,this)),this._oDim=this._calculateDimension(),this._applyDimension(),this.$().toggleClass("sapMTCEditable",!0===this.getEditable()),this._bRenderFirstPage?(this._bRenderFirstPage=!1,t=this._getVisibleTiles(),this._updateTileDimensionInfoAndPageSize(t),1===this.getTiles().length?this._update(!1,t):this._iMaxTiles!==1/0&&this._iMaxTiles&&this._renderTiles(t,0,this._iMaxTiles-1)):this._update(!0),r.system.desktop||r.system.combi){var e=t||this._getVisibleTiles();e.length>0&&this._mFocusables&&this._mFocusables[e[0].getId()]&&this._mFocusables[e[0].getId()].eq(0).attr("tabindex","0")}(r.system.tablet||r.system.phone)&&r.orientation.attachHandler(this._fnOrientationChange,this)},l.prototype.setEditable=function(t){var e=this._getVisibleTiles();this.setProperty("editable",t,!0);var i=this.getEditable();this.$().toggleClass("sapMTCEditable",i);for(var s=0;s<e.length;s++){var o=e[s];o.isA("sap.m.Tile")&&o.isEditable(i)}return this},l.prototype.updateTiles=function(){this.destroyTiles(),this.updateAggregation("tiles")},l.prototype._applyDimension=function(){var t,e,i,s=this._getDimension(),o=this.$(),n=10,a=this.$("scrl"),h=this.$("pager").outerHeight();a.css({width:s.outerwidth+"px",height:s.outerheight-h+"px"}),t=o.position(),e=a.position(),i=a.outerHeight(),r.system.phone?n=2:r.system.desktop&&(n=0),this.$("blind").css({top:e.top+n+"px",left:e.left+n+"px",right:"auto",width:a.outerWidth()-n+"px",height:i-n+"px"}),this.$("rightedge").css({top:t.top+n+"px",right:n+"px",left:"auto",height:i-n+"px"}),this.$("leftedge").css({top:t.top+n+"px",left:t.left+n+"px",right:"auto",height:i-n+"px"})},l.prototype._resize=function(){this._oDragSession||setTimeout(jQuery.proxy((function(){var t,e,i=this._getVisibleTiles(),s=i.length,o=this._iCurrentTileStartIndex,r=this._oDim;if(this._oPagesInfo.reset(),this._oDim=this._calculateDimension(),this._updateTileDimensionInfoAndPageSize(i),r.width!==this._oDim.width||r.height!==this._oDim.height){for(var n=0;n<s;n++)i[n]._rendered&&(i[n]._rendered=!1,i[n].$().remove());e=(t=this._getPageNumberForTile(o)*this._iMaxTiles)+this._iMaxTiles-1,this._renderTiles(i,t,e)}}),this),0)},l.prototype.exit=function(){this._sResizeListenerId&&(n.deregister(this._sResizeListenerId),this._sResizeListenerId=null),(r.system.tablet||r.system.phone)&&r.orientation.detachHandler(this._fnOrientationChange,this),delete this._oPagesInfo},l.prototype._update=function(t,e){this.getDomRef()&&this.getVisible()&&(e=e||this._getVisibleTiles(),this._oTileDimensionCalculator.calc(e),this._updateTilePositions(e),this._oDragSession||this.scrollIntoView(this._iCurrentTileStartIndex||0,t,e))},l.prototype.getPageFirstTileIndex=function(){return this._iCurrentTileStartIndex||0},l.prototype.moveTile=function(t,e){return isNaN(t)||(t=this._getVisibleTiles()[t]),t?(this.deleteTile(t),this.insertTile(t,e),this):(h.info("No Tile to move"),this)},l.prototype.addTile=function(t){return this.insertTile(t,this.getTiles().length),this},l.prototype.insertTile=function(t,e){var i,s=this;if(t.isEditable(this.getEditable()),r.system.desktop||r.system.combi){t.addEventDelegate({onAfterRendering:function(){s._mFocusables||(s._mFocusables={}),s._mFocusables[this.getId()]=this.$().find("[tabindex!='-1']").addBack().filter(s._isFocusable),s._mFocusables[this.getId()].attr("tabindex","-1")}},t);t.addEventDelegate({onfocusin:function(t){var e=s._getVisibleTiles().indexOf(this),i=Math.floor(e/s._iMaxTiles)-s._oPagesInfo.getCurrentPage(),o=s._iCurrentFocusIndex>=0?s._iCurrentFocusIndex:0,r=s._getVisibleTiles(),n=r[o];n&&(s._mFocusables[n.getId()].attr("tabindex","-1"),s._mFocusables[this.getId()].attr("tabindex","0")),0!=i&&s.scrollIntoView(e,null,r),s._handleAriaActiveDescendant(),s._iCurrentFocusIndex=e}},t)}return this.getDomRef()?(this.insertAggregation("tiles",t,e,!0),i=this._getVisibleTiles(),this._oDragSession?this._update(!1,i):t.getVisible()&&(1===i.length||this._getPageNumberForTile(e)<=this._oPagesInfo.getCurrentPage())?(this._renderTile(t,e),this._update(!1,i)):(this._oPagesInfo.setCount(Math.ceil(i.length/this._iMaxTiles)),this._updatePager()),(r.system.desktop||r.system.combi)&&this._updateTilesTabIndex(i)):(this.insertAggregation("tiles",t,e),i=this._getVisibleTiles()),t.getVisible()&&(_.call(this,e,i.length,i),f.call(this,i)),this},l.prototype._updateTilesTabIndex=function(t){if((t=t||this._getVisibleTiles()).length&&t.length>0)for(var e=0;e<t.length;e++)if("0"===t[e].$().attr("tabindex"))return;t[0].$().attr("tabindex","0")},l.prototype._isFocusable=function(t,e){var i=!isNaN(jQuery(e).attr("tabindex")),s=e.nodeName.toLowerCase();if("area"===s){var o=e.parentNode,r=o.name;return!(!e.href||!r||"map"!==o.nodeName.toLowerCase())&&!!jQuery("img[usemap='#"+r+"']")[0]}return/input|select|textarea|button|object/.test(s)?!e.disabled:"a"==s&&e.href||i},l.prototype.deleteTile=function(t){if("number"==typeof t){var e=this.getTiles();if(!0!==Array.isArray(e)||0===e.length)return;if(null==(t=e[t]))return}var i=this._getVisibleTiles(),s=this._indexOfVisibleTile(t,i);return this.getDomRef()?(i.splice(s,1),this.removeAggregation("tiles",t,!0),this._oDragSession||(t.getDomRef()&&t.getDomRef().parentNode.removeChild(t.getDomRef()),(r.system.desktop||r.system.combi)&&this._mFocusables&&this._mFocusables[t.getId()]&&delete this._mFocusables[t.getId()]),0===i.length?this._oPagesInfo.reset():t.getVisible()&&s>=0&&this._getPageNumberForTile(s)<=this._oPagesInfo.getCurrentPage()&&this._renderTilesInTheSamePage(this._oPagesInfo.getCurrentPage()*this._iMaxTiles,i),this._update(!1)):(this.removeAggregation("tiles",t,!1),i=this._getVisibleTiles()),_.call(this,s,i.length),f.call(this,i),this},l.prototype.removeTile=l.prototype.deleteTile,l.prototype.removeAllTiles=function(){for(var t=this.getTiles().length-1;t>=0;t--){var e=this.getTiles()[t];this.deleteTile(e)}return this},l.prototype.destroyTiles=function(){if(this.getDomRef()){var t=this.getTiles();this.removeAllAggregation("tiles",!0),this._oPagesInfo.reset(),this._update();for(var e=0;e<t.length;e++){t[e].destroy()}}else this.destroyAggregation("tiles",!1);return this},l.prototype.rerender=function(){this._oDragSession&&!this._oDragSession.bDropped||e.prototype.rerender.apply(this)},l.prototype.scrollLeft=function(){var t=0,e=this._getVisibleTiles();t=this._bRtl?this._iCurrentTileStartIndex+this._iMaxTiles:this._iCurrentTileStartIndex-this._iMaxTiles,this._renderTiles(e,t,t+this._iMaxTiles-1),this.scrollIntoView(t,null,e)},l.prototype.scrollRight=function(){var t=0,e=this._getVisibleTiles();t=this._bRtl?this._iCurrentTileStartIndex-this._iMaxTiles:this._iCurrentTileStartIndex+this._iMaxTiles,this._renderTiles(e,t,t+this._iMaxTiles-1),this.scrollIntoView(t,null,e)},l.prototype._renderTilesInTheSamePage=function(t,e){var i=this._getPageNumberForTile(t)*this._iMaxTiles,s=i+this._iMaxTiles-1;this._renderTiles(e,i,s)},l.prototype._renderTiles=function(t,e,i){var s,o=!1;for(s=e;s<=i;s++)t[s]&&!t[s]._rendered&&(this._renderTile(t[s],s),o=!0);o&&(this._update(!1,t),(r.system.desktop||r.system.combi)&&this._updateTilesTabIndex())},l.prototype.scrollIntoView=function(t,e,i){var s=this._getContentDimension().outerwidth,o=t,r=this.getTiles();isNaN(t)&&(o=this.indexOfAggregation("tiles",t)),r[o]&&r[o].getVisible()&&(i=i||this._getVisibleTiles(),(o=this._indexOfVisibleTile(r[o]))>-1&&this._renderTilesInTheSamePage(o,i),this._applyPageStartIndex(o,i),this._oPagesInfo.setCurrentPage(Math.floor(this._iCurrentTileStartIndex/this._iMaxTiles)),this._bRtl?this._scrollTo((this._oPagesInfo.getCount()-this._oPagesInfo.getCurrentPage())*s,e):this._scrollTo(this._oPagesInfo.getCurrentPage()*s,e),this._updatePager())},l.prototype._updateTilePositions=function(t){if(0!==this._getDimension().height){if(0===(t=t||this._getVisibleTiles()).length)return this._oPagesInfo.setCount(0),void this._updatePager();this._applyPageStartIndex(this._iCurrentTileStartIndex,t),this._applyDimension();var e=this._getContentDimension();this._oPagesInfo.setCount(Math.ceil(t.length/this._iMaxTiles));for(var i=this._oTileDimensionCalculator.getLastCalculatedDimension(),s=0;s<t.length;s++)if(t[s]._rendered&&!t[s].isDragged()){var o=Math.floor(s/this._iMaxTiles),r=t[s],n=o*e.outerwidth+this._iOffsetX+s%this._iMaxTilesX*i.width,a=this._iOffsetY+Math.floor(s/this._iMaxTilesX)*i.height-o*this._iMaxTilesY*i.height;this._bRtl&&(n=(this._oPagesInfo.getCount()-o)*e.outerwidth-this._iOffsetX-(s%this._iMaxTilesX+1)*i.width),r.setPos(n,a),r.setSize(i.width,i.height)}}},l.prototype._findTile=function(t){return t.hasClass("sapMTile")||t.hasClass("sapMCustomTile")?t:t.find(".sapMTile")||t.find(".sapMCustomTile")},l.prototype._updatePager=function(){var t,e,i,s,o=!1;if(this._oPagesInfo.pageCountChanged()||this._oPagesInfo.currentPageChanged()){if(t=this.$("pager")[0],e=this.$("leftscroller")[0],i=this.$("rightscroller")[0],null==this._oPagesInfo.getCount()||this._oPagesInfo.getCount()<=1)return t.innerHTML="",i.style.right="-100px",e.style.left="-100px",e.style.display="none",i.style.display="none",void this._oPagesInfo.setPagerCreated(!1);if(this._oPagesInfo.isPagerCreated())this._oPagesInfo.pageCountChanged()&&(this._oPagesInfo.getCount()-this._oPagesInfo.getOldCount()<0?t.removeChild(t.lastChild):t.appendChild(document.createElement("span")));else{s=[""];for(var n=0;n<this._oPagesInfo.getCount();n++)s.push("");t.innerHTML=s.join("<span></span>"),t.style.display="block",t.childNodes[0].className="sapMTCActive",this._oPagesInfo.setPagerCreated(!0),o=!0}this._oPagesInfo.currentPageChanged()&&(t.childNodes[this._oPagesInfo.getCurrentPage()].className="sapMTCActive",t.childNodes[this._oPagesInfo.getOldCurrentPage()]&&(t.childNodes[this._oPagesInfo.getOldCurrentPage()].className=""),this._oPagesInfo.getCurrentPage()>=1&&(t.childNodes[0].className="")),r.system.desktop&&(o||this._oPagesInfo.currentPageRelativePositionChanged())&&(this._bRtl&&(i.style.left="auto",e.style.right="auto"),i.style.right=this._oPagesInfo.currentPageIsLast()?"-100px":"1rem",e.style.left=this._oPagesInfo.currentPageIsFirst()?"-100px":"1rem",i.style.display=this._oPagesInfo.currentPageIsLast()?"none":"block",e.style.display=this._oPagesInfo.currentPageIsFirst()?"none":"block"),this._oPagesInfo.syncOldToCurrentValues()}},l.prototype._getContentDimension=function(){if(this.getDomRef()){var t=this.$("scrl");return{width:t.width(),height:t.height()-20,outerheight:t.outerHeight()-20,outerwidth:t.outerWidth()}}},l.prototype._getDimension=function(){return this._oDim||(this._oDim=this._calculateDimension()),this._oDim},l.prototype._calculatePageSize=function(t){var e,i;if(0!==(i=(t=t||this._getVisibleTiles()).length)&&0!==(e=jQuery.extend({},this._getDimension())).height){r.system.desktop&&(e.width-=90);var s=this._oTileDimensionCalculator.getLastCalculatedDimension(),o=this.$("pager")[0].offsetHeight,n=Math.max(Math.floor(e.width/s.width),1),a=Math.max(Math.floor((e.height-o)/s.height),1),h=i<n?i:n,l=i/h<a?Math.ceil(i/h):a;this._iMaxTiles=n*a,this._iMaxTilesX=n,this._iMaxTilesY=a,this._iOffsetX=Math.floor((e.width-s.width*h)/2),r.system.desktop&&(this._iOffsetX+=45),this._iOffsetY=Math.floor((e.height-o-s.height*l)/2)}},l.prototype._getTilesFromPosition=function(t,e){if(!this._getVisibleTiles().length)return[];t+=this._iScrollLeft;for(var i=this._getVisibleTiles(),s=[],o=0;o<i.length;o++){var r=i[o],n={top:r._posY,left:r._posX,width:r._width,height:r._height};!i[o].isDragged()&&e>n.top&&e<n.top+n.height&&t>n.left&&t<n.left+n.width&&s.push(i[o])}return s},l.prototype._applyPageStartIndex=function(t,e){if(0!==this._getDimension().height){e=e||this._getVisibleTiles(),this._calculatePageSize(e);var i=e.length;t<0?t=0:t>i-1&&(t=i-1);var s=Math.floor(t/this._iMaxTiles||0);this._iCurrentTileStartIndex=s*(this._iMaxTiles||0),h.info("current index "+this._iCurrentTileStartIndex)}},l.prototype._scrollTo=function(t,e){!1!==e&&(e=!0),this._applyTranslate(this.$("cnt"),-t,0,e),this._bRtl?this._iScrollLeft=t-this._getContentDimension().outerwidth:this._iScrollLeft=t},l.prototype._applyTranslate=function(t,e,i,s){var o=t[0];this.$("cnt").toggleClass("sapMTCAnim",s),"webkitTransform"in o.style?t.css("-webkit-transform","translate3d("+e+"px,"+i+"px,0)"):"MozTransform"in o.style?t.css("-moz-transform","translate("+e+"px,"+i+"px)"):"transform"in o.style?t.css("transform","translate3d("+e+"px,"+i+"px,0)"):"msTransform"in o.style&&t.css("-ms-transform","translate("+e+"px,"+i+"px)")},l.prototype._initTouchSession=function(t){if("touchstart"==t.type){var e=t.targetTouches[0];this._oTouchSession={dStartTime:new Date,fStartX:e.pageX,fStartY:e.pageY,fDiffX:0,fDiffY:0,oControl:t.srcControl,iOffsetX:e.pageX-t.target.offsetLeft}}else this._oTouchSession={dStartTime:new Date,fStartX:t.pageX,fStartY:t.pageY,fDiffX:0,fDiffY:0,oControl:t.srcControl,iOffsetX:t.pageX-t.target.offsetLeft}},l.prototype._initDragSession=function(t){for(;t.srcControl&&t.srcControl.getParent()!=this;)t.srcControl=t.srcControl.getParent();var e=this.indexOfAggregation("tiles",t.srcControl);"touchstart"==t.type?this._oDragSession={oTile:t.srcControl,oTileElement:t.srcControl.$()[0],iOffsetLeft:t.targetTouches[0].pageX-t.srcControl._posX+this._iScrollLeft,iOffsetTop:t.targetTouches[0].pageY-t.srcControl._posY,iIndex:e,iOldIndex:e,iDiffX:t.targetTouches[0].pageX,iDiffY:t.targetTouches[0].pageY}:this._oDragSession={oTile:t.srcControl,oTileElement:t.srcControl.$()[0],iOffsetLeft:t.pageX-t.srcControl._posX+this._iScrollLeft,iOffsetTop:t.pageY-t.srcControl._posY,iIndex:e,iOldIndex:e,iDiffX:t.pageX,iDiffY:t.pageY}},l.prototype.onclick=function(t){var e=this.$("pager")[0];t.target.id==this.getId()+"-leftscroller"||t.target.parentNode.id==this.getId()+"-leftscroller"?this.scrollLeft():t.target.id==this.getId()+"-rightscroller"||t.target.parentNode.id==this.getId()+"-rightscroller"?this.scrollRight():t.target==e&&r.system.desktop&&(t.offsetX<e.offsetWidth/2?this.scrollLeft():this.scrollRight())},l.prototype.ontouchstart=function(t){if(t.setMarked(),!(t.targetTouches.length>1||this._oTouchSession)){for(;t.srcControl&&t.srcControl.getParent()!=this;)t.srcControl=t.srcControl.getParent();t.srcControl&&t.srcControl.isA("sap.m.Tile")&&this.getEditable()?("sapMTCRemove"!=t.target.className?(this._initDragSession(t),this._initTouchSession(t),this._oDragSession.oTile.isDragged(!0)):this._initTouchSession(t),this._bAvoidChildTapEvent=!0):this._initTouchSession(t),jQuery(document).on("touchmove mousemove",jQuery.proxy(this._onmove,this)),jQuery(document).on("touchend touchcancel mouseup",jQuery.proxy(this._onend,this))}},l.prototype._onmove=function(t){if(document.selection&&document.selection.clear&&document.selection.clear(),!(t.isMarked("delayedMouseEvent")||t.targetTouches&&t.targetTouches.length>1)){t.targetTouches||(t.targetTouches=[{pageX:t.pageX,pageY:t.pageY}]);var e=this._oTouchSession;if(e.fDiffX=e.fStartX-t.targetTouches[0].pageX,e.fDiffY=e.fStartY-t.targetTouches[0].pageY,this._oDragSession)Math.abs(e.fDiffX)>5&&(this._oDragSession.bStarted?this._onDrag(t):(this._oDragSession.bStarted=!0,this._onDragStart(t)),this._bAvoidChildTapEvent=!0);else if(e){var i=this._getContentDimension().outerwidth,s=-this._iScrollLeft-e.fDiffX;if(s>this._iScrollGap)return;if(s<-((this._oPagesInfo.getCount()-1)*i+this._iScrollGap))return;this._bRtl&&(s-=i);var o=this._getVisibleTiles(),r=e.fDiffX>0?1:-1,n=this._iCurrentTileStartIndex+r*this._iMaxTiles,a=n+this._iMaxTiles-1;this._renderTiles(o,n,a),this._applyTranslate(this.$("cnt"),s,0,!1)}}},l.prototype._onend=function(t){if(!t.isMarked("delayedMouseEvent")){if(jQuery(document).off("touchend touchcancel mouseup",this._onend),jQuery(document).off("touchmove mousemove",this._onmove),this._oDragSession)return this._onDrop(t),void delete this._oTouchSession;if(this._oTouchSession){var e=this._oTouchSession,i=new Date-e.dStartTime<600,s=this._bRtl?-1:1;if(i){var o=this.$("pager")[0];Math.abs(e.fDiffX)>30?(this._applyPageStartIndex(this._iCurrentTileStartIndex+(e.fDiffX*s>0?1:-1)*this._iMaxTiles),this._bAvoidChildTapEvent=!0):t.target!=o||r.system.desktop?"sapMTCRemove"==t.target.className&&("touchend"===t.type||"mouseup"===t.type&&0===t.button)&&this.fireTileDelete({tile:e.oControl}):((e.iOffsetX-o.offsetWidth/2)*s<0?this.scrollLeft():this.scrollRight(),this._bAvoidChildTapEvent=!0)}else{var n=this._getContentDimension();Math.abs(e.fDiffX)>n.outerwidth/2&&(this._applyPageStartIndex(this._iCurrentTileStartIndex+(e.fDiffX*s>0?1:-1)*this._iMaxTiles),this._bAvoidChildTapEvent=!0)}this._update(),delete this._oDragSession,delete this._oTouchSession;var a=this;setTimeout((function(){a._bAvoidChildTapEvent=!1}),100)}}},l.prototype._onDragStart=function(t){this.$().append(this._oDragSession.oTileElement),this._oDragSession.iDiffX=this._oTouchSession.fStartX-this._oTouchSession.fDiffX,this._oDragSession.iDiffY=this._oTouchSession.fStartY-this._oTouchSession.fDiffY,this._oDragSession.oTile.setPos(this._oDragSession.iDiffX-this._oDragSession.iOffsetLeft,this._oDragSession.iDiffY-this._oDragSession.iOffsetTop),this.$("blind").css("display","block")},l.prototype._onDrag=function(t){if(!this._oTouchSession)return clearTimeout(this.iScrollTimer),this._oDragSession=null,this.iScrollTimer=null,void(this._bTriggerScroll=!1);this._oDragSession.iDiffX=this._oTouchSession.fStartX-this._oTouchSession.fDiffX,this._oDragSession.iDiffY=this._oTouchSession.fStartY-this._oTouchSession.fDiffY;var e=this._getContentDimension(),i=this._oDragSession.iDiffY-this._oDragSession.iOffsetTop,s=this._oDragSession.iDiffX-this._oDragSession.iOffsetLeft,o=i+this._oDragSession.oTileElement.offsetHeight/2,r=s+this._oDragSession.oTileElement.offsetWidth/2,n=s+this._oDragSession.oTileElement.offsetWidth-this._iTriggerScrollOffset>e.width,a=s<-this._iTriggerScrollOffset,h=e.width-(s+this._oDragSession.oTileElement.offsetWidth),l=s;this._oDragSession.oTile.setPos(s,i),this._oDragSession.oTile.$().css("clip","auto");var g=this.$("rightedge")[0];if(s+this._oDragSession.oTile._width>g.offsetLeft+g.offsetWidth&&this._oPagesInfo.getCurrentPage()<this._oPagesInfo.getCount()-1){var f=g.offsetLeft+g.offsetWidth-s-(this._oDragSession.oTile._width-this._oDragSession.oTile.$().outerWidth(!1))/2-2;this._oDragSession.oTile.$().css("clip","rect(-25px,"+f+"px,"+(this._oDragSession.oTile._height+20)+"px,-25px)")}var _=this.$("leftedge")[0];if(s<_.offsetLeft+2+(this._oDragSession.oTile._width-this._oDragSession.oTile.$().outerWidth(!1))/2&&this._oPagesInfo.getCurrentPage()>0){var u=_.offsetLeft+4-s-(this._oDragSession.oTile._width-this._oDragSession.oTile.$().outerWidth(!1))/2;this._oDragSession.oTile.$().css("clip","rect(-25px,"+this._oDragSession.oTile._width+"px,"+(this._oDragSession.oTile._height+20)+"px,"+u+"px)")}if(h<this._iEdgeShowStart&&this._oPagesInfo.getCurrentPage()<this._oPagesInfo.getCount()-1){var d=(this._iEdgeShowStart-h)/(this._iEdgeShowStart+this._iTriggerScrollOffset);this.$("rightedge").css("opacity",""+d)}else this.$("rightedge").css("opacity","0.01");if(l<this._iEdgeShowStart&&this._oPagesInfo.getCurrentPage()>0){d=(this._iEdgeShowStart-l)/(this._iEdgeShowStart+this._iTriggerScrollOffset);this.$("leftedge").css("opacity",""+d)}else this.$("leftedge").css("opacity","0.01");if(this._bRtl?n&&this._oPagesInfo.getCurrentPage()>0||a&&this._oPagesInfo.getCurrentPage()<this._oPagesInfo.getCount()-1:a&&this._oPagesInfo.getCurrentPage()>0||n&&this._oPagesInfo.getCurrentPage()<this._oPagesInfo.getCount()-1)if(this._bTriggerScroll)a?this.scrollLeft():this.scrollRight();else{var c=this;this.iScrollTimer||(this.iScrollTimer=setInterval((function(){c._bTriggerScroll=!0,c._onDrag(t),c._bTriggerScroll=!1}),1e3))}else{this.iScrollTimer&&(clearTimeout(this.iScrollTimer),this._bTriggerScroll=!1,this.iScrollTimer=null);var p=this._getTilesFromPosition(r,o);if(p&&p.length>0){var T=p[0],m={top:T._posY,left:T._posX,width:T._width,height:T._height},C=this.indexOfAggregation("tiles",T);r+this._iScrollLeft<(m.left+m.width)/2&&C%this._iMaxTilesX!=0&&C--,this._oDragSession.iIndex=C,this.moveTile(this._oDragSession.oTile,this._oDragSession.iIndex)}else if(this._oPagesInfo.getCurrentPage()==this._oPagesInfo.getCount()-1){var x=this._getVisibleTiles(),S=x[x.length-1];S&&r>S._posX-this._iScrollLeft&&o>S._posY&&(this._oDragSession.iIndex=x.length-1,this.moveTile(this._oDragSession.oTile,this._oDragSession.iIndex))}}},l.prototype._onDrop=function(t){if(this._oDragSession){var e=this._oDragSession.oTile,i=this._oDragSession.iIndex;this._oDragSession.oTile.isDragged(!1),this._oDragSession.iOldIndex!=this._oDragSession.iIndex&&this.fireTileMove({tile:e,newIndex:i}),this.$("blind").css("display","block"),this._oDragSession.bStarted&&this._oDragSession.oTile.setPos(this._oDragSession.oTile._posX+this._iScrollLeft,this._oDragSession.oTile._posY),this._oDragSession.oTile.$().css("clip","auto"),this.$("rightedge").css("opacity","0.01"),this.$("leftedge").css("opacity","0.01"),this.$("cnt").append(this._oDragSession.oTileElement),delete this._oDragSession,this.moveTile(e,i),this.scrollIntoView(e,!1),(r.system.desktop||r.system.combi)&&this._findTile(e.$()).trigger("focus"),this._handleAriaActiveDescendant(),this.$("blind").css("display","none")}},l.prototype._handleAriaActiveDescendant=function(){var t=s.closestTo(document.activeElement);t&&t.isA("sap.m.Tile")&&t.getParent()===this&&this.getDomRef().setAttribute("aria-activedescendant",t.getId())},l.prototype._renderTile=function(t,e){var s=i.createRenderManager(),o=this.$("cnt")[0];s.renderControl(t),s.flush(o,!1,e),s.destroy()},l.prototype.onThemeChanged=function(){this.getDomRef()&&this.invalidate()},l.prototype._calculateDimension=function(){var t=this.$();if(t)return{width:t.width(),height:t.height(),outerheight:t.outerHeight(),outerwidth:t.outerWidth()}},l.prototype._getVisibleTiles=function(){for(var t=[],e=this.getTiles(),i=0,s=e.length;i<s;i++)e[i].mProperties.visible&&t.push(e[i]);return t},l.prototype._indexOfVisibleTile=function(t,e){var i,s;for(s=(e=e||this._getVisibleTiles()).length,i=0;i<s;i++)if(e[i]===t)return i;return-1},l.prototype._updateTileDimensionInfoAndPageSize=function(t){t=t||this._getVisibleTiles(),this._oTileDimensionCalculator.calc(t),this._calculatePageSize(t)},l.prototype._getPageNumberForTile=function(t){return Math.floor(t/this._iMaxTiles||0)};var g=function(t){this._oDim=null,this._oTileContainer=t};function f(t){var e,i,s;for(e=(t=t||this._getVisibleTiles()).length,i=0;i<e;i++)(s=t[i])._rendered&&s.getDomRef()&&s.getDomRef().setAttribute("aria-setsize",e)}function _(t,e,i){var s,o=null;for(i=i||this._getVisibleTiles(),s=t;s<e;s++)(o=i[s])&&o.$().attr("aria-posinset",this._indexOfVisibleTile(o,i)+1)}return g.prototype.calc=function(t){var e,i;if(this._oTileContainer.getDomRef()){if((e=t||this._oTileContainer._getVisibleTiles()).length){i=e[0];for(var s=0,o=e.length;s<o;s++)if(e[s]._rendered){i=e[s];break}this._oDim={width:Math.round(i.$().outerWidth(!0)),height:Math.round(i.$().outerHeight(!0))}}return this._oDim}},g.prototype.getLastCalculatedDimension=function(){return this._oDim},l}));