/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["../utils/SelectionVariantHelper","sap/fe/navigation/SelectionVariant","sap/m/DynamicDateUtil","sap/ui/comp/util/DateTimeUtil","sap/ui/core/format/DateFormat","../utils/AppConstants","sap/ui/model/odata/v2/ODataModel","sap/ui/core/date/UI5Date","sap/ui/comp/odata/type/StringDate"],function(e,a,t,r,i,n,o,s,u){function l(t,r,i){var n=t.descriptorContent["sap.card"].configuration.parameters;var u=t.descriptorContent["sap.card"]["data"]["request"];var l=false,v={},d={};if(u&&u.batch){l=true;v=u.batch.header||{};d=u.batch.content||{}}var T=t&&n._headerDataUrl,D=t&&n._contentDataUrl;var g=new a;var h=n._relevantODataFilters.value;var E=n._relevantODataParameters.value;var y=n._semanticDateRangeSetting,S=[];if(y){y=JSON.parse(y.value);S=Object.keys(y)||[]}h.forEach(function(e){var t=new a(n[e].value);var r=t.getSelectOption(e);var i=[];if(r&&r.length){if(S.includes(e)){i=m(r[0],"Filter",n[e].type);if(i.length){r[0].Low=i[0];r[0].High=i[1]?i[1]:null;if(r[0].Low&&r[0].High&&r[0].Option!=="BT"){r[0].Option="BT"}g.massAddSelectOption(e,r)}else if(o&&o.prototype.formatValue&&r[0]){r[0].Low=o.prototype.formatValue(r[0].Low,"Edm.DateTime");if(r[0].High){r[0].High=o.prototype.formatValue(r[0].High,"Edm.DateTime")}g.massAddSelectOption(e,r)}}else{if(o&&o.prototype.formatValue&&r[0]&&n[e].type==="datetime"){r[0].Low=o.prototype.formatValue(r[0].Low,"Edm.DateTime");if(r[0].High){r[0].High=o.prototype.formatValue(r[0].High,"Edm.DateTime")}g.massAddSelectOption(e,r)}g.massAddSelectOption(e,r)}}});E.forEach(function(e){var a="";if(n[e].value){if(n[e].value.value||typeof n[e].value.value=="string"){a=n[e].value.value.toString()}else if(n[e].value instanceof Date){a=n[e].value}else{a=n[e].value.toString()}}if(n[e].type==="datetime"&&!S.includes(e)&&!a.includes("datetime")){if(o&&o.prototype.formatValue){a=o.prototype.formatValue(a,"Edm.DateTime");g.addParameter(e,a)}}else if(n[e].type==="datetime"&&S.includes(e)){a=typeof n[e].value==="string"&&Date.parse(n[e].value)?m(s.getInstance(a),"Parameter",n[e].type):m(a,"Parameter",n[e].type);if(a[0]){g.addParameter(e,a[0])}else{g.addParameter(e,"")}}else{g.addParameter(e,a)}});var A=n._entitySet.value;var O=A;if(E.length){var I={};E.forEach(function(e){I[e]=n[e].type});O+=e.getParameterQueryFromSV(g,I);var L=O;if(L&&Array.isArray(L.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm))&&L.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length){O=p(L)}}if(n._urlSuffix.value){O+=n._urlSuffix.value}var M={};h.forEach(function(e){M[e]=n[e].type});var H=e.getFilterQueryFromSV(g,M);var w=H;if(w&&Array.isArray(w.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm))&&w.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length){H=p(w)}var R="",V="",N="",_="",Q={header:"",content:""};if(l){R=c(n,"_header",H,t.descriptorContent["sap.card"].type);V=R?O+"?"+R:O;if(T&&T.value){var F=f(S,V);if(F){v.url="{= extension.formatters.formatHeaderDataUrlForSemanticDate() }";T.value=""}else{T.value=V;if(r){r._headerDataUrl=T.value}}}else if(T){if(r&&!i){T.value=V;r._headerDataUrl=T.value}Q.header=V}}if(n._contentDataUrl){N=c(n,"_content",H,t.descriptorContent["sap.card"].type);_=N?O+"?"+N:O;if(n._contentDataUrl.value){var U=f(S,_);if(U){if(l){d.url="{= extension.formatters.formatContentDataUrlForSemanticDate() }"}else{u.url="{= extension.formatters.formatContentDataUrlForSemanticDate() }"}D.value=""}else{D.value=_;if(r){r._contentDataUrl=D.value}}}else{if(r&&!i){D.value=_;r._contentDataUrl=D.value}Q.content=_;return Q}if(i){Q.header=V;Q.content=_;return Q}}}function f(e,a){var t=e.length?e:[];if(t.length&&a){return t.some(function(e){return a&&a.indexOf(e)>-1})}}function c(e,a,t,r){var i=[];if(t){i.push(t)}if(e[a+"SelectQuery"]&&e[a+"SelectQuery"].value){i.push(e[a+"SelectQuery"].value)}if(e[a+"ExpandQuery"]&&e[a+"ExpandQuery"].value){i.push(e[a+"ExpandQuery"].value)}if(e[a+"SortQuery"]&&e[a+"SortQuery"].value){var n=e[a+"SortQuery"].value;i.push(decodeURI(n)===n?encodeURI(n):n)}if(r==="Table"||r==="List"){i.push("$inlinecount=allpages");i.push("$skip=0&$top=13")}else{if(e[a+"TopQuery"]&&e[a+"TopQuery"].value){i.push(e[a+"TopQuery"].value)}if(e[a+"SkipQuery"]&&e[a+"SkipQuery"].value){i.push(e[a+"SkipQuery"].value)}}return i.length?i.join("&"):null}function p(e){var a=e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length;var t=function(){var a=e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm)[0];var t=a;t=t.replace("%27","");var r=t.lastIndexOf("%27");var i=t.substr(0,r)+t.substr(r+3,t.length-1);return i};for(var r=0;r<a;r++){e=e.replace(e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm)[0],t)}return e}function m(e,a,r){var i,o=[],s=[],l=false;if(a==="Parameter"){i=e}else if(a==="Filter"){e=typeof e==="string"?JSON.parse(e):e;i=e.Low;if(n.DATE_OPTIONS.SPECIAL_RANGE.includes(i)){o=e.High.split(",")}}var f,c=new u;if(n.DATE_OPTIONS.RANGE_OPTIONS.includes(i)||n.DATE_OPTIONS.SINGLE_OPTIONS.includes(i)){if(a==="Filter"){f=t.toDates({values:o,operator:i});if(r.toLowerCase()==="string"||r.toLowerCase()==="edm.string"){s.push(c.parseValue(f[0].oDate));s.push(c.parseValue(f[1].oDate));return s}else{s.push(f[0].oDate);s.push(f[1].oDate)}}else{f=t.toDates({values:o,operator:i});if(r.toLowerCase()==="string"||r.toLowerCase()==="edm.string"){s.push(c.parseValue(f[0].oDate));return s}s.push(f[0].oDate)}}if(["DATETIMERANGE","FROMDATETIME","TODATETIME","DATETIME"].includes(i)){l=true}if(s.length){s=v(s,true,l);return s}else if(Date(e)instanceof Date||e instanceof Date||Date.parse(e)){return v([e],true,l)}else if(r.toLowerCase()==="string"&&c.formatValue(e.Low)){var p=c.formatValue(e.Low);if(p.oDate&&p.oDate instanceof Date){s.push(c.parseValue(p.oDate));if(e.High&&c.formatValue(e.High)&&c.formatValue(e.High).oDate instanceof Date){s.push(c.parseValue(c.formatValue(e.High).oDate))}return s}}return[]}function v(e,a,t){var n;e.forEach(function(o,u){if(o.match){if(o.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z?$/gm)&&o.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z?$/gm).length){o=s.getInstance(o)}}o=r.localToUtc(o);if(!t){o=r.normalizeDate(o,true)}if(a){n=i.getDateInstance({pattern:"'datetime'''yyyy-MM-dd'T'HH:mm:ss''",calendarType:"Gregorian"});e[u]=n.format(o,true)}else{var l=i.getDateInstance({pattern:"''yyyy-MM-dd'T'HH:mm:ss.SSS''",calendarType:"Gregorian"});var f=o instanceof Date?o:s.getInstance(o);var c=l.format(f);e[u]=String(c).replace(/'/g,"")}});return e}function d(e,a,r){var i=r;if(e&&a){var n=e.operator;if(n!=="DATE"){return n}else{return e.values[0]}}if(!a){var o=e.operator;var s=e.values;var u="";if(o){switch(o){case"DATE":case"DATERANGE":case"SPECIFICMONTH":case"DATETIMERANGE":case"DATETIME":u="";if(typeof i==="string"){u=i}var l=t.toDates(e);s=l;var f=v(s,false,o==="DATETIMERANGE"||o==="DATETIME");if(!f[1]){f[1]=""}var c={Low:f[0],High:f[1],Option:"BT",Text:u};if(c){c.Text=u;return c}break;case"FROM":case"TO":case"FROMDATETIME":case"TODATETIME":u="";if(typeof i==="string"){u=i}var p=v(s,false,o==="FROMDATETIME"||o==="TODATETIME"),m;m=o==="FROM"||o==="FROMDATETIME"?"GE":"LE";var d={Low:p[0],High:"",Option:m,Text:u};if(d){d.Text=u;return d}break;case"LASTDAYS":case"LASTWEEKS":case"LASTMONTHS":case"LASTQUARTERS":case"LASTYEARS":case"NEXTDAYS":case"NEXTWEEKS":case"NEXTMONTHS":case"NEXTQUARTERS":case"NEXTYEARS":u="";if(typeof i==="string"){u=i}return{Low:o,High:s[0].toString(),Option:"BT",Text:u};case"TODAYFROMTO":u="";if(typeof i==="string"){u=i}var T=s&&s[0];var D=s&&s[1];return{Low:o,High:T.toString()+","+D.toString(),Option:"BT",Text:u};default:u="";if(typeof i==="string"){u=i.substring(0,i.indexOf("(")-1)}return{Low:o,High:null,Option:"EQ",Text:u}}}}}return{processPrivateParams:l,formatSemanticDateTime:m,getDateRangeValue:d}});
//# sourceMappingURL=UrlGenerateHelper.js.map