//@ui5-bundle sap/insights/library-preload.js
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 * This extension is for OVP Analytical cards delivered in 2208.
 */
sap.ui.predefine("sap/insights/CardExtension", ["sap/ui/integration/Extension","sap/ui/core/format/NumberFormat","sap/fe/navigation/SelectionVariant","sap/base/Log","sap/ui/core/format/DateFormat","sap/ui/core/library","sap/m/library","sap/ui/integration/util/Utils","sap/m/DynamicDateUtil","sap/fe/navigation/NavError","sap/insights/utils/UrlGenerateHelper","sap/insights/utils/AppConstants","sap/ui/core/date/UI5Date","sap/ui/core/Lib"],function(e,t,r,a,i,n,s,o,l,f,u,c,m,g){"use strict";var p=n.ValueState;var v=s.ValueColor;var d={StateValues:{None:"None",Negative:"Error",Critical:"Warning",Positive:"Success"},ColorValues:{None:"Neutral",Negative:"Error",Critical:"Critical",Positive:"Good"}};var h=a.getLogger("sap.insights.CardExtension");var b=function(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1};var S=function(e,t){var r;if(t){r=t.None;if(e&&e.EnumMember){var a=e.EnumMember;if(b(a,"Negative")){r=t.Negative}else if(b(a,"Critical")){r=t.Critical}else if(b(a,"Positive")){r=t.Positive}}}return r};var N=function(e,t,r,a,i,n,s){var o={};o.EnumMember="None";var l=Number.NEGATIVE_INFINITY;var f=Number.POSITIVE_INFINITY;if(!i&&i!==0&&(r||r===0)){i=r}if(!n&&n!==0&&(a||a===0)){n=a}if(!r&&r!==0){r=l}if(!a&&a!==0){a=f}if(e!==undefined){e=Number(e);if(b(t,"Minimize")||b(t,"Minimizing")){if((n||n===0)&&(a||a===0)){if(e<=parseFloat(n)){o.EnumMember="Positive"}else if(e>parseFloat(a)){o.EnumMember="Negative"}else{o.EnumMember="Critical"}}}else if(b(t,"Maximize")||b(t,"Maximizing")){if((i||i===0)&&(r||r===0)){if(e>=parseFloat(i)){o.EnumMember="Positive"}else if(e<parseFloat(r)){o.EnumMember="Negative"}else{o.EnumMember="Critical"}}}else if(b(t,"Target")){if((n||n===0)&&(a||a===0)&&(i||i===0)&&(r||r===0)){if(e>=parseFloat(i)&&e<=parseFloat(n)){o.EnumMember="Positive"}else if(e<parseFloat(r)||e>parseFloat(a)){o.EnumMember="Negative"}else{o.EnumMember="Critical"}}}}return S(o,s)};var O=function(e,t,r,a){if(!e||!t){return}e=Number(e);if(!a&&e-t>=0){return"Up"}if(!r&&e-t<=0){return"Down"}if(t&&a&&e-t>=a){return"Up"}if(t&&r&&e-t<=r){return"Down"}};var P=function(e,r,a){var i=r||{},n=e;var s=t.getFloatInstance({minFractionDigits:i.NumberOfFractionalDigits,maxFractionDigits:i.NumberOfFractionalDigits,style:"short",showScale:true,shortRefNumber:n});var o=s.format(Number(n)),l=s.getScale()||"";if(!a&&o){var f=o[o.length-1];return f===l?o.slice(0,o.length-1):o}if(a&&i.percentageAvailable){return l+"%"}if(a&&!i.percentageAvailable){return l}return""};var y=function(){var e=this.getCard().getCombinedParameters();return e._headerDataUrl};var D=function(){var e=this.getCard().getCombinedParameters();return e._contentDataUrl};var I=function(e,r,a){var i,n,s;if(isNaN(+e)){return""}if(e==0){s=r}else{s=e}if(a.NumberOfFractionalDigits){n=+a.NumberOfFractionalDigits}if(r){i=r}else if(a.manifestTarget){i=a.manifestTarget}if(!n||n<0){n=0}else if(n>2){n=2}if(i){var o=t.getFloatInstance({minFractionDigits:n,maxFractionDigits:n,style:"short",showScale:true,shortRefNumber:s});return o.format(+i)}};var C=function(e,r,a){var i,n;if(isNaN(+e)){return""}e=+e;if(a.NumberOfFractionalDigits){i=+a.NumberOfFractionalDigits}if(r){n=+r}else if(a.manifestTarget){n=+a.manifestTarget}if(!i||i<0){i=0}else if(i>2){i=2}if(n){var s=(e-n)/n;var o=t.getPercentInstance({style:"short",minFractionDigits:i,maxFractionDigits:i,showScale:true});return o.format(s)}};var F=function(e){var t={};t.EnumMember="None";if(Number(e)===1){t.EnumMember="Negative"}else if(Number(e)===2){t.EnumMember="Critical"}else if(Number(e)===3){t.EnumMember="Positive"}return S(t,d.ColorValues)};var w=function(){var e=arguments[arguments.length-1];var t=1;return N(arguments[0],e.sImprovementDirection,e.bIsDeviationLowBinding?arguments[t++]:e.deviationLow,e.bIsDeviationHighBinding?arguments[t++]:e.deviationHigh,e.bIsToleranceLowBinding?arguments[t++]:e.toleranceLow,e.bIsToleranceHighBinding?arguments[t++]:e.toleranceHigh,e.oCriticalityConfigValues)};var E=function(){var e=arguments[arguments.length-1];var t=1;return O(arguments[0],e.bIsRefValBinding?arguments[t++]:e.referenceValue,e.bIsDownDiffBinding?arguments[t++]:e.downDifference,e.bIsUpDiffBinding?arguments[t++]:e.upDifference)};var V=function(e){var t;var r=arguments[arguments.length-1],a=r&&r.propertyType;switch(a){case"yearmonth":var i=parseInt(e.substr(0,4),10),n=e.substr(4),s=parseInt(n,10)-1;t=m.getInstance(Date.UTC(i,s));break;case"yearquarter":var i=parseInt(e.substr(0,4),10),o=e.substr(4),l=parseInt(o,10)*3-2,s=l-1;t=m.getInstance(Date.UTC(i,s));break;case"yearweek":var i=parseInt(e.substr(0,4),10),f=e.substr(4),u=1+(parseInt(f,10)-1)*7;t=m.getInstance(Date.UTC(i,0,u));break;default:break}return t};var M=function(e,t){if(e){var r=o.parseJsonDateTime(e);return i.getInstance(t).format(m.getInstance(r),t.bUTC)}};var T=function(e){if(e){var r=t.getIntegerInstance({minFractionDigits:0,maxFractionDigits:1,decimalSeparator:".",style:"short"});return r.format(Number(e))}};var x=function(){var e=arguments[0],r=arguments[1],a=Number(arguments[2]),i=arguments[3];var n=t.getCurrencyInstance({style:"short",showMeasure:true,shortRefNumber:e.scaleFactor,minFractionDigits:e.numberOfFractionalDigits,maxFractionDigits:e.numberOfFractionalDigits});var s=n.format(a,i);if(!r){return s}else{var o=arguments[arguments.length-1];return s+" ("+o+")"}};var U=function(e,r,a,i,n){var s;if(e){e.maxFractionDigits=e.numberOfFractionalDigits||0;e.minFractionDigits=e.numberOfFractionalDigits||0;e.style=e.style||"short";e.showScale=e.showScale||true;e.shortRefNumber=e.scaleFactor;s=t.getFloatInstance(e)}var o=[];if(!isNaN(parseFloat(a))&&s){o.push(s.format(a))}else{o.push(a)}if(!isNaN(parseFloat(i))&&s){o.push(s.format(i))}else{o.push(i)}if(!isNaN(parseFloat(n))&&s){o.push(s.format(n))}else{o.push(n)}var l="";if(r&&r.length){r.forEach(function(e){if(typeof e==="number"){l=l+o[e]}else{l=l+e}})}return l};var A=function(e,t){if(t==="state"){switch(String(e)){case"1":case"Error":return p.Error;case"2":case"Warning":return p.Warning;case"3":case"Success":return p.Success;default:return p.None}}if(t==="color"){switch(String(e)){case"1":case"Error":return v.Error;case"2":case"Critical":return v.Critical;case"3":case"Good":return v.Good;default:return v.Neutral}}};var H=function(e,t,r){var a;if(r&&r.indexOf("sap.ui.model.odata.v4.ODataModel")>-1){a=this.getCard().getModel().getProperty("/content/value")||this.getCard().getModel().getProperty("/value")||[]}else{a=this.getCard().getModel().getProperty("/content/d/results")||this.getCard().getModel().getProperty("/d/results")||[]}var i=a.map(function(t){return t[e]});if(i.indexOf("0")===-1){i.push(0)}return Math[t].apply(Math,i)};var L=function(e,t,r){var a=1;var i=2;var n=4;for(var s in e){if(e.hasOwnProperty(s)){var o=e[s];if(o instanceof Date){o=o.toJSON()}else if(Array.isArray(o)||o&&typeof o==="object"){o=JSON.stringify(o)}else if(typeof o==="number"||typeof o==="boolean"){o=o.toString()}if(o===""){if(r&a){h.info("Semantic attribute "+s+" is an empty string and due to the chosen Suppression Behiavour is being ignored.");continue}}if(o===null){if(r&i){throw new h.error("NavigationHandler.INVALID_INPUT")}else{h.warning("Semantic attribute "+s+" is null and ignored for mix in to selection variant");continue}}if(o===undefined){if(r&n){throw new h.error("NavigationHandler.INVALID_INPUT")}else{h.warning("Semantic attribute "+s+" is undefined and ignored for mix in to selection variant");continue}}if(typeof o==="string"||o instanceof String){t.addSelectOption(s,"I","EQ",o)}else{throw new h.error("NavigationHandler.INVALID_INPUT")}}}return t};var J=function(e,t,a){var i=new r(t);var n=new r;if(i.getFilterContextUrl()){n.setFilterContextUrl(i.getFilterContextUrl())}if(i.getParameterContextUrl()){n.setParameterContextUrl(i.getParameterContextUrl())}if(Array.isArray(e)){e.forEach(function(e){L(e,n,a)})}else{L(e,n,a)}var s=i.getParameterNames();var o;for(o=0;o<s.length;o++){if(!n.getSelectOption(s[o])){n.addSelectOption(s[o],"I","EQ",i.getParameter(s[o]))}}var l=i.getSelectOptionsPropertyNames();for(o=0;o<l.length;o++){var f=i.getSelectOption(l[o]);if(!n.getSelectOption(l[o])){for(var u=0;u<f.length;u++){n.addSelectOption(l[o],f[u].Sign,f[u].Option,f[u].Low,f[u].High)}}}return n};function _(e){if(e){if(e.hasOwnProperty("SelectionVariantID")){delete e.SelectionVariantID}else if(e.hasOwnProperty("PresentationVariantID")){delete e.PresentationVariantID}delete e.Text;delete e.ODataFilterExpression;delete e.Version;delete e.FilterContextUrl;delete e.ParameterContextUrl;return e}return e}var k=function(e){try{if(JSON.parse(e)){return true}}catch(e){return false}};var B=function(e){var t=e&&e.length===1,r=e&&e[0];return t&&r["Option"]==="EQ"&&!r["High"]&&r["Low"]&&r["Sign"]==="I"};function R(e,t){var a=this.getCard().getManifestEntry("sap.card"),i=a&&a.configuration.parameters,n=new r,s=i._relevantODataFilters.value||[];e=e&&JSON.parse(e);var o=e&&e.sensitiveProps,l=a&&a.header.actions[0].parameters.ibnParams,f=a&&a.content.actions[0].parameters.ibnParams;s.forEach(function(e){var t=k(i[e].value);if(t&&!(o&&o[e])){var r=JSON.parse(i[e].value);var a=r.SelectOptions.Ranges;if(a&&a.length){var s=B(a);if(l[e]&&f[e]){if(s){l[e]=a[0].Low;f[e]=a[0].Low}else if(!s){delete f[e];delete l[e];n.massAddSelectOption(e,a)}}else{n.massAddSelectOption(e,a)}}}});if(t){var u=Object.keys(t)||[];for(var c=0;c<u.length;c++){if(o&&o[u[c]]||u[c]==="__metadata"){delete t[u[c]]}}var m=J(t,n&&n.toJSONObject());m=_(m.toJSONObject());e.selectionVariant=m}if(e&&e.sensitiveProps){delete e.sensitiveProps}return JSON.stringify(e)}var j=function(e){var t=i.getDateInstance({pattern:"''yyyy-MM-dd'T'HH:mm:ss.SSS'Z'''",calendarType:"Gregorian"});if(e){var r=t.format(e,true);return String(r).replace(/'/g,"")}};var G=function(e){var t=i.getDateInstance({pattern:"''yyyy-MM-dd'T'HH:mm:ss.SSS''",calendarType:"Gregorian"});var r=e instanceof Date?e:m.getInstance(e);var a=t.format(r);return String(a).replace(/'/g,"")};function Q(e,t,r,a,i,n){var s=l.toDates(e)||[];var o=s[0]&&s[0].oDate;var f=s[1]&&s[1].oDate;var u="",c="";if(a["sap:filter-restriction"]==="single-value"){if(t==="datetime"){u=G(o);if(u&&n&&n.ibnParams){n.ibnParams[r]=u}}else if(t==="string"){u=j(o);if(u&&n&&n.ibnParams){n.ibnParams[r]=u}}i.massAddSelectOption(r,[{Sign:"I",Option:"EQ",Low:u,High:null}])}else if(a["sap:filter-restriction"]==="interval"){if(t==="datetime"){u=G(o);c=G(f);if(u&&c){i.massAddSelectOption(r,[{Sign:"I",Option:"BT",Low:u,High:c}])}}else if(t==="string"){u=j(o);c=j(f);if(u&&c){i.massAddSelectOption(r,[{Sign:"I",Option:"BT",Low:u,High:c}])}}}}function q(e){var t={};var a;if(typeof e==="string"){a=new r(e)}else if(typeof e==="object"){a=e}else{throw new f("NavigationHandler.INVALID_INPUT")}var i=a.getSelectOptionsPropertyNames();for(var n=0;n<i.length;n++){var s=a.getSelectOption(i[n]);if(s.length===1&&s[0].Sign==="I"&&s[0].Option==="EQ"){t[i[n]]=s[0].Low}}var o=a.getParameterNames();for(var n=0;n<o.length;n++){var l=a.getParameter(o[n]);t[o[n]]=l}return t}function z(e,t){var a=this.getCard().getManifestEntry("sap.card"),i=a&&a.configuration.parameters,n=new r,s=i._relevantODataFilters.value||[],o=e&&JSON.parse(e)||{},l=o&&o.parameters,f=l&&l.ibnParams,u=f&&f.sensitiveProps,m=o&&o.sensitiveProps,g=i._semanticDateRangeSetting,p,v=[];if(g){p=JSON.parse(g.value);v=Object.keys(p)||[]}var d={};if(v.length){v.forEach(function(e){var t=i[e]||{};var r=k(t.value)?JSON.parse(t.value):t.value;var a=t.type;var s="";var l=t.description&&JSON.parse(t.description),f=l&&l.operator,g=u&&u[e]||m&&m.includes(e);if(c.DATE_OPTIONS.DATE_LIST.includes(f)&&!g){var v=r&&r.SelectOptions&&r.SelectOptions[0]&&r.SelectOptions[0].Ranges;if(v&&v.length){n.massAddSelectOption(e,v)}else{if(a==="datetime"){s=G(r)}else if(a==="string"){s=r.toString()}n.massAddSelectOption(e,[{Sign:"I",Option:"EQ",Low:s,High:null}])}}else if(f&&!g){Q(l,a,e,p[e],n,o)}})}i._relevantODataParameters.value.forEach(function(e){var t=u&&u[e]||m&&m.includes(e);if(i[e]&&i[e].value&&!v.includes(e)&&!t){if(f){f[e]=i[e].value}else if(o&&o.ibnParams){o.ibnParams[e]=i[e].value}n.massAddSelectOption(e,[{Sign:"I",Option:"EQ",Low:i[e].value,High:null}])}});s.forEach(function(e){var t=k(i[e].value);if(t&&v.indexOf(e)===-1&&(u&&!u[e]||m&&!m.includes(e))){var r=JSON.parse(i[e].value);var a=r.SelectOptions&&r.SelectOptions.Ranges||r.SelectOptions&&r.SelectOptions[0]&&r.SelectOptions[0].Ranges;if(a&&a.length){var s=B(a);if(s){if(f){f[e]=a[0].Low}else if(o&&o.ibnParams){o.ibnParams[e]=a[0].Low}}else{if(f&&f[e]&&!s){delete f[e]}}n.massAddSelectOption(e,a)}}});var h=t||{};var b=Object.keys(h)||[];for(var S=0;S<b.length;S++){if(u&&u[b[S]]||m&&m.includes(b[S])||b[S]==="__metadata"){delete h[b[S]]}}var N=J(h,n&&n.toJSONObject());var O=q(N);N=_(N.toJSONObject());if(f&&f.presentationVariant){d["presentationVariant"]=f.presentationVariant}else if(o&&o.ibnParams&&o.ibnParams.presentationVariant){d["presentationVariant"]=o.ibnParams.presentationVariant}if(N.Parameters.length||N.SelectOptions.length){d["selectionVariant"]=N}if(l&&!l.ibnParams){l.ibnParams={}}if(d["selectionVariant"]||d["presentationVariant"]){if(l&&l.ibnParams){l.ibnParams["sap-xapp-state-data"]=JSON.stringify(d)}else if(o&&o.ibnParams){o.ibnParams["sap-xapp-state-data"]=JSON.stringify(d)}}if(f&&f.sensitiveProps){delete f.sensitiveProps}if(o&&o.sensitiveProps){delete o.sensitiveProps}for(var P in O){if(l&&l.ibnParams){l.ibnParams[P]=O[P]}else if(o&&o.ibnParams){o.ibnParams[P]=O[P]}}if(f){delete f.selectionVariant;delete f.presentationVariant}if(o&&o.ibnParams&&o.ibnParams.presentationVariant){delete o.ibnParams.presentationVariant}return o.parameters?o.parameters:o}function W(){var e={descriptorContent:{}};e.descriptorContent=this.getCard().getManifestEntry("/");var t=Z(e,"header");return t}function Y(){var e={descriptorContent:{}};e.descriptorContent=this.getCard().getManifestEntry("/");var t=e.descriptorContent["sap.card"]["configuration"]["csrfTokens"]["token1"].data.request.url;var r=Z(e,"content");if(e.descriptorContent["sap.card"]["data"]["request"]&&e.descriptorContent["sap.card"]["data"]["request"]["batch"]){return r}return t+"/"+r}function Z(e,t){var r=u.processPrivateParams(e,null,true);if(t==="header"&&r.header){return r.header}else if(t==="content"&&r.content){return r.content}}function K(){var e=window["sap-ushell-config"],t=e&&e.ushell,r=t&&t.homeApp;return!!r}var X=e.extend("sap.insights.CardExtension",{init:function(){e.prototype.init.apply(this,arguments);e.prototype.setFormatters.apply(this,[{kpiformatter:P,formatHeaderUrl:y.bind(this),formatContentUrl:D.bind(this),returnPercentageChange:C,targetValueFormatter:I,kpiValueCriticality:F,formatValueColor:w,formatTrendIcon:E,formatDateValue:V,addPropertyValueToAppState:R.bind(this),getNavigationContext:z.bind(this),formatDate:M,formatNumber:U,formatCurrency:x,formatHeaderCount:T,formatCriticality:A,getMinMax:H.bind(this),formatHeaderDataUrlForSemanticDate:W.bind(this),formatContentDataUrlForSemanticDate:Y.bind(this)}])},loadDependencies:function(){var e=this.getCard(),t=e.getManifestEntry("/sap.card/type"),r=[];if(!K()){r.push(new Promise(function(e){sap.ui.require(["sap/insights/HandleNonS4Environment"],function(t){t.initialize(this);e()}.bind(this))}.bind(this)))}if(t==="Analytical"){r.push(g.load({name:"sap.viz"}).then(function(){return new Promise(function(e){sap.ui.require(["sap/insights/OVPChartFormatter"],function(t){t.registerCustomFormatters();e()})})}))}return Promise.all(r)}});X.prototype.addFormatters=function(e,t){if(!e||e===""){a.error("Namespace missing.");return this}var r=this.getProperty("formatters");r[e]=t;return this.setFormatters(r)};X.prototype.setFormatters=function(){a.error("Use of setFormatters is prohibited, instead use addFormatters method.");return this};return X});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/CardHelper", ["sap/base/Log","sap/ui/model/json/JSONModel","sap/insights/CardsChannel","./utils/BatchHelper","./utils/AppConstants","sap/ui/core/Lib"],function(e,t,r,a,i,n){"use strict";var s=e.getLogger("sap.insights.CardHelper");var o=n.getResourceBundleFor("sap.insights");function c(e){return i.REPO_BASE_URL+i.CARD_ENTITY_NAME+"('"+e+"')"}function d(){return fetch(i.REPO_BASE_URL,{method:"HEAD",headers:{"X-CSRF-Token":"Fetch"}}).then(function(e){var t=e.headers.get("X-CSRF-Token");if(e.ok&&t){return t}f(o.getText("tokenFetchError"))})}function u(e,t,r){if([i.PUT,i.POST].indexOf(r)===-1){f("Method not supported.")}var a=e["sap.app"].id;var n=r===i.PUT?c(a):i.REPO_BASE_URL+i.CARD_ENTITY_NAME;e={descriptorContent:JSON.stringify(e),id:a};var o=JSON.stringify(e);return fetch(n,{method:r,headers:{"X-CSRF-Token":t,"content-type":"application/json;odata.metadata=minimal;charset=utf-8"},body:o}).then(function(e){return e.json()}).then(function(e){if(e.error&&e.error.code==="/UI2/INSIGHTS_MSG/007"){s.error(e.error.message);throw new Error(e.error.code)}else if(e.error){f(e.error.message)}return JSON.parse(e.descriptorContent)})}function p(e){var t=e.split(".");if(t[0]!=="user"){f("sap.app.id value should start with user.<id>.")}}function l(e,t){return fetch(c(e),{method:"DELETE",headers:{"X-CSRF-Token":t}}).then(function(e){return e.ok?{}:e.json()}).then(function(t){if(t.error){f(t.error.message)}return e})}function h(){var e="sap.insights is not enabled for this system.";var t="ux.eng.s4producthomes1";try{var r=window["sap-ushell-config"];var a=r.apps.insights.enabled;var i=r.ushell.homeApp.component.name;var n=i===t;var s=r.ushell.spaces.enabled;if(a&&n&&s){return Promise.resolve(true)}return Promise.reject(new Error(e))}catch(t){return Promise.reject(new Error(e))}}function f(e){s.error(e);throw new Error(e)}function g(e){var t=false;if(e&&e.parameters&&e.parameters.ibnTarget&&e.parameters.ibnTarget.semanticObject&&e.parameters.ibnTarget.action){t=true}if(e&&e.ibnTarget&&e.ibnTarget.semanticObject&&e.ibnTarget.action){t=true}return t}function C(e){var t=false;if(!e["sap.app"]){s.error("Invalid card manifest. sap.app namespace do not exists.");t=true}if(!t&&!e["sap.app"].id){s.error("Invalid card manifest. sap.app.id do not exists.");t=true}if(!t){p(e["sap.app"].id,false)}if(!t&&!e["sap.app"].type){s.error("Invalid card manifest. sap.app.type do not exists.");t=true}if(!t&&e["sap.app"].type.toLowerCase()!=="card"){s.error("Invalid card manifest. invalid value for sap.app.type, expected card.");t=true}if(!t&&!e["sap.card"]){s.error("Invalid card manifest. sap.card namespace do not exists.");t=true}if(!t&&!e["sap.card"].type){s.error("Invalid card manifest. sap.card.type do not exists.");t=true}var r=["Analytical","List","Table"];if(!t&&r.indexOf(e["sap.card"].type)===-1){s.error("Invalid card manifest. Invalid value for sap.card.type. Supported types: "+r);t=true}if(!t&&!e["sap.insights"]){s.error("Invalid card manifest. sap.insights namespace do not exists.");t=true}if(!t&&!e["sap.insights"].parentAppId){s.error("Invalid card manifest. sap.insights.parentAppId do not exists.");t=true}if(!t&&!e["sap.insights"].cardType){s.error("Invalid card manifest. sap.insights.cardType do not exists.");t=true}if(!t&&e["sap.insights"].cardType!=="RT"){s.error("Invalid card manifest. Invalid value for sap.insights.cardType, supported value is RT");t=true}if(!t&&!e["sap.insights"].versions||!e["sap.insights"].versions.ui5){s.error("Invalid card manifest. Invalid value for sap.insights version");t=true}if(!t&&e["sap.insights"].templateName==="OVP"){var a,i,n,c=false,d=e["sap.card"].type;if(d==="Analytical"){a=e["sap.card"].content.actions||[];i=e["sap.card"].header.actions||[];a=a.filter(function(e){return e.type==="Navigation"&&e.parameters&&e.parameters.ibnTarget&&e.parameters.ibnTarget.semanticObject&&e.parameters.ibnTarget.action});i=i.filter(function(e){return e.type==="Navigation"&&e.parameters&&e.parameters.ibnTarget&&e.parameters.ibnTarget.semanticObject&&e.parameters.ibnTarget.action});if(a.length>0||i.length>0){c=true}if(e["sap.card"].configuration.parameters.state&&e["sap.card"].configuration.parameters.state.value){n=JSON.parse(e["sap.card"].configuration.parameters.state.value);c=g(n)}}if(d==="List"||d==="Table"){a=(d==="List"?e["sap.card"].content.item.actions:e["sap.card"].content.row.actions)||[];i=e["sap.card"].header.actions||[];a=a.filter(function(e){return e.type==="Navigation"});i=i.filter(function(e){return e.type==="Navigation"});if(a.length>0||i.length>0){var u={},l={};if(e["sap.card"].configuration.parameters.headerState&&e["sap.card"].configuration.parameters.headerState.value){u=JSON.parse(e["sap.card"].configuration.parameters.headerState.value)}if(e["sap.card"].configuration.parameters.lineItemState&&e["sap.card"].configuration.parameters.lineItemState.value){l=JSON.parse(e["sap.card"].configuration.parameters.lineItemState.value)}var h=g(u),f=g(l);c=h||f}}if(!c){s.error("Invalid card manifest. Card should have navigation.");t=true}}if(t){throw new Error(o.getText("invalidManifest"))}}var v;var m={localCardCache:{},userCardModel:(new t).setDefaultBindingMode("OneWay"),userVisibleCardModel:(new t).setDefaultBindingMode("OneWay"),parentAppDetailsCache:{},_oViewCache:{},_mergeCard:function(e,t,r){try{if(!r){C(e)}}catch(e){return Promise.reject(e)}this.userVisibleCardModel.setProperty("/isLoading",true);return d().then(function(r){return u(e,r,t)}).then(function(e){this.localCardCache={};this.userVisibleCardModel.setProperty("/isLoading",false);return e}.bind(this)).catch(function(e){this.userVisibleCardModel.setProperty("/isLoading",false);return Promise.reject(e)}.bind(this))},_createCard:function(e,t){return this._mergeCard(e,i.POST,t)},_createCards:function(e){var t=function(e){return e.filter(function(e){try{C(e);return true}catch(e){return false}})};var r=function(e){return e.map(function(e){var t=JSON.parse(JSON.stringify(e));return{id:t["sap.app"].id,descriptorContent:JSON.stringify(t)}})};var a=t(e);if(a.length>0){return this._updateMultipleCards(r(a),i.POST)}return Promise.resolve()},_updateCard:function(e,t){return this._mergeCard(e,i.PUT,t)},_deleteCard:function(e){try{p(e)}catch(e){return Promise.reject(e)}this.userVisibleCardModel.setProperty("/isLoading",true);return d().then(function(t){return l(e,t)}).then(function(e){this.localCardCache={};this.userVisibleCardModel.setProperty("/isLoading",false);var t=this.userCardModel.getProperty("/cards");var r=t.findIndex(function(t){return t.id===e});if(r>-1){t.splice(r,1)}this.userCardModel.setProperty("/cards",t);return e}.bind(this))},_getUserAllCards:function(){if(this.localCardCache&&this.localCardCache.userCards){return Promise.resolve(this.localCardCache.userCards)}var e=i.CARD_READ_URL+"?$orderby=rank";return this._readCard(e).then(function(e){this.localCardCache.userCards=e;return e}.bind(this))},_getUserAllCardModel:function(){return this._getUserAllCards().then(function(e){var t=e.filter(function(e){return e.visibility});this.userCardModel.setProperty("/cards",e);this.userCardModel.setProperty("/cardCount",e.length);this.userCardModel.setProperty("/visibleCardCount",t.length);return this.userCardModel}.bind(this))},_getUserVisibleCards:function(){if(this.localCardCache.userVisibleCards){return Promise.resolve(this.localCardCache.userVisibleCards)}var e=i.CARD_READ_URL+"?$filter=visibility eq true&$select=descriptorContent,visibility,rank&$orderby=rank&$skip=0&$top=10";return this._readCard(e).then(function(e){this.localCardCache.userVisibleCards=e;return e}.bind(this))},_getUserVisibleCardModel:function(){return this._getUserVisibleCards().then(function(e){this.userVisibleCardModel.setProperty("/cards",e);this.userVisibleCardModel.setProperty("/cardCount",e.length);this.userVisibleCardModel.setProperty("/isLoading",false);return this.userVisibleCardModel}.bind(this))},_readCard:function(e){return fetch(e).then(function(e){if(e.ok){return e.json()}f("Cannot read user's suggested cards.")}).then(function(e){e.value.forEach(function(e){if(e.descriptorContent){e.descriptorContent=JSON.parse(e.descriptorContent)}});return e.value})},_refreshUserCards:function(e){this.userVisibleCardModel.setProperty("/isLoading",true);this.userCardModel.setProperty("/isLoading",true);var t=e?{deleteAllCards:"X"}:{};return new Promise(function(e){fetch(i.REPO_BASE_URL,{method:"HEAD",headers:{"X-CSRF-Token":"Fetch"}}).then(function(r){var a=r.headers.get("X-CSRF-Token");fetch(i.REPO_BASE_URL+i.CARD_ENTITY_NAME+"/com.sap.gateway.srvd.ui2.insights_cards_repo_srv.v0001.deleteCards?",{method:i.POST,headers:{"X-CSRF-Token":a,"content-type":"application/json;odata.metadata=minimal;charset=utf-8"},body:JSON.stringify(t)}).then(function(e){return e.json()}).then(function(t){var r=t.value||[];this.iVisCardCount=0;r.forEach(function(e){if(e.descriptorContent){e.descriptorContent=JSON.parse(e.descriptorContent)}if(e.visibility){this.iVisCardCount++}}.bind(this));this.localCardCache={};this.localCardCache.userCards=r;this.userVisibleCardModel.setProperty("/isLoading",false);return this._getUserAllCardModel().then(function(){this.userCardModel.setProperty("/isLoading",false);e()}.bind(this))}.bind(this))}.bind(this))}.bind(this))},getParentAppDetails:function(e){if(this.parentAppDetailsCache[e.descriptorContent["sap.app"].id]){return Promise.resolve(this.parentAppDetailsCache[e.descriptorContent["sap.app"].id])}var t={};var r=e.descriptorContent["sap.insights"].parentAppUrl;if(r){return sap.ushell.Container.getServiceAsync("URLParsing").then(function(a){var i=a.parseShellHash(r);return sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(e){return e.isNavigationSupported([{target:{semanticObject:i.semanticObject,action:i.action},params:i.params}])}).then(function(a){if(a[0].supported){t.semanticObject=i.semanticObject;t.action=i.action;t.semanticURL=r;t.title=e.descriptorContent["sap.app"].title;this.parentAppDetailsCache[e.descriptorContent["sap.app"].id]=t;return Promise.resolve(t)}else{return this._getParentApp(e)}}.bind(this))}.bind(this))}else{return this._getParentApp(e)}},_getParentApp:function(e){var t={};return sap.ushell.Container.getServiceAsync("ClientSideTargetResolution").then(function(r){var a=r._oAdapter._aInbounds||[];var i=a.find(function(t){return t.resolutionResult&&t.resolutionResult.applicationDependencies&&t.resolutionResult.applicationDependencies.name===e.descriptorContent["sap.insights"].parentAppId});if(i){t.semanticObject=i.semanticObject;t.action=i.action;t.semanticURL="#"+i.semanticObject+"-"+i.action;t.title=e.descriptorContent["sap.app"].title;this.parentAppDetailsCache[e.descriptorContent["sap.app"].id]=t}return t}.bind(this))},_updateMultipleCards:function(e,t){try{return a.createMultipartRequest(e,t).then(function(){this.localCardCache={};return Promise.resolve()}.bind(this)).catch(function(e){return Promise.reject(e)})}catch(e){return Promise.reject(e)}},showCardPreview:function(e,t,r,a,i,n){return new Promise(function(o,c){try{sap.ui.require(["sap/insights/ManagePreview"],function(s){if(!this._oManagePreviewDialog){this._oManagePreviewDialog=new s({transformation:t,cardMessageInfo:r,confirmButtonText:a,dialogTitle:n,manifest:e})}else{this._oManagePreviewDialog.setTransformation(t);this._oManagePreviewDialog.setCardMessageInfo(r);this._oManagePreviewDialog.setConfirmButtonText(a);this._oManagePreviewDialog.setManifest(e);this._removeAllEventListeners(this._oManagePreviewDialog,"onConfirmButtonPress")}if(i){this._oManagePreviewDialog.attachOnConfirmButtonPress(i)}this._oManagePreviewDialog.openPreviewDialog();o(this._oManagePreviewDialog)}.bind(this))}catch(e){s.error(e.message);c(e.message)}}.bind(this))},_removeAllEventListeners:function(e,t){if(e.hasListeners(t)){e.mEventRegistry[t].forEach(function(r){e.detachEvent(t,r.fFunction,r.oListener)})}},getCardsChannel:function(){if(v){return Promise.resolve(v)}else{return new Promise(function(e){v=new r;v.init().then(function(){e(v)})})}}};return{getServiceAsync:function(){return h().then(function(){return m}).catch(function(e){return Promise.reject(e)})}}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/CardProvider", ["sap/ui/base/Object","sap/insights/CardHelper"],function(i,e){return i.extend("sap.insights.CardProvider",{constructor:function(i,s){e.getServiceAsync().then(function(e){e.getCardsChannel().then(function(e){if(e.isEnabled()){this.channel=e;this.id=i;this.sharedCards=s;this.consumers={};this._registerProvider()}}.bind(this))}.bind(this))},_registerProvider:function(){if(this.channel){return this.channel.registerProvider(this.id,this).then(function(){this.registered=true}.bind(this))}},_unregisterProvider:function(){if(this.channel){return this.channel.unregister(this.id).then(function(){this.registered=false;this.consumers={};this.sharedCards=[]}.bind(this))}},_shareAvailableCards:function(i){var e=this.sharedCards.map(function(i){return{id:i.id,title:i.descriptorContent["sap.card"].header.title,parentAppId:i.descriptorContent["sap.insights"].parentAppId,description:i.descriptorContent["sap.card"].header.subTitle?i.descriptorContent["sap.card"].header.subTitle:""}});this.channel.publishAvailableCards(this.id,e,i)},onConsumerConnected:function(i){if(!this.consumers[i]){this.consumers[i]=true;this._shareAvailableCards(i)}},onConsumerDisconnected:function(i){if(this.consumers[i]){delete this.consumers[i]}},onCardRequested:function(i,e){if(this.consumers[i]){var s=this.sharedCards.find(function(i){return i.id===e});if(s){this.publishCard(this.id,s,i)}}},onViewUpdate:function(i,e){if(this.registered!==i){if(i){this._registerProvider().then(function(){this.sharedCards=e;this._shareAvailableCards()}.bind(this))}else{this._unregisterProvider()}}else{if(this.registered){this.sharedCards=e;this._shareAvailableCards()}}}})});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 * POC
 */
sap.ui.predefine("sap/insights/CardsChannel", ["sap/ui/base/Object"],function(e){"use strict";var s="sap-insights";var n={available:"cardsAvailable",requested:"cardRequested",provided:"cardProvided",subscribed:"clientSubscribed"};function i(){this.subscribers={};this.onMessage=function(e){if(typeof e.data==="string"){var n=JSON.parse(e.data);if(n.type==="request"){if(n.body.channelId===s&&this.onNewMessage){this.onNewMessage(n.body.clientId,n.body.channelId,n.body.messageName,n.body.data)}else if(this.onSubscriptionChange){if(n.body.messageName==="clientSubscribed"&&!this.subscribers[n.body.clientId]){this.subscribers[n.body.clientId]=true;this.onSubscriptionChange(n.body.messageName,n.body.clientId,n.body.channels)}else if(n.body.messageName==="clientUnsubscribed"&&this.subscribers[n.body.clientId]){delete this.subscribers[n.body.clientId];this.onSubscriptionChange(n.body.messageName,n.body.clientId,n.body.channels)}}}}};this.connect=function(e){return new Promise(function(n){var i=function(e){if(typeof e.data==="string"){var s=JSON.parse(e.data);if(s.body.messageName==="connect"){window.removeEventListener("message",i);n()}}};window.addEventListener("message",i);window.parent.postMessage(JSON.stringify({type:"request",service:"sap.ushell.services.MessageBroker",request_id:Date.now().toString(),body:{channelId:s,clientId:e,messageName:"connect"}}),"*")})};this.subscribe=function(e,s,n,i){this.onNewMessage=n;this.onSubscriptionChange=i;window.addEventListener("message",this.onMessage.bind(this));window.parent.postMessage(JSON.stringify({type:"request",service:"sap.ushell.services.MessageBroker",request_id:Date.now().toString(),body:{channelId:"sap.ushell.MessageBroker",clientId:e,messageName:"subscribe",subscribedChannels:s}}),"*");return Promise.resolve()};this.publish=function(e,s,n,i,t,r){window.parent.postMessage(JSON.stringify({type:"request",service:"sap.ushell.services.MessageBroker",request_id:n,body:{channelId:e,clientId:s,messageName:i,targetClientIds:t,data:r}}),"*");return Promise.resolve()};this.unsubscribe=function(e,s){delete this.onNewMessage;delete this.onSubscriptionChange;window.addEventListener("message",this.onMessage.bind(this));window.parent.postMessage(JSON.stringify({type:"request",service:"sap.ushell.services.MessageBroker",request_id:Date.now().toString(),body:{channelId:"sap.ushell.MessageBroker",clientId:e,messageName:"unsubscribe",subscribedChannels:s}}),"*");return Promise.resolve()};this.disconnect=function(e){window.removeEventListener("message",this.onMessage.bind(this));window.parent.postMessage(JSON.stringify({type:"request",service:"sap.ushell.services.MessageBroker",request_id:Date.now().toString(),body:{channelId:s,clientId:e,messageName:"disconnect"}}),"*");return Promise.resolve()}.bind(this)}function t(e,i,t){this.onSubscriptionChange=function(n,t,r){if(e!==t&&r.find(function(e){return e.channelId===s})){if(n==="clientSubscribed"){i.onConsumerConnected(t)}else if(n==="clientUnsubscribed"){i.onConsumerDisconnected(t)}}};this.onNewMessage=function(e,t,r,o){if(t===s){switch(r){case n.subscribed:i.onConsumerConnected(e);break;case n.requested:i.onCardRequested(e,o);break;default:break}}};this.register=function(){return t.connect(e).then(function(){return t.subscribe(e,[{channelId:s}],this.onNewMessage,this.onSubscriptionChange)}.bind(this))}}function r(e,i,t){this.onSubscriptionChange=function(r,o,a){if(e!==o&&a.find(function(e){return e.channelId===s})){if(r==="clientSubscribed"){t.publish(s,e,Date.now().toString(),n.subscribed,[o])}else if(r==="clientUnsubscribed"){i.onCardsAvailable(o,[])}}};this.onNewMessage=function(e,t,r,o){if(t===s){switch(r){case n.available:i.onCardsAvailable(e,o);break;case n.provided:i.onCardProvided(e,o);break;default:break}}};this.register=function(){return t.connect(e).then(function(){return t.subscribe(e,[{channelId:s}],this.onNewMessage,this.onSubscriptionChange)}.bind(this))}}var o=e.extend("sap.insights.CardsChannel",{constructor:function(){this.clients={}},isEnabled:function(){return!!this.broker},init:function(){var e;if(sap.ushell.Container){e=sap.ushell.Container.getServiceAsync("MessageBroker")}else{e=Promise.resolve(new i)}return e.then(function(e){this.broker=e}.bind(this))},registerProvider:function(e,s){this.clients[e]=new t(e,s,this.broker);return this.clients[e].register()},registerConsumer:function(e,s){this.clients[e]=new r(e,s,this.broker);return this.clients[e].register()},publishAvailableCards:function(e,i,t){if(!t){t="*"}return this.broker.publish(s,e,Date.now().toString(),n.available,[t],i)},requestCard:function(e,i,t){return this.broker.publish(s,e,Date.now().toString(),n.requested,[t],i)},publishCard:function(e,i,t){if(!t){t="*"}return this.broker.publish(s,e,Date.now().toString(),n.provided,[t],i)},unregister:function(e){return this.broker.unsubscribe(e,[{channelId:s}]).then(function(){delete this.clients[e];return this.broker.disconnect(e)}.bind(this))},destroy:function(){var e=[];for(var s in this.clients){e.push(this.unregister(s))}return Promise.all(e).then(function(){delete this.broker}.bind(this))}});return o});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 * This code handles S/4 cards in SAP Start and SAP Mobile Start
 */
sap.ui.predefine("sap/insights/HandleNonS4Environment", ["sap/ushell/utils/UrlParsing","sap/base/Log","sap/ui/core/Configuration"],function(a,t,e){"use strict";var r="(runtimeURL)";var n=e.getSAPLogonLanguage();var i=function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";var t="";var e=new window.Uint32Array(40);window.crypto.getRandomValues(e);var r=function(t){var r=e[t]%a.length;return a[r]};while(t.length<40){t+=r(t.length)}return t};var s=function(t,e){var r=JSON.parse(JSON.stringify(t)),n="",i={};if(r.ibnParams&&r.ibnParams["sap-xapp-state-data"]){delete r.ibnParams["sap-xapp-state-data"]}i={target:r.ibnTarget,params:r.ibnParams};if(e){i.appStateKey=e}n=a.constructShellHash(i);n=encodeURI(n);n="#"+n;return n};var o=function(a){var t;if(a){var e=a.getHostInstance();if(e){t=e.getDestination(r,a)}}if(!t){t=Promise.reject("S/4 runtime destination URL could not be determined!")}return t};var u=async function(a,t){var e=a;if(e.indexOf("?")<0){e+="?"}else{e+="&"}e+="sap-language="+n;var r=t?await(t.getHostInstance()?.getContextValue("navigation/flp/defaultQueryParams/value")):null;if(r){r=JSON.parse(r);var i=Object.keys(r);if(i.length){i.forEach(function(a,t){e+="&"+a+"="+r[a]})}}return e};var p=function(a,e,r){var n={id:e,sessionKey:"",component:"",appName:"",value:r.replaceAll("{","\\{")};return a.request({url:"{{destinations.service}}/sap/opu/odata/UI2/INTEROP/GlobalContainers",method:"POST",parameters:n,headers:{Accept:"application/json","X-CSRF-Token":"{{csrfTokens.token1}}","content-type":"application/json"}}).then(function(a){return}).catch(function(a){t.error("FAILED to save sap-xapp-state-data in S/4")})};var c=async function(a){if(a.getParameter("type")!=="Navigation"){return}var e=this.getCard();var r=a.getParameter("parameters");if(r&&r.url){return}var n=r&&r.ibnParams&&r.ibnParams["sap-xapp-state-data"];var c=n?i():"";var l=s(r,c);if(l){a.preventDefault(true);if(n){await p(e,c,r.ibnParams["sap-xapp-state-data"])}try{var v=await o(this._oCard);if(v){var f=await u(v,this._oCard);f+=l;this.getCard().triggerAction({type:"Navigation",parameters:{url:f,target:"_blank"}})}}catch(a){t.error(a)}}};var l=function(a){a.attachAction(c.bind(a))};return{initialize:l,_:{createAppStateId:i,getIntent:s,getRuntimeDestinationUrl:o,addQueryParameter:u,saveXAppState:p,handleAction:c}}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/ManageCards", ["sap/ui/core/Control","sap/m/NavContainer","sap/ui/model/resource/ResourceModel","./manageCards/CardsList","./manageCards/CardDetails","sap/insights/CardHelper","sap/ui/core/Lib","sap/ui/core/Core"],function(t,e,i,a,s,n,r,o){"use strict";var d=r.getResourceBundleFor("sap.insights");var l=t.extend("sap.insights.ManageCards",{metadata:{properties:{enableResetAllCards:{type:"boolean",group:"Behavior",defaultValue:false},cardId:{type:"string",group:"Behavior",defaultValue:null}},aggregations:{_navContainer:{type:"sap.m.NavContainer",multiple:false,visibility:"hidden"}}},renderer:{apiVersion:2,render:function(t,e){t.openStart("div",e);t.style("height","100%");t.style("width","100%");t.openEnd();e._oNavContainer.to(e._oNavContainer.getInitialPage());t.renderControl(e.getAggregation("_navContainer"));t.close("div")}}});l.prototype.onAfterRendering=function(){this._oNavContainer.setBusy(true);n.getServiceAsync().then(function(t){return t._getUserAllCardModel()}).then(function(t){if(!this._cardDetailControl){this._cardListPage=new a(this.getId()+"cardList",{enableResetAllCards:this.getEnableResetAllCards(),listPress:this._navToDetails.bind(this)});this._cardListPage.setModel(t);this._cardListPage._handleModelChange();t.bindProperty("/cards").attachChange(function(t){this._cardListPage._handleModelChange()}.bind(this));this._cardDetailControl=new s(this.getId()+"previewPage",{navigate:this.navigateTo.bind(this)});this._oNavContainer.addPage(this._cardListPage)}var e=this.getCardId();if(e){var i=t.getProperty("/cards");var n=i.find(function(t){return t.id===e});if(n){this._oNavContainer.addPage(this._cardDetailControl);var r=JSON.stringify(n);this._cardDetailControl.setProperty("manifest",r,false);this._oNavContainer.to(this._cardDetailControl)}}else{this._oNavContainer.setInitialPage(this._cardListPage);this._oNavContainer.to(this._cardListPage)}this._oNavContainer.setBusy(false)}.bind(this))};l.prototype.loadCardDetails=function(){return new Promise(async function(t){if(!this._cardDetailControl){await o.loadLibrary("sap/ui/mdc");sap.ui.require(["sap/insights/manageCards/CardDetails"],function(e){this._cardDetailControl=new e(this.getId()+"previewPage",{navigate:this.navigateTo.bind(this)});t()}.bind(this))}else{t()}}.bind(this))};l.prototype.init=function(){this._oNavContainer=new e(this.getId()+"--selectionNavCon",{busy:true});this._oNavContainer.setModel(new i({bundle:d}),"i18n");this.setAggregation("_navContainer",this._oNavContainer)};l.prototype.navigateTo=function(t,e){if(!t&&e){this._oNavContainer.to(e)}else{this._oNavContainer.to(this._cardListPage.getId())}};l.prototype._navToDetails=function(t){if(t&&t.getParameter("manifest")){this._oNavContainer.setBusy(true);this.loadCardDetails().then(function(){this._cardDetailControl.setProperty("manifest",t.getParameter("manifest"),false);if(!this._oNavContainer.getPage(this._cardDetailControl.getId())){this._oNavContainer.addPage(this._cardDetailControl)}this._cardDetailControl.oPage.setShowNavButton(true);this._cardDetailControl.setEditable(false);this._oNavContainer.setBusy(false);this._oNavContainer.to(this._cardDetailControl)}.bind(this))}};l.prototype.clearPage=function(){if(this._cardListPage){this.navigateTo();if(this._cardListPage._oSearchField){this._cardListPage._oSearchField.clear()}if(this._cardListPage._oVisibleFilterSwitch&&this._cardListPage._oVisibleFilterSwitch.getState()){this._cardListPage._oVisibleFilterSwitch.setState(false);this._cardListPage._oVisibleFilterSwitch.fireChange()}}this.setProperty("cardId","")};return l});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/ManagePreview", ["sap/ui/core/Control","sap/m/NavContainer","sap/insights/CardHelper","sap/insights/manageCardPreview/Preview","sap/insights/manageCardPreview/ColumnListPreview","sap/insights/manageCardPreview/HouseOfCards","sap/m/Button","sap/m/Dialog","sap/ui/model/resource/ResourceModel","./utils/CardPreviewManager","sap/m/MessageToast","sap/m/MessageBox","./utils/DeviceType","sap/base/Log","sap/insights/utils/AppConstants","sap/ui/core/Lib","sap/ui/performance/trace/FESRHelper"],function(e,t,i,s,o,a,n,r,l,h,u,g,_,d,f,P,C){"use strict";var v=P.getResourceBundleFor("sap.insights");var T=d.getLogger("sap.insights.ManagePreview");var c=e.extend("sap.insights.ManagePreview",{metadata:{properties:{manifest:{type:"object",group:"Behavior",defaultValue:null},transformation:{type:"boolean",group:"Behavior",defaultValue:false},cardMessageInfo:{type:"object",group:"Appearance",defaultValue:null},confirmButtonText:{type:"string",group:"Appearance",defaultValue:""},dialogTitle:{type:"string",group:"Appearance",defaultValue:""}},aggregations:{_manageDialog:{type:"sap.m.Dialog",multiple:false,visibility:"hidden"}},events:{onConfirmButtonPress:{parameters:{manifest:{type:"string"}}}}}});c.prototype.init=function(){this.i18Bundle=new l({bundle:v}).getResourceBundle();this._createStaticControls();this._oNavContainer=new t(this.getId()+"selectionNavCon");this._oManageDialog=new r(this.getId()+"--insightsListDialog",{contentHeight:"42.8rem",contentWidth:"65.6rem",verticalScrolling:false,horizontalScrolling:false,resizable:false,draggable:true,showHeader:false,afterClose:this._afterCloseDialog.bind(this),content:[this._oNavContainer],buttons:[this.oBackButton,this.oAddButton,this.oNextButton,this.oCancelButton]}).addStyleClass("sapContrastPlus dialogScrollPadding")};c.prototype._afterCloseDialog=function(){this.oManifest={};this._oPreviewPage.setManifest({});this._oPreviewPage.setCardMessageInfo(null);this._oPreviewPage.bInitialPreviewLoad=true;this.setConfirmButtonText(null);if(this.getTransformation()){if(this._oColumnListPreview){this._oColumnListPreview.bShowPreview=false;this._oColumnListPreview.bDialogOpen=false;this._oColumnListPreview.oConfCard={};this._oColumnListPreview.oOrgCard={};if(this._oColumnListPreview.oColumnSearch){this._oColumnListPreview.oColumnSearch.setValue("")}}if(this._oHouseOfCards){this._oHouseOfCards._innerHocModel.setData({oSelected:{},aCards:[],aPreviewCards:[1,2,3],aAllowedChartTypes:[],sOriginalChartType:"",selectedPath:""})}}};c.prototype.setConfirmButtonText=function(e){this.setProperty("confirmButtonText",e);this.oAddButton.setText(e)};c.prototype._createStaticControls=function(){this.oBackButton=new n(this.getId()+"--backButton",{text:this.i18Bundle.getText("INT_DIALOG_BACK"),press:this._onNavBack.bind(this)});this.oAddButton=new n(this.getId()+"--addButton",{text:this.getConfirmButtonText()?this.getConfirmButtonText():this.i18Bundle.getText("INT_DIALOG_Ok"),press:this._save.bind(this),type:"Emphasized",enabled:false});C.setSemanticStepname(this.oAddButton,"press",f.FESR_STEP_NAME);this.oNextButton=new n(this.getId()+"--nextButton",{text:this.i18Bundle.getText("INT_DIALOG_NEXT"),press:this._callNextPage.bind(this),type:"Emphasized",enabled:false});this.oCancelButton=new n(this.getId()+"--cancelButton",{text:this.i18Bundle.getText("INT_DIALOG_CANCEL"),press:this._closeDialog.bind(this)})};c.prototype._setEnableButton=function(e){if(this.getTransformation()&&!this.bColumnPage){this.oNextButton.setEnabled(e.getParameter("enableButton"))}else{this.oAddButton.setEnabled(e.getParameter("enableButton"))}};c.prototype.openPreviewDialog=function(){this.oManifest=this.getManifest();this.oBackButton.setVisible(false);var e=this.getConfirmButtonText()?this.getConfirmButtonText():this.i18Bundle.getText("INT_DIALOG_Ok");this.oAddButton.setText(e);this._showPreview(this.oManifest);if(this.getTransformation()){this.oAddButton.setVisible(false);this.oNextButton.setVisible(true)}else{this.oAddButton.setVisible(true);this.oNextButton.setVisible(false)}};c.prototype._createColumnListDialog=function(){if(!this._oColumnListPreview){this._oColumnListPreview=new o({enableAddButton:this._setEnableButton.bind(this)})}this._oColumnListPreview.setManifest(this._oPreviewPage.getManifest());if(this.getDialogTitle()){this._oColumnListPreview.setDialogTitle(this.getDialogTitle())}else{this._oColumnListPreview.setDialogTitle(this.hasListeners("onConfirmButtonPress")?this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE_COLMANAGER"):this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE"))}this._oNavContainer.addPage(this._oColumnListPreview);this._oNavContainer.to(this._oColumnListPreview);if(_.getDialogBasedDevice()===f.DEVICE_TYPES.Desktop){this._oColumnListPreview.oPreviewCard.setPreviewMode(this._oColumnListPreview.iVisibleColumnCount>0?"Off":"Abstract");this._oColumnListPreview._refreshShowPreview()}else{this._oColumnListPreview.oPreviewColCardSD.setPreviewMode(this._oColumnListPreview.iVisibleColumnCount>0?"Off":"Abstract")}};c.prototype._createHocDialog=function(){if(!this._oHouseOfCards){this._oHouseOfCards=new a({})}this._oHouseOfCards.setManifest(this._oPreviewPage.getManifest());if(this.getDialogTitle()){this._oHouseOfCards.setDialogTitle(this.getDialogTitle())}else{this._oHouseOfCards.setDialogTitle(this.hasListeners("onConfirmButtonPress")?this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE_COLMANAGER"):this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE"))}};c.prototype._save=function(e){var t=JSON.parse(this._oPreviewPage.getManifest());if(this._oColumnListPreview){t=this._oColumnListPreview.oConfCard}else if(this._oHouseOfCards){t=this._oHouseOfCards._oConfCard}var s=h.insertActionsManifest(t,this.oManifest);if(this.hasListeners("onConfirmButtonPress")){this.fireOnConfirmButtonPress({manifest:s});this._closeDialog()}else if(t["sap.card"].header.title){var o=t["sap.insights"].visible;t["sap.insights"].visible=true;this._oManageDialog.setBusy(true);i.getServiceAsync().then(function(e){e._createCard(s).then(function(e){this._oManageDialog.setBusy(false);this._closeDialog();if(o){u.show(this.i18Bundle.getText("Card_Created"))}else{g.information(this.i18Bundle.getText("INT_CARD_LIMIT_MESSAGEBOX"),{styleClass:"msgBoxAlign"})}}.bind(this)).catch(function(e){if(e&&e.message==="/UI2/INSIGHTS_MSG/007"){g.error(this.i18Bundle.getText("INT_CARD_MAXLIMIT"))}else{u.show(e.message)}this._oManageDialog.setBusy(false);this._closeDialog()}.bind(this))}.bind(this))}else{this._oNavContainer.to(this._oPreviewPage);this._oPreviewPage.oTitleTextInput.focus()}};c.prototype._callNextPage=function(){try{var e=JSON.parse(this._oPreviewPage.getManifest());if(e&&this._oPreviewPage.oTitleTextInput.getValue().trim()){var t=e["sap.card"];if(t.type==="Table"||t.type==="List"){var i=_.getDialogBasedDevice()===f.DEVICE_TYPES.Desktop;this._createColumnListDialog();var s=i?this._oColumnListPreview.oColumnSegButton:this._oColumnListPreview.oSdColumnSegButton;if(!s.getSelectedKey()){s.setSelectedKey("list")}this._oColumnListPreview.oColumnSearch.setValue("");this._oColumnListPreview._onColumnSearch();this.bColumnPage=true;this.oNextButton.setVisible(false);this.oAddButton.setVisible(true);this.oBackButton.setVisible(true);this._oColumnListPreview.oColumnSearch.focus()}else if(t.type==="Analytical"){this._createHocDialog();this._oHouseOfCards.showHouseOfCardsDialog();this._oHouseOfCards.getChartTypeSearch().setValue("");this._oHouseOfCards._onChartTypeSearch();this._oNavContainer.addPage(this._oHouseOfCards);this._oNavContainer.to(this._oHouseOfCards);this.oNextButton.setVisible(false);this.oAddButton.setVisible(true);this.oBackButton.setVisible(true);this.oAddButton.setEnabled(true)}else{this._oColumnListPreview._callPreview(e)}}}catch(e){T.error(e.message);u.show(e.message);throw new Error(e)}};c.prototype._callPreviewPage=function(e){if(this._oColumnListPreview){this._oColumnListPreview.bShowPreview=false}if(this._oNavContainer&&this._oPreviewPage){this._oPreviewPage.bShowCardPreview=false;this._oPreviewPage._adjustLayoutStyles();var t=this._oPreviewPage.oTitleTextInput;if(e){if(e["sap.card"].header.title&&e["sap.card"].header.title.trim()){this.oNextButton.setEnabled(true);t.setValueState("None");t.setValueStateText("")}else{this.oNextButton.setEnabled(false);t.setValueState("Error");t.setValueStateText(this.i18Bundle.getText("INT_Preview_Title_ValueStateText"))}}this.bColumnPage=false;this._oNavContainer.to(this._oPreviewPage);var i=_.getDialogBasedDevice()===f.DEVICE_TYPES.Desktop;var s=i?this._oPreviewPage.oDefaultPreviewCardLS:this._oPreviewPage.oDefaultPreviewCardSD;if(s&&(e["sap.card"].type==="Table"||e["sap.card"].type==="List")){if(this._oColumnListPreview&&this._oColumnListPreview.iVisibleColumnCount>0){s.setPreviewMode("Off")}else{s.setPreviewMode("Abstract")}}this._oPreviewPage.setManifest(JSON.stringify(e));this.oBackButton.setVisible(false);this.oAddButton.setVisible(false);this.oNextButton.setVisible(true)}};c.prototype._closeDialog=function(){this.oAddButton.setEnabled(false);this._oManageDialog.close()};c.prototype._onNavBack=function(){if(this._oColumnListPreview&&this._oColumnListPreview.oConfCard){var e=this._oColumnListPreview.oConfCard["sap.card"];if(e.type==="Table"||e.type==="List"){this._callPreviewPage(this._oColumnListPreview.oConfCard)}}else{this._callPreviewPage(this._oHouseOfCards._oConfCard)}};c.prototype._showPreview=function(e){return i.getServiceAsync().then(function(t){return t._getUserAllCards().then(function(t){var i=t.filter(function(e){return e.visibility});if(i.length<10){e["sap.insights"].visible=true}var o=e?JSON.parse(JSON.stringify(e)):"";o=h.getCardPreviewManifest(e);if(!this._oPreviewPage){this._oPreviewPage=new s(this.getId()+"idPreviewPage",{cardMessageInfo:this.getCardMessageInfo(),transformation:this.getTransformation(),titleCheck:this._setEnableButton.bind(this)})}else{this._oPreviewPage.setCardMessageInfo(this.getCardMessageInfo());this._oPreviewPage.setTransformation(this.getTransformation())}this._oPreviewPage.setManifest(JSON.stringify(o));if(this.getDialogTitle()){this._oPreviewPage.setDialogTitle(this.getDialogTitle())}else{this._oPreviewPage.setDialogTitle(this.hasListeners("onConfirmButtonPress")?this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE_COLMANAGER"):this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE"))}this._oNavContainer.addPage(this._oPreviewPage);this._oNavContainer.to(this._oPreviewPage);this.bColumnPage=false;var a=this._oPreviewPage.oTitleTextInput;a.setValueState("None");this._oManageDialog.open();this._oPreviewPage.setPreviewModeOfCard();if(this.hasListeners("onConfirmButtonPress")){this._oPreviewPage.oDefaultSubText.setText(this.i18Bundle.getText("INT_CARD_SUBTITLE"))}else{this._oPreviewPage.oDefaultSubText.setText(this.i18Bundle.getText("INT_CARD_SUBTITLE")+"\n"+this.i18Bundle.getText("INT_CARD_LIMIT_SUBTITLE"))}return Promise.resolve()}.bind(this))}.bind(this)).catch(function(e){T.error(e.message);return Promise.reject(e)})};return c});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 * This extension is for OVP cards delivered in 2203 onwards.
 */
sap.ui.predefine("sap/insights/OVPCardExtension", ["sap/ui/integration/Extension","sap/ui/core/format/NumberFormat","sap/fe/navigation/SelectionVariant","sap/base/Log","sap/ui/core/format/DateFormat","sap/ui/core/library","sap/m/library","./OVPChartFormatter","sap/ui/integration/util/Utils","sap/m/DynamicDateUtil","sap/ui/core/date/UI5Date"],function(e,t,r,a,i,n,o,s,l,f,u){"use strict";var c=o.ValueColor,g=n.ValueState;var m={StateValues:{None:"None",Negative:"Error",Critical:"Warning",Positive:"Success"},ColorValues:{None:"Neutral",Negative:"Error",Critical:"Critical",Positive:"Good"}};var v=a.getLogger("sap.insights.OVPCardExtension");var p=function(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1};var d=function(e,t){var r;if(t){r=t.None;if(e&&e.EnumMember){var a=e.EnumMember;if(p(a,"Negative")){r=t.Negative}else if(p(a,"Critical")){r=t.Critical}else if(p(a,"Positive")){r=t.Positive}}}return r};var b=function(e,t,r,a,i,n,o){var s={};s.EnumMember="None";var l=Number.NEGATIVE_INFINITY;var f=Number.POSITIVE_INFINITY;if(!i&&i!==0&&(r||r===0)){i=r}if(!n&&n!==0&&(a||a===0)){n=a}if(!r&&r!==0){r=l}if(!a&&a!==0){a=f}if(e!==undefined){e=Number(e);if(p(t,"Minimize")||p(t,"Minimizing")){if((n||n===0)&&(a||a===0)){if(e<=parseFloat(n)){s.EnumMember="Positive"}else if(e>parseFloat(a)){s.EnumMember="Negative"}else{s.EnumMember="Critical"}}}else if(p(t,"Maximize")||p(t,"Maximizing")){if((i||i===0)&&(r||r===0)){if(e>=parseFloat(i)){s.EnumMember="Positive"}else if(e<parseFloat(r)){s.EnumMember="Negative"}else{s.EnumMember="Critical"}}}else if(p(t,"Target")){if((n||n===0)&&(a||a===0)&&(i||i===0)&&(r||r===0)){if(e>=parseFloat(i)&&e<=parseFloat(n)){s.EnumMember="Positive"}else if(e<parseFloat(r)||e>parseFloat(a)){s.EnumMember="Negative"}else{s.EnumMember="Critical"}}}}return d(s,o)};var h=function(e,t,r,a){if(!e||!t){return}e=Number(e);if(!a&&e-t>=0){return"Up"}if(!r&&e-t<=0){return"Down"}if(t&&a&&e-t>=a){return"Up"}if(t&&r&&e-t<=r){return"Down"}};var N=function(e,r,a){var i=r||{},n=e;var o=t.getFloatInstance({minFractionDigits:i.NumberOfFractionalDigits,maxFractionDigits:i.NumberOfFractionalDigits,style:"short",showScale:true,shortRefNumber:n});var s=o.format(Number(n)),l=o.getScale()||"";if(!a&&s){var f=s[s.length-1];return f===l?s.slice(0,s.length-1):s}if(a&&i.percentageAvailable){return l+"%"}if(a&&!i.percentageAvailable){return l}return""};var S=function(){var e=this.getCard().getCombinedParameters();return e._headerDataUrl};var D=function(){var e=this.getCard().getCombinedParameters();return e._contentDataUrl};var I=function(e,r,a){var i,n,o;if(isNaN(+e)){return""}if(e==0){o=r}else{o=e}if(a.NumberOfFractionalDigits){n=+a.NumberOfFractionalDigits}if(r){i=r}else if(a.manifestTarget){i=a.manifestTarget}if(!n||n<0){n=0}else if(n>2){n=2}if(i){var s=t.getFloatInstance({minFractionDigits:n,maxFractionDigits:n,style:"short",showScale:true,shortRefNumber:o});return s.format(+i)}};var y=function(e,r,a){var i,n;if(isNaN(+e)){return""}e=+e;if(a.NumberOfFractionalDigits){i=+a.NumberOfFractionalDigits}if(r){n=+r}else if(a.manifestTarget){n=+a.manifestTarget}if(!i||i<0){i=0}else if(i>2){i=2}if(n){var o=(e-n)/n;var s=t.getPercentInstance({style:"short",minFractionDigits:i,maxFractionDigits:i,showScale:true});return s.format(o)}};var O=function(e){var t={};t.EnumMember="None";if(Number(e)===1){t.EnumMember="Negative"}else if(Number(e)===2){t.EnumMember="Critical"}else if(Number(e)===3){t.EnumMember="Positive"}return d(t,m.ColorValues)};var F=function(){var e=arguments[arguments.length-1];var t=1;return b(arguments[0],e.sImprovementDirection,e.bIsDeviationLowBinding?arguments[t++]:e.deviationLow,e.bIsDeviationHighBinding?arguments[t++]:e.deviationHigh,e.bIsToleranceLowBinding?arguments[t++]:e.toleranceLow,e.bIsToleranceHighBinding?arguments[t++]:e.toleranceHigh,e.oCriticalityConfigValues)};var C=function(){var e=arguments[arguments.length-1];var t=1;return h(arguments[0],e.bIsRefValBinding?arguments[t++]:e.referenceValue,e.bIsDownDiffBinding?arguments[t++]:e.downDifference,e.bIsUpDiffBinding?arguments[t++]:e.upDifference)};var P=function(e){var t;var r=arguments[arguments.length-1],a=r&&r.propertyType;switch(a){case"yearmonth":var i=parseInt(e.substr(0,4),10),n=e.substr(4),o=parseInt(n,10)-1;t=u.getInstance(Date.UTC(i,o));break;case"yearquarter":var i=parseInt(e.substr(0,4),10),s=e.substr(4),l=parseInt(s,10)*3-2,o=l-1;t=u.getInstance(Date.UTC(i,o));break;case"yearweek":var i=parseInt(e.substr(0,4),10),f=e.substr(4),c=1+(parseInt(f,10)-1)*7;t=u.getInstance(Date.UTC(i,0,c));break;default:break}return t};var E=function(e,t){var r=l.parseJsonDateTime(e);return i.getInstance(t).format(u.getInstance(r),t.bUTC)};var w=function(e,r,a,i){var n;if(e){e.maxFractionDigits=e.numberOfFractionalDigits||0;e.minFractionDigits=e.numberOfFractionalDigits||0;e.style=e.style||"short";e.showScale=e.showScale||true;e.shortRefNumber=e.scaleFactor;n=t.getFloatInstance(e)}var o=[];if(!isNaN(parseFloat(a))&&n){o.push(n.format(a))}else{o.push(a)}if(!isNaN(parseFloat(i))&&n){o.push(n.format(i))}else{o.push(i)}var s="";if(r&&r.length){r.forEach(function(e){if(typeof e==="number"){s=s+o[e]}else{s=s+e}})}return s};var V=function(e,t){if(t==="state"){switch(String(e)){case"1":case"Error":return g.Error;case"2":case"Warning":return g.Warning;case"3":case"Success":return g.Success;case"4":case"Information":return g.Information;default:return g.None}}if(t==="color"){switch(String(e)){case"1":case"Error":return c.Error;case"2":case"Critical":return c.Critical;case"3":case"Good":return c.Good;case"4":case"Neutral":return c.Neutral;default:return c.None}}};var M=function(e,t){var r=this.getCard().getModel().getProperty("/content/d/results")||this.getCard().getModel().getProperty("/d/results")||[];return Math[t].apply(Math,r.map(function(t){return t[e]}))};var T=function(e,t,r){var a=1;var i=2;var n=4;for(var o in e){if(e.hasOwnProperty(o)){var s=e[o];if(s instanceof Date){s=s.toJSON()}else if(Array.isArray(s)||s&&typeof s==="object"){s=JSON.stringify(s)}else if(typeof s==="number"||typeof s==="boolean"){s=s.toString()}if(s===""){if(r&a){v.info("Semantic attribute "+o+" is an empty string and due to the chosen Suppression Behiavour is being ignored.");continue}}if(s===null){if(r&i){throw new v.error("NavigationHandler.INVALID_INPUT")}else{v.warning("Semantic attribute "+o+" is null and ignored for mix in to selection variant");continue}}if(s===undefined){if(r&n){throw new v.error("NavigationHandler.INVALID_INPUT")}else{v.warning("Semantic attribute "+o+" is undefined and ignored for mix in to selection variant");continue}}if(typeof s==="string"||s instanceof String){t.addSelectOption(o,"I","EQ",s)}else{throw new v.error("NavigationHandler.INVALID_INPUT")}}}return t};var x=function(e,t,a){var i=new r(t);var n=new r;if(i.getFilterContextUrl()){n.setFilterContextUrl(i.getFilterContextUrl())}if(i.getParameterContextUrl()){n.setParameterContextUrl(i.getParameterContextUrl())}if(Array.isArray(e)){e.forEach(function(e){T(e,n,a)})}else{T(e,n,a)}var o=i.getParameterNames();var s;for(s=0;s<o.length;s++){if(!n.getSelectOption(o[s])){n.addSelectOption(o[s],"I","EQ",i.getParameter(o[s]))}}var l=i.getSelectOptionsPropertyNames();for(s=0;s<l.length;s++){var f=i.getSelectOption(l[s]);if(!n.getSelectOption(l[s])){for(var u=0;u<f.length;u++){n.addSelectOption(l[s],f[u].Sign,f[u].Option,f[u].Low,f[u].High)}}}return n};function U(e){if(e){if(e.hasOwnProperty("SelectionVariantID")){delete e.SelectionVariantID}else if(e.hasOwnProperty("PresentationVariantID")){delete e.PresentationVariantID}delete e.Text;delete e.ODataFilterExpression;delete e.Version;delete e.FilterContextUrl;delete e.ParameterContextUrl;return e}return e}var H=function(e){try{if(JSON.parse(e)){return true}}catch(e){return false}};var A=function(e){var t=e&&e.length===1,r=e&&e[0];return t&&r["Option"]==="EQ"&&!r["High"]&&r["Low"]&&r["Sign"]==="I"};var L=function(e){var t=i.getDateInstance({pattern:"''yyyy-MM-dd'T'HH:mm:ss.SSS'Z'''",calendarType:"Gregorian"});if(e){var r=t.format(e,true);return String(r).replace(/'/g,"")}};var _=function(e){var t=i.getDateInstance({pattern:"''yyyy-MM-dd'T'HH:mm:ss.SSS''",calendarType:"Gregorian"});var r=e instanceof Date?e:u.getInstance(e);var a=t.format(r);return String(a).replace(/'/g,"")};var J=function(e,t,r){var a=[];if(e.operation==="DATE"&&e.value1){a=f.toDates({values:[e.value1],operator:e.operation})||[]}else{a=f.toDates({values:[],operator:e.operation})||[]}var i=a[0]&&a[0].oDate;var n=a[1]&&a[1].oDate;var o="",s="";if(e["sap:filter-restriction"]==="single-value"){if(e.type==="Edm.DateTime"&&i instanceof Date){o=_(i);if(o){t.massAddSelectOption(r,[{Sign:"I",Option:e.operator,Low:o,High:null}])}}else if(e.type==="Edm.String"){o=L(i);if(o){t.massAddSelectOption(r,[{Sign:"I",Option:e.operator,Low:o,High:null}])}}}else if(e["sap:filter-restriction"]==="interval"){if(e.type==="Edm.DateTime"){if(i instanceof Date){o=_(i)}if(n instanceof Date){s=_(n)}if(o&&s){t.massAddSelectOption(r,[{Sign:"I",Option:e.operator,Low:o,High:s}])}}else if(e.type==="Edm.String"){if(i instanceof Date){o=L(i)}if(n instanceof Date){s=L(n)}if(o&&s){t.massAddSelectOption(r,[{Sign:"I",Option:e.operator,Low:o,High:s}])}}}};function k(e,t){var a=this.getEventingParent().getManifest()["sap.card"],i=a&&a.configuration.parameters,n=new r,o=i._relevantODataFilters.value||[],s=i._mandatoryODataParameters.value||[],e=e&&JSON.parse(e)||{},l=e.parameters||{},f=l.ibnParams||{},u=f.sensitiveProps||{};var c={};s.forEach(function(e){var t=H(i[e].value);if(t&&!u[e]){var r=JSON.parse(i[e].value);if(r&&r.operation){J(r,n,e)}}});o.forEach(function(e){var t=H(i[e].value);if(t&&!u[e]){var r=JSON.parse(i[e].value);if(r&&r.operation){J(r,n,e)}else{var a=r.SelectOptions.Ranges||r.SelectOptions&&r.SelectOptions[0]&&r.SelectOptions[0].Ranges;if(a&&a.length){var o=A(a);if(o){f[e]=a[0].Low}else{if(f[e]&&!o){delete f[e]}n.massAddSelectOption(e,a)}}}}});var g=t||{};var m=Object.keys(g)||[];for(var v=0;v<m.length;v++){if(u&&u[m[v]]||m[v]==="__metadata"){delete g[m[v]]}}var p=x(g,n&&n.toJSONObject());p=U(p.toJSONObject());if(f.presentationVariant){c["presentationVariant"]=f.presentationVariant}if(p.Parameters.length||p.SelectOptions.length){c["selectionVariant"]=p}if(!l.ibnParams){l.ibnParams={}}if(c["selectionVariant"]||c["presentationVariant"]){l.ibnParams["sap-xapp-state-data"]=JSON.stringify(c)}if(f&&f.sensitiveProps){delete f.sensitiveProps}delete f.selectionVariant;delete f.presentationVariant;return e}return e.extend("sap.insights.CardExtension",{init:function(){e.prototype.init.apply(this,arguments);s.registerCustomFormatters();this.setFormatters({kpiformatter:N,formatHeaderUrl:S.bind(this),formatContentUrl:D.bind(this),returnPercentageChange:y,targetValueFormatter:I,kpiValueCriticality:O,formatValueColor:F,formatTrendIcon:C,formatDateValue:P,addPropertyValueToAppState:k.bind(this),formatDate:E,formatNumber:w,formatCriticality:V,getMinMax:M.bind(this)})}})});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/OVPChartFormatter", ["sap/viz/library","sap/viz/ui5/format/ChartFormatter","sap/viz/ui5/api/env/Format","sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/ui/core/date/UI5Date"],function(t,e,r,a,n,i){"use strict";var o=10;var s=[{prefix:"CURR",fn:f},{prefix:"axisFormatter",fn:u},{prefix:"0.0%",fn:m}];var c=["YearMonthDay","YearMonth","MMM","YearQuarter","Quarter","YearWeek","Week"];function f(t,e){var r;if(t===-1){r=a.getCurrencyInstance({style:"short",currencyCode:false})}else{r=a.getCurrencyInstance({style:"short",currencyCode:false,minFractionDigits:t,maxFractionDigits:t})}return r.format(Number(e))}function u(t,e){var r;if(t===-1){r=a.getFloatInstance({style:"short"})}else{r=a.getFloatInstance({style:"short",minFractionDigits:t,maxFractionDigits:t?t:1})}return r.format(Number(e))}function m(t,e){var r;if(t===-1){r=a.getPercentInstance({style:"short",minFractionDigits:1,maxFractionDigits:1})}else{r=a.getPercentInstance({style:"short",minFractionDigits:t,maxFractionDigits:t})}return r.format(Number(e))}function g(t,e){if(e.constructor===Date){var r=n.getDateTimeInstance({pattern:t});if(t==="YearMonthDay"){r=n.getDateInstance({style:"medium"})}if(t==="YearMonth"||t==="MMM"){r=n.getDateTimeInstance({format:"MMM"})}if(t==="YearQuarter"||t==="Quarter"){r=n.getDateTimeInstance({format:"QQQ"})}if(t==="YearWeek"||t==="Week"){r=n.getDateTimeInstance({format:"www"})}e=r.format(i.getInstance(e),true)}return e}return{registerCustomFormatters:function(){var t=e.getInstance();var a=[];s.forEach(function(t){a.push({name:t.prefix,fn:t.fn.bind(null,2)});for(var e=-1;e<=o;e++){var r="/"+e+"/";a.push({name:t.prefix+r,fn:t.fn.bind(null,e)})}});c.forEach(function(t){a.push({name:t,fn:g.bind(null,t)})});a.forEach(function(e){t.registerCustomFormatter(e.name,e.fn)});r.numericFormatter(t)}}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 * This extension is for OVP Analytical cards delivered in 2208.
 */
sap.ui.predefine("sap/insights/base/InMemoryCachingHost", ["sap/ui/integration/Host"],function(t){"use strict";var e={};var n={};return t.extend("sap.insights.InMemoryCachingHost",{clearCache:function(t){if(t){e[t]=n[t]={}}else{e=n={}}},_fetchData:function(n,r,i,a){return t.prototype.fetch.call(this,n,r,i).then(function(t){e[a][n]=t;return e[a][n]}).catch(function(t){var r={error:t.toString()};var i=new Response(JSON.stringify(r),{headers:{"Content-Type":"application/json"}});e[a][n]=i;return e[a][n]})},_isCSRFFetchCall:function(t){return t.method==="HEAD"},fetch:function(r,i,a,s){var c=s.getManifestEntry("sap.app").id;e[c]=e[c]?e[c]:{};n[c]=n[c]?n[c]:{};if(this._isCSRFFetchCall(a)){return t.prototype.fetch.call(this,r,i,a)}else if(!e[c][r]&&!n[c][r]){n[c][r]=this._fetchData(r,i,a,c);return n[c][r]}else if(!e[c][r]&&n[c][r]){return n[c][r]}else{return new Promise(function(t){t(e[c][r])})}}})});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/library", ["sap/ui/core/Lib","sap/ui/core/library"],function(s){"use strict";var e=s.init({name:"sap.insights",dependencies:["sap.m","sap.f","sap.ui.core","sap.ushell"],types:[],interfaces:[],controls:["sap.insights.ManageCards"],elements:[],version:"1.120.10",extensions:{}});return e});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/manageCardPreview/ColumnListPreview", ["sap/ui/core/Control","sap/m/Label","sap/m/Title","sap/m/Text","sap/m/VBox","sap/m/Page","sap/m/FlexBox","sap/m/ScrollContainer","sap/m/Toolbar","sap/m/HBox","sap/ui/integration/widgets/Card","sap/m/Panel","sap/m/Button","../utils/CardPreviewManager","sap/ui/model/resource/ResourceModel","../utils/DeviceType","sap/ui/Device","sap/m/Table","sap/m/SearchField","sap/m/Column","sap/ui/core/dnd/DragInfo","sap/ui/core/dnd/DropInfo","sap/ui/core/Icon","sap/m/ColumnListItem","sap/m/CheckBox","sap/m/ObjectIdentifier","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","../utils/Transformations","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","../base/InMemoryCachingHost","../utils/AppConstants","sap/ui/core/Element","sap/ui/core/Lib"],function(e,t,i,s,o,n,a,r,l,d,h,C,u,g,m,p,w,c,v,f,b,S,P,B,T,x,I,y,D,V,_,E,L,M,O,A){var F=A.getResourceBundleFor("sap.insights");var N=e.extend("sap.insights.manageCardPreview.ColumnListPreview",{metadata:{properties:{manifest:{type:"string",group:"Behavior",defaultValue:""},dialogTitle:{type:"string",defaultValue:""}},aggregations:{_page:{type:"sap.m.Page",multiple:false,visibility:"hidden"}},events:{enableAddButton:{parameters:{enableButton:{type:"boolean"}}}}},renderer:{render:function(e,t){e.openStart("div",t);e.style("height","100%");e.style("width","100%");e.openEnd();e.renderControl(t.getAggregation("_page"));e.close("div")}}});N.prototype.init=function(){this.i18Bundle=new m({bundle:F}).getResourceBundle();this._innerModel=new E;this.setModel(this._innerModel);w.resize.attachHandler(this._adjustLayoutStyles.bind(this));this.oCardColumnPage=new n(this.getId()+"--insightCardColumnPage",{title:this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE"),titleLevel:"H1",showHeader:true,showSubHeader:true,backgroundDesign:"List",enableScrolling:false,headerContent:[],content:[]});this.setAggregation("_page",this.oCardColumnPage);this.host=new L(this.getId()+"--transactionalCardHost",{action:function(e){var t=e.getParameter("card")||{};this.oConfCard=t.getManifest()}.bind(this)});this.createStaticControls();this.oCardColumnPage.addHeaderContent(this.oCardPreviewBtn);this.oCardColumnPage.addHeaderContent(this.oHideCardPreviewBtn);this.oCardColumnPage.addContent(this.oFlexContainerColumnContent)};N.prototype.onBeforeRendering=function(){this.oManifest=this.getManifest();if(this.oManifest){this.oManifest=JSON.parse(this.oManifest)}this._initConfigureCard(this.oManifest);this._adjustLayoutStyles();this.oInsightsColCardLayer.setVisible(this.oManifest["sap.card"].type==="Analytical"?false:true);this.oInsightsColCardLayerSD.setVisible(this.oManifest["sap.card"].type==="Analytical"?false:true)};N.prototype.createStaticControls=function(){this.oCardPreviewBtn=new u(this.getId()+"--cardPreviewId",{text:this.i18Bundle.getText("INT_DIALOG_CardPreview"),press:this._callPreview.bind(this),enabled:true});this.oHideCardPreviewBtn=new u(this.getId()+"--hideCardPreviewId",{text:this.i18Bundle.getText("INT_DIALOG_HidePreview"),press:this._callClosePreview.bind(this),enabled:true});this.oDefaultTitle=new i(this.getId()+"--defaultTitle",{text:this.i18Bundle.getText("INT_COLUMN_TITLE"),level:"H4"});this.oDefaultSubText=new s(this.getId()+"--defaultSubText",{text:this.i18Bundle.getText("INT_COLUMN_SUBTITLE")});this.oInsightsColumnEditVBox=new o(this.getId()+"--insightsColumnEditVBox",{direction:"Column",items:[this.oDefaultTitle,this.oDefaultSubText]}).addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginTop sapUiTinyMarginBottom");this.oColumnSearch=new v(this.getId()+"--columnSearch",{placeholder:this.i18Bundle.getText("INT_COL_SEARCH"),liveChange:this._onColumnSearch.bind(this)}).addStyleClass("sapUiTinyMarginBottom");this.oColumnSearchVBox=new o(this.getId()+"--columnSearchVBox",{renderType:"Bare",items:[this.oColumnSearch]});this.oEditColumnsTableCheckBox=new f(this.getId()+"--editColumnsTableCheckBox",{hAlign:"Center"});this.oEditColumnsName=new f(this.getId()+"--editColumnsName",{});this.oColumnDrag=new b(this.getId()+"--idColumnDrag",{groupName:"editColumns",sourceAggregation:"items"});this.oColumnDrop=new S(this.getId()+"--idColumnDrop",{groupName:"editColumns",targetAggregation:"items",dropPosition:"On",drop:this._onColumnDrop.bind(this)});this.oInsightsCardsEditColumnsListTable=new c(this.getId()+"--insightsCardsEditColumnsListTable",{fixedLayout:"true",columns:[this.oEditColumnsTableCheckBox,this.oEditColumnsName],dragDropConfig:[this.oColumnDrag,this.oColumnDrop]}).addStyleClass("sapContrastPlus");this.oEditColumnsScrollContainer=new r(this.getId()+"--idEditColumnsScrollContainer",{vertical:true,horizontal:false,height:"90%",width:"100%",content:[this.oInsightsCardsEditColumnsListTable]});this.oInsightsColumnEditFlexBox=new a(this.getId()+"--insightsColumnEditFlexBox",{height:"92%",width:"95%",direction:"Column",renderType:"Bare",items:[this.oColumnSearchVBox,this.oEditColumnsScrollContainer]}).addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd");this.oLabelColLayout=new t(this.getId()+"--labelColLayout",{text:this.i18Bundle.getText("INT_COL_LAYOUT")});this.oListViewSD=new y(this.getId()+"--idListViewSD",{icon:"sap-icon://list",key:"List"});this.oTableViewSD=new y(this.getId()+"--idTableViewSD",{icon:"sap-icon://table-view",key:"Table"});this.oSdColumnSegButton=new I(this.getId()+"--sdColumnSegButton",{width:"3.75rem",selectionChange:this._onSegmentedSelectionChange.bind(this),tooltip:this.i18Bundle.getText("INT_LAYOUT_TOOLTIP"),items:[this.oListViewSD,this.oTableViewSD]});this.oPreviewVBoxSD=new o(this.getId()+"--previewVBoxSD",{direction:"Column",height:"4rem",backgroundDesign:"Solid",items:[this.oLabelColLayout,this.oSdColumnSegButton]}).addStyleClass("sapUiSmallMarginBegin sapUiTinyMarginTop");this.oPreviewColCardSD=new h(this.getId()+"--previewColCardSD",{manifestApplied:this._setPreviewCardAriaText.bind(this,this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview")),width:"19rem",height:"32rem",host:this.host}).addStyleClass("sapUiTinyMarginBeginEnd sapUiTinyMarginTopBottom");this.oInsightsColOverflowInnerHBoxSD=new d(this.getId()+"--insightsColOverflowInnerHBoxSD",{}).addStyleClass("insightsCardOverflowLayer insightsPreviewCardOverLay insightsColOverLayPositionSD");this.oInsightsColCardLayerSD=new d(this.getId()+"--insightsColCardLayerSD",{height:"0",items:[this.oInsightsColOverflowInnerHBoxSD]}).addStyleClass("sapMFlexBoxJustifyCenter");this.oColCardsScrollSD=new r(this.getId()+"--colCardsScrollSD",{vertical:true,horizontal:false,height:"100%",content:[this.oPreviewColCardSD,this.oInsightsColCardLayerSD]});this.oPreviewColCardVBox=new o(this.getId()+"--previewColCardVBox",{width:"100%",height:"calc(100% - 4rem)",alignItems:"Center",backgroundDesign:"Solid",justifyContent:"SpaceAround",items:[this.oColCardsScrollSD]});this.oPreviewColCardFlex=new a(this.getId()+"--previewColCardFlex",{direction:"Column",height:"100%",width:"100%",items:[this.oPreviewVBoxSD,this.oPreviewColCardVBox]});this.oEditColumnInsightsCardsFlex=new a(this.getId()+"--editColumnInsightsCardsFlex",{height:"100%",width:"62%",direction:"Column",items:[this.oInsightsColumnEditVBox,this.oInsightsColumnEditFlexBox,this.oPreviewColCardFlex]});this.oInsightPreviewText=new i(this.getId()+"--insightPreviewText",{text:this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview"),textAlign:"Left"}).addStyleClass("sapUiTinyMarginTop sapUiSmallMarginEnd");this.oListViewLD=new y(this.getId()+"--idListViewLD",{icon:"sap-icon://list",key:"List"});this.oTableViewLD=new y(this.getId()+"--idTableViewLD",{icon:"sap-icon://table-view",key:"Table"});this.oColumnSegButton=new I(this.getId()+"--columnSegButton",{width:"3.75rem",selectionChange:this._onSegmentedSelectionChange.bind(this),tooltip:this.i18Bundle.getText("INT_LAYOUT_TOOLTIP"),items:[this.oListViewLD,this.oTableViewLD]});this.oPreviewTextHBox=new d(this.getId()+"--idPreviewTextHBox",{width:"100%",justifyContent:"Start",backgroundDesign:"Transparent",renderType:"Bare",items:[this.oInsightPreviewText,this.oColumnSegButton]});this.oPreviewPanelToolBar=new l(this.getId()+"--previewPanelToolBar",{style:"Clear",design:"Auto",content:[this.oPreviewTextHBox]}).addStyleClass("sapThemeBaseBG");this.oPreviewCard=new h(this.getId()+"--previewCard",{manifestApplied:this._setPreviewCardAriaText.bind(this,this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview")),width:"19rem",height:"35rem",host:this.host}).addStyleClass("sapMFlexBoxJustifyCenter");this.oInsightsColOverflowInnerHBox=new d(this.getId()+"--insightsColOverflowInnerHBox",{}).addStyleClass("insightsCardOverflowLayer insightsPreviewCardOverLay insightsColOverLayPositionLS");this.oInsightsColCardLayer=new d(this.getId()+"--insightsColCardLayer",{height:"0",items:[this.oInsightsColOverflowInnerHBox]}).addStyleClass("insightsCardOverflowLayer insightsPreviewCardOverLay");this.oCardsPreviewVBox=new o(this.getId()+"--idCardsPreviewVBox",{height:"100%",alignItems:"Center",backgroundDesign:"Transparent",justifyContent:"SpaceAround",items:[this.oPreviewCard,this.oInsightsColCardLayer]});this.oPreviewPanelContainer=new C(this.getId()+"--previewPanelContainer",{expanded:false,height:"100%",backgroundDesign:"Transparent",headerToolbar:[this.oPreviewPanelToolBar],content:[this.oCardsPreviewVBox]});this.oColCardsScroll=new r(this.getId()+"--colCardsScroll",{vertical:true,horizontal:false,height:"100%",content:[this.oPreviewPanelContainer]});this.oColumnPreviewCardFlexbox=new a(this.getId()+"--columnPreviewCardFlexbox",{direction:"Column",width:"38%",height:"100%",renderType:"Bare",items:[this.oColCardsScroll]}).addStyleClass("sapMPageBgStandard");this.oFlexContainerColumnContent=new o(this.getId()+"--flexContainerColumnContent",{height:"100%",width:"100%",direction:"Row",justifyContent:"SpaceBetween",items:[this.oEditColumnInsightsCardsFlex,this.oColumnPreviewCardFlexbox]})};N.prototype._setPreviewCardAriaText=function(e,t){var i=t.getSource()._ariaText.getText();var s=this.i18Bundle.getText(e);t.getSource()._ariaText.setText(s+i)};N.prototype._callPreview=function(){var e,t;t=p.getDialogBasedDevice()!==M.DEVICE_TYPES.Desktop;if(t){this.bShowPreview=true;this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(true);this.oPreviewColCardVBox.setVisible(true);this.oPreviewColCardFlex.setVisible(true);this.oInsightsColumnEditFlexBox.setVisible(false);this.oColumnPreviewCardFlexbox.setVisible(false);this.oInsightsColumnEditVBox.setVisible(false);e=t?this.oPreviewColCardSD:this.oPreviewCard}if(e){e.refresh()}};N.prototype._callClosePreview=function(){this.bShowPreview=false;this.oHideCardPreviewBtn.setVisible(false);this.oCardPreviewBtn.setVisible(true);this.oPreviewColCardFlex.setVisible(false);this.oInsightsColumnEditFlexBox.setVisible(true);this.oColumnPreviewCardFlexbox.setVisible(false);this.oInsightsColumnEditVBox.setVisible(true)};N.prototype._onColumnSearch=function(e){var t="";if(e){t=e.getSource().getValue()}var i=new V("title",_.Contains,t);var s=[];s.push(i);var o=this.oInsightsCardsEditColumnsListTable;var n=o.getBinding("items");n.filter(s,"Application")};N.prototype._refreshShowPreview=function(){this.bShowPreview=true;var e=p.getDialogBasedDevice()===M.DEVICE_TYPES.Desktop;var t=e?this.oPreviewCard:this.oPreviewColCardSD;if(t){t.refresh()}};N.prototype._onColumnDrop=function(e){var t=e.getParameter("dropPosition"),i=e.getParameter("draggedControl"),s=i.getBindingContextPath().split("/"),o=Number(s[2]),n=e.getParameter("droppedControl"),a=n.getBindingContextPath().split("/"),r=Number(a[2]),l=this.cardColumn;if(t==="Before"&&o===r-1){r--}else if(t==="After"&&o===r+1){r++}if(o!==r){if(t==="Before"&&o<r){r--}else if(t==="After"&&o>r){r++}var d=l.splice(o,1)[0];l.splice(r,0,d);this.cardColumn=l;this._innerModel.setProperty("/cardColumn",this.cardColumn);if(p.getDialogBasedDevice()===M.DEVICE_TYPES.Desktop){this._refreshShowPreview()}}};N.prototype._handleColumnVisibilityToggle=function(e){var t=e.getSource();this.sColumnPath=t.getBindingContext().getPath();var i=this._innerModel.getProperty(this.sColumnPath);var s=t.getSelected();i["visible"]=s;var o=this.iVisibleColumnCount;this.iVisibleColumnCount=s?o+1:o-1;if(this.oConfCard["sap.card"].content.row){this.oConfCard["sap.card"].content.row.columns=this.cardColumn}else{this.oConfCard["sap.card"].content.item.attributes=this.cardColumn}this._innerModel.setProperty("/visibleColumnCount",this.iVisibleColumnCount);if(this.iVisibleColumnCount>0){this.fireEnableAddButton({enableButton:true})}else{this.fireEnableAddButton({enableButton:false})}if(p.getDialogBasedDevice()===M.DEVICE_TYPES.Desktop){this.oPreviewCard.setPreviewMode(this.iVisibleColumnCount>0?"Off":"Abstract");this._refreshShowPreview()}else{this.oPreviewColCardSD.setPreviewMode(this.iVisibleColumnCount>0?"Off":"Abstract")}};N.prototype._onSegmentedSelectionChange=function(){var e=p.getDialogBasedDevice()===M.DEVICE_TYPES.Desktop?this.oColumnSegButton:this.oSdColumnSegButton,t=e.getSelectedKey();if(t==="Table"){var i=D.createListOptions(this.oConfCard);var s=i.filter(function(e){if(e){return e["sap.card"].type==="Table"}});if(s.length){this.oConfCard=s[0];var o=s[0]["sap.card"].content.row.columns;this.cardColumn=o}}else if(t==="List"){var n=D.createTableOptions(this.oConfCard);var a=n.filter(function(e){if(e){return e["sap.card"].type==="List"}});if(a.length){this.oConfCard=a[0];var r=a[0]["sap.card"].content.item.attributes;this.cardColumn=r}}this._innerModel.setProperty("/cardColumn",this.cardColumn);var l=p.getDialogBasedDevice()===M.DEVICE_TYPES.Desktop;var d=l?this.oPreviewCard:this.oPreviewColCardSD;if(d){d.setManifest(this.oConfCard)}};N.prototype._setCardColumnValue=function(e){var t=e["sap.card"];if(t.type==="Table"){var i;i=t.content.row.columns;this.cardColumn=i;var s=i.map(function(e){e["visible"]=e["visible"]?e["visible"]:false;return e}).filter(function(e){return e.visible});this.iVisibleColumnCount=s.length;this._innerModel.setProperty("/visibleColumnCount",this.iVisibleColumnCount);var o=D.createTableOptions(this.oConfCard);var n=o.filter(function(e){return e["sap.card"].type==="List"});if(n.length){this.oConfCard=n[0];var a=n[0]["sap.card"].content.item.attributes;this.cardColumn=a}this._innerModel.setProperty("/cardColumn",this.cardColumn);this.oInsightsCardsEditColumnsListTable.bindAggregation("items",{path:"/cardColumn",factory:this._generateTableColumnsTemplate.bind(this)})}};N.prototype._generateTableColumnsTemplate=function(){var e=new B({});var t=new d({items:[new P({src:"sap-icon://BusinessSuiteInAppSymbols/icon-grip"}).addStyleClass("compositeDndIcon"),new T({selected:"{= ${visible} ? true : false}",enabled:"{= !(!${visible} && (${/visibleColumnCount} > 2)) ? true : false}",select:this._handleColumnVisibilityToggle.bind(this)})]}).addStyleClass("sapUiNoPadding");var i=new x({title:"{title}",tooltip:"{title}"}).addStyleClass("sapUiNoPadding");e.addCell(t);e.addCell(i);return e};N.prototype._adjustLayoutStyles=function(){if(p.getDialogBasedDevice()!==M.DEVICE_TYPES.Desktop){this.bDesktop=false;if(this.bShowPreview===true){this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(true);this.oPreviewColCardFlex.setVisible(true);this.oInsightsColumnEditFlexBox.setVisible(false);this.oInsightsColumnEditVBox.setVisible(false)}else{this.oCardPreviewBtn.setVisible(true);this.oHideCardPreviewBtn.setVisible(false);this.oPreviewColCardFlex.setVisible(false);this.oInsightsColumnEditFlexBox.setVisible(true);this.oInsightsColumnEditVBox.setVisible(true);this.oEditColumnInsightsCardsFlex.setWidth("100%")}this.oColumnPreviewCardFlexbox.setVisible(false);this.oPreviewColCardSD.setManifest(this.oConfCard);this.oColumnSearch.setWidth("90%");this.oEditColumnsTableCheckBox.setWidth("20%");this.oEditColumnsName.setWidth("80%");this.oSdColumnSegButton.setSelectedKey(this.oConfCard["sap.card"].type);this.oPreviewColCardSD.refresh()}else{this.bDesktop=true;this.oColumnSearch.setWidth("100%");this.oEditColumnsTableCheckBox.setWidth("10%");this.oEditColumnsName.setWidth("90%");this.oPreviewCard.setManifest(this.oConfCard);this.oColumnSegButton.setSelectedKey(this.oConfCard["sap.card"].type);this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(false);this.oPreviewColCardFlex.setVisible(false);this.oInsightsColumnEditVBox.setVisible(true);this.oInsightsColumnEditFlexBox.setVisible(true);this.oColumnPreviewCardFlexbox.setVisible(true);this.oPreviewCard.refresh()}var e=!this.bDesktop&&this.bShowPreview;this.oPreviewColCardVBox.setVisible(e?true:false);this.oPreviewColCardFlex.setVisible(e?true:false);this.oCardColumnPage.setTitle(this.getDialogTitle())};N.prototype._initConfigureCard=function(e){var t=e,i;var s=O.getElementById("myhomeSettingsView--INSIGHTS_CARDS");this.oOrgCard=t;i=JSON.parse(JSON.stringify(t));i=g.getCardPreviewManifest(i);this.oConfCard=i;this.iVisibleColumnCount=this.iVisibleColumnCount?this.iVisibleColumnCount:0;if(i){var o=i["sap.card"];if(o.type==="Table"){var n=p.getDialogBasedDevice()===M.DEVICE_TYPES.Desktop?this.oColumnSegButton:this.oSdColumnSegButton;n.setSelectedKey(this.oManifest["sap.card"].type);this._setCardColumnValue(i,s)}}};return N});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/manageCardPreview/HouseOfCards", ["sap/ui/core/Control","sap/ui/core/Item","sap/ui/core/Icon","sap/m/Title","sap/m/Text","sap/m/VBox","sap/m/Page","sap/m/FlexBox","sap/m/ComboBox","sap/m/ScrollContainer","sap/m/Toolbar","sap/m/HBox","sap/m/Panel","sap/m/Button","sap/m/Table","sap/m/Column","sap/m/ColumnListItem","sap/m/ObjectIdentifier","sap/m/SearchField","sap/ui/Device","sap/ui/integration/widgets/Card","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","../utils/CardPreviewManager","../utils/DeviceType","../utils/AppConstants","../utils/Transformations","sap/ui/core/Lib"],function(e,t,i,o,r,a,s,n,h,l,d,c,C,p,g,_,f,u,y,v,w,P,T,m,S,b,H,x,M,B){var I=B.getResourceBundleFor("sap.insights");var D=e.extend("sap.insights.manageCardPreview.HouseOfCards",{metadata:{properties:{manifest:{type:"string",group:"Behavior",defaultValue:""},dialogTitle:{type:"string",defaultValue:""}},aggregations:{_page:{type:"sap.m.Page",multiple:false,visibility:"hidden"}}},renderer:{render:function(e,t){e.openStart("div",t);e.style("height","100%");e.style("width","100%");e.openEnd();e.renderControl(t.getAggregation("_page"));e.close("div")}}});D.prototype.init=function(){this.i18Bundle=new S({bundle:I}).getResourceBundle();this._innerHocModel=new m;if(this._bDesktop){this._bShowPreview=true}else{this._bShowPreview=false}this._createHocFlex();v.resize.attachHandler(this._adjustLayoutStyles.bind(this));this._oPreviewButton=new p({text:this.i18Bundle.getText("INT_DIALOG_CardPreview"),press:this._callPreview.bind(this)});this._oHidePreviewButton=new p({text:this.i18Bundle.getText("INT_DIALOG_HidePreview"),press:this._callClosePreview.bind(this)});var e=H.getDialogBasedDevice();this._bDesktop=e===x.DEVICE_TYPES.Desktop;this.oParentPage=new s(this.getId()+"--insightHouseOfCardPage",{title:this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE"),titleLevel:"H1",showHeader:true,showSubHeader:true,backgroundDesign:"List",enableScrolling:false,headerContent:[this._oPreviewButton,this._oHidePreviewButton],content:[new a(this.getId()+"--hocbox1",{height:"100%",width:"100%",direction:"Row",justifyContent:"SpaceBetween",items:[this._oHocflexbox1,this._oHocflexbox2]})]});this._innerHocModel.setData({oSelected:{},aCards:[],aPreviewCards:[1,2,3],aAllowedChartTypes:[],sOriginalChartType:"",selectedPath:""});this._oConfCard=null;this.oParentPage.setModel(this._innerHocModel,"hocModel");this.setAggregation("_page",this.oParentPage)};D.prototype.onBeforeRendering=function(){this._oManifest=this.getManifest();if(this._oManifest){this._oManifest=JSON.parse(this._oManifest)}this._oConfCard=this._oManifest;this._innerHocModel.setProperty("/oSelected",this._oManifest);this._oHocChartCombo.bindAggregation("items",{path:"hocModel>/aPreviewCards",template:new t({key:"{hocModel>sap.card/content/chartType}",text:{parts:[{path:"hocModel>sap.card/content/chartType"},{value:"title"}],formatter:this._setChartDetail}})});this._oCardsTypeTable.bindAggregation("items",{path:"hocModel>/aPreviewCards",template:new f({type:"Active",selected:"{= ${hocModel>sap.card/content/chartType} ===   ${hocModel>/oSelected/sap.card/content/chartType} ? true : false}",cells:[new c({items:[new i({src:{parts:[{path:"hocModel>sap.card/content/chartType"},{value:"icon"}],formatter:this._setChartDetail}})]}).addStyleClass("sapUiNoPadding"),new u({title:{parts:[{path:"hocModel>sap.card/content/chartType"},{value:"title"}],formatter:this._setChartDetail},tooltip:"{hocModel>sap.card/content/chartType}"}).addStyleClass("sapUiNoPadding")]})});this._oCardContainer.bindAggregation("items",{path:"hocModel>/aPreviewCards",template:new w({width:"17rem",height:"29.5rem",manifest:"{= ${hocModel>}}",host:"HouseOfCardsHost",manifestReady:this._onCardRender.bind(this)}).addStyleClass("sapUiSmallMarginBegin sapUiTinyMarginTopBottom")});this._adjustLayoutStyles()};D.prototype._createHocFlex=function(){this._oCardContainer=new a("CardContainer",{fitContainer:true,alignItems:"Start",justifyContent:"Start",renderType:"Bare",alignContent:"Start",wrap:"Wrap",width:"100%",direction:"Row"});this._oHoCScrollContainer=new l("idHoCScrollContainer",{vertical:true,horizontal:false,height:"100%",width:"100%",content:[this._oCardContainer]});this._oHocChartCombo=new h("hocChartCombo",{ariaLabelledBy:"previewChartInfoTitle previewChartInfoSubTitle hocChartCombo",maxWidth:"33%",selectionChange:this._onSelectionChange.bind(this)}).addStyleClass("sapUiSmallMarginBegin sapUiTinyMarginTopBottom");this._oCardContainerFlex=new n(this.getId()+"--cardContainerFlex",{renderType:"Bare",height:"100%",direction:"Column",items:[new a("chartSelectVBox",{direction:"Column",items:[new o("previewChartInfoTitle",{text:this.i18Bundle.getText("INT_CHART_TITLE"),level:"H4"}).addStyleClass("sapUiSmallMarginTop"),new r("previewChartInfoSubTitle",{text:this.i18Bundle.getText("INT_CHART_SUBTITLE")})]}).addStyleClass("sapUiSmallMarginBegin"),new n("hocflexbox3",{height:"calc(100% - 4rem)",width:"100%",visible:this._bDesktop,direction:"Column",renderType:"Bare",items:[this._oHocChartCombo,this._oHoCScrollContainer]})]});this._oCardsTypeTable=new g("insightsCardsTypeTable",{width:"90%",fixedLayout:true,mode:"SingleSelectMaster",itemPress:this._onChartTypePress.bind(this),columns:[new _("chartIconColumn",{hAlign:"Center",width:"10%"}),new _("chartTypeNameColumn",{width:"90%"})]}).addStyleClass("sapContrastPlus sapUiSmallMarginBeginEnd");this._oChartTypeSearch=new y("chartTypeSearch",{ariaLabelledBy:"previewChartInfoTitle previewChartInfoSubTitle chartTypeSearch",placeholder:this.i18Bundle.getText("INT_CHART_SEARCH"),width:"90%",liveChange:this._onChartTypeSearch.bind(this)}).addStyleClass("sapUiSmallMarginBegin");this._oPreviewPanelCardContainer=new n("previewPanelCardContainer",{height:"100%",width:"100%",direction:"Column",renderType:"Bare",items:[this._oChartTypeSearch,new l("insightsCardsTypeScroll",{vertical:true,horizontal:false,height:"94%",width:"100%",content:[this._oCardsTypeTable]}).addStyleClass("sapUiTinyMarginTop")]});this._oPreviewCardHoCSD=new w("previewCardHoCSD",{manifest:"{hocModel>/oSelected}",width:"19rem",height:"33rem"}).addStyleClass("sapUiTinyMarginBeginEnd");this._oPreviewCardHoCVBox=new a("previewCardHoCVBox",{height:"100%",width:"100%",alignItems:"Center",backgroundDesign:"Solid",items:[this._oPreviewCardHoCSD]}).addStyleClass("sapUiSmallMarginTop sapUiTinyMarginBottom");this._oPanelFlexHoC=new n("panelFlexHoC",{height:"100%",width:"100%",renderType:"Bare",justifyContent:"Center",items:[new l("hoCCardsScrollSD",{vertical:true,horizontal:false,height:"100%",content:[this._oPreviewCardHoCVBox]})]});this._oPanelFlexCard=new n(this.getId()+"--panelFlexCard",{width:"100%",height:"calc(100% - 3rem)",direction:"Column",renderType:"Bare",items:[this._oPreviewPanelCardContainer,this._oPanelFlexHoC]});this._oPreviewCardHoC=new w("previewCardHoC",{manifest:"{ path: 'hocModel>/oSelected', mode: 'TwoWay' }",manifestApplied:this._setPreviewCardAriaText.bind(this),host:"HouseOfCardsHost",width:"19rem",height:"33rem"});var e=new C("hocPreviewPanelContainer",{expanded:false,height:"100%",backgroundDesign:"Transparent",headerToolbar:[new d("hocPreviewToolBar",{width:"100%",height:"2.7rem",style:"Clear",design:"Auto",content:[new c("hocPreviewCardTextHBox",{width:"100%",justifyContent:"Start",backgroundDesign:"Transparent",items:[new o("hocInsightPreviewCardText",{text:this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview"),textAlign:"Left"}).addStyleClass("sapUiTinyMarginTop")]})]}).addStyleClass("sapThemeBaseBG")],content:[new a("hocCardsPreviewVBox1",{height:"calc(100% - 2.8rem)",alignItems:"Center",backgroundDesign:"Transparent",justifyContent:"SpaceAround",items:[this._oPreviewCardHoC]})]});this._oHocflexbox1=new n(this.getId()+"--hocflexbox1",{height:"100%",width:"100%",direction:"Column",justifyContent:"Center",items:[this._oCardContainerFlex,this._oPanelFlexCard]});this._oHocflexbox2=new n("hocflexbox2",{direction:"Column",width:"38%",height:"100%",renderType:"Bare",fitContainer:true,items:[new l("hoCCardsScroll",{vertical:true,horizontal:false,height:"100%",content:[e]})]}).addStyleClass("sapMPageBgStandard")};D.prototype._onChartTypeSearch=function(e){var t="";if(e){t=e.getSource().getValue()}var i=new P("sap.card/content/chartType",T.Contains,t);var o=[];o.push(i);var r=this._oCardsTypeTable.getBinding("items");if(r){r.filter(o,"Application")}};D.prototype._setChartDetail=function(e,t){var i=x.CHART_TYPE_DETAILS;if(t==="icon"&&e){return i[e]?i[e].icon:i["default"].icon}if(t==="title"&&e){return i[e]?i[e].title:e.replaceAll("_"," ")}};D.prototype._setPreviewCardAriaText=function(e){var t=e.getSource()._ariaText.getText();var i=this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview");e.getSource()._ariaText.setText(i+t)};D.prototype._onSelectionChange=function(e){var t=e.getParameters();var i=t.selectedItem;var o=i&&i.getBindingContext("hocModel").getPath();this._onClickFunction(null,o)};D.prototype._onCardLoadFailure=function(e){var t=this._oCardContainer.removeItem(e.sId);if(t){t.destroy()}};D.prototype._onCardStateChanged=function(e){var t=e.getAggregation("_content")&&e.getAggregation("_content").getAggregation("_content");if(t&&t.attachRenderComplete){t.attachRenderComplete(function(t){var i=t.getSource()._errorType;if(i){var o=this._oCardContainer.removeItem(e.sId);if(o){o.destroy()}}}.bind(this))}var i=e.getManifest()["sap.card"].content.chartType;var o=this._innerHocModel.getProperty("/sOriginalChartType");if(!b.hasVizData(e)&&i!==o){var r=this._innerHocModel.getProperty("/aPreviewCards");var a=r.findIndex(function(e){return e["sap.card"].content.chartType===i});if(a>-1){var s=this._oCardContainer.removeItem(a);if(s){s.destroy()}r.splice(a,1);this._innerHocModel.setProperty("/aPreviewCards",r)}}};D.prototype._callPreview=function(){var e=this._bDesktop?this._oPreviewCardHoC:this._oPreviewCardHoCSD;this._bShowPreview=true;if(e){e.refresh()}this._adjustLayoutStyles()};D.prototype._callClosePreview=function(){this._bShowPreview=false;this._adjustLayoutStyles()};D.prototype._setFocusOnElement=function(){if(this._bDesktop){this._oHocChartCombo.focus()}else{this._oChartTypeSearch.focus()}};D.prototype._onCardRender=function(e){var t=e.getSource();t.attachManifestApplied(function(e){var t=e.getSource();var i=this._oCardContainer.getItems();i.forEach(function(e){if(e.getBindingContext("hocModel")){var i=e.getBindingContext("hocModel").getPath();if(this._innerHocModel.getProperty("/selectedPath")===i&&e.sId===t.sId){e.addStyleClass("sapThemeHighlight-asBorderColor");e.focus()}}}.bind(this));if(t.getCardHeader()){var o=t.getCardHeader();o.addStyleClass("sapFCardHeaderToolbarFocused")}t.attachEvent("_error",this._onCardLoadFailure.bind(this,t));t.attachEvent("stateChanged",this._onCardStateChanged.bind(this,t))}.bind(this));var i=t.getDomRef();i.removeEventListener("click",this._onClickFunction.bind(this,t));i.addEventListener("click",this._onClickFunction.bind(this,t),{capture:true})};D.prototype._onClickFunction=function(e,t){var i;var o=this._oCardContainer.getItems();var r=this._innerHocModel.getProperty("/selectedPath");o.forEach(function(o){if(o.getBindingContext("hocModel")){var a=o.getBindingContext("hocModel").getPath();if(t&&!e&&a===t){e=o}if(a===r&&r!==t){i=o}}});if(this._oCardContainer.getItems()[0].hasStyleClass("sapThemeHighlight-asBorderColor")){this._oCardContainer.getItems()[0].removeStyleClass("sapThemeHighlight-asBorderColor")}else if(i){i.removeStyleClass("sapThemeHighlight-asBorderColor")}if(e){setTimeout(function(){e.addStyleClass("sapThemeHighlight-asBorderColor")},0);this._oHoCScrollContainer.scrollToElement(e);e.focus();var a=e.getBindingContext("hocModel").getPath();this._innerHocModel.setProperty("/selectedPath",a);var s=a.split("/");var n=s[s.length-1];var h=this._innerHocModel.getProperty("/aCards/"+n);this._innerHocModel.setProperty("/oSelected",e.getManifest());if(this._oConfCard){this._oConfCard=h;this._oPreviewCardHoC.refresh()}this._oHocChartCombo.setSelectedKey(e.getManifest()["sap.card"].content.chartType)}};D.prototype._onChartTypePress=function(e){var t=e.getParameter("listItem");if(t.getBindingContext("hocModel")){var i=t.getBindingContext("hocModel").getPath();var o=this._innerHocModel.getProperty(i);var r;var a=this._oCardContainer.getItems();var s=this._innerHocModel.getProperty("/selectedPath");a.forEach(function(e){if(e.getBindingContext("hocModel")){var t=e.getBindingContext("hocModel").getPath();if(t===s&&s!==i){r=e}}});if(r){r.removeStyleClass("sapThemeHighlight-asBorderColor")}this._innerHocModel.setProperty("/oSelected",o);this._innerHocModel.setProperty("/selectedPath",i);var n=i.split("/");var h=n[n.length-1];var l=this._innerHocModel.getProperty("/aCards/"+h);if(this._oConfCard){this._oConfCard=l;this._oPreviewCardHoCSD.refresh()}this._oHocChartCombo.setSelectedKey(o["sap.card"].content.chartType)}};D.prototype.showHouseOfCardsDialog=function(){var e=this.getManifest();if(e){e=JSON.parse(e)}this._oManifest=e;if(this._bDesktop){this._bShowPreview=true}else{this._bShowPreview=false}if(!Object.keys(this._innerHocModel.getProperty("/oSelected")).length){this._innerHocModel.setProperty("/selectedPath","");if(this._oChartTypeSearch){this._oChartTypeSearch.setValue("");this._onChartTypeSearch()}this._createHouseOfCards()}else if(this._innerHocModel.getProperty("/selectedPath")){this._setBorderStyleSelectedCard(this._innerHocModel.getProperty("/selectedPath"))}};D.prototype._setBorderStyleSelectedCard=function(e){var t=this._oCardContainer.getItems();var i;t.forEach(function(t){if(t.getBindingContext("hocModel")){var o=t.getBindingContext("hocModel").getPath();if(e&&!i&&o===e){i=t}}});if(i){setTimeout(function(){i.addStyleClass("sapThemeHighlight-asBorderColor")},0);i.focus()}};D.prototype.getChartTypeSearch=function(){return this._oChartTypeSearch};D.prototype._createHouseOfCards=function(){var e=this._oManifest;var t=e["sap.card"].content.chartType;this._innerHocModel.setProperty("/sOriginalChartType",t);this._innerHocModel.setProperty("/aCards",[]);this._innerHocModel.setProperty("/aPreviewCards",[]);var i=JSON.parse(JSON.stringify(e));var o=i["sap.card"];var r=this._oCardContainer.getMetadata().getDefaultAggregation();var a=[],s=[];var n;this._oCardContainer.removeAllAggregation(r.name);if(o.type==="Analytical"){var h=e["sap.insights"].allowedChartTypes;var l=[];if(h){this._innerHocModel.setProperty("/aAllowedChartTypes",h);l=h.map(function(e){return e.key});var d=l.filter(function(e){return!!e});if(d.length===0){l=h.map(function(e){return e.chart})}}a=M.transformAnalyticalManifest(i,l)}a=a.filter(function(e){return!!e});if(a.length===0){a.push(i)}else{var c=a.findIndex(function(e){return e["sap.card"].content.chartType===t});a.splice(c,1);a.unshift(i)}a.forEach(function(e){var t=JSON.parse(JSON.stringify(e));var i=b.getCardPreviewManifest(t);s.push(i)});this._innerHocModel.setProperty("/aCards",a);this._innerHocModel.setProperty("/aPreviewCards",s);if(!this._innerHocModel.getProperty("/selectedPath")){this._oHoCScrollContainer.scrollTo(0);this._oChartTypeSearch.setValue("");this._onChartTypeSearch()}if(!this._innerHocModel.getProperty("/oSelected")||Object.keys(this._innerHocModel.getProperty("/oSelected")).length===0){this._innerHocModel.setProperty("/oSelected",s[0]);if(this._oConfCard){this._oConfCard=a[0]}this._innerHocModel.setProperty("/selectedPath","/aPreviewCards/0")}else{n=this._innerHocModel.getProperty("/oSelected");n["sap.card"].header.title=this._oConfCard["sap.card"].header.title;n["sap.card"].header.subTitle=this._oConfCard["sap.card"].header.subTitle;this._oPreviewCardHoC.refresh()}n=this._innerHocModel.getProperty("/oSelected");this._oHocChartCombo.setSelectedKey(n["sap.card"].content.chartType)};D.prototype._adjustLayoutStyles=function(){var e=H.getDialogBasedDevice();this._bDesktop=e===x.DEVICE_TYPES.Desktop;if(this._bDesktop){this._oPreviewButton.setVisible(false);this._oHidePreviewButton.setVisible(false);this._oCardContainerFlex.setVisible(true);this._oPanelFlexCard.setVisible(false);this._oPanelFlexHoC.setVisible(false);this._oPreviewPanelCardContainer.setVisible(false);this._oPreviewPanelCardContainer.setVisible(false);this._oHocflexbox1.setWidth(this._bShowPreview?"62%":"100%");this._oPreviewCardHoCVBox.setVisible(false);this._oCardsTypeTable.getColumns()[0].setWidth("10%");this._oCardsTypeTable.getColumns()[1].setWidth("90%");this._oHocflexbox2.setVisible(true);this._oCardContainerFlex.getItems()[1].setVisible(true);this._oHoCScrollContainer.setVisible(true)}else{this._oPreviewButton.setVisible(!this._bShowPreview);this._oHidePreviewButton.setVisible(this._bShowPreview);this._oCardContainerFlex.setVisible(!this._bShowPreview);this._oCardContainerFlex.setHeight(!this._bShowPreview?"4rem":"100%");this._oPanelFlexCard.setVisible(true);this._oPanelFlexHoC.setVisible(true);this._oPreviewPanelCardContainer.setVisible(!this._bShowPreview);this._oPreviewCardHoCVBox.setVisible(this._bShowPreview);this._oHocflexbox1.setWidth("100%");this._oCardsTypeTable.getColumns()[0].setWidth("20%");this._oCardsTypeTable.getColumns()[1].setWidth("80%");this._oHocflexbox2.setVisible(false);this._oCardContainerFlex.getItems()[1].setVisible(false)}this._setFocusOnElement();this.oParentPage.setTitle(this.getDialogTitle())};return D});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/manageCardPreview/Preview", ["sap/ui/core/Control","sap/ui/layout/form/SimpleForm","sap/m/Input","sap/m/Label","sap/m/Title","sap/m/Text","sap/m/VBox","sap/m/Page","sap/m/FlexBox","sap/m/ScrollContainer","sap/m/Toolbar","sap/m/HBox","sap/ui/integration/widgets/Card","sap/m/Panel","sap/m/Button","sap/ui/model/resource/ResourceModel","../utils/DeviceType","../utils/Transformations","sap/ui/Device","sap/m/MessageStrip","../utils/AppConstants","sap/ui/core/Lib","sap/ui/layout/form/SimpleFormLayout","sap/ui/core/InvisibleText"],function(e,t,i,s,a,r,l,o,n,h,d,u,f,g,w,v,p,P,T,x,C,S,D,I){var b=S.getResourceBundleFor("sap.insights");var B=e.extend("sap.insights.manageCardPreview.Preview",{metadata:{properties:{manifest:{type:"string",group:"Behavior",defaultValue:""},cardMessageInfo:{type:"object",group:"Appearance",defaultValue:null},transformation:{type:"boolean",group:"Behavior",defaultValue:false},dialogTitle:{type:"string",defaultValue:""}},aggregations:{_page:{type:"sap.m.Page",multiple:false,visibility:"hidden"}},events:{titleCheck:{parameters:{enableButton:{type:"boolean"}}}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.style("height","100%");e.style("width","100%");e.openEnd();e.renderControl(t.getAggregation("_page"));e.close("div")}}});B.prototype.init=function(){this.bInitialPreviewLoad=true;this.i18Bundle=new v({bundle:b}).getResourceBundle();T.resize.attachHandler(this._adjustLayoutStyles.bind(this));this.oPreviewPage=new o(this.getId()+"--insightCardPreviewPage",{title:this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE"),titleLevel:"H1",showHeader:true,showSubHeader:true,backgroundDesign:"List",enableScrolling:false,headerContent:[],content:[]}).addStyleClass("sapMPageBgStandard");this.setAggregation("_page",this.oPreviewPage);this.createStaticControls();this.oPreviewPage.addHeaderContent(this.oCardPreviewBtn);this.oPreviewPage.addHeaderContent(this.oHideCardPreviewBtn);this.oPreviewPage.addContent(this.oDefaultVBox)};B.prototype.onBeforeRendering=function(){this.bShowCardPreview=false;this.oManifest=this.getManifest();if(this.oManifest){this.oManifest=JSON.parse(this.oManifest)}this.oTitleTextInput.setValue(this.oManifest["sap.card"].header.title);this.oSubTitleTextInput.setValue(this.oManifest["sap.card"].header.subTitle);this._formatTitle(this.oTitleTextInput.getValue());this._adjustLayoutStyles();this.oInsightsPreviewOverflowLayerSD.setVisible(this.oManifest["sap.card"].type==="Analytical"?false:true);this.oInsightsCardOverflowLayer.setVisible(this.oManifest["sap.card"].type==="Analytical"?false:true)};B.prototype.createStaticControls=function(){this.oCardPreviewBtn=new w(this.getId()+"cardPreviewId",{text:this.i18Bundle.getText("INT_DIALOG_CardPreview"),press:this._callPreview.bind(this),enabled:true});this.oHideCardPreviewBtn=new w(this.getId()+"hideCardPreviewId",{text:this.i18Bundle.getText("INT_DIALOG_HidePreview"),press:this._callClosePreview.bind(this),enabled:true});this.oDefaultTitle=new a(this.getId()+"--defaultTitle",{text:this.i18Bundle.getText("INT_CARD_TITLEINFO"),level:"H4"}).addStyleClass("sapUiSmallMarginTop");this.oDefaultSubText=new s(this.getId()+"--defaultSubText",{wrapping:true});this.oInvisibleText=new I(this.getId()+"--invisibleText",{text:this.i18Bundle.getText("INT_Dialog_Header",this.getDialogTitle())});this.oDefaultInfoVBox=new l(this.getId()+"--defaultInfoVBox",{direction:"Column",items:[this.oDefaultTitle,this.oDefaultSubText,this.oInvisibleText]}).addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd");this.oLabelTitle=new s(this.getId()+"--labelTitle",{text:this.i18Bundle.getText("INT_Preview_CARDTITLE"),required:true,labelFor:this.getId()+"--titleTextInput"}).addStyleClass("sapUiTinyMarginTop");this.oTitleTextInput=new i(this.getId()+"--titleTextInput",{change:this._handleTitleChange.bind(this),required:true,ariaLabelledBy:[this.getId()+"--invisibleText",this.getId()+"--defaultTitle",this.getId()+"--defaultSubText",this.getId()+"--labelTitle"]});this.oLabelSubTitle=new s(this.getId()+"--labelSubTitle",{text:this.i18Bundle.getText("INT_Preview_SubTitleTitleField_Label"),required:false,labelFor:"subTitleTextInput"}).addStyleClass("sapUiTinyMarginTop");this.oSubTitleTextInput=new i(this.getId()+"--subTitleTextInput",{change:this._handleSubTitleChange.bind(this)});this.oSimpleForm=new t(this.getId()+"--defaultPreviewForm",{width:"100%",layout:D.ColumnLayout,editable:true,adjustLabelSpan:true,labelSpanXL:12,labelSpanL:12,labelSpanM:12,labelSpanS:12,content:[this.oLabelTitle,this.oTitleTextInput,this.oLabelSubTitle,this.oSubTitleTextInput]});this.oDefaultPreviewFormFlex=new l(this.getId()+"--defaultPreviewFormFlex",{height:"100%",width:"100%",items:[this.oSimpleForm]});this.oDefaultPreviewCardSD=new f(this.getId()+"--defaultPreviewCardSD",{manifestApplied:this._setAriaTextOnManifest.bind(this),width:"19rem",height:"33rem"}).addStyleClass("sapUiTinyMarginBeginEnd");this.oInsightsPreviewOverflowInnerHBoxSD=new u(this.getId()+"--insightsPreviewOverflowInnerHBoxSD",{}).addStyleClass("insightsCardOverflowLayer insightsPreviewCardOverLay insightsPreviewOVPOverLayPositionSD");this.oInsightsPreviewOverflowLayerSD=new u(this.getId()+"--insightsPreviewOverflowLayerSD",{height:"0",items:[this.oInsightsPreviewOverflowInnerHBoxSD]}).addStyleClass("sapMFlexBoxJustifyCenter");this.oDefaultPreviewCardVBox=new l(this.getId()+"--defaultPreviewCardVBox",{width:"100%",height:"100%",alignItems:"Center",backgroundDesign:"Transparent",justifyContent:"SpaceAround",items:[this.oDefaultPreviewCardSD,this.oInsightsPreviewOverflowLayerSD]}).addStyleClass("sapUiSmallMarginTop sapUiTinyMarginBottom");this.oDefaultPreviewScrollSD=new h(this.getId()+"--defaultPreviewScrollSD",{vertical:true,horizontal:false,height:"100%",content:[this.oDefaultPreviewCardVBox]});this.oDefaultPreviewFlexBox=new n(this.getId()+"--defaultPreviewFlexBox",{height:"100%",width:"100%",visible:false,justifyContent:"Center",items:[this.oDefaultPreviewScrollSD]});this.oMessageStrip=new x(this.getId()+"--messageStripId",{showIcon:true,showCloseButton:false}).addStyleClass("sapUiSmallMargin");this.oCardMessageStrip=new l(this.getId()+"--cardMessageId",{items:[this.oMessageStrip]});this.oDefaultFlexBox=new n(this.getId()+"--defaultFlexBox",{height:"100%",direction:"Column",items:[this.oDefaultInfoVBox,this.oCardMessageStrip,this.oDefaultPreviewFormFlex,this.oDefaultPreviewFlexBox]});this.oDefaultPreviewCardText=new a(this.getId()+"--defaultPreviewCardText",{text:this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview"),textAlign:"Left"}).addStyleClass("sapUiTinyMarginTop");this.oDefaultPreviewHBox=new u(this.getId()+"--defaultPreviewHBox",{width:"100%",justifyContent:"Start",backgroundDesign:"Transparent",items:[this.oDefaultPreviewCardText]}).addStyleClass("sapUiTinyMarginBegin");this.oDefaultPreviewToolBar=new d(this.getId()+"--defaultPreviewToolBar",{width:"100%",height:"2.7rem",style:"Clear",design:"Auto",content:[this.oDefaultPreviewHBox]}).addStyleClass("sapThemeBaseBG");this.oInsightsCardOverflowInnerHBox=new u(this.getId()+"--insightsCardOverflowInnerHBox",{}).addStyleClass("insightsCardOverflowLayer insightsPreviewCardOverLay insightsPreviewOVPOverLayPositionLS");this.oDefaultPreviewCardLS=new f(this.getId()+"--defaultPreviewCardLS",{manifestApplied:this._setAriaTextOnManifest.bind(this),width:"19rem",height:"33rem"});this.oInsightsCardOverflowLayer=new u(this.getId()+"--insightsCardOverflowLayer",{height:"0",items:[this.oInsightsCardOverflowInnerHBox]}).addStyleClass("sapMFlexBoxJustifyCenter");this.oDefaultPreviewVBox=new l(this.getId()+"--defaultPreviewVBox",{height:"100%",alignItems:"Center",backgroundDesign:"Transparent",justifyContent:"SpaceAround",items:[this.oDefaultPreviewCardLS,this.oInsightsCardOverflowLayer]});this.oDefaultPreviewPanel=new g(this.getId()+"--defaultPreviewPanel",{expanded:false,height:"100%",backgroundDesign:"Transparent",content:[this.oDefaultPreviewVBox]});this.oDefaultPreviewPanelFlex=new n(this.getId()+"--defaultPreviewPanelFlex",{height:"calc(100% - 2.8rem)",backgroundDesign:"Transparent",justifyContent:"Center",items:[this.oDefaultPreviewPanel]});this.oDefaultPreviewScroll=new h(this.getId()+"--defaultPreviewScroll",{vertical:true,horizontal:false,height:"100%",content:[this.oDefaultPreviewToolBar,this.oDefaultPreviewPanelFlex]});this.oPreviewFlexBox=new n(this.getId()+"--defaultPreviewFlex",{height:"100%",width:"38%",direction:"Column",renderType:"Bare",items:[this.oDefaultPreviewScroll]}).addStyleClass("sapMPageBgStandard");this.oDefaultVBox=new l(this.getId()+"--defaultVBox",{height:"100%",width:"100%",direction:"Row",justifyContent:"SpaceBetween",items:[this.oDefaultFlexBox,this.oPreviewFlexBox]})};B.prototype.setPreviewModeOfCard=function(){var e=p.getDialogBasedDevice()===C.DEVICE_TYPES.Desktop;var t=e?this.oDefaultPreviewCardLS:this.oDefaultPreviewCardSD;if(t&&this.getTransformation()&&(this.oManifest["sap.card"].type==="Table"||this.oManifest["sap.card"].type==="List")){t.setPreviewMode("Abstract")}else{t.setPreviewMode("Off")}};B.prototype._setCardMessageInfo=function(){var e=this.getCardMessageInfo();if(e&&e.text&&e.text.trim()!==""){if(p.getDialogBasedDevice()===C.DEVICE_TYPES.Desktop){this.oCardMessageStrip.setVisible(true)}else{this.oCardMessageStrip.setVisible(this.bShowCardPreview?false:true)}if(this.oMessageStrip){this.oMessageStrip.setText(e.text);this.oMessageStrip.setType(e.type)}}else{e=null;this.oCardMessageStrip.setVisible(false)}};B.prototype._callPreview=function(){this.bShowCardPreview=true;this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(true);this.oDefaultInfoVBox.setVisible(false);this.oDefaultPreviewFormFlex.setVisible(false);this.oDefaultPreviewFlexBox.setVisible(true);if(p.getDialogBasedDevice()===C.DEVICE_TYPES.Desktop){this.oDefaultPreviewCardLS.refresh()}else{this.oDefaultPreviewCardSD.refresh()}this._setCardMessageInfo()};B.prototype._callClosePreview=function(){this.bShowCardPreview=false;this.oCardPreviewBtn.setVisible(true);this.oHideCardPreviewBtn.setVisible(false);this.oDefaultInfoVBox.setVisible(true);this.oDefaultPreviewFormFlex.setVisible(true);this.oDefaultPreviewFlexBox.setVisible(false);this._setCardMessageInfo()};B.prototype._handleTitleChange=function(e){var t=e.getSource();var i=t.getValue().trim();var s;if(p.getDialogBasedDevice()===C.DEVICE_TYPES.Desktop){s=this.oDefaultPreviewCardLS}else{s=this.oDefaultPreviewCardSD}if(s.getCardHeader()){this.oManifest["sap.card"].header.title=i;this.bInitialPreviewLoad=true}if(i){t.setValueState("None");t.setValueStateText("");this.fireTitleCheck({enableButton:true})}else{t.setValueState("Error");t.setValueStateText(this.i18Bundle.getText("INT_Preview_Title_ValueStateText"));this.fireTitleCheck({enableButton:false})}this.setManifest(JSON.stringify(this.oManifest));s.refresh()};B.prototype._handleSubTitleChange=function(e){var t=e.getSource();var i=t.getValue();var s;if(p.getDialogBasedDevice()===C.DEVICE_TYPES.Desktop){s=this.oDefaultPreviewCardLS}else{s=this.oDefaultPreviewCardSD}if(s.getCardHeader()){this.oManifest["sap.card"].header.subTitle=i;this.bInitialPreviewLoad=true}s.refresh();this.setManifest(JSON.stringify(this.oManifest))};B.prototype._adjustLayoutStyles=function(){if(p.getDialogBasedDevice()!==C.DEVICE_TYPES.Desktop){if(this.bShowCardPreview){this.oDefaultInfoVBox.setVisible(false);this.oDefaultPreviewFormFlex.setVisible(false);this.oDefaultPreviewFlexBox.setVisible(true);this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(true)}else{this.oDefaultPreviewFlexBox.setVisible(false);this.oDefaultInfoVBox.setVisible(true);this.oDefaultPreviewFormFlex.setVisible(true);this.oCardPreviewBtn.setVisible(true);this.oHideCardPreviewBtn.setVisible(false)}this.oPreviewFlexBox.setVisible(false);this.oDefaultPreviewCardSD.setManifest(this._setCardTypeForColumn(this.oManifest));this.oDefaultPreviewCardSD.refresh();this.oDefaultPreviewFormFlex.setWidth("100%");this.oDefaultFlexBox.setWidth("100%")}else{this.oPreviewFlexBox.setVisible(true);this.oDefaultInfoVBox.setVisible(true);this.oDefaultPreviewFormFlex.setVisible(true);this.oDefaultPreviewFlexBox.setVisible(false);this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(false);this.oDefaultPreviewFormFlex.setWidth("50%");this.oDefaultFlexBox.setWidth("62%");this.oDefaultPreviewCardLS.setManifest(this._setCardTypeForColumn(this.oManifest));this.oDefaultPreviewCardLS.refresh()}this._setCardMessageInfo();this.oPreviewPage.setTitle(this.getDialogTitle())};B.prototype._setCardTypeForColumn=function(e){if(e["sap.card"].type==="Table"&&this.bInitialPreviewLoad&&this.getTransformation()){var t=P.createTableOptions(e);var i=t.filter(function(e){return e["sap.card"].type==="List"});if(i.length){e=i[0]}this.bInitialPreviewLoad=false}return e};B.prototype._setAriaTextOnManifest=function(e){var t=e.getSource()._ariaText.getText();var i=this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview");e.getSource()._ariaText.setText(i+t)};B.prototype._formatTitle=function(e){var t=this.oTitleTextInput;if(e&&e.trim()){t.setValueState("None");t.setValueStateText("");this.fireTitleCheck({enableButton:true})}else{t.setValueState("Error");t.setValueStateText(this.i18Bundle.getText("INT_Preview_Title_ValueStateText"));this.fireTitleCheck({enableButton:false})}};return B});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/manageCards/CardDetails", ["sap/ui/core/Control","sap/m/FlexBox","sap/m/VBox","sap/m/HBox","sap/m/ScrollContainer","sap/m/Title","sap/ui/integration/widgets/Card","sap/ui/layout/Grid","../utils/AppConstants","sap/m/Link","sap/m/Label","sap/insights/CardHelper","../utils/oDataModelProvider","sap/ui/core/CustomData","../utils/MetadataAnalyser","../utils/V4MetadataAnalyser","sap/m/Token","sap/ui/core/date/UI5Date","../utils/UrlGenerateHelper","../utils/SelectionVariantHelper","sap/fe/navigation/SelectionVariant","sap/ui/core/IconPool","sap/base/util/deepClone","sap/ui/comp/util/DateTimeUtil","sap/ui/layout/form/SimpleForm","sap/m/Toolbar","sap/m/Input","sap/m/DynamicDateRange","sap/m/Button","sap/m/Page","../utils/CardPreviewManager","sap/base/Log","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/resource/ResourceModel","sap/ui/mdc/MultiValueField","sap/ui/mdc/field/MultiValueFieldItem","sap/m/Text","sap/ui/model/json/JSONModel","../base/InMemoryCachingHost","sap/ui/core/Element","sap/ui/core/Lib"],function(e,t,i,a,r,s,n,o,l,d,p,h,u,g,c,f,m,v,C,y,S,b,T,I,x,_,F,P,w,D,E,B,A,V,M,O,k,L,N,U,G,H){"use strict";var K=e.extend("sap.insights.manageCards.CardDetails",{metadata:{properties:{manifest:{type:"string",defaultValue:null,group:"Data",bindable:true,invalidate:true},editable:{type:"boolean",group:"Behavior",defaultValue:false,invalidate:true},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"}},aggregations:{_page:{type:"sap.m.Page",multiple:false,visibility:"hidden"}},events:{navigate:{allowPreventDefault:true,parameters:{}}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.style("height",t.getHeight());e.style("width",t.getWidth());e.openEnd();e.renderControl(t.getAggregation("_page"));e.close("div");return}}});K.prototype.init=function(){h.getServiceAsync().then(function(e){this.oCardHelperServiceInstance=e;e._getUserAllCards().then(function(e){this.aCards=e}.bind(this))}.bind(this));this.parentAppUrl=null;this.oLogger=B.getLogger("sap.insights.manageCards.CardDetails");var e=H.getResourceBundleFor("sap.insights");this.i18Bundle=new M({bundle:e}).getResourceBundle();this.host=new U("CardDetailHost");this.oFlexBox=new t(this.getId()+"idCardsPreviewFlex",{height:"100%",direction:"Column"}).addStyleClass("sapUiTinyMarginBeginEnd");this.oInnerDeleteButton=new sap.m.Button({text:this.i18Bundle.getText("delete"),press:this._handleCardDeleteConfirm.bind(this)});this._createStaticControls();this.oPage=new D({id:this.getId()+"insightCardPage",headerContent:[this.oInnerDeleteButton],content:this.oFlexBox,showNavButton:true,navButtonPress:this._navigateToList.bind(this)});this.oSmartFormMap={};this.oDraftCardParams={};this.setAggregation("_page",this.oPage)};K.prototype._createStaticControls=function(){this.oPreviewTitle=new s(this.getId()+"--previewTitle",{text:this.i18Bundle.getText("preview"),titleStyle:"H4"}).addStyleClass("sapUiSmallMargin");this.oCard=new n(this.getId()+"--previewCard",{width:"17rem",height:"23.5rem",manifest:this.getManifest()?this.getManifest():"",visible:true,manifestReady:this._setCopyVisible.bind(this),manifestApplied:this._setPreviewCardAriaText.bind(this,"preview")});this.oOverflowInnerHBox=new a(this.getId()+"--insightsPreviewOverflowInnerHBox").addStyleClass("insightsCardOverflowLayer insightsCardOverflowTop insightsPreviewOverLaySize");this.oOverFlowHBox=new a(this.getId()+"insightsPreviewOverflowLayer",{height:"0",items:[this.oOverflowInnerHBox]}).addStyleClass("sapMFlexBoxJustifyCenter");this.oPreviewVBox=new i(this.getId()+"--idCardsPreviewVBox",{alignItems:"Center",justifyContent:"Center",items:[this.oCard,this.oOverFlowHBox]});this.oSmartFormFlex=new t(this.getId()+"--smartFormFlex",{justifyContent:"Center",direction:"Column",visible:false,items:[]}).addStyleClass("sapUiTinyMarginTop");this.oOtherTitle=new s(this.getId()+"--otherSectionTitle",{text:this.i18Bundle.getText("otherSectionTitle"),titleStyle:"H5"}).addStyleClass("sapUiSmallMargin");this.oTitleVBox=new i(this.getId()+"--otherSectionTitleVBox",{width:"100%",items:[this.oOtherTitle]});this.parentLink=new d(this.getId()+"--parentAppLink",{ariaLabelledBy:"parentAppLabel parentAppLink",press:this._navigateToParentApp.bind(this),wrapping:true});this.parentAppLabel=new p(this.getId()+"--parentAppLabel",{text:this.i18Bundle.getText("parentApp")});this.parentLinkVBox=new i(this.getId()+"--parentAppLinkVBox",{width:"100%",items:[this.parentLink]}).addStyleClass("sapUiSmallMarginEnd");this.appLabelVBox=new i(this.getId()+"--parentAppLabelVBox",{width:"100%",alignItems:"End",items:[this.parentAppLabel]}).addStyleClass("sapUiSmallMarginEnd");this.parentAppGrid=new o(this.getId()+"--parentAppLinkGrid",{width:"100%",vSpacing:0,hSpacing:1,position:"Left",defaultSpan:"XL4 L4 M4 S6",defaultIndent:"XL0 L0 M0 S0",content:[this.appLabelVBox,this.parentLinkVBox]});this.otherSection=new a(this.getId()+"--otherSectionHBox",{direction:"Column",items:[this.oTitleVBox,this.parentAppGrid]});this.outerMainVBox=new i(this.getId()+"--idPreviewOuterVBox",{height:"100%",width:"100%",items:[this.oPreviewTitle,this.oPreviewVBox,this.oSmartFormFlex,this.otherSection]});this.scrollContainer=new r(this.getId()+"--idCardsPreviewContainer",{vertical:true,horizontal:false,height:"100%",content:[this.outerMainVBox]})};K.prototype._createCopyStaticControls=function(){this.oDetailsTitle=new s(this.getId()+"--detailsTitle",{text:this.i18Bundle.getText("editDetails"),titleStyle:"H5"}).addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd sapUiSmallMarginTop");this.oCopyTitleLabel=new p(this.getId()+"--copyCardsEditTitleLabel",{text:this.i18Bundle.getText("title"),required:true});this.oCopyTitleInput=new F(this.getId()+"--copyCardsEditTitleField",{change:this._handleCardsInputChange.bind(this)});this.oCopySubLabel=new p(this.getId()+"--copyCardsEditSubTitleLabel",{text:this.i18Bundle.getText("subTitle")});this.oCopySubInput=new F(this.getId()+"--copyCardsEditSubTitleField",{change:this._handleCardsInputChange.bind(this)});this._oCopyForm=new x(this.getId()+"--copyCardsEditDetailsForm",{layout:"ColumnLayout",backgroundDesign:"Transparent",width:"100%",editable:true,content:[this.oCopyTitleLabel,this.oCopyTitleInput,this.oCopySubLabel,this.oCopySubInput]}).addStyleClass("sapContrastPlus sapUiSmallMarginEnd sapUiSmallMarginBegin");this.outerCopyFormVBox=new i(this.getId()+"--idCopyFormVBox",{height:"100%",width:"100%",items:[this.oDetailsTitle,this._oCopyForm]});this.oDynDate=new P(this.getId()+"--hiddenDDR",{hideInput:true});this.oDynDateFilter=new P(this.getId()+"--hiddenFilterDDR",{hideInput:true});this.oCopyPreviewTitle=new s(this.getId()+"--copyCardPreviewTitle",{text:this.i18Bundle.getText("preview"),titleStyle:"H5"}).addStyleClass("sapUiSmallMarginTop sapUiSmallMarginBegin");this.oRefreshButton=new w(this.getId()+"--copyCardPreviewRefreshButton",{type:"Transparent",text:this.i18Bundle.getText("refresh"),press:this._handleCardPreviewPress.bind(this)});this.oCopyHbox=new a(this.getId()+"--copyCardPreviewHBox",{alignItems:"Center",justifyContent:"SpaceBetween",width:"100%",items:[this.oCopyPreviewTitle,this.oRefreshButton]});this.oCopyCard=new n(this.getId()+"--copyCardPreview",{manifestApplied:this._setPreviewCardAriaText.bind(this,"preview"),width:"17rem",height:"23.5rem"});this.oCopyInnerOverflow=new a(this.getId()+"--insightsCopyOverflowInnerHBox").addStyleClass("insightsCardOverflowLayer insightsCardOverflowTop insightsPreviewOverLaySize");this.oCopyOverflow=new a(this.getId()+"--insightsCopyOverflowLayer",{height:"0",items:[this.oCopyInnerOverflow]}).addStyleClass("sapMFlexBoxJustifyCenter");this.oCopyPreviewVBox=new i(this.getId()+"--copyCardsPreviewVBox",{alignItems:"Center",items:[this.oCopyCard,this.oCopyOverflow]}).addStyleClass("sapUiMediumMarginBottom");this.oCopyVBox=new i(this.getId()+"--copyCardPreviewVBoxWrapper",{backgroundDesign:"Transparent",height:"100%",width:"100%",items:[this.oCopyHbox,this.oCopyPreviewVBox]}).addStyleClass("sapUiMediumMarginTop")};K.prototype._handleCardSavePress=function(){var e=this.oSmartFormFlex,t=e&&e.getItems()[0];if(t&&!t.getSmartFields().some(function(e){return e.checkClientError({handleSuccess:true})})){if(this.oCopyCardManifest.descriptorContent["sap.card"].header.title){this.oPage.setBusy(true);var i=this.oActualManifest;var a=i.descriptorContent["sap.app"].id;var r=this.oCopyCardManifest;var s=a+"."+Date.now();var n=this.aCards||[];this.oDraftCardParams[s]={};r=this._mergeDraftParamsIncard(r);r.descriptorContent["sap.app"].id=s;var o=n.filter(function(e){return e.visibility});r.descriptorContent["sap.insights"].visible=o.length<10?true:false;r.visibility=o.length<10?true:false;r.descriptorContent["sap.insights"].parentAppId=i.descriptorContent["sap.insights"].parentAppId;r.descriptorContent["sap.insights"].isDtCardCopy=false;r.descriptorContent["sap.ui5"].componentName=s;var l=false;if(r.descriptorContent["sap.card"]&&r.descriptorContent["sap.card"].extension&&r.descriptorContent["sap.card"].extension==="module:sap/insights/OVPCardExtension"){l=true}h.getServiceAsync().then(function(e){e._createCard(r.descriptorContent,l).then(function(){var t=i.descriptorContent["sap.card"].header.title;var a=this.i18Bundle.getText("copyCardSuccessMsg",t);A.show(a);this.oPage.setShowNavButton(true);e._getUserAllCardModel().then(function(e){this.aCards=e.getProperty("/cards")}.bind(this));this._navigateToList()}.bind(this)).catch(function(e){if(e&&e.message==="/UI2/INSIGHTS_MSG/007"){V.error(this.i18Bundle.getText("INT_CARD_MAXLIMIT"))}else{A.show(e.message)}}.bind(this)).finally(function(){this.oPage.setBusy(false)}.bind(this))}.bind(this))}}else{this.oLogger.error(this.i18Bundle.getText("cardCopyErrorMsg"))}};K.prototype._setEditable=function(e){this.oFlexBox.removeAllItems();var t;var i=this.oActualManifest.descriptorContent["sap.app"];var a=i&&i.dataSources;var r=a&&a.filterService;if(r&&r.settings&&r.settings.odataVersion===l.ODATA_VERSION_4){t=true}if(e&&!t){if(!this.oCopyVBox){this._createCopyStaticControls()}this.oInnerSaveBtn.setVisible(true);this.oInnerCancelBtn.setVisible(true);this.oInnerDeleteButton.setVisible(false);this.oInnerCopyBtn.setVisible(false);this.oFlexBox.addItem(this.oCopyTitle);this.oFlexBox.addItem(this.outerCopyFormVBox);this.oFlexBox.addItem(this.oSmartFormFlex);this.oFlexBox.addItem(this.oDynDate);this.oFlexBox.addItem(this.oDynDateFilter);this.oFlexBox.addItem(this.oCopyVBox)}else{this.oInnerDeleteButton.setVisible(true);if(this.oInnerSaveBtn){this.oInnerSaveBtn.setVisible(false);this.oInnerCancelBtn.setVisible(false)}if(this.outerMainVBox.indexOfItem(this.oSmartFormFlex)=="-1"){this.outerMainVBox.insertItem(this.oSmartFormFlex,2)}if(this.oInnerCopyBtn){if(!t){this.oInnerCopyBtn.setVisible(true)}else{this.oInnerCopyBtn.setVisible(false)}}this.oFlexBox.addItem(this.scrollContainer)}};K.prototype._setManifest=function(e){if(this.getEditable()){this.oCopyPreview=E.getCardPreviewManifest(e.descriptorContent);this.oCopyCard.setManifest(this.oCopyPreview)}else{this.oPreviewManifest=E.getCardPreviewManifest(e.descriptorContent);this.oPage.setTitle(e.descriptorContent["sap.card"].header.title);this.oCard.setManifest(this.oPreviewManifest);this.oCard.setHost(this.host)}if(e.descriptorContent["sap.app"].id!==this.currentCardId||this.getEditable()||this.bValueUpdate){if(e.descriptorContent["sap.card"]["type"]==="Analytical"){this.oOverFlowHBox.setVisible(false)}else{this.oOverFlowHBox.setVisible(true)}this._setSmartFormForCardEdit();this.currentCardId=e.descriptorContent["sap.app"].id}};K.prototype._navigateToList=function(){this._navigateCancel();this.fireNavigate()};K.prototype._setCopyVisible=function(){var e=this.oPreviewManifest;this.oSmartFormFlex.setVisible(false);if(e){var t=e["sap.app"].dataSources;var i=t.filterService;var a=i&&i.uri;var r=i&&i.settings;if(a&&r){this.oSmartFormFlex.setVisible(true)}if(a&&r&&e["sap.insights"].isDtCardCopy){if(!this.oInnerCopyBtn){this.oInnerCopyBtn=new sap.m.Button({text:this.i18Bundle.getText("copy"),press:this._navigateToCopyCard.bind(this),visible:true});this.oPage.insertHeaderContent(this.oInnerCopyBtn,1)}this.oInnerCopyBtn.setVisible(true)}else if(this.oInnerCopyBtn){this.oInnerCopyBtn.setVisible(false)}}};K.prototype._navigateCancel=function(){var e;if(this.oSmartFormFlex.getItems()[0]&&this.oSmartFormFlex.getItems()[0].isA("sap.ui.comp.smartform.SmartForm")&&this.oSmartFormFlex.getItems()[0].getEditable()){e=this.oSmartFormFlex.getItems()[0].check().length}if(this.bValueUpdate&&e){this.oSmartFormFlex.removeAllItems();this.setProperty("editable",false)}else{this.setProperty("editable",false);if(this.oSmartFormFlex.getItems()[0]){this.oSmartFormFlex.getItems()[0].setEditable(false)}}this.oPage.setShowNavButton(true)};K.prototype.onBeforeRendering=function(){if(this.getManifest()){this.oActualManifest=JSON.parse(this.getManifest());this._setManifest(this.oActualManifest);this._updateParentDetails(this.oActualManifest)}this.oCard.refresh();if(this.getEditable()){this._setEditable(true)}else{this._setEditable(false)}};K.prototype._setPreviewCardAriaText=function(e,t){var i=t.getSource()._ariaText.getText();var a=this.i18Bundle.getText(e);t.getSource()._ariaText.setText(a+i)};K.prototype._navigateToCopyCard=function(){var e=this.oActualManifest.descriptorContent["sap.app"].id;this.oPage.setShowNavButton(false);if(this.oDraftCardParams){this.oDraftCardParams[e]={}}if(!this.oCopyVBox){this._createCopyStaticControls()}if(!this.oInnerCancelBtn&&!this.oInnerSaveBtn){this.oInnerCancelBtn=new sap.m.Button({text:this.i18Bundle.getText("cancelButton"),press:this._navigateCancel.bind(this)});this.oInnerSaveBtn=new sap.m.Button({text:this.i18Bundle.getText("save"),press:this._handleCardSavePress.bind(this)});this.oPage.insertHeaderContent(this.oInnerSaveBtn,2);this.oPage.insertHeaderContent(this.oInnerCancelBtn,3)}this.setEditable(true);this.bValueUpdate=false;this.oCopyCardManifest=JSON.parse(JSON.stringify(this.oActualManifest));this.oCopyPreview=JSON.parse(JSON.stringify(this.oPreviewManifest));this.oCopyCard.setManifest(this.oCopyPreview);this.oCopyTitleInput.setValue(this.oCopyCardManifest.descriptorContent["sap.card"].header.title);this.oCopySubInput.setValue(this.oCopyCardManifest.descriptorContent["sap.card"].header.subTitle);this.oPage.setTitle(this.i18Bundle.getText("copyCard"))};K.prototype._handleCardsInputChange=function(e){var t=e.getSource(),i=t.getValue(),a=t.getId();if(a&&a.includes("copyCardsEditTitleField")){if(!i){t.setValueState("Error")}else{t.setValueState("None")}this.oCopyCardManifest.descriptorContent["sap.card"].header.title=i}else if(a&&a.includes("copyCardsEditSubTitleField")){this.oCopyCardManifest.descriptorContent["sap.card"].header.subTitle=i}};K.prototype._handleCardPreviewPress=function(){if(this.oCopyCardManifest.descriptorContent["sap.card"].header.title){var e=this._mergeDraftParamsIncard(this.oCopyCardManifest);this.oCopyPreview=E.getCardPreviewManifest(e.descriptorContent);this.oCopyCard.setManifest(this.oCopyPreview);this.oCopyCard.refresh()}};K.prototype._setSmartFormForCardEdit=function(){if(this.oActualManifest.descriptorContent&&this.oActualManifest.descriptorContent&&this.oActualManifest.descriptorContent["sap.app"]){var e=this.oActualManifest.descriptorContent["sap.app"];var t=e&&e.dataSources;var i=t&&t.filterService;if(i&&i.settings&&i.settings.odataVersion===l.ODATA_VERSION_2){var a=this.oActualManifest.descriptorContent["sap.app"].id,r=this.oSmartFormMap[a]&&!this.getEditable()&&!this.bValueUpdate?Promise.resolve(this.oSmartFormMap[a]):this._createSmartFormForCardEdit(this.oActualManifest.descriptorContent,this.getEditable());r.then(function(e){if(this.getEditable()){e.setEditable(true)}else{e.setEditable(false)}var t=this.oSmartFormFlex;t.removeAllItems();var i=this.oActualManifest.descriptorContent["sap.app"].dataSources;u.getOdataModel(i).then(function(i){var a=i&&i.loaded;var r=false;if(e.getGroups()&&e.getGroups().length&&e.getGroups()[0].getGroupElements()){r=e.getGroups()[0].getGroupElements().some(function(e){return e.getElements().some(function(e){return e.getVisible()})})}if(e.getAggregation("content").getFormContainers().length&&a&&r){e.setVisible(true);setTimeout(function(){var i=e.getAggregation("content").getLayout();if(i){i.setBackgroundDesign("Transparent")}t.addItem(e)},0)}else{this._setFilterTextForNoData(e,a,true);t.addItem(e)}}.bind(this))}.bind(this))}else if(i&&i.settings&&i.settings.odataVersion===l.ODATA_VERSION_4){this._createSimpleForm(this.oActualManifest.descriptorContent)}}};K.prototype._createSimpleForm=function(e){u.getOdataModel(this._search(e,"/sap.app/dataSources")).then(function(t){var i=this.oSmartFormFlex,a=e,r=t.oData,n=this._search(a,"/sap.app/id"),o=function(e){return new L({text:e,textAlign:"Center"})};i.removeAllItems();this._oSimpleForm=this._oSimpleForm||{};var l={onAfterRendering:function(){if(this._oSimpleForm[n].getAggregation("form").getLayout()&&this._oSimpleForm[n].getAggregation("form").getLayout().setBackgroundDesign){this._oSimpleForm[n].getAggregation("form").getLayout().setBackgroundDesign("Transparent");this._oSimpleForm[n].fireEvent("Rendered")}}.bind(this)};var d=function(){this._oSimpleForm[n].removeEventDelegate(l)};if(!this._oSimpleForm[n]){this._oSimpleForm[n]=new x({layout:"ColumnLayout",editable:false,toolbar:new _({style:"Clear",content:[new s({text:this.i18Bundle.getText("filterBy"),titleStyle:"H5"})]}).addStyleClass("sapThemeBaseBG-asBackgroundColor")});this._oSimpleForm[n].addEventDelegate(l);if(t.loaded){Promise.all([this._fetchRelevantFilters(a,r),this._fetchParameterizedFilters(a,r)]).then(function(e){var t=e[0],a=e[1];if(t.length||a.length){a.concat(t).forEach(function(e){this._oSimpleForm[n].addContent(new sap.m.Label({text:e.name}));this._oSimpleForm[n].addContent(this._generateMultiValueField(e.tokens))}.bind(this))}else{this._oSimpleForm[n].addContent(o(this.i18Bundle.getText("noFilterMsg")))}this._oSimpleForm[n].attachEventOnce("Rendered",null,d.bind(this),this._oSimpleForm[n]);i.addItem(this._oSimpleForm[n])}.bind(this))}else{this._oSimpleForm[n].addContent(o(this.i18Bundle.getText("noFilterLoaded")));this._oSimpleForm[n].attachEventOnce("Rendered",null,d.bind(this),this._oSimpleForm[n]);i.addItem(this._oSimpleForm[n])}}else{this._oSimpleForm[n].addEventDelegate(l);this._oSimpleForm[n].attachEventOnce("Rendered",null,d.bind(this),this._oSimpleForm[n]);i.addItem(this._oSimpleForm[n])}}.bind(this))};K.prototype._fetchParameterizedFilters=function(e,t){var i=this._search(e,"/sap.card/configuration/parameters"),a=this._search(i,"/_relevantODataParameters/value")||[];return a.reduce(function(a,r){return a.then(function(a){return f.getAnnotations(t,e,r,["@com.sap.vocabularies.Common.v1.Label","@com.sap.vocabularies.UI.v1.Hidden"]).then(function(e){var t=e[0],s=e[1],n=i[r].value,o=i[r].label;if(n&&!s){a.push({name:t||r,tokens:[new m({key:n,text:o?o:n})]})}return Promise.resolve(a)})})},Promise.resolve([]))};K.prototype._fetchRelevantFilters=function(e,t){var i=this._search(e,"/sap.card/configuration/parameters"),a=this._search(i,"/_relevantODataFilters/value")||[];return a.reduce(function(a,r){return a.then(function(a){return f.getAnnotations(t,e,r,["@com.sap.vocabularies.Common.v1.Label","@com.sap.vocabularies.UI.v1.Hidden"]).then(function(e){var t=e[0],s=e[1],n=i[r].value,o=new S(n),l=o.getSelectOption(r);if(l.length&&!s){var d=y.getTokenFromSelectOptions(l,r);a.push({name:t||r,tokens:d})}return Promise.resolve(a)})})},Promise.resolve([]))};K.prototype._generateMultiValueField=function(e){var t=new N(e.map(function(e){return{key:e.getKey(),name:e.getText()}}));var i=new O({editMode:"Display",display:"Description",width:"100%",items:{path:"/",template:new k({description:"{name}",key:"{key}"})}});i.setModel(t);return i};K.prototype._search=function(e,t){return t?t.split("/").reduce(function(e,t){return e&&t?e[t]:e},e):undefined};K.prototype._handleCardDeleteConfirm=function(){V.show(this.i18Bundle.getText("deleteCardMsg"),{icon:V.Icon.WARNING,title:this.i18Bundle.getText("delete"),actions:[V.Action.DELETE,V.Action.CANCEL],emphasizedAction:V.Action.DELETE,onClose:function(e){if(e===V.Action.DELETE){this._handleCardDelete(this.currentCardPreviewPath)}}.bind(this)})};K.prototype._handleCardDelete=function(){this.oPage.setBusy(true);var e=this.oActualManifest;var t=e.descriptorContent["sap.app"].id;var i=e.descriptorContent["sap.card"].header.title;this.oCardHelperServiceInstance._deleteCard(t).then(function(){var e=this.aCards.filter(function(e){return e.descriptorContent["sap.app"].id!==t});this.aCards=e;this.oPage.setBusy(false);A.show(this.i18Bundle.getText("deleteCardSuccess",i));this.fireNavigate()}.bind(this)).catch(function(e){this.oPage.setBusy(false);A.show(e.message)}.bind(this))};K.prototype._setFilterTextForNoData=function(e,t,i){H.load({name:"sap.ui.comp"}).then(function(){sap.ui.require(["sap/ui/comp/smartform/Group","sap/ui/comp/smartform/GroupElement","sap/ui/comp/smartform/Layout"],function(a,r,s){e.removeAllGroups();var n=new a;var o=new r;var l=new L({text:t?this.i18Bundle.getText("noFilterMsg"):this.i18Bundle.getText("noFilterLoaded"),textAlign:"Center"});o.addElement(l);n.addGroupElement(o);e.setLayout(new s);e.addGroup(n);if(i){e.getAggregation("content").getLayout().setBackgroundDesign("Transparent")}}.bind(this))}.bind(this))};K.prototype._mergeDraftParamsIncard=function(e){var t=e.descriptorContent["sap.card"].configuration.parameters;var i=e.descriptorContent["sap.app"].id;var a=this.oDraftCardParams[i];Object.keys(a).forEach(function(e){if(a[e]){if(t[e]){if(t[e].type==="datetime"&&typeof t[e].value==="string"&&t[e].value.includes("operation")){var i=JSON.parse(t[e].value);i.operation=a[e];t[e].value=JSON.stringify(i)}else{t[e].value=a[e].value?a[e].value:a[e];if(a[e].label){t[e].label=a[e].label}t[e].description=a[e].description}}else if(e.indexOf("P_")===0&&t[e.replace("P_","")]){a[e.replace("P_","")]=a[e].replace("P_","");t[e.replace("P_","")].value=a[e].replace("P_","");delete a[e]}}});C.processPrivateParams(e,a);Object.keys(t).forEach(function(e){var i=t[e].value;if(t[e].type==="datetime"&&typeof i==="string"&&i.includes("datetime")){i=i.split("datetime");i=i[i.length-1];i=i.replace(/["']/g,"");t[e].value=i}});return e};K.prototype._getOptionsForDynamicDate=function(e,t){var i;if(e[t]["sap:filter-restriction"]==="single-value"){i=l.DATE_OPTIONS.SINGLE_OPTIONS}else if(e[t]["sap:filter-restriction"]==="interval"){i=l.DATE_OPTIONS.RANGE_OPTIONS;i=i.concat(l.DATE_OPTIONS.SINGLE_OPTIONS)}if(e&&e[t].exclude){i=i.filter(function(i){return!e[t].selectedValues.includes(i)})}return i};K.prototype._attachInitialiseToGroupElement=function(e){if(e.getFields()&&e.getFields().length){e.getFields()[0].attachInitialise(function(){if(e.getFields().length&&e.getLabelControl()&&!e.getLabelControl().getText()){var t=e.getFields()[0].getBindingPath("value");if(t&&e.getFields()[0].getVisible()){e.getFields()[0].setTextLabel(t)}}})}};K.prototype._createSmartFormForCardEdit=function(e){return new Promise(function(t){Promise.all([H.load({name:"sap.ui.comp"}),H.load({name:"sap.m"})]).then(function(){sap.ui.require(["sap/ui/comp/smartmultiinput/SmartMultiInput","sap/ui/comp/smartform/SmartForm","sap/ui/comp/smartform/Group","sap/ui/comp/smartform/GroupElement","sap/ui/comp/smartform/Layout","sap/m/Title","sap/m/Toolbar"],function(i,a,r,s,n,o,l){var d=e;var p=d["sap.card"].configuration.parameters;var h=d["sap.insights"].filterEntitySet;var f=p&&p._entitySet.value;var b=d["sap.app"].dataSources;u.getOdataModel(b).then(function(e){var u=e&&e.loaded;var b={layout:new n({labelSpanS:6}),customToolbar:new l({content:[new o({text:this.i18Bundle.getText("filterBy"),titleStyle:"H5"})],style:"Clear"})};var T=new a(b);var I=new r;var x=[],_=[],F=[],P=[],w,D,E=[];if(p){x=p._mandatoryODataParameters.value||[];_=p._mandatoryODataFilters.value||[];F=p._relevantODataParameters.value||[];P=p._relevantODataFilters.value||[];D=p._semanticDateRangeSetting;if(D){w=JSON.parse(D.value);E=Object.keys(w)||[]}}T.attachEditToggled(function(e){var t=e.getParameters().editable;var i=e.getSource().getGroups()&&e.getSource().getGroups().length?e.getSource().getGroups()[0]:null;if(t&&i){i.getGroupElements().forEach(function(e){e.getFields().forEach(function(e){e.attachInnerControlsCreated(function(e){var t=e.getSource(),i=t.getBindingPath("value");if((x.includes(i)||_.includes(i))&&t.getProperty("editable")){t.setMandatory(true)}else if(t.getMandatory()){t.setMandatory(false)}t.checkClientError()})})})}});var B=function(e,t){if(t){var i=new g({key:"date",value:t});e.insertCustomData(i)}};var A=e&&c.getParameterisedEntitySetByEntitySet(e.oData,h);var V=A?c.getPropertyNamesOfEntitySet(e.oData,A):[];if(u){if(F.length){F.forEach(function(t){var a=A;var r=true;if(V.indexOf(t)===-1){a=f;r=false}var n=c.isValueListWithFixedValues(e.oData,a,t);var o=c.isDate(e.oData,a,t);var l=E.includes(t);var d=new s;var h=new i({entitySet:a,value:"{"+t+"}",editable:r,visible:r,singleTokenMode:true,supportRanges:false,innerControlsCreated:this._handleVisibilityChange.bind(this,l,true)});if(n){h.attachInnerControlsCreated(function(e){var t=e.getSource();if(t.getMode()==="edit"){var i=t.getInnerControls();if(Array.isArray(i)&&i.length){var a=t.getAggregation("_initialTokens");if(t.getSingleTokenMode()){var r=i[0],s=Array.isArray(a)&&a.length?a[0]:null;if(r.setForceSelection){r.setForceSelection(false);if(s){r.setSelectedKey(s.getKey())}else{r.setSelectedItem(null)}}}else{var n=i[0];if(Array.isArray(a)&&a.length){n.setSelectedKeys(a.map(function(e){return e.getKey()}))}}if(t.getMandatory()){t.checkClientError()}}}});h.checkClientError=function(){return this._checkClientError(h)}.bind(this);h.attachSelectionChange(this._handleParameterSelectionChange.bind(this))}else{if(l){h.addStyleClass("semanticDateInsight")}h.attachTokenUpdate(this._handleParameterTokenUpdate.bind(this,null,l))}var u=p[t].value;var g=p[t].label;if(u){var y=new m({key:u,text:g?g:u});if(o){if(!E.includes(t)){B(y,v.getInstance(u))}else{if(w&&this.getEditable()){var S=this._getOptionsForDynamicDate(w,t);var b=this.oDynDate;b.setStandardOptions(S)}u=C.formatSemanticDateTime(u,"Parameter",p[t].type)[0];B(y,u)}}if(n&&h.getInnerControls().length){var T=h.getInnerControls()[0];T.setSelectedKey(y.getKey())}h.addAggregation("_initialTokens",y)}if(u&&h.getVisible()){d.addElement(h);I.addGroupElement(d)}else if(this.getEditable()&&h.getVisible()){d.addElement(h);I.addGroupElement(d)}this._attachInitialiseToGroupElement(d)}.bind(this))}var M=c.getPropertyNamesOfEntitySet(e.oData,h);P.forEach(function(t){var a=t;if(!(a==="DisplayCurrency"&&F.indexOf("P_DisplayCurrency")>-1)){var r=h;var n=true;if(M.indexOf(a)===-1){var o="P_"+a;if(V.indexOf(o)>-1){r=A;a=o}else{r=f;n=false}}var l=c.isValueListWithFixedValues(e.oData,r,a);var d=c.isDate(e.oData,r,a);var u=E.includes(a);var g=new s;var m;if(a.indexOf("P_")===0){m=true}else{m=c.getPropertyFilterRestrictionByEntitySet(e.oData,r,a)}var b=new i({entitySet:r,value:"{"+a+"}",editable:n,visible:n,supportRanges:!m,singleTokenMode:m,innerControlsCreated:this._handleVisibilityChange.bind(this,u,false)});if(l){b.attachInnerControlsCreated(function(e){var t=e.getSource();if(t.getMode()==="edit"){var i=t.getInnerControls();if(Array.isArray(i)&&i.length){var a=t.getAggregation("_initialTokens");if(t.getSingleTokenMode()){var r=i[0],s=Array.isArray(a)&&a.length?a[0]:null;if(r.setForceSelection){r.setForceSelection(false);if(s){r.setSelectedKey(s.getKey())}else{r.setSelectedItem(null)}}}else{var n=i[0];if(Array.isArray(a)&&a.length){n.setSelectedKeys(a.map(function(e){return e.getKey()}))}}if(t.getMandatory()){t.checkClientError()}}}});b.checkClientError=function(){return this._checkClientError(b)}.bind(this);b.attachSelectionChange(this._handleFilterSelectionChange.bind(this))}else{if(u){b.setSingleTokenMode(true);b.addStyleClass("semanticDateInsight")}b.attachTokenUpdate(this._handleFilterTokenUpdate.bind(this,null,u))}var T=new S(p[t].value);var x=T.getSelectOption(t);if(x&&x.length){var _=[],P=[];_=y.getTokenFromSelectOptions(x,t);_.forEach(function(e,i){if(d){if(!E.includes(t)){B(e,v.getInstance(e.getKey()))}else{if(w&&this.getEditable()){var a=this._getOptionsForDynamicDate(w,t);var r=this.oDynDateFilter;r.setStandardOptions(a)}P=C.formatSemanticDateTime(x[i],"Filter",p[t].type);P.forEach(function(t){B(e,t)})}}if(l&&b.getInnerControls().length){var s=b.getInnerControls()[0];s.setSelectedKey(e.getKey())}b.addAggregation("_initialTokens",e)}.bind(this));g.addElement(b);I.addGroupElement(g)}else if(this.getEditable()){g.addElement(b);I.addGroupElement(g)}this._attachInitialiseToGroupElement(g)}}.bind(this))}if(I.getAggregation("formElements")&&I.getAggregation("formElements").length){T.addGroup(I)}var O=d["sap.app"].id;if(u){T.setModel(e.oData)}this.oSmartFormMap[O]=T;this.bValueUpdate=false;t(T)}.bind(this))}.bind(this))}.bind(this))}.bind(this))};K.prototype._handleParameterSelectionChange=function(e){var t=e.getParameter("selectedItem");var i=e.getSource(),a="";var r={value:"",label:"",description:""};if(t){i.setValueState("None");a=t.getText()?t.getText():t.getKey();r.value=t.getKey();r.label=a}i.removeAllAggregation("_initialTokens");i.addAggregation("_initialTokens",new m({key:r.value,text:r.label}));var s=e.getSource().getBinding("value").getPath();var n=this.oActualManifest.descriptorContent["sap.app"].id;this.oDraftCardParams[n][s]=r;this.bValueUpdate=true};K.prototype._checkClientError=function(e){var t=e.getSingleTokenMode()&&e.getInnerControls()[0]?!e.getInnerControls()[0].getSelectedKey():!e.getInnerControls()[0].getSelectedKeys().length,i=e.getMandatory()&&t;e.setValueState(i?"Error":"None");return i};K.prototype._handleParameterTokenUpdate=function(e,t,i){var a=e?e:i.getSource();if(a.getMandatory()){a.checkClientError()}var r=a.getBinding("value").sPath;var s=a.getTokens();var n=this.oActualManifest.descriptorContent["sap.app"].id;var o={value:"",label:"",description:""};var d=a.getModel();var p=c.isDate(d,a.getEntitySet(),r);var h,u;if(t&&(!s.length||e)){u=this.oDynDate;this.bValueApplied=true;u.attachEventOnce("change",null,this._onSemanticParameterDateChange.bind(this,r,a),u);u.openBy(a.getDomRef())}if(s.length){o.label=s[0].getText()?s[0].getText():s[0].getKey();if(t&&!u){u=this.oDynDate}if(u&&u._parseValue){h=u._parseValue(s[0].getKey());if(h){u.setValue(h);o.value=C.getDateRangeValue(h,true);o.description=JSON.stringify(h);var g;if(r&&h){g=this._getLabelForField(e,"Parameter")}var f="";var m=h.operator==="DATE";if(g&&typeof g==="string"){f=g.substring(0,g.indexOf("(")-1);if(!f&&m){f=g}}o.label=f?f:h.operator}else{o.value=s[0].getKey();if(Date.parse(o.value)){o.value=v.getInstance(o.value)}o.description=u.getValue()?JSON.stringify(u.getValue()):"";var y=this.oActualManifest.descriptorContent["sap.card"].configuration.parameters;if(!u.getValue()&&y[r]&&y[r].description){var S;o.description=y[r].description;S=JSON.parse(o.description);if(l.DATE_OPTIONS.DATE_LIST.includes(S.operator)){S.values[0]=v.getInstance(S.values[0]);o.value=typeof s[0].getKey()==="string"?v.getInstance(s[0].getKey()):s[0].getKey()}u.setValue(S)}else{u.setValue(u.getValue())}}}else{h=a._parseValue&&a._parseValue(s[0].getKey());if(p&&h){h=a.getModel().formatValue(h,a.getDataType());o.value=h}else if(h){o.value=h}else{h=s[0].getKey();o.value=h}}}this.oDraftCardParams[n][r]=o;this.bValueUpdate=true};K.prototype._handleFilterTokenUpdate=function(e,t,i){var a=e?e:i.getSource();if(a.getMandatory()){a.checkClientError()}var r=a.getBinding("value").sPath;var s=a.getTokens();var n=this.oCopyCardManifest.descriptorContent;var o=n["sap.app"].id;var d=a.getModel();var p=c.isDate(d,a.getEntitySet(),r);var h,u="",g,f={value:"",label:"",description:""};g=n["sap.card"].configuration.parameters;if(t&&(!s.length||e)){h=this.oDynDateFilter;h.attachEventOnce("change",null,this._onSemanticFilterDateChange.bind(this,r,a),h);this.bValueApplied=true;h.openBy(a.getDomRef());if(!s.length){f.value=y.getEmptySVStringforProperty(r)}else{u=h._parseValue(s[0].getKey());if(u){h.setValue(u)}else{f.description=h.getValue()?JSON.stringify(h.getValue()):"";if(!h.getValue()&&g[r]&&g[r].description){var m;f.description=g[r].description;f.value=g[r].value;m=JSON.parse(f.description);m.values.forEach(function(e,t){if(l.DATE_OPTIONS.DATE_LIST.includes(m.operator)){var i=v.getInstance(e);if(e.match&&!(e.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z$/gm)&&e.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z$/gm).length)){m.values[t]=I.utcToLocal(i);if(!["DATETIMERANGE","FROMDATETIME","TODATETIME","DATETIME"].includes(m.operator)){m.values[t]=I.normalizeDate(m.values[t],true)}}else{m.values[t]=i}}});h.setValue(m)}else{h.setValue(h.getValue())}}}}else if(s.length){var C=new S;var b=[];var T="";s.forEach(function(e){T="";if(e.data("selectOption")){var t=e.data("selectOption");if(!t.Text){t.Text=e.getText?e.getText():null}b.push(t)}else if(e.data("range")){var i=e.data("range");var s=y.getSelectOptionFromRange(i,e.getText());b.push(s)}else if(p){var n=d.formatValue(e.getKey(),"Edm.DateTime");C.addSelectOption(r,"I","EQ",n,null,n)}else if(a._parseValue){var o=a._parseValue(e.getKey());T=e.getText()?e.getText():e.getKey();C.addSelectOption(r,"I","EQ",o,null,T)}else{T=e.getText()?e.getText():e.getKey();C.addSelectOption(r,"I","EQ",e.getKey(),null,T)}});C.massAddSelectOption(r,b);f.value=C.toJSONString()}else{f.value=y.getEmptySVStringforProperty(r)}this.oDraftCardParams[o][r]=f.value?f:this.oDraftCardParams[o][r];this.bValueUpdate=true};K.prototype._handleVisibilityChange=function(e,t,i){var a=i.getSource();var r=this.oSmartFormFlex;var s=r&&r.getItems()[0];var n=false;if(e&&a.getMode()==="edit"){var o=t?this.oDynDate:this.oDynDateFilter;o.setValue(null);var l=a.getBinding("value").sPath;var d=a.getInnerControls();if(d.length){var p=d[0];a.setShowValueHelp(false);a.setShowSuggestion(false);if(!G.getElementById(p.getId()+"-dynamicDateIcon")){p.addEndIcon({id:p.getId()+"-dynamicDateIcon",src:b.getIconURI("check-availability"),press:t?this._handleParameterTokenUpdate.bind(this,a,true):this._handleFilterTokenUpdate.bind(this,a,true)});p.attachLiveChange(function(){this.bValueApplied=true;p.setValue("");o.attachEventOnce("change",null,t?this._onSemanticParameterDateChange.bind(this,l,a):this._onSemanticFilterDateChange.bind(this,l,a),o);o.openBy(a.getDomRef())}.bind(this))}}}setTimeout(function(){if(s){var e=s.getGroups()&&s.getGroups().length?s.getGroups()[0]:null;var t=e&&e.getGroupElements();if(t&&t.length){t.forEach(function(t){var i=t.getFields();i.forEach(function(e){if(!this.getEditable()&&e.getId()===a.getId()&&(e.getTokens&&e.getTokens().length===0)){t.removeField(e)}if(t.getVisible()&&e.getVisible()&&e.getTokens&&e.getTokens().length){n=true}}.bind(this));if(!t.getFields().length){e.removeGroupElement(t)}}.bind(this))}}if(!n&&r&&!this.getEditable()){r.removeAllItems();this._setFilterTextForNoData(s,true,false);r.addItem(s)}}.bind(this),0)};K.prototype._handleFilterSelectionChange=function(e){var t=e.getParameters();var i=e.getSource().getBinding("value").getPath();var a=this.oActualManifest.descriptorContent;var r=a["sap.app"].id;var s=e.getSource();var n=new S;var o="",l={value:"",label:"",description:""};if(t.selectedItem){s.setValueState("None");var d=e.getParameter("selectedItem");if(d){o=d.getText()?d.getText():d.getKey();s.removeAllAggregation("_initialTokens");s.addAggregation("_initialTokens",new m({key:d.getKey(),text:o}));n.addSelectOption(i,"I","EQ",d.getKey(),null,o);l.value=n.toJSONString()}else{l.value=y.getEmptySVStringforProperty(i)}}else{var p=e.getSource().getInnerControls()[0].getSelectedItems();if(p.length){s.setValueState("None");s.removeAllAggregation("_initialTokens");p.forEach(function(e){o=e.getText()?e.getText():e.getKey();s.addAggregation("_initialTokens",new m({key:e.getKey(),text:o}));n.addSelectOption(i,"I","EQ",e.getKey(),null,o)});l.value=n.toJSONString()}else{l.value=y.getEmptySVStringforProperty(i)}}this.oDraftCardParams[r][i]=l;this.bValueUpdate=true};K.prototype._onSemanticParameterDateChange=function(e,t,i){if(this.bValueApplied){var a=i.getParameter("value");var r=t.getInnerControls()[0];var s=this.oActualManifest.descriptorContent;var n=s["sap.app"].id;var o;if(e&&a){o=this._getLabelForField(t,"Parameter")}var l="";var d=a.operator==="DATE";if(o&&typeof o==="string"){l=o.substring(0,o.indexOf("(")-1);if(!l&&d){l=o}}if(!this.oDraftCardParams[n][e]){this.oDraftCardParams[n][e]={}}this.oDraftCardParams[n][e].value=d?a.values[0]:a.operator;this.oDraftCardParams[n][e].label=d?a.values[0]:a.operator;this.oDraftCardParams[n][e].description=JSON.stringify(a);r.setTokens([]);if(l){this.oDraftCardParams[n][e].label=l}var p=new m({key:this.oDraftCardParams[n][e].value,text:this.oDraftCardParams[n][e].label});r.setTokens([p]);var h=i.getParameter("valid");t.setValueState(h?"None":"Error");this.bValueApplied=false;this.bValueUpdate=true}};K.prototype._onSemanticFilterDateChange=function(e,t,i){if(this.bValueApplied){var a=t.getInnerControls()[0];var r=i.getParameter("value");var s;if(e&&r){s=this._getLabelForField(t,"Filter")}var n=T(r);var o=C.getDateRangeValue(n,false,s);var l=this.oActualManifest.descriptorContent;var d=l["sap.app"].id;var p=new S;if(!o.High){o.High=""}if(!this.oDraftCardParams[d][e]){this.oDraftCardParams[d][e]={}}p.addSelectOption(e,"I",o.Option,o.Low,o.High,o.Text);this.oDraftCardParams[d][e].value=p.toJSONString();this.oDraftCardParams[d][e].description=JSON.stringify(n);a.setTokens([]);var h=y.getTokenFromSelectOptions(p.getSelectOption(e),e);a.setTokens(h);var u=i.getParameter("valid");t.setValueState(u?"None":"Error");this.bValueApplied=false;this.bValueUpdate=true}};K.prototype._getLabelForField=function(e,t){var i=t==="Parameter"?this.oDynDate:this.oDynDateFilter;var a=i.getIdForLabel()||"";a=a.substring(0,a.lastIndexOf("-"));if(a){var r=G.getElementById(a);return r&&r.getValue()}else if(i&&i.getProperty("value")){return i.getProperty("value")}else if(e&&typeof e.getTokens==="function"){var s=e.getTokens()||[],n=s.map(function(e){return e.getText()});return{type:"filters",value:n}}};K.prototype._updateParentDetails=function(e){return h.getServiceAsync().then(function(t){t.getParentAppDetails(e).then(function(e){if(this._getIsNavigationEnabled(e)){this.parentLink.setText(e.title);this.otherSection.setVisible(true);this.parentAppUrl=e.semanticURL}else{this.otherSection.setVisible(false)}}.bind(this))}.bind(this))};K.prototype._navigateToParentApp=function(){var e=this.parentAppUrl;sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(t){t.toExternal({target:{shellHash:e}});this.fireNavigate()}.bind(this))};K.prototype._getIsNavigationEnabled=function(e){return sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(t){return t.isNavigationSupported([{target:{semanticObject:e.semanticObject,action:e.action}}])}).then(function(e){return e[0].supported||false})};return K});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/manageCards/CardsList", ["sap/base/Log","sap/ui/core/Control","sap/ui/core/Icon","sap/ui/core/dnd/DragDropInfo","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/resource/ResourceModel","sap/ui/integration/widgets/Card","sap/m/MessageStrip","sap/m/FlexBox","sap/m/HBox","sap/m/VBox","sap/m/Text","sap/m/Button","sap/m/Title","sap/m/SearchField","sap/m/ScrollContainer","sap/m/Table","sap/m/Column","sap/m/ColumnListItem","sap/m/CheckBox","sap/m/Link","sap/m/MessageBox","sap/m/FormattedText","sap/m/MessageToast","sap/m/Popover","sap/m/Page","sap/m/Label","sap/m/Switch","../CardHelper","../utils/CardRanking","../base/InMemoryCachingHost","sap/f/IllustratedMessage","sap/ui/model/BindingMode","sap/ui/core/Lib","../utils/CardPreviewManager","../utils/DeviceType","../utils/AppConstants"],function(e,t,i,s,r,a,n,o,l,d,h,g,p,u,C,c,f,m,x,b,y,B,v,T,_,w,S,I,P,M,F,V,A,H,L,D,R,E){"use strict";var N=L.getResourceBundleFor("sap.insights");var k=e.getLogger("sap.insights.manageCards.CardsList");var W;var U;var O=t.extend("sap.insights.manageCards.CardsList",{metadata:{properties:{enableResetAllCards:{type:"boolean",group:"Behavior",defaultValue:false},_count:{type:"number",group:"Appearance",defaultValue:0},_visibleCount:{type:"number",group:"Appearance",defaultValue:0},_dtCards:{type:"array",group:"Appearance",defaultValue:[]}},aggregations:{_page:{type:"sap.m.Page",multiple:false,visibility:"hidden"}},events:{listPress:{allowPreventDefault:true,parameters:{manifest:"string"}}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.style("height","100%");e.style("width","100%");e.openEnd();e.renderControl(t.getAggregation("_page"));e.close("div");return}}});O.prototype.init=function(){this._oWrapperFlexBox=new d(this.getId()+"--flexContainerCardsContent",{alignItems:"Start",justifyContent:"Start",height:"100%",width:"100%",direction:"Column",busy:"{/isLoading}"}).addStyleClass("flexContainerCards");this.i18Bundle=new n({bundle:N}).getResourceBundle();var e=new S(this.getId()+"--insightCardPage",{title:this.i18Bundle.getText("insightsCards"),showHeader:true,backgroundDesign:"List",enableScrolling:false,content:this._oWrapperFlexBox});this.setAggregation("_page",e);this.host=new V("CardListHost")};O.prototype._handleModelChange=function(){if(this.getModel()){var e=this.getModel().getProperty("/cards");if(e.length>0){this._setHeaderStaticControls();this._setProperties();this._createTableContent();if(this.oScrollContainerNoCards){this.oScrollContainerNoCards.setVisible(false)}}else{this._createNoCardContent()}}};O.prototype._setHeaderStaticControls=function(){if(!this.oMessageStrip){this.oMessageStrip=new l(this.getId()+"--insightMaxCardMsg",{text:this.i18Bundle.getText("insightMaxCardText"),type:"Warning",showIcon:true});this.oTextMessage=new p(this.getId()+"--insightCardText",{text:this.i18Bundle.getText("insightCardTabText"),textAlign:"Begin",width:"100%"}).addStyleClass("sapUiSmallMarginTop");this.oMessageVBox=new g(this.getId()+"--insightCardMessageVBox",{alignItems:"Start",width:"calc(100% - 2rem)",items:[this.oMessageStrip,this.oTextMessage]}).addStyleClass("sapUiSmallMarginTop sapUiSmallMarginBegin");this.oCardListHeaderHBox=new h(this.getId()+"--insightCardListHeaderVBox",{width:"calc(100% - 2rem)",alignItems:"Center"}).addStyleClass("sapUiSmallMarginTop sapUiSmallMarginBegin insightsCardTitleFlex");this.oCardCountTitle=new C(this.getId()+"--availableInsightsCardsTitle",{titleStyle:"H5"});this.oCardListHeaderHBox.addItem(this.oCardCountTitle);var e=new h(this.getId()+"--insightCardSearchHBox",{width:"100%",justifyContent:"End"});var t=new h(this.getId()+"--insightCardVisFilterHBox",{width:"50%",alignItems:"Center",justifyContent:"End"});t.addItem(new I({text:this.i18Bundle.getText("cardsVisibleFilter")}));this._oVisibleFilterSwitch=new P(this.getId()+"--insightCardSwitchBtn",{customTextOn:" ",customTextOff:" ",ariaLabelledBy:[this.getId()+"--insightCardVisFilterHBox",this.getId()+"--insightCardSwitchBtn"],change:this._handleVisibleFilterChange.bind(this)});t.addItem(this._oVisibleFilterSwitch);e.addItem(t);this._oSearchField=new c(this.getId()+"--insightCardSearch",{ariaLabelledBy:"availableInsightsCardsTitle",liveChange:this._onCardSearch.bind(this),width:"100%"});e.addItem(this._oSearchField);this.oCardListHeaderHBox.addItem(e);this._oWrapperFlexBox.addItem(this.oMessageVBox);this._oWrapperFlexBox.addItem(this.oCardListHeaderHBox)}else{this.oMessageVBox.setVisible(true);this.oCardListHeaderHBox.setVisible(true)}};O.prototype._applyFilters=function(e,t){var i;var s=[];if(t){i=new r("visibility",a.EQ,true);s.push(i)}if(this._oSearchField.getValue()){i=new r("descriptorContent/sap.card/header/title",a.Contains,e);s.push(i)}var n=this._oTable.getBinding("items");n.filter(s,"Application")};O.prototype._handleVisibleFilterChange=function(e){var t=e.getSource().getState();this._applyFilters(this._oSearchField.getValue(),t)};O.prototype._createResetBox=function(){if(!this.oRefreshHBox){this.oRefreshHBox=new h(this.getId()+"--insightCardMessageHBox",{alignItems:"Center"});this.oRefreshHBox.addItem(new p(this.getId()+"--insightsRefreshText",{text:this.i18Bundle.getText("refreshText")}));this.oRefreshHBox.addItem(new u(this.getId()+"--insightsRefreshIcon",{tooltip:this.i18Bundle.getText("refresh"),icon:"sap-icon://refresh",type:"Transparent",press:this._refreshCardList.bind(this)}));this.oMessageVBox.addItem(this.oRefreshHBox)}else{this.oRefreshHBox.setVisible(true)}};O.prototype._setProperties=function(){var e=this.getModel().getProperty("/cards");this.setProperty("_count",e.length);var t=e.filter(function(e){return e.descriptorContent["sap.insights"].isDtCardCopy});this.setProperty("_dtCards",t);var i=e.filter(function(e){return e.visibility});this.setProperty("_visibleCount",i.length);this.bEnableResetAll=this.getEnableResetAllCards();if(this.getProperty("_visibleCount")>9){this.oMessageStrip.setVisible(true);this.oTextMessage.setVisible(false)}else{this.oTextMessage.setVisible(true);this.oMessageStrip.setVisible(false)}this.oCardCountTitle.setText(this.i18Bundle.getText("availableCards")+" ("+this.getProperty("_visibleCount")+"/"+this.getProperty("_count")+")");if(this.bEnableResetAll||this.getProperty("_dtCards").length>0){this._createResetBox()}else if(this.oRefreshHBox){this.oRefreshHBox.setVisible(false)}if(this._oTable){this._oTable.updateAggregation("items")}};O.prototype._createNoCardContent=function(){if(!this.oScrollContainerNoCards){this.oNoCardMessage=new A(this.getId()+"--editInsightNoInsightsCardsMsg",{illustrationSize:"Auto",illustrationType:"sapIllus-SimpleEmptyList",title:this.i18Bundle.getText("editInsightsEmptyCardTitle"),description:this.i18Bundle.getText("editInsightsEmptyCardSubTitle")}).addStyleClass("sapFIllustratedMessageAlign sapFFrequentIllustratedMessageAlign sapUiMargin-24Top");this.oScrollContainerNoCards=new f(this.getId()+"--idNoCardCardsScrollContainer",{vertical:true,horizontal:false,height:"100%",width:"100%",content:[this.oNoCardMessage]});this._oWrapperFlexBox.addItem(this.oScrollContainerNoCards)}else{this.oScrollContainerNoCards.setVisible(true)}if(this.oCardListHeaderHBox){this.oCardListHeaderHBox.setVisible(false)}if(this.oMessageVBox){this.oMessageVBox.setVisible(false)}if(this.oTableFlexBox){this.oTableFlexBox.setVisible(false)}};O.prototype._handleTableItemsChange=function(e){if(e&&e.getParameters()&&e.getParameters().reason!=="filter"){this._handleModelChange()}};O.prototype._createTableContent=function(){if(!this.oTableFlexBox){this.oTableFlexBox=new d(this.getId()+"--editInsightsCardsFlex",{alignItems:"Start",justifyContent:"Start",height:"100%",width:"calc(100% - 2rem)",direction:"Row"}).addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginTop flexContainerCards");this.oTableVBox=new g(this.getId()+"--insightsCardsVBox",{height:"100%",width:"100%",justifyContent:"Start",direction:"Column"});this.oScrollContainer=new f(this.getId()+"--idCardsScrollContainer",{vertical:true,horizontal:false,height:"100%",width:"100%",content:this._createTable()});this.oTableVBox.addItem(this.oScrollContainer);this.oTableFlexBox.addItem(this.oTableVBox);this._oWrapperFlexBox.addItem(this.oTableFlexBox);this._oTable.getBinding("items").attachChange(this._handleTableItemsChange.bind(this))}else{this.oTableFlexBox.setVisible(true)}};O.prototype._onCardSearch=function(e,t){var i=e?e.getSource().getValue():t;this._applyFilters(i,this._oVisibleFilterSwitch.getState())};O.prototype._createTable=function(){if(!this._oTable){this._oTable=new m(this.getId()+"--insightsCardsListTable",{columns:[new x(this.getId()+"--idTableDnDIconColumn",{hAlign:"Center",width:"5%"}),new x(this.getId()+"--idSectionTitleColumn",{width:R.getDialogBasedDevice()!==E.DEVICE_TYPES.Mobile?"85%":"81%"}),new x(this.getId()+"--idSectionVisColumn",{width:R.getDialogBasedDevice()!==E.DEVICE_TYPES.Mobile?"10%":"14%"})],updateFinished:function(){if(W){this.getItems()[W].focus()}if(U){var e=this.getItems().findIndex(function(e){return e.getBindingContextPath()===U});if(e!==-1){this.getItems()[e].getCells()[2].getItems()[0].focus()}}}}).addStyleClass("sapContrastPlus");this._oTable.bindAggregation("items",{path:"/cards",length:100,factory:this._generateTableColumnsTemplate.bind(this)});this._oTable.addDragDropConfig(new s({sourceAggregation:"items",targetAggregation:"items",drop:this._handleDrop.bind(this)}));this._oTable.attachBrowserEvent("keydown",this._attachDndHandler.bind(this,this._oTable,this._handleDrop.bind(this)))}return this._oTable};O.prototype._generateTableColumnsTemplate=function(){var e=new b({press:this._handleCardListItemPress.bind(this),type:"Navigation"}).addStyleClass("insightsListItem insightsListMargin");var t=new h({items:[new i({src:"sap-icon://BusinessSuiteInAppSymbols/icon-grip"}).addStyleClass("insightsDndIcon")]});var s=new g({items:[new B({text:"{descriptorContent/sap.card/header/title}",wrapping:true,press:this._showCardPreviewPopover.bind(this)}),new h({visible:"{= ${descriptorContent/sap.card/header/subTitle} ? true : false }",items:[new p({text:"{descriptorContent/sap.card/header/subTitle}"})]}).addStyleClass("cardsSubTitleMargin")]}).addStyleClass("cardsTitlePadding");var r=new h({items:[new u({type:{path:"visibility",formatter:function(e){return e==true?"Emphasized":"Default"}},enabled:{path:"visibility",mode:"TwoWay",formatter:function(e){if(e==false&&this.getProperty("_visibleCount")>=10){return false}return true}.bind(this)},press:this._handleCardVisibilityToggle.bind(this),icon:"sap-icon://show",tooltip:{path:"visibility",formatter:function(e){return e==true?this.i18Bundle.getText("hideBtn"):this.i18Bundle.getText("showBtn")}.bind(this)}})]});e.addCell(t);e.addCell(s);e.addCell(r);return e};O.prototype._refreshCardList=function(){var e;if(this.bEnableResetAll){e=this.i18Bundle.getText("deleteAllCardsMsg")}else{var t=this.getProperty("_dtCards");var i="<p>"+this.i18Bundle.getText("refreshAllCards")+"</p>";i+="<ul>";t.forEach(function(e){i+='<li class="sapUiTinyMarginBottom">'+e.descriptorContent["sap.card"].header.title+"</li>"});i+="</ul>";e=new T({htmlText:i})}v.show(e,{icon:v.Icon.WARNING,title:this.i18Bundle.getText("refresh"),actions:[v.Action.OK,v.Action.CANCEL],emphasizedAction:v.Action.OK,onClose:function(e){if(e===v.Action.OK){M.getServiceAsync().then(function(e){return e._refreshUserCards(this.bEnableResetAll).then(function(){return this._handleModelChange()}.bind(this))}.bind(this))}}.bind(this)})};O.prototype._handleCardListItemPress=function(e,t){if(e){this.currentCardPreviewPath=e.getSource().getBindingContextPath()}else if(t){this.currentCardPreviewPath=t.getBindingContextPath()}var i=this.getModel().getProperty(this.currentCardPreviewPath);this.fireListPress({manifest:JSON.stringify(i)})};O.prototype._handleCardVisibilityToggle=function(e){this._oWrapperFlexBox.setBusy(true);var t=e.getSource();U=t.getBindingContext().sPath;var i=t.getBindingContext().getPath();var s=this.getModel().getProperty(i);var r=!s.visibility;s.visibility=r;s.descriptorContent["sap.insights"].visible=r;M.getServiceAsync().then(function(e){e._updateCard(s.descriptorContent,true).then(function(){this._oWrapperFlexBox.setBusy(false);this._handleModelChange();if(this._oTable){this._oTable.updateAggregation("items");this._applyFilters(this._oSearchField.getValue(),this._oVisibleFilterSwitch.getState())}return}.bind(this)).catch(function(e){this._oWrapperFlexBox.setBusy(false);_.show(e.message);k.error(e.message)})}.bind(this))};O.prototype._showCardPreviewPopover=function(e){var t=this.getModel();var i=e.getSource().getParent().getBindingContext().getPath();var s=t.getProperty(i);var r=e.getSource();var a=new g({alignItems:"Center",justifyContent:"Center"}).addStyleClass("sapUiSmallMargin");var n=new o({manifest:D.getCardPreviewManifest(s.descriptorContent),width:"17rem",height:"23.5rem",host:this.host});a.addItem(n);var l=new w({title:this.i18Bundle.getText("preview"),placement:"VerticalPreferredBottom",initialFocus:"idCardPreviewPopover",showHeader:true}).addStyleClass("sapContrastPlus previewPopoverBackground");l.addContent(a);l.openBy(r)};O.prototype._handleDrop=function(e){var t=e.getParameter?e.getParameter("draggedControl"):e.draggedControl,i=t.getParent().indexOfItem(t),s=e.getParameter?e.getParameter("droppedControl"):e.droppedControl,r=t.getParent().indexOfItem(s);if(i!==r){var a=this._setCardsRanking(i,r);a=a.map(function(e){var t=JSON.parse(JSON.stringify(e));var i=t.descriptorContent["sap.app"].id;t.descriptorContent["sap.insights"].ranking=t.rank;t.descriptorContent=JSON.stringify(t.descriptorContent);return{id:i,descriptorContent:t.descriptorContent}});try{this._oWrapperFlexBox.setBusy(true);M.getServiceAsync().then(function(e){e._updateMultipleCards(a,"PUT").then(function(){var e=this.getModel().getProperty("/cards");e=e.sort(function(e,t){if(e.rank<t.rank){return-1}return 1});this.getModel().setProperty("/cards",e);this._oWrapperFlexBox.setBusy(false)}.bind(this))}.bind(this))}catch(e){this._oWrapperFlexBox.setBusy(false);k.error(e.message)}}};O.prototype._attachDndHandler=function(e,t,i){var s=i.metaKey||i.ctrlKey;if(s&&(i.key==="ArrowUp"||i.key==="ArrowDown")){i.preventDefault();var r=i.key==="ArrowUp"?"Before":"After";var a=e.getItems();var n=sap.ui.getCore().getCurrentFocusedControlId();var o=a.findIndex(e=>e.getId()===n);if(o>=0&&o<a.length){var l=i.key==="ArrowDown"?o+1:o-1;if(l>=0&&l<a.length){var d=a[o];var h=a[l];var g={draggedControl:d,droppedControl:h,dropPosition:r};W=l;t(g)}a.forEach(function(e,t){e.tabIndex=t===l?0:-1})}}};O.prototype._setCardsRanking=function(e,t){var i=this._oTable.getItems().map(function(e){return e.getBindingContext().getObject()});if(e<t){return F.reorder(i,e,t+1)}return F.reorder(i,e,t)};return O});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/AppConstants", [],function(){"use strict";var t="/sap/opu/odata4/ui2/insights_srv/srvd/ui2/";var a="INSIGHTS_CARDS";return{DATE_OPTIONS:{SINGLE_OPTIONS:["DATE","YESTERDAY","TOMORROW","TODAY","FIRSTDAYWEEK","LASTDAYWEEK","FIRSTDAYMONTH","LASTDAYMONTH","FIRSTDAYQUARTER","LASTDAYQUARTER","FIRSTDAYYEAR","LASTDAYYEAR"],RANGE_OPTIONS:["THISWEEK","LASTWEEK","NEXTWEEK","THISMONTH","LASTMONTH","NEXTMONTH","THISQUARTER","LASTQUARTER","NEXTQUARTER","QUARTER1","QUARTER2","QUARTER3","QUARTER4","THISYEAR","LASTYEAR","NEXTYEAR","YEARTODATE","DATETOYEAR","DATERANGE","DATETIMERANGE","FROM","FROMDATETIME","LASTDAYS","LASTMONTHS","LASTQUARTERS","LASTWEEKS","LASTYEARS","NEXTDAYS","NEXTMONTHS","NEXTQUARTERS","NEXTWEEKS","NEXTYEARS","SPECIFICMONTH","TO","TODATETIME","TODAYFROMTO"],DATE_LIST:["DATE","DATERANGE","DATETIME","DATETIMERANGE","FROM","TO","FROMDATETIME","TODATETIME","SPECIFICMONTH"],SPECIAL_RANGE:["LASTDAYS","LASTMONTHS","LASTQUARTERS","LASTWEEKS","LASTYEARS","NEXTDAYS","NEXTMONTHS","NEXTQUARTERS","NEXTWEEKS","NEXTYEARS","TODAYFROMTO"]},DEVICE_TYPES:{Desktop:"Desktop",Tablet:"Tablet",Mobile:"Mobile"},CHART_TYPE_DETAILS:{bar:{icon:"sap-icon://horizontal-bar-chart",title:"Bar Chart"},column:{icon:"sap-icon://vertical-bar-chart",title:"Column Chart"},dual_column:{icon:"sap-icon://vertical-bar-chart",title:"Dual Column Chart"},dual_bar:{icon:"sap-icon://horizontal-bar-chart",title:"Dual Bar Chart"},stacked_bar:{icon:"sap-icon://full-stacked-chart",title:"Stacked Bar Chart"},stacked_column:{icon:"sap-icon://vertical-stacked-chart",title:"Stacked Column Chart"},line:{icon:"sap-icon://line-chart",title:"Line Chart"},dual_line:{icon:"sap-icon://line-chart",title:"Dual Line Chart"},combination:{icon:"sap-icon://business-objects-experience",title:"Combination Chart"},bullet:{icon:"sap-icon://horizontal-bullet-chart",title:"Bullet Chart"},time_bullet:{icon:"sap-icon://horizontal-bullet-chart",title:"Time Bullet Chart"},bubble:{icon:"sap-icon://product",title:"Bubble Chart"},time_bubble:{icon:"sap-icon://product",title:"Time Bubble Chart"},pie:{icon:"sap-icon://pie-chart",title:"Pie Chart"},donut:{icon:"sap-icon://donut-chart",title:"Donut Chart"},timeseries_column:{icon:"sap-icon://vertical-bar-chart",title:"TimeSeries Column Chart"},timeseries_line:{icon:"sap-icon://line-chart",title:"TimeSeries Line Chart"},timeseries_scatter:{icon:"sap-icon://scatter-chart",title:"TimeSeries Scatter Chart"},timeseries_bubble:{icon:"sap-icon://product",title:"TimeSeries Bubble Chart"},timeseries_stacked_column:{icon:"sap-icon://vertical-stacked-chart",title:"TimeSeries Stacked Column Chart"},timeseries_100_stacked_column:{icon:"sap-icon://full-stacked-column-chart",title:"TimeSeries 100% Stacked Column Chart"},timeseries_bullet:{icon:"sap-icon://horizontal-bullet-chart",title:"TimeSeries Bullet Chart"},timeseries_waterfall:{icon:"sap-icon://vertical-waterfall-chart",title:"TimeSeries Waterfall Chart"},timeseries_stacked_combination:{icon:"sap-icon://business-objects-experience",title:"Timeseries Stacked Combination Chart"},scatter:{icon:"sap-icon://scatter-chart",title:"Scatter Plot"},vertical_bullet:{icon:"sap-icon://vertical-bullet-chart",title:"Vertical Bullet Chart"},dual_stacked_bar:{icon:"sap-icon://full-stacked-chart",title:"Dual Stacked Bar Chart"},"100_stacked_bar":{icon:"sap-icon://full-stacked-chart",title:"100% Stacked Bar Chart"},"100_dual_stacked_bar":{icon:"sap-icon://full-stacked-chart",title:"100% Dual Stacked Bar Chart"},dual_stacked_column:{icon:"sap-icon://vertical-stacked-chart",title:"Dual Stacked Column Chart"},"100_stacked_column":{icon:"sap-icon://full-stacked-column-chart",title:"100% Stacked Column Chart"},"100_dual_stacked_column":{icon:"sap-icon://vertical-stacked-chart",title:"100% Dual Stacked Column Chart"},stacked_combination:{icon:"sap-icon://business-objects-experience",title:"Stacked Combination Chart"},horizontal_stacked_combination:{icon:"sap-icon://business-objects-experience",title:"Horizontal Stacked Combination Chart"},dual_stacked_combination:{icon:"sap-icon://business-objects-experience",title:"Dual Stacked Combination Chart"},dual_horizontal_stacked_combination:{icon:"sap-icon://business-objects-experience",title:"Dual Horizontal Stacked Combination Chart"},heatmap:{icon:"sap-icon://heatmap-chart",title:"Heat Map"},waterfall:{icon:"sap-icon://vertical-waterfall-chart",title:"Waterfall Chart"},horizontal_waterfall:{icon:"sap-icon://horizontal-waterfall-chart",title:"Horizontal Waterfall Chart"},treemap:{icon:"sap-icon://product",title:"Tree Map"},area:{icon:"sap-icon://product",title:"Area Chart"},radar:{icon:"sap-icon://product",title:"Radar Chart"},dual_combination:{icon:"sap-icon://business-objects-experience",title:"Dual Combination Chart"},dual_horizontal_combination:{icon:"sap-icon://business-objects-experience",title:"Dual Horizontal Combination Chart"},default:{icon:"sap-icon://product"}},ODATA_VERSION_2:"2.0",ODATA_VERSION_4:"4.0",BASE_URL:t,REPO_BASE_URL:t+"insights_cards_repo_srv/0001/",CARD_ENTITY_NAME:a,CARD_READ_URL:t+"insights_cards_read_srv/0001/"+a,POST:"POST",PUT:"PUT",FESR_STEP_NAME:"Insights:AddCard"}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/BatchHelper", ["sap/ui/base/Object","sap/base/Log","./AppConstants","sap/ui/core/Lib"],function(t,e,n,r){"use strict";var s=t.extend("sap.insights.utils.BatchHelper",{});var i=r.getResourceBundleFor("sap.insights");var a=e.getLogger("sap.insights.utils.BatchHelper");var o;function h(t,e){var r="INSIGHTS_CARDS";this.url=e==="POST"?r:r+"('"+t.id+"')";this.mOptions={};this.batchRequests=[];this.payload=t;this.boundary="batch_id_"+Date.now()+"_01";this.mOptions.headers={};this.mOptions.method=e||n.PUT;this.mOptions.headers["content-type"]="multipart/mixed;boundary="+this.boundary;this.mOptions.headers["X-CSRF-Token"]=o;return this}function u(){return fetch(n.REPO_BASE_URL,{method:"HEAD",headers:{"X-CSRF-Token":"Fetch"}}).then(function(t){var e=t.headers.get("X-CSRF-Token");if(t.ok&&e){return e}var n=i.getText("tokenFetchError");a.error(n);throw new Error(n)})}h.prototype.addRequest=function(t){this.batchRequests.push(t)};h.prototype._constructBody=function(){var t="--"+this.boundary;var e="\r\n";var n="Content-Type:application/http"+e+"Content-Transfer-Encoding:binary"+e;var r="changeset_001";var s="--"+r;var i="Content-Type: multipart/mixed; boundary="+r+e;var a=t+e+i;a+=e+s;for(var o=0;o<this.batchRequests.length;o++){var h=this.batchRequests[o];a+=e+n;a+="Content-ID: "+(o+1)+e+e;a+=h.mOptions.method+" "+h.url+" HTTP/1.1 "+e;a+="sap-context-accept: header"+e+"Content-Type:application/json"+e+e;a+=JSON.stringify(this.batchRequests[o].payload)+e+e;a+=s;if(o===this.batchRequests.length-1){a+="--"+e;a+=t+"--"}}return a};function c(t){var e=[];var n=[];var r=[];try{n=t.split("\r\n")}catch(t){throw new Error}n.forEach(function(t){if(t!==""){r.push(t)}});var s="";for(var i=1;i<r.length-1;i++){s=r[i].includes("Content-Type: ")?r[i].split("Content-Type: ")[1]:s;if(r[i+1].includes(r[0])){if(s==="application/json"){r[i]=JSON.parse(r[i]);e.push(r[i])}else{e.push(r[i])}}}return e}s.createMultipartRequest=function(t,e){return u().then(function(n){this.url="/sap/opu/odata4/ui2/insights_srv/srvd/ui2/insights_cards_repo_srv/001/$batch";this.batchRequests=[];var r;o=n;for(var s=0;s<t.length;s++){var i=t[s];var a=new h(i,e);if(!r){r=a}r.addRequest(a)}return this.fetchData(r)}.bind(this))};s.fetchData=function(t){t.mOptions.body=t._constructBody();t.mOptions.method="POST";return fetch(this.url,t.mOptions).then(function(t){if(t.ok===false){throw new Error}return t.text()}).then(function(t){return c(t)})};return s});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/CardPreviewManager", [],function(){function t(t){return t&&Array.isArray(t)&&t.length}function a(a){var e=JSON.parse(JSON.stringify(a));var n=e["sap.card"].type;if(t(e["sap.card"].header.actions)){e["sap.card"].header.actions=[];delete e["sap.card"].header.actions}if(n==="Analytical"&&t(e["sap.card"].content.actions)){e["sap.card"].content.actions=[];delete e["sap.card"].content.actions}else if(n==="List"&&t(e["sap.card"].content.item.actions)){e["sap.card"].content.item.actions=[];delete e["sap.card"].content.item.actions}else if(n==="Table"&&t(e["sap.card"].content.row.actions)){e["sap.card"].content.row.actions=[];delete e["sap.card"].content.row.actions}return e}function e(a,e){var n=JSON.parse(JSON.stringify(e)),c=JSON.parse(JSON.stringify(a));var r=c["sap.card"].type,i=n["sap.card"].type;if(t(n["sap.card"].header.actions)){c["sap.card"].header["actions"]=n["sap.card"].header.actions}if(r==="Analytical"&&t(n["sap.card"].content.actions)){c["sap.card"].content.actions=n["sap.card"].content.actions}else if(r===i){if(r==="List"&&t(n["sap.card"].content.item.actions)){c["sap.card"].content.item.actions=n["sap.card"].content.item.actions}else if(r==="Table"&&t(n["sap.card"].content.row.actions)){c["sap.card"].content.row.actions=n["sap.card"].content.row.actions}}else if(i==="List"&&t(n["sap.card"].content.item.actions)){c["sap.card"].content.row.actions=n["sap.card"].content.item.actions}else{c["sap.card"].content.item.actions=n["sap.card"].content.row.actions}return c}function n(t){if(t.getAggregation("_content")&&t.getAggregation("_content").getAggregation("_content")&&t.getAggregation("_content").getAggregation("_content")._getVizDataset){if(t.getAggregation("_content").getAggregation("_content")._errorType){return false}var a=t.getAggregation("_content").getAggregation("_content")._getVizDataset();var e=a&&a._FlatTableD&&a._FlatTableD._data&&Array.isArray(a._FlatTableD._data)&&a._FlatTableD._data.length;if(e){return true}}return false}return{getCardPreviewManifest:a,hasVizData:n,insertActionsManifest:e}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/CardRanking", ["./BatchHelper"],function(r){"use strict";function n(r,n){if(!r){r="!"}if(!n){n="~"}return String.fromCharCode(Math.floor((r.charCodeAt(0)+n.charCodeAt(0))/2))}function e(r,e){if(!r){r="!"}if(!e){e="~"}if(r>=e){throw new Error("Second Argument should be greater than the first one")}var t="";var a=r.length>e.length?r.length:e.length;for(var o=0;o<a;o++){t+=n(r[o],e[o])}if(t===r){return t+"0"}else if(t>=e){throw new Error("No Mid possible between "+r+" and "+e)}return t}function t(r){var n=r.length;var e=0;for(var t=0;t<n;t++){e+=r.charCodeAt(t)*Math.pow(10,n-t-1)}return e}function a(r,n){return Math.abs(t(r)-t(n))}function o(r,n,t){var i=[];var f=a(r[n-1].rank,r[n].rank);var u=a(r[t].rank,r[t+1].rank);var h,c,d;if(f>u){h=n-1;d=c=n}else{d=h=t;c=t+1}try{r[d].rank=e(r[h].rank,r[c].rank)}catch(n){i=i.concat(o(r,h,c));r[d].rank=e(r[h].rank,r[c].rank)}i.push(r[d]);return i}function i(r,n,t){var a=[],i=r[n],f=t-1,u=t,h=r[f],c=r[u],d=h?h.rank:undefined,k=c?c.rank:undefined;try{i.rank=e(d,k)}catch(n){a=a.concat(o(r,f,u));i.rank=e(d,k)}a.push(i);return a}return{reorder:i}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/DeviceType", ["sap/ui/base/Object","sap/ui/Device","./AppConstants"],function(e,i,t){"use strict";var s={phone:240,tablet:600,desktop:1024,xxsmall:240,xsmall:320,small:480,medium:560,large:768,xlarge:960,xxlarge:1120,xxxlarge:1440};var a=e.extend("sap.insights.utils.DeviceType",{});a.getDeviceType=function(){var e;if(i.resize.width>=s.xsmall&&i.resize.width<s.tablet){e=t.DEVICE_TYPES.Mobile}else if(i.resize.width>=s.tablet&&i.resize.width<s.desktop){e=t.DEVICE_TYPES.Tablet}else{e=t.DEVICE_TYPES.Desktop}return e};a.getDialogBasedDevice=function(){var e;if(i.resize.width<1024){e=t.DEVICE_TYPES.Mobile}else{e=t.DEVICE_TYPES.Desktop}return e};a.getDeviceWidth=function(){return i.resize.width};return a});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/MetadataAnalyser", [],function(){"use strict";return{getPropertyNamesOfEntitySet:function(t,e){if(!t||!t.getMetaModel){return[]}var a=t.getMetaModel();var r=a.getODataEntitySet(e);var n=[];if(r){var i=a.getODataEntityType(r.entityType);i.property.forEach(function(t){n.push(t.name)})}return n},getParameterisedEntitySetByEntitySet:function(t,e){if(!t||!t.getMetaModel){return}var a=t.getMetaModel();var r=a.getODataEntitySet(e);if(r){var n=a.getODataEntityType(r.entityType);var i=n.navigationProperty;if(!i){return}var o=i.filter(function(t){var e=a.getODataAssociationEnd(n,t.name);var r=a.getODataEntityType(e.type);return r["sap:semantics"]==="parameters"&&r.key});if(o&&o.length){return a.getODataAssociationSetEnd(n,o[0].name).entitySet}}return},getPropertyFilterRestrictionByEntitySet:function(t,e,a){if(!t||!t.getMetaModel){return false}var r=t.getMetaModel();var n=r.getODataEntitySet(e);if(n){var i=r.getODataEntityType(n.entityType);var o;o=i.property.find(function(t){return t.name===a});if(o&&o["sap:filter-restriction"]&&o["sap:filter-restriction"]==="single-value"){return true}}return false},isDate:function(t,e,a){if(!t||!t.getMetaModel){return false}var r=t.getMetaModel(),n=r.getODataEntitySet(e);if(!n){return false}var i=r.getODataEntityType(n.entityType),o=i.property.find(function(t){return t.name===a});return o&&o.type==="Edm.DateTime"},isValueListWithFixedValues:function(t,e,a){if(!t||!t.getMetaModel){return false}var r=t.getMetaModel(),n=r.getODataEntitySet(e),i,o;if(n){var u=r.getODataEntityType(n.entityType),y=u.property.find(function(t){return t.name===a}),f="com.sap.vocabularies.Common.v1.ValueList",s="com.sap.vocabularies.Common.v1.ValueListWithFixedValues",l=y&&y[f],p=y&&y[s],g=y&&y["sap:value-list"];i=l&&g==="fixed-values";o=!!p&&p.Bool==="true"}return i||o||false}}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/SelectionVariantHelper", ["sap/base/security/encodeURL","sap/m/Token","sap/ui/core/CustomData","sap/fe/navigation/SelectionVariant"],function(e,a,t,r){"use strict";var n=function(e){return"("+e+")"};var o=function(e,a,t){var r="or";var o=a;if(t==="E"){o=["not",n(a)].join(" ");r="and"}if(e===""){return o}return[e,r,o].join(" ")};var i=function(e,a){if(a==="number"){return e+"m"}if(!(a==="integer"||a==="boolean"||a==="datetime")){return"'"+e+"'"}return e};var u=function(e,a,t,r){var u="";a.forEach(function(a){var s;switch(a.Option){case"BT":s=n([e,"ge",i(a.Low,r),"and",e,"le",i(a.High,r)].join(" "));break;case"CP":if(a.Low.match(/^[*]\\*(.*)\\*[*]$/)){a.Low=a.Low.slice(1,-1)}s="substringof("+i(a.Low,r)+","+e+")";break;default:s=[e,a.Option.toLowerCase(),i(a.Low,r)].join(" ");break}u=o(u,s,t)});return u};var s=function(e,a,t){var r=[],o=[];a.forEach(function(e){if(e.Sign==="I"){if(e.Option==="NE"){o.push(e)}else{r.push(e)}}else{if(e.Option==="NE"){r.push(e)}else{o.push(e)}}});var i=u(e,r,"I",t);var s=[];if(i){s.push(n(i))}var c=u(e,o,"E",t);if(c){s.push(n(c))}return s.join(" and ")};var c=function(a,t){var r=[];a.getSelectOptionsPropertyNames().forEach(function(e){r.push(s(e,a.getSelectOption(e),t[e]))});return r.length?"$filter="+e(r.join(" and ")):null};var f=function(a,t){var r="";a.getParameterNames().forEach(function(e){if(r!==""){r+=","}r+=e+"=";var n=a.getParameter(e);r+=i(n,t[e])});return r===""?null:n(e(r))};var v=function(e){var a=e.Option;switch(e.Option){case"CP":var t=e.Low;var r=t.indexOf("*")===0;var n=t.indexOf("*",1)===t.length-1;if(r&&!n){a="StartsWith"}else if(!r&&n){a="EndsWith"}else if(r&&n){a="Contains"}break;case"EQ":if(e.Low===""){a="Empty"}break}return a};var w=function(e,a){return new t({key:"range",value:{exclude:e.Sign==="E",keyField:a,operation:v(e),value1:e.Option==="CP"?e.Low.replace(/\*/g,""):e.Low,value2:e.High}})};var l=function(e,r){var o=[];var i=0;e.forEach(function(e){var u="";var s="";switch(e.Option){case"BT":u+=e.Low+" .. "+e.High;s="range_"+i++;break;case"CP":u+=e.Low;s="range_"+i++;break;case"EQ":if(e.Low===""){u+="<EMPTY>";s="<EMPTY>"}else{u+=e.Text?e.Text:e.Low;s=e.Low}break;case"NE":u+="!"+e.Low;s="range_"+i++;break;case"GT":u+=">"+e.Low;s="range_"+i++;break;case"GE":u+=">="+e.Low;s="range_"+i++;break;case"LT":u+="<"+e.Low;s="range_"+i++;break;case"LE":u+="<="+e.Low;s="range_"+i++;break}if(e.Sign==="E"){u="!"+n(u)}var c=new a({key:s,text:e.Text?e.Text:u});if(s!==e.Low){c.addCustomData(w(e,r))}c.addCustomData(new t({key:"selectOption",value:e}));o.push(c)});return o};var p=function(){var e=new r;return e.toJSONString()};var L=function(e){switch(e.Option){case"BT":e.Text+=e.Low+" .. "+e.High;break;case"EQ":if(e.Low===""){e.Text+="<EMPTY>"}else{e.Text+=e.Low}break;case"NE":e.Text+="!"+e.Low;break;case"GT":e.Text+=">"+e.Low;break;case"GE":e.Text+=">="+e.Low;break;case"LT":e.Text+="<"+e.Low;break;case"LE":e.Text+="<="+e.Low;break;default:e.Text+=e.Low;break}return e.Text};var g=function(e,a){var t={Sign:e.exclude?"E":"I",Option:e.operation,Low:e.value1.toString(),High:e.value2?e.value2.toString():"",Text:a?a:""};switch(e.operation){case"Contains":t.Option="CP";if(e.value1){t.Low="*"+e.value1+"*"}break;case"StartsWith":t.Option="CP";if(e.value1){t.Low=e.value1+"*"}break;case"EndsWith":t.Option="CP";if(e.value1){t.Low="*"+e.value1}break;case"Empty":t.Option="EQ";t.Low="";break}if(!t.Text){t.Text=L(t)}return t};return{getFilterQueryFromSV:c,getParameterQueryFromSV:f,getTokenFromSelectOptions:l,getEmptySVStringforProperty:p,getSelectOptionFromRange:g}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/Transformations", ["sap/ui/base/BindingParser"],function(e){var r=function(r){var a=e.complexParser(r);return a.path||a.parts&&a.parts[0].path};var a={bar_series:["bar","column","line","bullet","stacked_bar","stacked_column","vertical_bullet","100_stacked_bar","100_stacked_column","waterfall","horizontal_waterfall","area","radar"],pie_series:["pie","donut"]};var t={bar_series:a["bar_series"].concat("combination","stacked_combination","horizontal_stacked_combination"),pie_series:a["pie_series"],dual_series:["dual_bar","dual_column","dual_line","dual_stacked_bar","dual_stacked_column","dual_combination","dual_horizontal_combination","dual_stacked_combination","dual_horizontal_stacked_combination","100_dual_stacked_bar","100_dual_stacked_column"],scatter_series:["scatter"],heatmap_series:["heatmap"],bubble_series:["bubble"]};var n=function(e){var r=e.content.measures.length;return r>1?t:a};var i=function(e,r){var a=null;var t=Object.keys(r);t.forEach(function(t){if(r[t].includes(e)){a=t}});return a};var s=function(e,r){var a=[];r.forEach(function(r){var t=JSON.parse(e);var n=t["sap.card"];var i=n.content;i.chartType=r;a.push(t)});return a};var u=function(e,r){var a=JSON.parse(e);var t=a["sap.card"];var n=t.content;if(n.chartProperties&&n.chartProperties.legend){n.chartProperties.legend["visible"]=false}n.feeds=[{uid:"categoryAxis",type:"Dimension",values:n.dimensions.map(function(e){return e.label||e.name})},{uid:"valueAxis",type:"Measure",values:n.measures.map(function(e){return e.label||e.name})}];return s(JSON.stringify(a),r)};var l=function(e,r){var a=JSON.parse(e);var t=a["sap.card"];var n=t.content;if(n.chartProperties&&n.chartProperties.legend){n.chartProperties.legend["visible"]=true}n.feeds=[{uid:"size",type:"Measure",values:n.measures.map(function(e){return e.label||e.name})},{uid:"color",type:"Dimension",values:n.dimensions.map(function(e){return e.label||e.name})}];return s(JSON.stringify(a),r)};var c=function(e,r){var a=JSON.parse(e);var t=a["sap.card"];var n=t.content;if(n.chartProperties&&n.chartProperties.legend){n.chartProperties.legend["visible"]=false}n.feeds=[{uid:"categoryAxis",type:"Dimension",values:n.dimensions.map(function(e){return e.label||e.name})}].concat(n.measures.map(function(e,r){return{uid:"valueAxis"+(r===0?"":r+1),type:"Measure",values:[e.label||e.name]}}));return s(JSON.stringify(a),r)};var o=function(e,r){var a=JSON.parse(e);var t=a["sap.card"];var n=t.content;if(n.chartProperties&&n.chartProperties.legend){n.chartProperties.legend["visible"]=false}n.feeds=[{uid:"color",type:"Dimension",values:n.dimensions.map(function(e){return e.label||e.name})}].concat(n.measures.map(function(e,r){var a="valueAxis";if(r!==0){if(r===1){a="valueAxis2"}else{if(r!==n.measures.length-1){a=a+(r+1)}if(r===n.measures.length-1){a="bubbleWidth"}}}return{uid:a,type:"Measure",values:[e.label||e.name]}}));return s(JSON.stringify(a),r)};var d=function(e,r){var a=JSON.parse(e);var t=a["sap.card"];var n=t.content;if(n.chartProperties&&n.chartProperties.legend){n.chartProperties.legend["visible"]=true}n.feeds=[{uid:"color",type:"Measure",values:[n.measures[0].name||n.measures[0].label]},{uid:"categoryAxis",type:"Dimension",values:n.dimensions.map(function(e){return e.name||e.label})}];return s(JSON.stringify(a),r)};var p=function(e,r){var a=JSON.parse(e);var t=a["sap.card"];var n=t.content;if(n.measures.length<3){return null}if(n.chartProperties&&n.chartProperties.legend){n.chartProperties.legend["visible"]=true}n.feeds=[{uid:"color",type:"Dimension",values:[n.dimensions[0].name||n.dimensions[0].label]},{uid:"valueAxis",type:"Measure",values:[n.measures[0].name||n.measures[0].label]},{uid:"valueAxis2",type:"Measure",values:[n.measures[1].name||n.measures[1].label]},{uid:"bubbleWidth",type:"Measure",values:[n.measures[2].name||n.measures[2].label]}];return s(JSON.stringify(a),r)};var f=function(e,r,a){switch(r){case"bar_series":return u(e,a);case"pie_series":return l(e,a);case"dual_series":return c(e,a);case"scatter_series":return o(e,a);case"heatmap_series":return d(e,a);case"bubble_series":return p(e,a);default:return null}};function v(e,r){var a=n(e["sap.card"]);var t=e["sap.card"].content.chartType;var u=JSON.stringify(e);var l=[];var c=Object.keys(a);if(r&&Array.isArray(r)&&r.length){r.forEach(function(e){var r=i(e,a);if(r){l=l.concat(f(u,r,[e]))}else{l.push(null)}})}else{e["sap.card"].data.request["timeout"]=1e5;c.forEach(function(e){var r=a[e];if(r.includes(t)){l=l.concat(s(u,r))}else{l=l.concat(f(u,e,r))}})}return l}var m=[function e(r){return r},function e(r){var a=r["sap.card"].content.item;if(a.chart){if(!a.info&&a.chart.displayValue){a.info={value:a.chart.displayValue};if(a.chart.color){a.info.state=a.chart.color}}delete a.chart;return r}return null},function e(r){var a=r["sap.card"].content.item;if(a.info){delete a.info;return r}return null},function e(r){var a=r["sap.card"].content.item;if(a.attributes&&a.attributes.length>0){delete a.attributes;delete a.attributesLayoutType;return r}return null},function e(a){var t=a["sap.card"].content.item;if(t.info){a["sap.card"].content.group={title:t.info.value,order:{path:r(t.info.value),dir:"DESC"}};delete t.info;return a}return null},function e(a){var t=a["sap.card"].content.item;if(t.attributes&&t.attributes.length>0){a["sap.card"].content.group={title:t.attributes[0].value,order:{path:r(t.attributes[0].value),dir:"DESC"}};delete t.attributes;delete t.attributesLayoutType;return a}return null},function e(r){var a=r["sap.card"].content;var t=a.item;var n=[];var i=[];if(t.title){n.push({value:t.title})}if(t.actions&&t.actions.length){i=i.concat(t.actions)}if(t.chart&&t.chart.displayValue){n.push({value:t.chart.displayValue});if(t.chart.color){n[n.length-1].state=t.chart.color}}if(t.attributes&&t.attributes.length>0){n=n.concat(t.attributes)}if(t.info){n.push(t.info)}if(n.length>0){a.row={columns:n};if(i.length>0){a.row["actions"]=i}delete a.item;r["sap.card"].type="Table";return r}return null}];function b(e,r){var a=JSON.stringify(e);return r.map(function(e){var r=JSON.parse(a);return e(r)})}function h(e){return b(e,m)}var _=[function e(r){return r},function e(r){var a=r["sap.card"].content;var t={attributesLayoutType:"OneColumn"};var n=a.row.columns||[];if(n.length>0){n.forEach(function(e,r){t.attributes=t.attributes||[];t.attributes.push(e)});if(a.row.actions&&a.row.actions.length){t["actions"]=a.row.actions}r["sap.card"].type="List";a.item=t;delete a.row;return r}return null}];function y(e){return b(e,_)}var g=[function e(r){var a=r["sap.card"].content;var t=a.data;var n=a.dimensions||[];var i=a.measures||[];var s=n.map(function(e){return{title:e.label,value:e.displayValue||e.value}});s=s.concat(i.map(function(e){return{title:e.label,value:e.value}}));if(s.length>0){r["sap.card"].type="Table";r["sap.card"].content={data:t,row:{columns:s}};return r}return null}];function O(e){return b(e,g)}return{transformAnalyticalManifest:v,createListOptions:h,createTableOptions:y,createChartToListOrTableOptions:O}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/UrlGenerateHelper", ["../utils/SelectionVariantHelper","sap/fe/navigation/SelectionVariant","sap/m/DynamicDateUtil","sap/ui/comp/util/DateTimeUtil","sap/ui/core/format/DateFormat","../utils/AppConstants","sap/ui/model/odata/v2/ODataModel","sap/ui/core/date/UI5Date","sap/ui/comp/odata/type/StringDate"],function(e,a,t,r,i,n,o,s,u){function l(t,r,i){var n=t.descriptorContent["sap.card"].configuration.parameters;var u=t.descriptorContent["sap.card"]["data"]["request"];var l=false,v={},d={};if(u&&u.batch){l=true;v=u.batch.header||{};d=u.batch.content||{}}var T=t&&n._headerDataUrl,D=t&&n._contentDataUrl;var g=new a;var h=n._relevantODataFilters.value;var E=n._relevantODataParameters.value;var y=n._semanticDateRangeSetting,S=[];if(y){y=JSON.parse(y.value);S=Object.keys(y)||[]}h.forEach(function(e){var t=new a(n[e].value);var r=t.getSelectOption(e);var i=[];if(r&&r.length){if(S.includes(e)){i=m(r[0],"Filter",n[e].type);if(i.length){r[0].Low=i[0];r[0].High=i[1]?i[1]:null;if(r[0].Low&&r[0].High&&r[0].Option!=="BT"){r[0].Option="BT"}g.massAddSelectOption(e,r)}else if(o&&o.prototype.formatValue&&r[0]){r[0].Low=o.prototype.formatValue(r[0].Low,"Edm.DateTime");if(r[0].High){r[0].High=o.prototype.formatValue(r[0].High,"Edm.DateTime")}g.massAddSelectOption(e,r)}}else{if(o&&o.prototype.formatValue&&r[0]&&n[e].type==="datetime"){r[0].Low=o.prototype.formatValue(r[0].Low,"Edm.DateTime");if(r[0].High){r[0].High=o.prototype.formatValue(r[0].High,"Edm.DateTime")}g.massAddSelectOption(e,r)}g.massAddSelectOption(e,r)}}});E.forEach(function(e){var a="";if(n[e].value){if(n[e].value.value||typeof n[e].value.value=="string"){a=n[e].value.value.toString()}else if(n[e].value instanceof Date){a=n[e].value}else{a=n[e].value.toString()}}if(n[e].type==="datetime"&&!S.includes(e)&&!a.includes("datetime")){if(o&&o.prototype.formatValue){a=o.prototype.formatValue(a,"Edm.DateTime");g.addParameter(e,a)}}else if(n[e].type==="datetime"&&S.includes(e)){a=typeof n[e].value==="string"&&Date.parse(n[e].value)?m(s.getInstance(a),"Parameter",n[e].type):m(a,"Parameter",n[e].type);if(a[0]){g.addParameter(e,a[0])}else{g.addParameter(e,"")}}else{g.addParameter(e,a)}});var A=n._entitySet.value;var O=A;if(E.length){var I={};E.forEach(function(e){I[e]=n[e].type});O+=e.getParameterQueryFromSV(g,I);var L=O;if(L&&Array.isArray(L.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm))&&L.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length){O=p(L)}}if(n._urlSuffix.value){O+=n._urlSuffix.value}var M={};h.forEach(function(e){M[e]=n[e].type});var H=e.getFilterQueryFromSV(g,M);var w=H;if(w&&Array.isArray(w.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm))&&w.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length){H=p(w)}var R="",V="",N="",_="",Q={header:"",content:""};if(l){R=c(n,"_header",H,t.descriptorContent["sap.card"].type);V=R?O+"?"+R:O;if(T&&T.value){var F=f(S,V);if(F){v.url="{= extension.formatters.formatHeaderDataUrlForSemanticDate() }";T.value=""}else{T.value=V;if(r){r._headerDataUrl=T.value}}}else if(T){if(r&&!i){T.value=V;r._headerDataUrl=T.value}Q.header=V}}if(n._contentDataUrl){N=c(n,"_content",H,t.descriptorContent["sap.card"].type);_=N?O+"?"+N:O;if(n._contentDataUrl.value){var U=f(S,_);if(U){if(l){d.url="{= extension.formatters.formatContentDataUrlForSemanticDate() }"}else{u.url="{= extension.formatters.formatContentDataUrlForSemanticDate() }"}D.value=""}else{D.value=_;if(r){r._contentDataUrl=D.value}}}else{if(r&&!i){D.value=_;r._contentDataUrl=D.value}Q.content=_;return Q}if(i){Q.header=V;Q.content=_;return Q}}}function f(e,a){var t=e.length?e:[];if(t.length&&a){return t.some(function(e){return a&&a.indexOf(e)>-1})}}function c(e,a,t,r){var i=[];if(t){i.push(t)}if(e[a+"SelectQuery"]&&e[a+"SelectQuery"].value){i.push(e[a+"SelectQuery"].value)}if(e[a+"ExpandQuery"]&&e[a+"ExpandQuery"].value){i.push(e[a+"ExpandQuery"].value)}if(e[a+"SortQuery"]&&e[a+"SortQuery"].value){var n=e[a+"SortQuery"].value;i.push(decodeURI(n)===n?encodeURI(n):n)}if(r==="Table"||r==="List"){i.push("$inlinecount=allpages");i.push("$skip=0&$top=13")}else{if(e[a+"TopQuery"]&&e[a+"TopQuery"].value){i.push(e[a+"TopQuery"].value)}if(e[a+"SkipQuery"]&&e[a+"SkipQuery"].value){i.push(e[a+"SkipQuery"].value)}}return i.length?i.join("&"):null}function p(e){var a=e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length;var t=function(){var a=e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm)[0];var t=a;t=t.replace("%27","");var r=t.lastIndexOf("%27");var i=t.substr(0,r)+t.substr(r+3,t.length-1);return i};for(var r=0;r<a;r++){e=e.replace(e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm)[0],t)}return e}function m(e,a,r){var i,o=[],s=[],l=false;if(a==="Parameter"){i=e}else if(a==="Filter"){e=typeof e==="string"?JSON.parse(e):e;i=e.Low;if(n.DATE_OPTIONS.SPECIAL_RANGE.includes(i)){o=e.High.split(",")}}var f,c=new u;if(n.DATE_OPTIONS.RANGE_OPTIONS.includes(i)||n.DATE_OPTIONS.SINGLE_OPTIONS.includes(i)){if(a==="Filter"){f=t.toDates({values:o,operator:i});if(r.toLowerCase()==="string"||r.toLowerCase()==="edm.string"){s.push(c.parseValue(f[0].oDate));s.push(c.parseValue(f[1].oDate));return s}else{s.push(f[0].oDate);s.push(f[1].oDate)}}else{f=t.toDates({values:o,operator:i});if(r.toLowerCase()==="string"||r.toLowerCase()==="edm.string"){s.push(c.parseValue(f[0].oDate));return s}s.push(f[0].oDate)}}if(["DATETIMERANGE","FROMDATETIME","TODATETIME","DATETIME"].includes(i)){l=true}if(s.length){s=v(s,true,l);return s}else if(Date(e)instanceof Date||e instanceof Date||Date.parse(e)){return v([e],true,l)}else if(r.toLowerCase()==="string"&&c.formatValue(e.Low)){var p=c.formatValue(e.Low);if(p.oDate&&p.oDate instanceof Date){s.push(c.parseValue(p.oDate));if(e.High&&c.formatValue(e.High)&&c.formatValue(e.High).oDate instanceof Date){s.push(c.parseValue(c.formatValue(e.High).oDate))}return s}}return[]}function v(e,a,t){var n;e.forEach(function(o,u){if(o.match){if(o.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z?$/gm)&&o.match(/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3})Z?$/gm).length){o=s.getInstance(o)}}o=r.localToUtc(o);if(!t){o=r.normalizeDate(o,true)}if(a){n=i.getDateInstance({pattern:"'datetime'''yyyy-MM-dd'T'HH:mm:ss''",calendarType:"Gregorian"});e[u]=n.format(o,true)}else{var l=i.getDateInstance({pattern:"''yyyy-MM-dd'T'HH:mm:ss.SSS''",calendarType:"Gregorian"});var f=o instanceof Date?o:s.getInstance(o);var c=l.format(f);e[u]=String(c).replace(/'/g,"")}});return e}function d(e,a,r){var i=r;if(e&&a){var n=e.operator;if(n!=="DATE"){return n}else{return e.values[0]}}if(!a){var o=e.operator;var s=e.values;var u="";if(o){switch(o){case"DATE":case"DATERANGE":case"SPECIFICMONTH":case"DATETIMERANGE":case"DATETIME":u="";if(typeof i==="string"){u=i}var l=t.toDates(e);s=l;var f=v(s,false,o==="DATETIMERANGE"||o==="DATETIME");if(!f[1]){f[1]=""}var c={Low:f[0],High:f[1],Option:"BT",Text:u};if(c){c.Text=u;return c}break;case"FROM":case"TO":case"FROMDATETIME":case"TODATETIME":u="";if(typeof i==="string"){u=i}var p=v(s,false,o==="FROMDATETIME"||o==="TODATETIME"),m;m=o==="FROM"||o==="FROMDATETIME"?"GE":"LE";var d={Low:p[0],High:"",Option:m,Text:u};if(d){d.Text=u;return d}break;case"LASTDAYS":case"LASTWEEKS":case"LASTMONTHS":case"LASTQUARTERS":case"LASTYEARS":case"NEXTDAYS":case"NEXTWEEKS":case"NEXTMONTHS":case"NEXTQUARTERS":case"NEXTYEARS":u="";if(typeof i==="string"){u=i}return{Low:o,High:s[0].toString(),Option:"BT",Text:u};case"TODAYFROMTO":u="";if(typeof i==="string"){u=i}var T=s&&s[0];var D=s&&s[1];return{Low:o,High:T.toString()+","+D.toString(),Option:"BT",Text:u};default:u="";if(typeof i==="string"){u=i.substring(0,i.indexOf("(")-1)}return{Low:o,High:null,Option:"EQ",Text:u}}}}}return{processPrivateParams:l,formatSemanticDateTime:m,getDateRangeValue:d}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/V4MetadataAnalyser", [],function(){"use strict";return{_search:function(t,e){return e?e.split("/").reduce(function(t,e){return t&&e?t[e]:t},t):undefined},getAnnotations:function(t,e,n,r){return this._fetchEntitySetName(t,e,n).then(function(e){return Promise.all(r.map(function(r){return this.getMetadataProperty(t,e,n,r)}.bind(this)))}.bind(this))},_fetchEntitySetName:function(t,e,n){var r=this._search(e,"/sap.card/configuration/parameters/_entitySet/value"),i=this._search(e,"/sap.card/configuration/parameters/_relevantODataParameters/value"),a=this._search(e,"/sap.insights/filterEntitySet"),s="";return this.getMetadataProperty(t,r).then(function(e){if(e){if(Object.keys(e).includes(n)){s=r}else if(!i.includes(n)){s=a}else{var u=this._search(e,"/Parameters/$Type"),c=u.split("."),h=c[c.length-1];return this.getMetadataProperty(t,h).then(function(t){return Object.keys(t).includes(n)?h:a})}}return s}.bind(this))},getMetadataProperty:function(t,e,n,r){if(!t||!t.getMetaModel){return false}return t.getMetaModel().requestObject("/"+e+"/"+(n||"")+(r||""))}}});
/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.predefine("sap/insights/utils/oDataModelProvider", ["sap/ui/model/odata/v2/ODataModel","sap/ui/model/odata/v4/ODataModel","./AppConstants"],function(e,t,n){var a={};function i(a){var i=a.filterService;var r=i&&i.uri;var o=i&&i.settings;var s=[];if(o){if(o.annotations&&o.annotations.length){o.annotations.forEach(function(e){var t=a[e];var n=t.uri;s.push(n)})}if(o.odataVersion===n.ODATA_VERSION_2){return new e(r,{annotationURI:s,loadAnnotationsJoined:true})}else if(o.odataVersion===n.ODATA_VERSION_4){return new t({serviceUrl:r,annotationURI:s})}}}function r(e){var t=e.filterService;var r=t&&t.uri;var o=t&&t.settings;var s=i(e);a[r]={oData:s,loaded:undefined};if(o.odataVersion===n.ODATA_VERSION_2){return new Promise(function(e){if(s){s.attachMetadataLoaded(function(t){return t.getSource().getMetaModel().loaded().then(function(){a[r].loaded=true;e(a[r])})});s.attachMetadataFailed(function(){a[r].loaded=false;e(a[r])})}else{e(a[r])}})}else if(o.odataVersion===n.ODATA_VERSION_4){return new Promise(function(e){s.getMetaModel().requestData().then(function(){a[r].loaded=true}).catch(function(){a[r].loaded=false}).finally(function(){e(a[r])})})}}function o(e){if(e.filterService&&e.filterService.uri){var t=e.filterService,i=e.filterService.uri;if(a[i]){return Promise.resolve(a[i])}else if(t.settings&&t.settings.odataVersion===n.ODATA_VERSION_2){return r(e)}else if(t.settings&&t.settings.odataVersion===n.ODATA_VERSION_4){return r(e)}}else{return Promise.resolve(undefined)}}return{getOdataModel:o}});
sap.ui.require.preload({
	"sap/insights/manifest.json":'{"_version":"1.21.0","sap.app":{"id":"sap.insights","type":"library","embeds":[],"applicationVersion":{"version":"1.120.10"},"title":"SAP UI library: sap.insights","description":"SAP UI library: sap.insights","ach":"CA-FLP-EXT-INS","resources":"resources.json","offline":true},"sap.ui":{"technology":"UI5","supportedThemes":["base","sap_belize","sap_belize_hcb","sap_belize_hcw","sap_belize_plus","sap_bluecrystal","sap_fiori_3","sap_fiori_3_dark","sap_fiori_3_hcb","sap_fiori_3_hcw","sap_hcb","sap_horizon","sap_horizon_dark","sap_horizon_hcb","sap_horizon_hcw"]},"sap.ui5":{"dependencies":{"minUI5Version":"1.120","libs":{"sap.ui.core":{"minVersion":"1.120.20"},"sap.viz":{"minVersion":"1.120.20","lazy":true},"sap.m":{"minVersion":"1.120.20","lazy":true},"sap.ui.integration":{"minVersion":"1.120.20","lazy":true},"sap.f":{"minVersion":"1.120.20","lazy":true},"sap.ui.layout":{"minVersion":"1.120.20","lazy":true}}},"library":{"i18n":{"bundleUrl":"messagebundle.properties","supportedLocales":["","ar","bg","ca","cnr","cs","cy","da","de","el","en","en-GB","en-US-sappsd","en-US-saprigi","en-US-saptrc","es","es-MX","et","fi","fr","fr-CA","hi","hr","hu","id","it","iw","ja","kk","ko","lt","lv","mk","ms","nl","no","pl","pt","pt-PT","ro","ru","sh","sk","sl","sr","sv","th","tr","uk","vi","zh-CN","zh-TW"]},"content":{"controls":["sap.insights.ManageCards"],"elements":[],"types":[],"interfaces":[]}}}}'
});
//# sourceMappingURL=library-preload.js.map
