/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Control","sap/m/Label","sap/m/Title","sap/m/Text","sap/m/VBox","sap/m/Page","sap/m/FlexBox","sap/m/ScrollContainer","sap/m/Toolbar","sap/m/HBox","sap/ui/integration/widgets/Card","sap/m/Panel","sap/m/Button","../utils/CardPreviewManager","sap/ui/model/resource/ResourceModel","../utils/DeviceType","sap/ui/Device","sap/m/Table","sap/m/SearchField","sap/m/Column","sap/ui/core/dnd/DragInfo","sap/ui/core/dnd/DropInfo","sap/ui/core/Icon","sap/m/ColumnListItem","sap/m/CheckBox","sap/m/ObjectIdentifier","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","../utils/Transformations","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","../base/InMemoryCachingHost","../utils/AppConstants","sap/ui/core/Element","sap/ui/core/Lib"],function(e,t,i,s,o,n,a,r,l,d,h,C,u,g,m,p,w,c,v,f,b,S,P,B,T,x,I,y,D,V,_,E,L,M,O,A){var F=A.getResourceBundleFor("sap.insights");var N=e.extend("sap.insights.manageCardPreview.ColumnListPreview",{metadata:{properties:{manifest:{type:"string",group:"Behavior",defaultValue:""},dialogTitle:{type:"string",defaultValue:""}},aggregations:{_page:{type:"sap.m.Page",multiple:false,visibility:"hidden"}},events:{enableAddButton:{parameters:{enableButton:{type:"boolean"}}}}},renderer:{render:function(e,t){e.openStart("div",t);e.style("height","100%");e.style("width","100%");e.openEnd();e.renderControl(t.getAggregation("_page"));e.close("div")}}});N.prototype.init=function(){this.i18Bundle=new m({bundle:F}).getResourceBundle();this._innerModel=new E;this.setModel(this._innerModel);w.resize.attachHandler(this._adjustLayoutStyles.bind(this));this.oCardColumnPage=new n(this.getId()+"--insightCardColumnPage",{title:this.i18Bundle.getText("INT_PREVIEW_POPOVER_BUTTON_TITLE"),titleLevel:"H1",showHeader:true,showSubHeader:true,backgroundDesign:"List",enableScrolling:false,headerContent:[],content:[]});this.setAggregation("_page",this.oCardColumnPage);this.host=new L(this.getId()+"--transactionalCardHost",{action:function(e){var t=e.getParameter("card")||{};this.oConfCard=t.getManifest()}.bind(this)});this.createStaticControls();this.oCardColumnPage.addHeaderContent(this.oCardPreviewBtn);this.oCardColumnPage.addHeaderContent(this.oHideCardPreviewBtn);this.oCardColumnPage.addContent(this.oFlexContainerColumnContent)};N.prototype.onBeforeRendering=function(){this.oManifest=this.getManifest();if(this.oManifest){this.oManifest=JSON.parse(this.oManifest)}this._initConfigureCard(this.oManifest);this._adjustLayoutStyles();this.oInsightsColCardLayer.setVisible(this.oManifest["sap.card"].type==="Analytical"?false:true);this.oInsightsColCardLayerSD.setVisible(this.oManifest["sap.card"].type==="Analytical"?false:true)};N.prototype.createStaticControls=function(){this.oCardPreviewBtn=new u(this.getId()+"--cardPreviewId",{text:this.i18Bundle.getText("INT_DIALOG_CardPreview"),press:this._callPreview.bind(this),enabled:true});this.oHideCardPreviewBtn=new u(this.getId()+"--hideCardPreviewId",{text:this.i18Bundle.getText("INT_DIALOG_HidePreview"),press:this._callClosePreview.bind(this),enabled:true});this.oDefaultTitle=new i(this.getId()+"--defaultTitle",{text:this.i18Bundle.getText("INT_COLUMN_TITLE"),level:"H4"});this.oDefaultSubText=new s(this.getId()+"--defaultSubText",{text:this.i18Bundle.getText("INT_COLUMN_SUBTITLE")});this.oInsightsColumnEditVBox=new o(this.getId()+"--insightsColumnEditVBox",{direction:"Column",items:[this.oDefaultTitle,this.oDefaultSubText]}).addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginTop sapUiTinyMarginBottom");this.oColumnSearch=new v(this.getId()+"--columnSearch",{placeholder:this.i18Bundle.getText("INT_COL_SEARCH"),liveChange:this._onColumnSearch.bind(this)}).addStyleClass("sapUiTinyMarginBottom");this.oColumnSearchVBox=new o(this.getId()+"--columnSearchVBox",{renderType:"Bare",items:[this.oColumnSearch]});this.oEditColumnsTableCheckBox=new f(this.getId()+"--editColumnsTableCheckBox",{hAlign:"Center"});this.oEditColumnsName=new f(this.getId()+"--editColumnsName",{});this.oColumnDrag=new b(this.getId()+"--idColumnDrag",{groupName:"editColumns",sourceAggregation:"items"});this.oColumnDrop=new S(this.getId()+"--idColumnDrop",{groupName:"editColumns",targetAggregation:"items",dropPosition:"On",drop:this._onColumnDrop.bind(this)});this.oInsightsCardsEditColumnsListTable=new c(this.getId()+"--insightsCardsEditColumnsListTable",{fixedLayout:"true",columns:[this.oEditColumnsTableCheckBox,this.oEditColumnsName],dragDropConfig:[this.oColumnDrag,this.oColumnDrop]}).addStyleClass("sapContrastPlus");this.oEditColumnsScrollContainer=new r(this.getId()+"--idEditColumnsScrollContainer",{vertical:true,horizontal:false,height:"90%",width:"100%",content:[this.oInsightsCardsEditColumnsListTable]});this.oInsightsColumnEditFlexBox=new a(this.getId()+"--insightsColumnEditFlexBox",{height:"92%",width:"95%",direction:"Column",renderType:"Bare",items:[this.oColumnSearchVBox,this.oEditColumnsScrollContainer]}).addStyleClass("sapUiSmallMarginBegin sapUiSmallMarginEnd");this.oLabelColLayout=new t(this.getId()+"--labelColLayout",{text:this.i18Bundle.getText("INT_COL_LAYOUT")});this.oListViewSD=new y(this.getId()+"--idListViewSD",{icon:"sap-icon://list",key:"List"});this.oTableViewSD=new y(this.getId()+"--idTableViewSD",{icon:"sap-icon://table-view",key:"Table"});this.oSdColumnSegButton=new I(this.getId()+"--sdColumnSegButton",{width:"3.75rem",selectionChange:this._onSegmentedSelectionChange.bind(this),tooltip:this.i18Bundle.getText("INT_LAYOUT_TOOLTIP"),items:[this.oListViewSD,this.oTableViewSD]});this.oPreviewVBoxSD=new o(this.getId()+"--previewVBoxSD",{direction:"Column",height:"4rem",backgroundDesign:"Solid",items:[this.oLabelColLayout,this.oSdColumnSegButton]}).addStyleClass("sapUiSmallMarginBegin sapUiTinyMarginTop");this.oPreviewColCardSD=new h(this.getId()+"--previewColCardSD",{manifestApplied:this._setPreviewCardAriaText.bind(this,this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview")),width:"19rem",height:"32rem",host:this.host}).addStyleClass("sapUiTinyMarginBeginEnd sapUiTinyMarginTopBottom");this.oInsightsColOverflowInnerHBoxSD=new d(this.getId()+"--insightsColOverflowInnerHBoxSD",{}).addStyleClass("insightsCardOverflowLayer insightsPreviewCardOverLay insightsColOverLayPositionSD");this.oInsightsColCardLayerSD=new d(this.getId()+"--insightsColCardLayerSD",{height:"0",items:[this.oInsightsColOverflowInnerHBoxSD]}).addStyleClass("sapMFlexBoxJustifyCenter");this.oColCardsScrollSD=new r(this.getId()+"--colCardsScrollSD",{vertical:true,horizontal:false,height:"100%",content:[this.oPreviewColCardSD,this.oInsightsColCardLayerSD]});this.oPreviewColCardVBox=new o(this.getId()+"--previewColCardVBox",{width:"100%",height:"calc(100% - 4rem)",alignItems:"Center",backgroundDesign:"Solid",justifyContent:"SpaceAround",items:[this.oColCardsScrollSD]});this.oPreviewColCardFlex=new a(this.getId()+"--previewColCardFlex",{direction:"Column",height:"100%",width:"100%",items:[this.oPreviewVBoxSD,this.oPreviewColCardVBox]});this.oEditColumnInsightsCardsFlex=new a(this.getId()+"--editColumnInsightsCardsFlex",{height:"100%",width:"62%",direction:"Column",items:[this.oInsightsColumnEditVBox,this.oInsightsColumnEditFlexBox,this.oPreviewColCardFlex]});this.oInsightPreviewText=new i(this.getId()+"--insightPreviewText",{text:this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview"),textAlign:"Left"}).addStyleClass("sapUiTinyMarginTop sapUiSmallMarginEnd");this.oListViewLD=new y(this.getId()+"--idListViewLD",{icon:"sap-icon://list",key:"List"});this.oTableViewLD=new y(this.getId()+"--idTableViewLD",{icon:"sap-icon://table-view",key:"Table"});this.oColumnSegButton=new I(this.getId()+"--columnSegButton",{width:"3.75rem",selectionChange:this._onSegmentedSelectionChange.bind(this),tooltip:this.i18Bundle.getText("INT_LAYOUT_TOOLTIP"),items:[this.oListViewLD,this.oTableViewLD]});this.oPreviewTextHBox=new d(this.getId()+"--idPreviewTextHBox",{width:"100%",justifyContent:"Start",backgroundDesign:"Transparent",renderType:"Bare",items:[this.oInsightPreviewText,this.oColumnSegButton]});this.oPreviewPanelToolBar=new l(this.getId()+"--previewPanelToolBar",{style:"Clear",design:"Auto",content:[this.oPreviewTextHBox]}).addStyleClass("sapThemeBaseBG");this.oPreviewCard=new h(this.getId()+"--previewCard",{manifestApplied:this._setPreviewCardAriaText.bind(this,this.i18Bundle.getText("INT_DIALOG_TITLE_CardPreview")),width:"19rem",height:"35rem",host:this.host}).addStyleClass("sapMFlexBoxJustifyCenter");this.oInsightsColOverflowInnerHBox=new d(this.getId()+"--insightsColOverflowInnerHBox",{}).addStyleClass("insightsCardOverflowLayer insightsPreviewCardOverLay insightsColOverLayPositionLS");this.oInsightsColCardLayer=new d(this.getId()+"--insightsColCardLayer",{height:"0",items:[this.oInsightsColOverflowInnerHBox]}).addStyleClass("insightsCardOverflowLayer insightsPreviewCardOverLay");this.oCardsPreviewVBox=new o(this.getId()+"--idCardsPreviewVBox",{height:"100%",alignItems:"Center",backgroundDesign:"Transparent",justifyContent:"SpaceAround",items:[this.oPreviewCard,this.oInsightsColCardLayer]});this.oPreviewPanelContainer=new C(this.getId()+"--previewPanelContainer",{expanded:false,height:"100%",backgroundDesign:"Transparent",headerToolbar:[this.oPreviewPanelToolBar],content:[this.oCardsPreviewVBox]});this.oColCardsScroll=new r(this.getId()+"--colCardsScroll",{vertical:true,horizontal:false,height:"100%",content:[this.oPreviewPanelContainer]});this.oColumnPreviewCardFlexbox=new a(this.getId()+"--columnPreviewCardFlexbox",{direction:"Column",width:"38%",height:"100%",renderType:"Bare",items:[this.oColCardsScroll]}).addStyleClass("sapMPageBgStandard");this.oFlexContainerColumnContent=new o(this.getId()+"--flexContainerColumnContent",{height:"100%",width:"100%",direction:"Row",justifyContent:"SpaceBetween",items:[this.oEditColumnInsightsCardsFlex,this.oColumnPreviewCardFlexbox]})};N.prototype._setPreviewCardAriaText=function(e,t){var i=t.getSource()._ariaText.getText();var s=this.i18Bundle.getText(e);t.getSource()._ariaText.setText(s+i)};N.prototype._callPreview=function(){var e,t;t=p.getDialogBasedDevice()!==M.DEVICE_TYPES.Desktop;if(t){this.bShowPreview=true;this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(true);this.oPreviewColCardVBox.setVisible(true);this.oPreviewColCardFlex.setVisible(true);this.oInsightsColumnEditFlexBox.setVisible(false);this.oColumnPreviewCardFlexbox.setVisible(false);this.oInsightsColumnEditVBox.setVisible(false);e=t?this.oPreviewColCardSD:this.oPreviewCard}if(e){e.refresh()}};N.prototype._callClosePreview=function(){this.bShowPreview=false;this.oHideCardPreviewBtn.setVisible(false);this.oCardPreviewBtn.setVisible(true);this.oPreviewColCardFlex.setVisible(false);this.oInsightsColumnEditFlexBox.setVisible(true);this.oColumnPreviewCardFlexbox.setVisible(false);this.oInsightsColumnEditVBox.setVisible(true)};N.prototype._onColumnSearch=function(e){var t="";if(e){t=e.getSource().getValue()}var i=new V("title",_.Contains,t);var s=[];s.push(i);var o=this.oInsightsCardsEditColumnsListTable;var n=o.getBinding("items");n.filter(s,"Application")};N.prototype._refreshShowPreview=function(){this.bShowPreview=true;var e=p.getDialogBasedDevice()===M.DEVICE_TYPES.Desktop;var t=e?this.oPreviewCard:this.oPreviewColCardSD;if(t){t.refresh()}};N.prototype._onColumnDrop=function(e){var t=e.getParameter("dropPosition"),i=e.getParameter("draggedControl"),s=i.getBindingContextPath().split("/"),o=Number(s[2]),n=e.getParameter("droppedControl"),a=n.getBindingContextPath().split("/"),r=Number(a[2]),l=this.cardColumn;if(t==="Before"&&o===r-1){r--}else if(t==="After"&&o===r+1){r++}if(o!==r){if(t==="Before"&&o<r){r--}else if(t==="After"&&o>r){r++}var d=l.splice(o,1)[0];l.splice(r,0,d);this.cardColumn=l;this._innerModel.setProperty("/cardColumn",this.cardColumn);if(p.getDialogBasedDevice()===M.DEVICE_TYPES.Desktop){this._refreshShowPreview()}}};N.prototype._handleColumnVisibilityToggle=function(e){var t=e.getSource();this.sColumnPath=t.getBindingContext().getPath();var i=this._innerModel.getProperty(this.sColumnPath);var s=t.getSelected();i["visible"]=s;var o=this.iVisibleColumnCount;this.iVisibleColumnCount=s?o+1:o-1;if(this.oConfCard["sap.card"].content.row){this.oConfCard["sap.card"].content.row.columns=this.cardColumn}else{this.oConfCard["sap.card"].content.item.attributes=this.cardColumn}this._innerModel.setProperty("/visibleColumnCount",this.iVisibleColumnCount);if(this.iVisibleColumnCount>0){this.fireEnableAddButton({enableButton:true})}else{this.fireEnableAddButton({enableButton:false})}if(p.getDialogBasedDevice()===M.DEVICE_TYPES.Desktop){this.oPreviewCard.setPreviewMode(this.iVisibleColumnCount>0?"Off":"Abstract");this._refreshShowPreview()}else{this.oPreviewColCardSD.setPreviewMode(this.iVisibleColumnCount>0?"Off":"Abstract")}};N.prototype._onSegmentedSelectionChange=function(){var e=p.getDialogBasedDevice()===M.DEVICE_TYPES.Desktop?this.oColumnSegButton:this.oSdColumnSegButton,t=e.getSelectedKey();if(t==="Table"){var i=D.createListOptions(this.oConfCard);var s=i.filter(function(e){if(e){return e["sap.card"].type==="Table"}});if(s.length){this.oConfCard=s[0];var o=s[0]["sap.card"].content.row.columns;this.cardColumn=o}}else if(t==="List"){var n=D.createTableOptions(this.oConfCard);var a=n.filter(function(e){if(e){return e["sap.card"].type==="List"}});if(a.length){this.oConfCard=a[0];var r=a[0]["sap.card"].content.item.attributes;this.cardColumn=r}}this._innerModel.setProperty("/cardColumn",this.cardColumn);var l=p.getDialogBasedDevice()===M.DEVICE_TYPES.Desktop;var d=l?this.oPreviewCard:this.oPreviewColCardSD;if(d){d.setManifest(this.oConfCard)}};N.prototype._setCardColumnValue=function(e){var t=e["sap.card"];if(t.type==="Table"){var i;i=t.content.row.columns;this.cardColumn=i;var s=i.map(function(e){e["visible"]=e["visible"]?e["visible"]:false;return e}).filter(function(e){return e.visible});this.iVisibleColumnCount=s.length;this._innerModel.setProperty("/visibleColumnCount",this.iVisibleColumnCount);var o=D.createTableOptions(this.oConfCard);var n=o.filter(function(e){return e["sap.card"].type==="List"});if(n.length){this.oConfCard=n[0];var a=n[0]["sap.card"].content.item.attributes;this.cardColumn=a}this._innerModel.setProperty("/cardColumn",this.cardColumn);this.oInsightsCardsEditColumnsListTable.bindAggregation("items",{path:"/cardColumn",factory:this._generateTableColumnsTemplate.bind(this)})}};N.prototype._generateTableColumnsTemplate=function(){var e=new B({});var t=new d({items:[new P({src:"sap-icon://BusinessSuiteInAppSymbols/icon-grip"}).addStyleClass("compositeDndIcon"),new T({selected:"{= ${visible} ? true : false}",enabled:"{= !(!${visible} && (${/visibleColumnCount} > 2)) ? true : false}",select:this._handleColumnVisibilityToggle.bind(this)})]}).addStyleClass("sapUiNoPadding");var i=new x({title:"{title}",tooltip:"{title}"}).addStyleClass("sapUiNoPadding");e.addCell(t);e.addCell(i);return e};N.prototype._adjustLayoutStyles=function(){if(p.getDialogBasedDevice()!==M.DEVICE_TYPES.Desktop){this.bDesktop=false;if(this.bShowPreview===true){this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(true);this.oPreviewColCardFlex.setVisible(true);this.oInsightsColumnEditFlexBox.setVisible(false);this.oInsightsColumnEditVBox.setVisible(false)}else{this.oCardPreviewBtn.setVisible(true);this.oHideCardPreviewBtn.setVisible(false);this.oPreviewColCardFlex.setVisible(false);this.oInsightsColumnEditFlexBox.setVisible(true);this.oInsightsColumnEditVBox.setVisible(true);this.oEditColumnInsightsCardsFlex.setWidth("100%")}this.oColumnPreviewCardFlexbox.setVisible(false);this.oPreviewColCardSD.setManifest(this.oConfCard);this.oColumnSearch.setWidth("90%");this.oEditColumnsTableCheckBox.setWidth("20%");this.oEditColumnsName.setWidth("80%");this.oSdColumnSegButton.setSelectedKey(this.oConfCard["sap.card"].type);this.oPreviewColCardSD.refresh()}else{this.bDesktop=true;this.oColumnSearch.setWidth("100%");this.oEditColumnsTableCheckBox.setWidth("10%");this.oEditColumnsName.setWidth("90%");this.oPreviewCard.setManifest(this.oConfCard);this.oColumnSegButton.setSelectedKey(this.oConfCard["sap.card"].type);this.oCardPreviewBtn.setVisible(false);this.oHideCardPreviewBtn.setVisible(false);this.oPreviewColCardFlex.setVisible(false);this.oInsightsColumnEditVBox.setVisible(true);this.oInsightsColumnEditFlexBox.setVisible(true);this.oColumnPreviewCardFlexbox.setVisible(true);this.oPreviewCard.refresh()}var e=!this.bDesktop&&this.bShowPreview;this.oPreviewColCardVBox.setVisible(e?true:false);this.oPreviewColCardFlex.setVisible(e?true:false);this.oCardColumnPage.setTitle(this.getDialogTitle())};N.prototype._initConfigureCard=function(e){var t=e,i;var s=O.getElementById("myhomeSettingsView--INSIGHTS_CARDS");this.oOrgCard=t;i=JSON.parse(JSON.stringify(t));i=g.getCardPreviewManifest(i);this.oConfCard=i;this.iVisibleColumnCount=this.iVisibleColumnCount?this.iVisibleColumnCount:0;if(i){var o=i["sap.card"];if(o.type==="Table"){var n=p.getDialogBasedDevice()===M.DEVICE_TYPES.Desktop?this.oColumnSegButton:this.oSdColumnSegButton;n.setSelectedKey(this.oManifest["sap.card"].type);this._setCardColumnValue(i,s)}}};return N});
//# sourceMappingURL=ColumnListPreview.js.map