/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){function t(t,e,r){if(r){return e?e(t):t}if(!t||!t.then){t=Promise.resolve(t)}return e?t.then(e):t}sap.ui.define(["../../sina/SinaObject","../../core/util","./typeConverter","../tools/WhyfoundProcessor"],function(e,r,i,a){function u(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}function s(t,e,r){if(e)n(t.prototype,e);if(r)n(t,r);Object.defineProperty(t,"prototype",{writable:false});return t}function o(t,e){if(typeof e!=="function"&&e!==null){throw new TypeError("Super expression must either be null or a function")}t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:true,configurable:true}});Object.defineProperty(t,"prototype",{writable:false});if(e)l(t,e)}function l(t,e){l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function t(e,r){e.__proto__=r;return e};return l(t,e)}function f(t){var e=v();return function r(){var i=d(t),a;if(e){var u=d(this).constructor;a=Reflect.construct(i,arguments,u)}else{a=i.apply(this,arguments)}return c(this,a)}}function c(t,e){if(e&&(typeof e==="object"||typeof e==="function")){return e}else if(e!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return p(t)}function p(t){if(t===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t}function v(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(t){return false}}function d(t){d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function t(e){return e.__proto__||Object.getPrototypeOf(e)};return d(t)}
/*!
   * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
   */var b=e["SinaObject"];var g=a["WhyfoundProcessor"];var y=function(e){o(n,e);var a=f(n);function n(t){var e;u(this,n);e=a.call(this);e.provider=t;e.sina=t.sina;e.suvNavTargetResolver=e.sina._createSuvNavTargetResolver();return e}s(n,[{key:"parse",value:function t(e,r){if(r.ResultList.SearchResults===null){return Promise.resolve([])}var i=r.ResultList.SearchResults.results;return this.parseItems(i)}},{key:"parseItems",value:function t(e){var r=[];for(var i=0;i<e.length;++i){var a=e[i];var u=this.parseItem(a);r.push(u)}return Promise.all(r)}},{key:"parseItem",value:function e(a){try{const e=this;var u;var n={};var s=[];var o=[];var l=[];var f=[];var c=[];var p;var v=e.sina.getDataSource(a.DataSourceId);var d,b,y,h;var m=Number(a.Score)/100;var A=[];var T,_,O,I;var S={};var P={};var R=new g(e.sina);for(u=0;u<a.Attributes.results.length;u++){d=a.Attributes.results[u];b=v.getAttributeMetadata(d.Id);y=e.sina._createSearchResultSetItemAttribute({id:d.Id,label:b.label,value:i.odata2Sina(b.type,d.Value),valueFormatted:d.ValueFormatted!==undefined?d.ValueFormatted:d.Value,valueHighlighted:d.Snippet||"",isHighlighted:d.Snippet.indexOf("<b>")>-1&&d.Snippet.indexOf("</b>")>-1,metadata:b,groups:[]});n[y.id]=y;r.appendRemovingDuplicates(A,r.extractHighlightedTerms(y.valueHighlighted));if(b.suvUrlAttribute&&b.suvMimeTypeAttribute){O=n[b.suvUrlAttribute]||b.suvUrlAttribute.id;I=n[b.suvMimeTypeAttribute]||b.suvMimeTypeAttribute.id;S[d.Id]={suvThumbnailAttribute:y,suvTargetUrlAttribute:O,suvTargetMimeTypeAttribute:I}}if(b.usage.Navigation){if(b.usage.Navigation.mainNavigation){p=e.sina._createNavigationTarget({text:y.value,targetUrl:y.value,target:"_blank"})}}l.push(y);if(b.usage.Detail){f.push(y)}if(b.usage.Title){s.push(y)}if(b.usage.TitleDescription){o.push(y)}h=v.attributeMetadataMap[y.id]._private.semanticObjectType;if(h&&h.length>0){c.push({name:h,value:y.value,type:y.metadata.type})}if(y.isHighlighted||y.descriptionAttribute&&y.descriptionAttribute.isHighlighted){if(!e._isVisible(b)&&typeof P[y.id]==="undefined"){P[y.id]=[y.valueHighlighted]}}}for(_ in S){T=S[_];if(typeof T.suvTargetUrlAttribute==="string"){T.suvTargetUrlAttribute=n[T.suvTargetUrlAttribute]}if(typeof T.suvTargetMimeTypeAttribute==="string"){T.suvTargetMimeTypeAttribute=n[T.suvTargetMimeTypeAttribute]}if(!(T.suvTargetUrlAttribute||T.suvTargetMimeTypeAttribute)){delete S[_]}}s.sort(function(t,e){return t.metadata.usage.Title.displayOrder-e.metadata.usage.Title.displayOrder});f.sort(function(t,e){return t.metadata.usage.Detail.displayOrder-e.metadata.usage.Detail.displayOrder});e.suvNavTargetResolver.resolveSuvNavTargets(v,S,A);var j=e.sina._createSearchResultSetItem({dataSource:v,attributes:l,titleAttributes:s,titleDescriptionAttributes:o,detailAttributes:f,defaultNavigationTarget:p,navigationTargets:[],score:m});j._private.allAttributesMap=n;j._private.semanticObjectTypeAttributes=c;var w=e.sina._createItemPostParser({searchResultSetItem:j});var D=j.detailAttributes;return t(w.postParseResultSetItem(),function(r){P=e._pushAdditionalWhyFounds(a,P,D);return t(R.processAdditionalWhyfoundAttributes(P,r))})}catch(t){return Promise.reject(t)}}},{key:"_isVisible",value:function t(e){if(typeof e.usage.Title!=="undefined"||typeof e.usage.Detail!=="undefined"||typeof e.isDescription!=="undefined"){return true}if(Array.isArray(e.groups)){for(var r=0;r<e.groups.length;r++){var i=e.groups[r].group;if(this._isVisible(i)&&this._isInTamplate(e.id,i)){return true}}return false}return false}},{key:"_isInTamplate",value:function t(e,r){if(r.template&&r.attributes&&r.attributes.length>0){var i=this._getNameInGroup(e,r.attributes);if(i&&r.template.includes("{"+i+"}")){return true}}return false}},{key:"_getNameInGroup",value:function t(e,r){for(var i=0;i<r.length;i++){if(r[i].attribute.id===e){return r[i].nameInGroup}}return undefined}},{key:"_pushAdditionalWhyFounds",value:function t(e,r,i){if(e.HitAttributes&&Array.isArray(e.HitAttributes.results)){for(var a=0;a<e.HitAttributes.results.length;a++){var u=e.HitAttributes.results[a];if(typeof r[u.Id]==="undefined"&&!this._isUngrouppedDetailAttribute(u.Id,i)){r[u.Id]=[u.Snippet]}}}return r}},{key:"_isUngrouppedDetailAttribute",value:function t(e,r){for(var i=0;i<r.length;i++){if(e===r[i].id){return true}}return false}}]);return n}(b);var h={__esModule:true};h.ItemParser=y;return h})})();
//# sourceMappingURL=ItemParser.js.map