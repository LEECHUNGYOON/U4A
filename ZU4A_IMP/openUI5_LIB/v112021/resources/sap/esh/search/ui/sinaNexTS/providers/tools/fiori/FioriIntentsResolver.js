/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){function e(e,t,n){if(n){return t?t(e):e}if(!e||!e.then){e=Promise.resolve(e)}return t?e.then(t):e}function t(e,t,n){if(n){return t?t(e()):e()}try{var r=Promise.resolve(e());return t?r.then(t):r}catch(e){return Promise.reject(e)}}function n(e,t){var n=e();if(n&&n.then){return n.then(t)}return t(n)}function r(e,t){try{var n=e()}catch(e){return t(e)}if(n&&n.then){return n.then(void 0,t)}return n}sap.ui.define(["../../../sina/SinaObject","../../../sina/AttributeType","./NavigationServiceFactory"],function(i,o,a){function u(e,t){var n=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=c(e))||t&&e&&typeof e.length==="number"){if(n)e=n;var r=0;var i=function(){};return{s:i,n:function(){if(r>=e.length)return{done:true};return{done:false,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,a=false,u;return{s:function(){n=n.call(e)},n:function(){var e=n.next();o=e.done;return e},e:function(e){a=true;u=e},f:function(){try{if(!o&&n.return!=null)n.return()}finally{if(a)throw u}}}}function s(e,t){return v(e)||d(e,t)||c(e,t)||f()}function f(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){if(!e)return;if(typeof e==="string")return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}function l(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t){var n=e==null?null:typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(n==null)return;var r=[];var i=true;var o=false;var a,u;try{for(n=n.call(e);!(i=(a=n.next()).done);i=true){r.push(a.value);if(t&&r.length===t)break}}catch(e){o=true;u=e}finally{try{if(!i&&n["return"]!=null)n["return"]()}finally{if(o)throw u}}return r}function v(e){if(Array.isArray(e))return e}function y(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}function h(e,t,n){if(t)g(e.prototype,t);if(n)g(e,n);Object.defineProperty(e,"prototype",{writable:false});return e}function m(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});Object.defineProperty(e,"prototype",{writable:false});if(t)p(e,t)}function p(e,t){p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,n){t.__proto__=n;return t};return p(e,t)}function b(e){var t=T();return function n(){var r=w(e),i;if(t){var o=w(this).constructor;i=Reflect.construct(r,arguments,o)}else{i=r.apply(this,arguments)}return S(this,i)}}function S(e,t){if(t&&(typeof t==="object"||typeof t==="function")){return t}else if(t!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return I(e)}function I(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function T(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function w(e){w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function e(t){return t.__proto__||Object.getPrototypeOf(t)};return w(e)}var P=i["SinaObject"];var O=o["AttributeType"];var j=a["getNavigationService"];var _=function(i){m(a,i);var o=b(a);function a(e){var t,n,r;var i;y(this,a);i=o.call(this,e);var u=typeof window!=="undefined"?(t=window)===null||t===void 0?void 0:(n=t.sap)===null||n===void 0?void 0:(r=n.ushell)===null||r===void 0?void 0:r["Container"]:null;if(u){i._fioriFrontendSystemInfo={systemId:u.getLogonSystem().getName(),client:u.getLogonSystem().getClient()};i._primaryIntentAction="-displayFactSheet";i._suppressInSearchTag="suppressInEnterpriseSearch".toLowerCase()}else{i._fioriFrontendSystemInfo={systemId:i.getLogonSystem().getName(),client:i.getLogonSystem().getClient()}}return i}h(a,[{key:"resolveIntents",value:function n(r){const i=this;var o=i;return t(j,function(t){if(!t||!r){return{defaultNavigationTarget:r.fallbackDefaultNavigationTarget}}if(Array.isArray(r)){var n=r.map(function(e){return o.doResolveIntents(e)});return e(Promise.all(n))}else{return e(i.doResolveIntents(r))}})}},{key:"doResolveIntents",value:function t(r){try{var i,o,a,f;const t=this;var c=r.semanticObjectType;var l=r.semanticObjectTypeAttributes;var d=r.systemId;var v=r.client;var y=r.fallbackDefaultNavigationTarget;if(!c||c.length===0){return e({defaultNavigationTarget:y})}if(!l||l.length===0){return e(undefined)}var g=t.convertSemanticObjectTypeAttrs(l);return e(Promise.all([t.getPrimaryIntent(c,g),t.getSecondaryIntents(c,g)]),function(r){i=r;o=s(i,2);a=o[0];f=o[1];var c={defaultNavigationTarget:undefined,navigationTargets:[]};var l=t.assembleSapSystem(d,v);var y;return n(function(){if(a&&!t.shallIntentBeSuppressed(a)){return e(t.getNavigationTargetForIntent(a,l),function(e){y=e;c.defaultNavigationTarget=y})}},function(){var n=c.defaultNavigationTarget!==undefined;if(!f){return c}var r=[];var i=[];var o=u(f),a;try{for(o.s();!(a=o.n()).done;){var s=a.value;if(t.shallIntentBeSuppressed(s)){continue}r.push(s);i.push(t.getNavigationTargetForIntent(s,l))}}catch(e){o.e(e)}finally{o.f()}return e(Promise.all(i),function(e){for(var i=0;i<r.length;++i){var o=r[i];var a=e[i];if(!n&&t.isPrimaryIntentAction(o)){c.defaultNavigationTarget=a;n=true}else if(!y||!a.isEqualTo(y)){c.navigationTargets.push(a)}}return c})})})}catch(e){return Promise.reject(e)}}},{key:"isPrimaryIntentAction",value:function e(t){var n=t.intent.substring(t.intent.indexOf("-"),t.intent.indexOf("?"));return n===this._primaryIntentAction}},{key:"assembleSapSystem",value:function e(t,n){var r={systemId:t||this._fioriFrontendSystemInfo&&this._fioriFrontendSystemInfo.systemId,client:n||this._fioriFrontendSystemInfo.client&&this._fioriFrontendSystemInfo.client};if(window.sap&&window.sap["cf"]||t&&t.trim().length>0&&n&&n.trim().length>0&&(!this._fioriFrontendSystemInfo||!(this._fioriFrontendSystemInfo.systemId===t&&this._fioriFrontendSystemInfo.client===n))){r.urlParameter="sap-system=sid("+t+"."+n+")"}return r}},{key:"convertSemanticObjectTypeAttrs",value:function e(t){var n={};var r=u(t),i;try{for(r.s();!(i=r.n()).done;){var o=i.value;var a=this.convertAttributeValueToUI5DataTypeFormats(o.value,o.type);n[o.name]=a}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"getPrimaryIntent",value:function n(i,o){const a=this;return t(j,function(t){return!t||!t.getPrimaryIntent?undefined:r(function(){return e(a.convertJQueryDeferredToPromise(t.getPrimaryIntent(i,o)))},function(){return undefined})})}},{key:"getSecondaryIntents",value:function n(i,o){const a=this;return t(j,function(t){return t?t.getLinks?r(function(){return e(a.convertJQueryDeferredToPromise(t.getLinks({semanticObject:i,params:o,withAtLeastOneUsedParam:true,sortResultOnTexts:true})))},function(){return undefined}):undefined:undefined})}},{key:"shallIntentBeSuppressed",value:function e(t){if(t.tags){for(var n=0;n<t.tags.length;n++){if(t.tags[n].toLowerCase()===this._suppressInSearchTag){return true}}}return false}},{key:"getNavigationTargetForIntent",value:function n(r,i){const o=this;return t(j,function(t){var n=o;var a=r.intent;if(i.urlParameter){if(a.indexOf("?")===-1){a+="?"}else{a+="&"}a+=i.urlParameter}var u={target:{shellHash:a}};return e(o.convertJQueryDeferredToPromise(t.hrefForExternalAsync(u)),function(e){var i=n.sina._createNavigationTarget({text:r.text,targetUrl:e,customWindowOpenFunction:function e(){t.toExternal(u)}});return i})})}},{key:"convertAttributeValueToUI5DataTypeFormats",value:function e(t,n){var r,i,o,a,u,s,f;switch(n){case O.Timestamp:r=t.getUTCFullYear();i=t.getUTCMonth()+1;o=t.getUTCDate();a=t.getUTCHours();u=t.getUTCMinutes();s=t.getUTCSeconds();f=t.getUTCMilliseconds()*1e3;t=this.addLeadingZeros(r.toString(),4)+"-"+this.addLeadingZeros(i.toString(),2)+"-"+this.addLeadingZeros(o.toString(),2)+"T"+this.addLeadingZeros(a.toString(),2)+":"+this.addLeadingZeros(u.toString(),2)+":"+this.addLeadingZeros(s.toString(),2)+"."+this.addLeadingZeros(f.toString(),3);break;case O.Date:t=t.slice(0,4)+"-"+t.slice(5,7)+"-"+t.slice(8,10);break}return t}},{key:"addLeadingZeros",value:function e(t,n){return"00000000000000".slice(0,n-t.length)+t}},{key:"getLogonSystem",value:function e(){return{getName:function e(){return},getClient:function e(){return},getPlatform:function e(){return}}}},{key:"convertJQueryDeferredToPromise",value:function e(t){if(t.always){return new Promise(function(e,n){t.then(e,n)})}else{return t}}}]);return a}(P);var A={__esModule:true};A.FioriIntentsResolver=_;return A})})();
//# sourceMappingURL=FioriIntentsResolver.js.map