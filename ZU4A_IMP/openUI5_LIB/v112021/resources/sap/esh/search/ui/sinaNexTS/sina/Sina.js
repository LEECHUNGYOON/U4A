/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){function e(){}function t(t,r){if(!r){return t&&t.then?t.then(e):Promise.resolve()}}function r(e,t){var r=e();if(r&&r.then){return r.then(t)}return t(r)}function a(e,t,r){if(r){return t?t(e):e}if(!e||!e.then){e=Promise.resolve(e)}return t?e.then(t):e}sap.ui.define(["../core/core","../core/errors","../core/util","./AttributeType","./AttributeFormatType","./AttributeGroupTextArrangement","./DataSourceType","./MatchingStrategy","./LogicalOperator","./ComparisonOperator","./FacetType","./SuggestionCalculationMode","./SuggestionType","./SortOrder","./ConditionType","../providers/tools/cds/CDSAnnotationsParser","../providers/tools/sors/NavigationTargetGenerator","./SearchResultSet","./SearchResultSetItem","./SearchResultSetItemAttribute","./ObjectSuggestion","./SearchQuery","./ChartQuery","./SuggestionQuery","./DataSourceQuery","./Filter","./ComplexCondition","./SimpleCondition","./AttributeMetadata","./AttributeGroupMetadata","./AttributeGroupMembership","./SearchResultSetItemAttributeGroup","./SearchResultSetItemAttributeGroupMembership","./SearchTermSuggestion","./SearchTermAndDataSourceSuggestion","./DataSourceSuggestion","./SuggestionResultSet","./ChartResultSet","./DataSourceResultSet","./ChartResultSetItem","./DataSourceResultSetItem","./Capabilities","./Configuration","./NavigationTarget","./formatters/Formatter","./DataSource","./UserCategoryDataSource","../providers/tools/ItemPostParser","../providers/tools/fiori/SuvNavTargetResolver","../providers/tools/fiori/FioriIntentsResolver","./formatters/ResultValueFormatter","./formatters/NavtargetsInResultSetFormatter","./formatters/HierarchyResultSetFormatter","./formatters/ConfigSearchResultSetFormatter","./formatters/ConfigMetadataFormatter","./FilteredDataSource","../providers/inav2/Provider","../providers/abap_odata/Provider","./HierarchyQuery","./HierarchyNode","./HierarchyResultSet","../providers/inav2/typeConverter","./HierarchyNodePath","./HierarchyDisplayType"],function(e,i,o,n,s,c,u,h,l,S,v,y,f,d,p,m,g,b,F,C,A,D,R,O,T,j,w,_,P,I,M,k,N,H,x,G,Q,L,E,J,U,B,$,V,z,q,K,W,X,Y,Z,ee,te,re,ae,ie,oe,ne,se,ce,ue,he,le,Se){function ve(e,t){var r=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ye(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var a=0;var i=function(){};return{s:i,n:function(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,n=false,s;return{s:function(){r=r.call(e)},n:function(){var e=r.next();o=e.done;return e},e:function(e){n=true;s=e},f:function(){try{if(!o&&r.return!=null)r.return()}finally{if(n)throw s}}}}function ye(e,t){if(!e)return;if(typeof e==="string")return fe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fe(e,t)}function fe(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function de(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function pe(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}function me(e,t,r){if(t)pe(e.prototype,t);if(r)pe(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function ge(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}var be=n["AttributeType"];var Fe=s["AttributeFormatType"];var Ce=c["AttributeGroupTextArrangement"];var Ae=u["DataSourceSubType"];var De=u["DataSourceType"];var Re=h["MatchingStrategy"];var Oe=l["LogicalOperator"];var Te=S["ComparisonOperator"];var je=v["FacetType"];var we=y["SuggestionCalculationMode"];var _e=f["SuggestionType"];var Pe=d["SortOrder"];var Ie=p["ConditionType"];var Me=m["CDSAnnotationsParser"];var ke=g["NavigationTargetGenerator"];var Ne=b["SearchResultSet"];var He=F["SearchResultSetItem"];var xe=C["SearchResultSetItemAttribute"];var Ge=A["ObjectSuggestion"];var Qe=D["SearchQuery"];var Le=R["ChartQuery"];var Ee=O["SuggestionQuery"];var Je=T["DataSourceQuery"];var Ue=j["Filter"];var Be=w["ComplexCondition"];var $e=_["SimpleCondition"];var Ve=P["AttributeMetadata"];var ze=I["AttributeGroupMetadata"];var qe=M["AttributeGroupMembership"];var Ke=k["SearchResultSetItemAttributeGroup"];var We=N["SearchResultSetItemAttributeGroupMembership"];var Xe=H["SearchTermSuggestion"];var Ye=x["SearchTermAndDataSourceSuggestion"];var Ze=G["DataSourceSuggestion"];var et=Q["SuggestionResultSet"];var tt=L["ChartResultSet"];var rt=E["DataSourceResultSet"];var at=J["ChartResultSetItem"];var it=U["DataSourceResultSetItem"];var ot=B["Capabilities"];var nt=$["Configuration"];var st=V["NavigationTarget"];var ct=z["Formatter"];var ut=q["DataSource"];var ht=K["UserCategoryDataSource"];var lt=W["ItemPostParser"];var St=X["SuvNavTargetResolver"];var vt=Y["FioriIntentsResolver"];var yt=Z["ResultValueFormatter"];var ft=ee["NavtargetsInResultSetFormatter"];var dt=te["HierarchyResultSetFormatter"];var pt=re["ConfigSearchResultSetFormatter"];var mt=ae["ConfigMetadataFormatter"];var gt=ie["FilteredDataSource"];var bt=oe["Provider"];var Ft=ne["Provider"];var Ct=se["HierarchyQuery"];var At=ce["HierarchyNode"];var Dt=ue["HierarchyResultSet"];var Rt=le["HierarchyNodePath"];var Ot=Se["HierarchyDisplayType"];var Tt=function(){function n(t){de(this,n);ge(this,"isNeededCache",{});this.core=e;this.errors=i;this.util=o;this.inav2TypeConverter=he;this.provider=t;this.createSearchQuery=this.createSinaObjectFactory(Qe);this.createChartQuery=this.createSinaObjectFactory(Le);this.createHierarchyQuery=this.createSinaObjectFactory(Ct);this.createSuggestionQuery=this.createSinaObjectFactory(Ee);this.createDataSourceQuery=this.createSinaObjectFactory(Je);this.createFilter=this.createSinaObjectFactory(Ue);this.createComplexCondition=this.createSinaObjectFactory(Be);this.createSimpleCondition=this.createSinaObjectFactory($e);this.createHierarchyNode=this.createSinaObjectFactory(At);this.createHierarchyNodePath=this.createSinaObjectFactory(Rt);this._createAttributeMetadata=this.createSinaObjectFactory(Ve);this._createAttributeGroupMetadata=this.createSinaObjectFactory(ze);this._createAttributeGroupMembership=this.createSinaObjectFactory(qe);this._createSearchResultSetItemAttribute=this.createSinaObjectFactory(xe);this._createSearchResultSetItemAttributeGroup=this.createSinaObjectFactory(Ke);this._createSearchResultSetItemAttributeGroupMembership=this.createSinaObjectFactory(We);this._createSearchResultSetItem=this.createSinaObjectFactory(He);this._createSearchResultSet=this.createSinaObjectFactory(Ne);this._createSearchTermSuggestion=this.createSinaObjectFactory(Xe);this._createSearchTermAndDataSourceSuggestion=this.createSinaObjectFactory(Ye);this._createDataSourceSuggestion=this.createSinaObjectFactory(Ze);this._createObjectSuggestion=this.createSinaObjectFactory(Ge);this._createSuggestionResultSet=this.createSinaObjectFactory(et);this._createChartResultSet=this.createSinaObjectFactory(tt);this._createHierarchyResultSet=this.createSinaObjectFactory(Dt);this._createChartResultSetItem=this.createSinaObjectFactory(at);this._createDataSourceResultSetItem=this.createSinaObjectFactory(it);this._createCapabilities=this.createSinaObjectFactory(ot);this._createConfiguration=this.createSinaObjectFactory(nt);this._createNavigationTarget=this.createSinaObjectFactory(st);this._createSorsNavigationTargetGenerator=this.createSinaObjectFactory(ke);this._createFioriIntentsResolver=this.createSinaObjectFactory(vt);this._createCDSAnnotationsParser=this.createSinaObjectFactory(Me);this._createItemPostParser=this.createSinaObjectFactory(lt);this._createSuvNavTargetResolver=this.createSinaObjectFactory(St);this.searchResultSetFormatters=[];this.suggestionResultSetFormatters=[];this.chartResultSetFormatters=[];this.metadataFormatters=[];this.dataSources=[];this.dataSourceMap={};this.allDataSource=this.createDataSource({id:"All",label:"All",type:De.Category});this.searchResultSetFormatters.push(new ft);this.searchResultSetFormatters.push(new dt);this.searchResultSetFormatters.push(new yt);this.DataSourceType=De;this.DataSourceSubType=Ae;this.HierarchyDisplayType=Ot;this.AttributeGroupTextArrangement=Ce;this.AttributeType=be;this.AttributeFormatType=Fe;this.FacetType=je;this.SuggestionType=_e;this.ConditionType=Ie;this.SuggestionCalculationMode=we;this.SortOrder=Pe;this.MatchingStrategy=Re;this.ComparisonOperator=Te;this.LogicalOperator=Oe}me(n,[{key:"initAsync",value:function e(o){try{const e=this;e.configuration=o;e.isDummyProvider=o.provider.indexOf("dummy")>-1;e.provider.label=o.label;return a(e._evaluateConfigurationAsync(o),function(){o.sina=e;return a(e.provider.initAsync(o),function(n){n=n||{capabilities:null};e.capabilities=n.capabilities||e._createCapabilities({sina:e});return a(e._formatMetadataAsync(),function(){return r(function(){if(o.initAsync){return t(o.initAsync(e))}},function(){if(e.getBusinessObjectDataSources().length===0&&!e.isDummyProvider){throw new i.ESHNotActiveError("Not active - no datasources")}})})})})}catch(e){return Promise.reject(e)}}},{key:"_formatMetadataAsync",value:function t(){return e.executeSequentialAsync(this.metadataFormatters,function(e){return e.formatAsync({dataSources:this.dataSources})}.bind(this))}},{key:"_evaluateConfigurationAsync",value:function e(t){try{const e=this;var r=[];if(t.searchResultSetFormatters){for(var a=0;a<t.searchResultSetFormatters.length;++a){var i=t.searchResultSetFormatters[a];if(!(i instanceof ct)&&!i.formatAsync){i=new pt(i)}e.searchResultSetFormatters.push(i);if(i.initAsync){r.push(i.initAsync())}}}if(t.suggestionResultSetFormatters){for(var o=0;o<t.suggestionResultSetFormatters.length;++o){var n=t.suggestionResultSetFormatters[o];e.suggestionResultSetFormatters.push(n);if(n.initAsync){r.push(n.initAsync())}}}if(t.chartResultSetFormatters){for(var s=0;s<t.chartResultSetFormatters.length;++s){var c=t.chartResultSetFormatters[s];e.chartResultSetFormatters.push(c);if(c.initAsync){r.push(c.initAsync())}}}if(t.metadataFormatters){for(var u=0;u<t.metadataFormatters.length;++u){var h=t.metadataFormatters[u];if(!(h instanceof ct)&&!h.formatAsync){h=new mt(h)}e.metadataFormatters.push(h);if(h.initAsync){r.push(h.initAsync())}}}return Promise.all(r)}catch(e){return Promise.reject(e)}}},{key:"loadMetadata",value:function e(t){try{const e=this;if(e.provider instanceof bt){if(e.provider.loadMetadata){return a(e.provider.loadMetadata(t))}}return Promise.resolve()}catch(e){return Promise.reject(e)}}},{key:"createDataSourceMap",value:function e(t){var r={};for(var a=0;a<t.length;++a){var i=t[a];r[i.id]=i}return r}},{key:"createSinaObjectFactory",value:function e(t){return function(e){var r;e=(r=e)!==null&&r!==void 0?r:{sina:this};e.sina=this;return new t(e)}}},{key:"_createDataSourceResultSet",value:function e(t){var r=this.removeHierarchyDataSources(t.items,function(e){return e.dataSource});t.items=r;var a=new rt(t);a.sina=this;return a}},{key:"removeHierarchyDataSources",value:function e(t,r){var a=this;var i=function e(t){var r=a.isNeededCache[t.id];if(typeof r!=="undefined"){return r}var i=ve(a.dataSources),o;try{for(i.s();!(o=i.n()).done;){var n=o.value;var s=ve(n.attributesMetadata),c;try{for(s.s();!(c=s.n()).done;){var u=c.value;if(u.hierarchyName===t.hierarchyName&&u.hierarchyDisplayType===Ot.HierarchyResultView){a.isNeededCache[t.id]=true;return true}}}catch(e){s.e(e)}finally{s.f()}}}catch(e){i.e(e)}finally{i.f()}a.isNeededCache[t.id]=false;return false};for(var o=0;o<t.length;o++){var n=t[o];var s=r(n);if(!s.isHierarchyDataSource){continue}if(!i(s)){t.splice(o,1);o--}}return t}},{key:"createDataSource",value:function e(t){t.sina=this;var r;switch(t.type){case De.BusinessObject:switch(t.subType){case Ae.Filtered:r=new gt(t);break;default:r=new ut(t)}break;case De.UserCategory:r=new ht(t);break;default:r=new ut(t)}if(this.dataSourceMap[r.id]){throw new i.CanNotCreateAlreadyExistingDataSourceError('cannot create an already existing datasource: "'+r.id+'"')}this._addDataSource(r);return r}},{key:"_createDataSource",value:function e(t){return this.createDataSource(t)}},{key:"_addDataSource",value:function e(t){if(t.type===De.BusinessObject&&t.subType===Ae.Filtered){var r=-1;for(var a=this.dataSources.length-1;a>=1;--a){var i=this.dataSources[a];if(i.type===De.BusinessObject&&i.subType===Ae.Filtered){r=a;break}}if(r>=0){this.dataSources.splice(r+1,0,t)}else{this.dataSources.push(t)}}else{this.dataSources.push(t)}this.dataSourceMap[t.id]=t}},{key:"getAllDataSource",value:function e(){return this.allDataSource}},{key:"getBusinessObjectDataSources",value:function e(){var t=[];for(var r=0;r<this.dataSources.length;++r){var a=this.dataSources[r];if(!a.hidden&&a.type===De.BusinessObject&&a.subType!==Ae.Filtered){t.push(a)}}return this.removeHierarchyDataSources(t,function(e){return e})}},{key:"getDataSource",value:function e(t){return this.dataSourceMap[t]}},{key:"getConfigurationAsync",value:function e(){try{const e=arguments,r=this;var t=e.length>0&&e[0]!==undefined?e[0]:{};if(r.provider instanceof bt||r.provider instanceof Ft){if(r.configurationPromise&&!t.forceReload){return a(r.configurationPromise)}r.configurationPromise=r.provider.getConfigurationAsync();return a(r.configurationPromise)}return Promise.resolve(r._createConfiguration({personalizedSearch:false,isPersonalizedSearchEditable:false}))}catch(e){return Promise.reject(e)}}},{key:"logUserEvent",value:function e(t){this.provider.logUserEvent(t)}},{key:"getDebugInfo",value:function e(){return this.provider.getDebugInfo()}},{key:"parseDataSourceFromJson",value:function e(t){var r=this.getDataSource(t.id);if(r){return r}if(t.type!==De.Category){throw new i.DataSourceInURLDoesNotExistError("Datasource in URL does not exist "+t.id)}r=this._createDataSource(t);return r}},{key:"parseSimpleConditionFromJson",value:function t(r){var a;if(e.isObject(r.value)){a=o.dateFromJson(r.value)}else{a=r.value}var i;if(r.userDefined){i=true}else{i=false}var n;if(r.dynamic){n=true}else{n=false}return this.createSimpleCondition({operator:r.operator,attribute:r.attribute,value:a,attributeLabel:r.attributeLabel,valueLabel:r.valueLabel,userDefined:i,isDynamicValue:n})}},{key:"parseComplexConditionFromJson",value:function e(t){var r=[];for(var a=0;a<t.conditions.length;++a){var i=t.conditions[a];r.push(this.parseConditionFromJson(i))}var o;if(t.userDefined){o=true}else{o=false}return this.createComplexCondition({operator:t.operator,conditions:r,attributeLabel:t.attributeLabel,valueLabel:t.valueLabel,userDefined:o})}},{key:"parseConditionFromJson",value:function e(t){switch(t.type){case Ie.Simple:return this.parseSimpleConditionFromJson(t);case Ie.Complex:return this.parseComplexConditionFromJson(t);default:throw new i.UnknownConditionTypeError('unknown condition type "'+t.type+'"')}}},{key:"parseFilterFromJson",value:function e(t){var r=this.parseConditionFromJson(t.rootCondition);if(r instanceof Be){return this.createFilter({searchTerm:t===null||t===void 0?void 0:t.searchTerm,rootCondition:r,dataSource:this.parseDataSourceFromJson(t.dataSource)})}else{throw new i.UnknownConditionTypeError("Only complex condition is allowed in Filter JSON")}}},{key:"createStaticHierarchySearchNavigationTarget",value:function e(t,r,a,i,o){if(!o){o=a.hierarchyAttribute;if(!o){var n=a.getHierarchyDataSource();if(n&&n.hierarchyAttribute){o=n.hierarchyAttribute}else{return null}}}var s=new Ue({dataSource:a,searchTerm:"",sina:this});if(t!=="$$ROOT$$"){var c=new $e({attribute:o,operator:Te.DescendantOf,value:t,valueLabel:r});s.autoInsertCondition(c)}return this.createSearchNavigationTarget(s,i||"Children Folders")}},{key:"getHierarchyDataSource",value:function e(t){var r=this.dataSources;for(var a=0;a<r.length;++a){var i=r[a];if(i.type!==this.DataSourceType.BusinessObject){continue}if(!i.isHierarchyDataSource){continue}if(t===i.hierarchyName){return i}}}}]);return n}();var jt={__esModule:true};jt.Sina=Tt;return jt})})();
//# sourceMappingURL=Sina.js.map