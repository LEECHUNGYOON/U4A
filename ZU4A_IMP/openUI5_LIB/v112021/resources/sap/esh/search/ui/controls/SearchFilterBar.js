/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["../i18n","sap/m/Text","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/library","sap/ui/core/Icon","../eventlogging/UserEvents","../sinaNexTS/sina/HierarchyDisplayType","../error/errors"],function(t,e,r,i,a,n,o,s,l){function u(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}var c=u(t);var f=a["ToolbarDesign"];var h=o["UserEventType"];var d=s["HierarchyDisplayType"];var p=u(l);var v=r.extend("sap.esh.search.ui.controls.SearchFilterBar",{renderer:{apiVersion:2},constructor:function t(a,o){r.prototype.constructor.call(this,a,o);this.setProperty("design",f.Info);this.addStyleClass("sapUshellSearchFilterContextualBar");this.filterFormatter=this.filterFormatter.bind(this);this.filterText=new e(this.getId()+"-resetFilterText",{text:{parts:[{path:"/uiFilter/rootCondition"},{path:"/facets"}],formatter:this.filterFormatter},tooltip:{parts:[{path:"/uiFilter/rootCondition"},{path:"/facets"}],formatter:this.filterFormatter}}).addStyleClass("sapUshellSearchFilterText");this.filterText.setMaxLines(1);this.filterText.clampText();this.addContent(this.filterText);this.addContent(new i);this.resetButton=new n(this.getId()+"-resetFilterButton",{src:"sap-icon://clear-filter",tooltip:c.getText("resetFilterButton_tooltip")}).addStyleClass("sapUshellSearchFilterResetButton");this.addContent(this.resetButton)},filterFormatter:function t(e,r){if(!e||!e.hasFilters()){return""}var i=this.getModel();if(i.config.formatFilterBarText){try{return i.config.formatFilterBarText(this._assembleFilterLabels(e,r))}catch(t){var a=new p.ConfigurationExitError("formatFilterBarText",i.config.applicationComponent,t);var n=i.getSearchCompositeControlInstanceByChildControl(this);n===null||n===void 0?void 0:n.errorHandler.onError(a);return this._formatFilterText(e,r)}}else{return this._formatFilterText(e,r)}},_assembleFilterLabels:function t(e,r){var i=[];e=this.sortConditions(e,r);for(var a=0;a<e.conditions.length;++a){var n,o;var s=e.conditions[a];var l=this.getModel();var u=s.getFirstAttribute();var c=(n=l.getProperty("/uiFilter"))===null||n===void 0?void 0:n.dataSource.attributeMetadataMap[u];if(c&&c.isHierarchy===true&&c.hierarchyDisplayType===d.StaticHierarchyFacet){continue}if(s.containsAttribute((o=l.config)===null||o===void 0?void 0:o.dimensionNameSpace_Description)){continue}var f={attributeName:c.id,attributeLabel:"",attributeFilterValueLabels:[]};i.push(f);for(var h=0;h<s.conditions.length;++h){var p=s.conditions[h];if(h===0){f.attributeLabel=p.attributeLabel}f.attributeFilterValueLabels.push(this._formatLabel(p.valueLabel||p.value,p.operator))}}return i},_formatFilterText:function t(e,r){var i=this._assembleFilterLabels(e,r);var a=i.map(function(t){return t.attributeLabel+" ("+t.attributeFilterValueLabels.join(", ")+")"});return c.getText("filtered_by",[a.join(", ")])},_formatLabel:function t(e,r){var i;switch(r){case this.getModel().sinaNext.ComparisonOperator.Bw:i=e+"*";break;case this.getModel().sinaNext.ComparisonOperator.Ew:i="*"+e;break;case this.getModel().sinaNext.ComparisonOperator.Co:i="*"+e+"*";break;default:i=e;break}return i},sortConditions:function t(e,r){if(r.length===0){return e}var i=function t(e){var r=e.conditions[0];if(r.attribute){return r.attribute}return r.conditions[0].attribute};var a=function t(e,r,i){for(var a=0;a<e.length;++a){var n=e[a];if(n[r]===i){return a}}};e=e.clone();e.conditions.sort(function(t,e){var n=i(t);var o=a(r,"dimension",n);var s=i(e);var l=a(r,"dimension",s);return o-l});var n=function t(e){var n=i(e);var o=a(r,"dimension",n);if(!o){return}var s=r[o];if(s.facetType==="hierarchy"){return}var l=function t(e,r){return a(s.items,"label",e.valueLabel)-a(s.items,"label",r.valueLabel)};e.conditions.sort(l)};for(var o=0;o<e.conditions.length;++o){var s=e.conditions[o];n(s)}return e},onAfterRendering:function t(e){var i=this;r.prototype.onAfterRendering.call(this,e);this.resetButton.attachPress(function(){var t=i.getModel();t.eventLogger.logEvent({type:h.CLEAR_ALL_FILTERS});t.resetFilterByFilterConditions(true)});var a=jQuery(".sapUshellSearchFilterText");a.attr("aria-label",c.getText("filtered_by_aria_label"))}});return v})})();
//# sourceMappingURL=SearchFilterBar.js.map