/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){function e(e,t,r){if(r){return t?t(e):e}if(!e||!e.then){e=Promise.resolve(e)}return t?e.then(t):e}sap.ui.define(["../../../UIUtil","../../core/errors","../../sina/ComparisonOperator","../../sina/DataSource","../../sina/DataSourceType","../../sina/SearchResultSetItemAttribute","../../sina/SimpleCondition","../../sina/UserCategoryDataSource","../AbstractProvider","./template","./template2"],function(t,r,a,i,s,u,o,n,l,c,f){function d(e){"@babel/helpers - typeof";return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function v(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}function S(e,t,r){if(t)v(e.prototype,t);if(r)v(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function p(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});Object.defineProperty(e,"prototype",{writable:false});if(t)m(e,t)}function m(e,t){m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return m(e,t)}function g(e){var t=I();return function r(){var a=C(e),i;if(t){var s=C(this).constructor;i=Reflect.construct(a,arguments,s)}else{i=a.apply(this,arguments)}return y(this,i)}}function y(e,t){if(t&&(typeof t==="object"||typeof t==="function")){return t}else if(t!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return b(e)}function b(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function I(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function C(e){C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function e(t){return t.__proto__||Object.getPrototypeOf(t)};return C(e)}function F(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}var O=t["registerHandler"];var w=r["ForcedBySearchTermTestError"];var A=r["NotImplementedError"];var P=a["ComparisonOperator"];var _=i["DataSource"];var R=s["DataSourceType"];var T=u["SearchResultSetItemAttribute"];var V=o["SimpleCondition"];var L=n["UserCategoryDataSource"];var k=l["AbstractProvider"];var j=c["createTemplate"];var q=f["createTemplate"];var H=function(t){p(a,t);var r=g(a);function a(){var e;h(this,a);e=r.call(this);e.id="sample";return e}S(a,[{key:"initAsync",value:function t(r){try{const t=this;t.sina=r.sina;t.templateProvider=j;if(document.location.href.indexOf("use=sample1")>0){t.templateProvider=q}var a=t.templateProvider(t);a._init(a);var i=Promise.resolve({capabilities:t.sina._createCapabilities({fuzzy:false})});return e(i)}catch(e){return Promise.reject(e)}}},{key:"getSuggestionList",value:function e(t){var r=this._stringify(t);var a=new RegExp('"valueFormatted":"([^{/]+?)","valueHighlighted',"g");var i=r.match(a).slice();var s=i.toString().split(" ");s=s.toString().split(",");i=i.concat(s);i=i.filter(function(e,t){if(e!==""){return i.indexOf(e)==t}});return i}},{key:"_stringify",value:function e(t){var r=[];var a=JSON.stringify(t,function(e,t){if(d(t)==="object"&&t!==null){if(r.indexOf(t)!==-1){return undefined}r.push(t)}return t});r=null;return a}},{key:"adjustImageViewing",value:function e(){var t,r,a;try{O("image-mouseenter",$(".sapUshellSearchResultListItem-Image"),"mouseenter",function(){t=$(this).clone();$("body").append(t);r=($(window).height()-$(t).outerHeight())*.33;a=($(window).width()-$(t).outerWidth())*.33;t.css({position:"absolute",top:r+"px",left:a+"px"}).show()});O("image-mouseleave",$(".sapUshellSearchResultListItem-Image"),"mouseleave",function(){t.remove()})}catch(e){}}},{key:"applyFilters",value:function e(t,r){var a=[];if(r.filter.rootCondition instanceof V){}else{if(r.filter.rootCondition.conditions.length===0||r.filter.rootCondition.conditions[0].conditions.length===0){if(r.filter.dataSource instanceof L){var i=r.filter.dataSource.subDataSources;if(i){return t.filter(function(e){return i.find(function(t){return t.id===e.dataSource.id})})}}return t}}var s=[];var u=[];if(r.filter.rootCondition instanceof V){var o=r.filter.rootCondition;s.push({attribute:o.attribute,operator:o.operator,value:o.value,fits:false});u.push(o.attribute)}else{for(var n=0;n<r.filter.rootCondition.conditions.length;n++){var l=r.filter.rootCondition.conditions[n].conditions;for(var c=0;c<l.length;c++){s.push({attribute:l[c].attribute,value:l[c].value,operator:l[c].operator,fits:false});u.push(l[c].attribute)}}}var f=false;for(var d=0;d<t.length;d++){var h=t[d];var v=[];for(var S=0;S<s.length;S++){f=false;for(var p=0;p<h.detailAttributes.length;p++){var m=h.detailAttributes[p];if(m instanceof T){if(m.id===s[S].attribute&&this.checkFilterValueMatch(m.value,s[S].value,s[S].operator)){f=true}}}for(var g=0;g<h.titleAttributes.length;g++){var y=h.titleAttributes[g];if(y instanceof T){if(y.id===s[S].attribute&&this.checkFilterValueMatch(y.value,s[S].value,s[S].operator)){f=true}}}s[S].fits=f;v.push(f)}if(v.toString().match(/false/)===null){a.push(h)}else{var b=[];var I=u.filter(function(e,t){return u.indexOf(e)==t});for(var C=0;C<I.length;C++){f=false;var F=I[C];for(var O=0;O<s.length;O++){if(s[O].attribute===F&&s[O].fits===true){f=true;break}}b.push(f)}if(b.toString().match(/false/)===null){a.push(h)}}}return a}},{key:"checkFilterValueMatch",value:function e(t,r,a){switch(a){case P.Co:{return t.toLowerCase().includes(r.toLowerCase())}case P.Eq:{return r===t}case P.Ne:{return r!==t}case P.Gt:{return r>t}case P.Ge:{return r>=t}case P.Lt:{return r<t}case P.Le:{return r<=t}default:{return t===r}}return false}},{key:"adjustHighlights",value:function e(t,r){var a=[];var i="";for(var s=0;s<t.length;s++){var u=t[s];var o=true;i="";u.titleHighlighted=this.addHighlight(u.title,r);if(u.titleHighlighted!==u.title){o=false}for(var n=0;n<t[s].detailAttributes.length;n++){var l=t[s].detailAttributes[n];i=l.metadata.type;if(i==="String"||i==="Integer"){l.valueHighlighted=this.addHighlight(l.valueFormatted,r);if(l.valueHighlighted!==l.valueFormatted){o=false}}}for(var c=0;c<t[s].titleAttributes.length;c++){var f=t[s].titleAttributes[c];i=f.metadata.type;if(i==="String"||i==="Integer"||i==="ImageUrl"){f.valueHighlighted=this.addHighlight(f.valueFormatted,r);if(f.valueHighlighted!==f.valueFormatted){o=false}}}if(o===false||r==="*"||r===""){a.push(u)}}return a}},{key:"addHighlight",value:function e(t,r){if(typeof t!=="string"||typeof r!=="string"){return t}var a=t.toLowerCase().indexOf(r.toLowerCase());if(a>-1){var i=a+r.length;var s=t.substring(0,a)+"<b>"+t.substring(a,i)+"</b>"+t.substring(i);return s}return t}},{key:"addSuvLinkToSearchResultItem",value:function e(t,r,a){var i=this.sina._createSuvNavTargetResolver();if(!r){r="/resources/sap/esh/search/ui/sinaNexTS/providers/sample/docs/folklorist_authors_and_publications.suv"}if(!a){a=[]}var s={};s.obj={suvThumbnailAttribute:t,suvTargetMimeTypeAttribute:{value:"application/vnd.sap.universal-viewer+suv"},suvTargetUrlAttribute:{value:r}};i.resolveSuvNavTargets(null,s,a)}},{key:"executeSearchQuery",value:function t(r){try{const t=this;var i=t;t.searchQuery=r;return e(new Promise(function(e){var t;var s=i.templateProvider(i);var u=s.searchResultSetItemArray;var o=s.searchResultSetItemArray2;var n=u.concat(o);var l;if(s.searchResultSetItemArray3){l=s.searchResultSetItemArray3;n=n.concat(l)}var c=r.filter.searchTerm;var f=r.filter.dataSource.id;var d=r.filter.dataSource.type;var h=i.generateFacets(r);if(c===w.forcedBySearchTerm){throw new w}var v;var S=a.getEshGptResponseData(f,c);if(i.searchQuery.eshGpt&&a.isSupportedEshGptAllQuery(f,c)){c=S.searchTerm;f=S.dataSource.id;d=S.dataSource.type}if(f===a.dataSourceIds.Scientists||f===a.dataSourceIds.Folklorists){v=i.adjustHighlights(u,c);if(S.dataSource){r.filter.dataSource=S.dataSource}v=i.applyFilters(v,r);t=i.sina._createSearchResultSet({items:v,facets:h,query:r,nlqSuccess:S.nlqSuccess,title:S.title,totalCount:v.length})}else if(f===a.dataSourceIds.Mysterious_Sightings||f===a.dataSourceIds.Urban_Legends||i.searchQuery.eshGpt&&a.isSupportedEshGptAllQuery(f,c)){v=i.adjustHighlights(o,c);v=i.applyFilters(v,r);t=i.sina._createSearchResultSet({items:v,facets:h,query:r,nlqSuccess:S.nlqSuccess,title:S.title,totalCount:v.length})}else if(f==="Publications"||i.searchQuery.eshGpt&&a.isSupportedEshGptAllQuery(f,c)){v=i.adjustHighlights(l,c);v=i.applyFilters(v,r);t=i.sina._createSearchResultSet({items:v,facets:h,query:r,nlqSuccess:S.nlqSuccess,title:S.title,totalCount:v.length})}else if(f===a.dataSourceIds.All||d===i.sina.DataSourceType.UserCategory){h[0].items.forEach(function(e){e.measureValue=0;e.measureValueFormatted=""});v=i.adjustHighlights(u,c);v=i.applyFilters(v,r);var p=v.length;v=i.adjustHighlights(o,c);v=i.applyFilters(v,r);var m=v.length;var g=0;if(l){v=i.adjustHighlights(l,c);v=i.applyFilters(v,r);g=v.length}h[0].items[0].measureValue=p;h[0].items[0].measureValueFormatted=""+p;h[0].items[1].measureValue=m;h[0].items[1].measureValueFormatted=""+m;if(l&&h[0].items.length>2){h[0].items[2].measureValue=g;h[0].items[2].measureValueFormatted=""+g}h[0].items=h[0].items.filter(function(e){return e.measureValue>0});v=i.adjustHighlights(n,c);v=i.applyFilters(v,r);var y=[];for(var b=r.skip;b<r.skip+r.top&&b<v.length;b++){y.push(v[b])}t=i.sina._createSearchResultSet({items:y,facets:h,query:r,nlqSuccess:S.nlqSuccess,title:S.title,totalCount:v.length})}e(t)}))}catch(e){return Promise.reject(e)}}},{key:"executeHierarchyQuery",value:function e(t){throw new A}},{key:"executeSuggestionQuery",value:function t(r){try{const t=this;var a=t;var i=r.filter.searchTerm;var s=t.templateProvider(t);var u=s.searchResultSetItemArray.concat(s.searchResultSetItemArray2).concat(s.searchResultSetItemArray3);var o=t.getSuggestionList(u);var n=o.filter(function(e){var t=new RegExp("^"+i,"gi");return e.match(t)});if(n.length===0){n=o}var l=[];var c=function e(t){var i=a.sina.SuggestionCalculationMode.Data;var s=r.filter.clone();s.setSearchTerm(t);return a.sina._createSearchTermSuggestion({searchTerm:t,calculationMode:i,filter:s,label:t})};for(var f=0;f<n.length;f++){l.push(c(n[f]))}var d=t.sina._createSuggestionResultSet({title:"Suggestions",query:r,items:l});return e(new Promise(function(e){e(d)}))}catch(e){return Promise.reject(e)}}},{key:"executeChartQuery",value:function t(r){try{const t=this;var a=t.generateFacets(r);var i=1;if(r.dimension==="LOCATION"||a.length===1){i=0}return e(new Promise(function(e){e(a[i])}))}catch(e){return Promise.reject(e)}}},{key:"getChartResultSetItemsForLocations",value:function e(t){var r=[];var a;var i=[];var s,u,o,n,l;for(u=0;u<t.length;u++){l=t[u].detailAttributes;for(o=0;o<l.length;o++){if(l[o].id==="LOCATION"){a=l[o].value;if(i.indexOf(a)===-1){i.push(a);s=this.sina._createChartResultSetItem({filterCondition:this.sina.createSimpleCondition({attribute:"LOCATION",operator:this.sina.ComparisonOperator.Eq,value:a}),dimensionValueFormatted:a,measureValue:1,measureValueFormatted:"1"});r.push(s)}else{for(n=0;n<r.length;n++){if(r[n].filterCondition.value===a){r[n].measureValue=r[n].measureValue+1;r[n].measureValueFormatted=""+r[n].measureValue}}}}}}return r}},{key:"getChartResultSetItemsForPublications",value:function e(t){var r=[];var a;var i=[];var s,u,o,n,l;for(u=0;u<t.length;u++){l=t[u].detailAttributes;for(o=0;o<l.length;o++){if(l[o].id==="PUBLICATION"){a=l[o].value;if(i.indexOf(a)===-1){i.push(a);s=this.sina._createChartResultSetItem({filterCondition:this.sina.createSimpleCondition({attribute:"PUBLICATION",operator:this.sina.ComparisonOperator.Eq,value:a}),dimensionValueFormatted:a,measureValue:1,measureValueFormatted:"1"});r.push(s)}else{for(n=0;n<r.length;n++){if(r[n].filterCondition.value===a){r[n].measureValue=r[n].measureValue+1;r[n].measureValueFormatted=""+r[n].measureValue}}}}}}return r}},{key:"getSientistOrFolkloristFacet",value:function e(t,r){var i;var s=[];var u,o,n,l,c,f;var d=[];for(o=0;o<r.length;o++){c=r[o].titleAttributes;if(t.filter.dataSource.id===a.dataSourceIds.Mysterious_Sightings||t.filter.dataSource.id===a.dataSourceIds.Urban_Legends||t.filter.dataSource.id===a.dataSourceIds.Publications){c=r[o].detailAttributes}for(n=0;n<c.length;n++){if(c[n].id==="SCIENTIST"||c[n].id==="FOLKLORIST"){i=c[n].value;f=c[n].id;if(s.indexOf(i)===-1){s.push(i);u=this.sina._createChartResultSetItem({filterCondition:this.sina.createSimpleCondition({attribute:c[n].id,operator:this.sina.ComparisonOperator.Eq,value:i}),dimensionValueFormatted:i,measureValue:1,measureValueFormatted:"1"});d.push(u)}else{for(l=0;l<d.length;l++){if(d[l].filterCondition.value===i){d[l].measureValue=d[l].measureValue+1;d[l].measureValueFormatted=""+d[l].measureValue}}}}}}return[d,f]}},{key:"getTopFacetOnly",value:function e(t){var r=t.filter.sina.allDataSource;var a=[this.sina._createDataSourceResultSetItem({dataSource:t.filter.sina.dataSources[1],dimensionValueFormatted:r.labelPlural,measureValue:4,measureValueFormatted:"4"}),this.sina._createDataSourceResultSetItem({dataSource:t.filter.sina.dataSources[2],dimensionValueFormatted:r.labelPlural,measureValue:5,measureValueFormatted:"5"})];if(t.filter.sina.dataSources[3]){a[2]=this.sina._createDataSourceResultSetItem({dataSource:t.filter.sina.dataSources[3],dimensionValueFormatted:r.labelPlural,measureValue:1,measureValueFormatted:"1"})}var i=[this.sina._createDataSourceResultSet({title:t.filter.dataSource.label,items:a,query:t})];return i}},{key:"generateFacets",value:function e(t){if(t.filter.dataSource.id===a.dataSourceIds.All||t.filter.dataSource.type===this.sina.DataSourceType.UserCategory){return this.getTopFacetOnly(t)}var r=[];var i;var s=this.templateProvider(this);var u=this.sina.createFilter({searchTerm:this.searchQuery.filter.searchTerm,dataSource:this.searchQuery.filter.dataSource,rootCondition:this.searchQuery.filter.rootCondition.clone()});var o=[];var n;if(t.filter.dataSource.id===a.dataSourceIds.Publications){n=s.searchResultSetItemArray3}else if(t.filter.dataSource.id===a.dataSourceIds.Scientists||t.filter.dataSource.id===a.dataSourceIds.Folklorists){n=s.searchResultSetItemArray}else if(t.filter.dataSource.id===a.dataSourceIds.Urban_Legends||t.filter.dataSource.id===a.dataSourceIds.Mysterious_Sightings){n=s.searchResultSetItemArray2}if(t.filter.dataSource.id===a.dataSourceIds.Scientists||t.filter.dataSource.id===a.dataSourceIds.Mysterious_Sightings){o=this.getChartResultSetItemsForLocations(n);i=this.sina._createChartResultSet({items:o,query:this.sina.createChartQuery({filter:u,dimension:"LOCATION"}),title:"Locations"});r.push(i)}var l=this.getSientistOrFolkloristFacet(t,n);o=l[0];var c=l[1];i=this.sina._createChartResultSet({items:o,query:this.sina.createChartQuery({filter:u,dimension:c}),title:c.charAt(0).toUpperCase()+c.slice(1).toLowerCase()+"s"});r.push(i);return r}}],[{key:"isSupportedEshGptAllQuery",value:function e(t,r){if(t===a.dataSourceIds.All){return r.toLowerCase()==="all scientists"||r.toLowerCase()==="all folklorists"||r.toLowerCase()==="all publications"||r.toLowerCase()==="all urban legends"||r.toLowerCase()==="all mysterious sightings"}return false}},{key:"getEshGptResponseData",value:function e(t,r){var i={nlqSuccess:false,title:""};if(a.isSupportedEshGptAllQuery(t,r)){if(t===a.dataSourceIds.All){if(r.toLowerCase()==="all scientists"){i={dataSource:new _({type:R.BusinessObject,id:a.dataSourceIds.Scientists,label:"Scientist",labelPlural:"Scientists"}),searchTerm:"*",nlqSuccess:true,title:JSON.stringify({scope:a.dataSourceIds.Scientists,query:"*"})}}else if(r.toLowerCase()==="all folklorists"){i={dataSource:new _({type:R.BusinessObject,id:a.dataSourceIds.Folklorists,label:"Folklorist",labelPlural:"Folklorists"}),searchTerm:"*",nlqSuccess:true,title:JSON.stringify({scope:a.dataSourceIds.Folklorists,query:"*"})}}else if(r.toLowerCase()==="all publications"){i={dataSource:new _({type:R.BusinessObject,id:a.dataSourceIds.Publications,label:"Publication",labelPlural:"Publications"}),searchTerm:"*",nlqSuccess:true,title:JSON.stringify({scope:a.dataSourceIds.Publications,query:"*"})}}else if(r.toLowerCase()==="all urban legends"){i={dataSource:new _({type:R.BusinessObject,id:a.dataSourceIds.Urban_Legends,label:"Urban Legend",labelPlural:"Urban Legends"}),searchTerm:"*",nlqSuccess:true,title:JSON.stringify({scope:a.dataSourceIds.Urban_Legends,query:"*"})}}else if(r.toLowerCase()==="all mysterious sightings"){i={dataSource:new _({type:R.BusinessObject,id:a.dataSourceIds.Mysterious_Sightings,label:"Mysterious Sighting",labelPlural:"Mysterious Sightings"}),searchTerm:"*",nlqSuccess:true,title:JSON.stringify({scope:a.dataSourceIds.Mysterious_Sightings,query:"*"})}}}}return i}}]);return a}(k);F(H,"dataSourceIds",{All:"All",Urban_Legends:"Urban_Legends",Folklorists:"Folklorists",Publications:"Publications",Scientists:"Scientists",Mysterious_Sightings:"Mysterious_Sightings"});var U={__esModule:true};U.Provider=H;return U})})();
//# sourceMappingURL=Provider.js.map