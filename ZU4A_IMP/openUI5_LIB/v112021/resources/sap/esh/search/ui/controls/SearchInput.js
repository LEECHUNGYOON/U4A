/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["../i18n","sap/m/Input","sap/m/Label","sap/m/Text","sap/m/library","sap/m/Column","sap/m/ColumnListItem","sap/m/CustomListItem","sap/m/FlexItemData","sap/m/BusyIndicator","sap/m/FlexBox","sap/ui/core/Icon","sap/ui/layout/HorizontalLayout","sap/ui/layout/VerticalLayout","sap/ui/model/BindingMode","../SearchHelper","../controls/SearchObjectSuggestionImage","../suggestions/SuggestionType","../SearchShellHelperHorizonTheme","../eventlogging/UserEvents","../UIEvents","../sinaNexTS/sina/NavigationTarget"],function(e,t,a,s,i,r,n,o,l,c,g,u,h,d,f,p,S,v,y,m,b,T){function I(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function C(e,t){var a=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=w(e))||t&&e&&typeof e.length==="number"){if(a)e=a;var s=0;var i=function(){};return{s:i,n:function(){if(s>=e.length)return{done:true};return{done:false,value:e[s++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,n=false,o;return{s:function(){a=a.call(e)},n:function(){var e=a.next();r=e.done;return e},e:function(e){n=true;o=e},f:function(){try{if(!r&&a.return!=null)a.return()}finally{if(n)throw o}}}}function w(e,t){if(!e)return;if(typeof e==="string")return A(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor)a=e.constructor.name;if(a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return A(e,t)}function A(e,t){if(t==null||t>e.length)t=e.length;for(var a=0,s=new Array(t);a<t;a++){s[a]=e[a]}return s}var R=I(e);var x=i["FlexAlignItems"];var D=i["ListType"];var L=I(S);var U=I(v);var N=I(y);var O=m["UserEventType"];var F=I(b);var M=T["NavigationTarget"];var H=t.extend("sap.esh.search.ui.controls.SearchInput",{renderer:{apiVersion:2},constructor:function e(a,s){var i=this;var n=sap.ui.Device.system.phone;try{sap.ui.Device.system.phone=false;t.prototype.constructor.call(this,a,s)}finally{sap.ui.Device.system.phone=n}this.setWidth("100%");this.setShowValueStateMessage(false);this.setShowTableSuggestionValueHelp(false);this.setEnableSuggestionsHighlighting(false);this.setShowSuggestion(true);this.setFilterSuggests(false);this.addSuggestionColumn(new r(""));this.attachSuggestionItemSelected(this.handleSuggestionItemSelected.bind(this));this.setAutocomplete(false);this.setTooltip(R.getText("search"));this.bindProperty("placeholder",{path:"/searchTermPlaceholder",mode:f.OneWay});this.attachLiveChange(this.handleLiveChange.bind(this));this.bindProperty("enabled",{parts:[{path:"/initializingObjSearch"}],formatter:function e(t){return!t}});this.bindAggregation("suggestionRows",{path:"/suggestions",factory:function e(t,a){return i.suggestionItemFactory(t,a)}});this.addStyleClass("searchInput");this._bUseDialog=false;this._bFullScreen=false;this._ariaDescriptionIdNoResults=a+"-No-Results-Description";this.addAriaDescribedBy(this._ariaDescriptionIdNoResults);this.listNavigationMode=false;this.listNavigationModeCache={}},isMobileDevice:function e(){return false},onfocusin:function e(a){t.prototype.onfocusin.call(this,a);var s=this.getModel();if(s.getSearchBoxTerm().length===0&&s.config.bRecentSearches){s.doSuggestion()}},onsapenter:function e(){var a;if(!((a=this["_oSuggestionPopup"])!==null&&a!==void 0&&a.isOpen()&&this["_oSuggPopover"].getFocusedListItem())){this.getModel().invalidateQuery();this.triggerSearch()}for(var s=arguments.length,i=new Array(s),r=0;r<s;r++){i[r]=arguments[r]}t.prototype.onsapenter.apply(this,i)},triggerSearch:function e(){var t=this.getModel().getProperty("/messagePopoverControlId");var a=sap.ui.getCore().byId(t);if(this.getModel().getProperty("/errors").length>0&&a!==null&&a!==void 0&&a.isOpen()){a.close();a.setVisible(false)}p.subscribeOnlyOnce("triggerSearch",F.ESHSearchFinished,function(){this.getModel().autoStartApp()},this);var s=this.getModel();var i=this.getValue();if(i.trim()===""&&s.config.isUshell){i="*"}s.setSearchBoxTerm(i,false);var r=true;var n=C(s.searchTermHandlers),o;try{for(n.s();!(o=n.n()).done;){var l=o.value;var c=l.handleSearchTerm(i,this);if(c.navigateToSearchApp===false){r=false}}}catch(e){n.e(e)}finally{n.f()}if(r){this.navigateToSearchApp()}this.destroySuggestionRows();s.abortSuggestions()},handleLiveChange:function e(){var t=this;var a=this["_oSuggPopover"];if(a&&a.handleListNavigation&&!a.handleListNavigation.decorated){var s=a.handleListNavigation;a.handleListNavigation=function(){t.listNavigationMode=true;t.listNavigationModeCache={};for(var e=arguments.length,i=new Array(e),r=0;r<e;r++){i[r]=arguments[r]}var n=s.apply(a,i);t.listNavigationMode=false;return n};a.handleListNavigation.decorated=true}var i=this.getValue();var r=this.getModel();r.setSearchBoxTerm(i,false);if(r.getSearchBoxTerm().length>0||r.config.bRecentSearches){r.doSuggestion()}else{this.destroySuggestionRows();r.abortSuggestions()}},handleSuggestionItemSelected:function e(t){var a=this.getModel();var s=a.getSearchBoxTerm();var i=t.getParameter("selectedRow").getBindingContext().getObject();var r=i.searchTerm||"";var n=i.dataSource||a.getDataSource();var o=i.url;var l=i.uiSuggestionType;if(l===U.Header){return}a.eventLogger.logEvent({type:O.SUGGESTION_SELECT,suggestionType:l,suggestionTerm:r,searchTerm:s,targetUrl:o,dataSourceKey:n?n.id:""});if(a.config.bRecentSearches&&a.recentlyUsedStorage&&l===U.Object){a.recentlyUsedStorage.addItem(i)}this.selectText(0,0);switch(l){case U.Recent:if(i.titleNavigation instanceof M){a.invalidateQuery();i.titleNavigation.performNavigation();break}case U.Transaction:case U.App:this.destroySuggestionRows();a.abortSuggestions();if(o[0]==="#"){if(o.indexOf("#Action-search")===0&&(o===p.getHashFromUrl()||o===decodeURIComponent(p.getHashFromUrl()))){a.setSearchBoxTerm(a.getLastSearchTerm(),false);a.notifySubscribers(F.ESHSearchFinished);sap.ui.getCore().getEventBus().publish(F.ESHSearchFinished);return}if(window["hasher"]){if(o[1]===window.hasher.prependHash){o=o.slice(0,1)+o.slice(2)}window["hasher"].setHash(o)}else{window.location.href=o}}else{this.logRecentActivity(i);window.open(o,"_blank","noopener,noreferrer");a.setSearchBoxTerm("",false);this.setValue("")}if(a.config.isUshell&&o.indexOf("#Action-search")!==0){if(!N.isSearchFieldExpandedByDefault()){sap.ui.require("sap/esh/search/ui/SearchShellHelper").collapseSearch()}}else{this.focus()}break;case U.DataSource:a.setDataSource(n,false);a.setSearchBoxTerm("",false);this.setValue("");this.focus();break;case U.SearchTermData:a.setDataSource(n,false);a.setSearchBoxTerm(r,false);a.invalidateQuery();this.navigateToSearchApp();this.setValue(r);break;case U.SearchTermHistory:a.setDataSource(n,false);a.setSearchBoxTerm(r,false);a.invalidateQuery();this.navigateToSearchApp();this.setValue(r);break;case U.Object:if(i.titleNavigation){i.titleNavigation.performNavigation()}break;default:break}},logRecentActivity:function e(t){sap.ui.require(["sap/ushell/Config","sap/ushell/services/AppType"],function(e,a){var s=e.last("/core/shell/enableRecentActivity")&&e.last("/core/shell/enableRecentActivityLogging");if(s){var i={title:t.title,appType:a.URL,url:t.url,appId:t.url};window.sap.ushell.Container.getRenderer("fiori2").logRecentActivity(i)}})},suggestionItemFactory:function e(t,a){var s=a.getObject();var i=s.uiSuggestionType;if(i===U.Recent){i=s.originalUiSuggestionType}switch(i){case U.Object:return this.objectSuggestionItemFactory(t,a);case U.Header:return this.headerSuggestionItemFactory();case U.BusyIndicator:return this.busyIndicatorSuggestionItemFactory();default:return this.regularSuggestionItemFactory(t,a)}},busyIndicatorSuggestionItemFactory:function e(){var t=this;var a=new d("",{content:[new c("",{size:"0.6rem"})]});a["getText"]=function(){return t.getValue()};var s=new n("",{cells:[a],type:D.Inactive});s.addStyleClass("searchSuggestion");s.addStyleClass("searchBusyIndicatorSuggestion");s.getVisible=this.assembleListNavigationModeGetVisibleFunction(s);return s},headerSuggestionItemFactory:function e(){var t=this;var s=new a("",{text:{path:"label"}});var i=new d("",{content:[s]});i["getText"]=function(){return t.getValue()};var r=new n("",{cells:[i],type:D.Inactive});r.addStyleClass("searchSuggestion");r.addStyleClass("searchHeaderSuggestion");r.getVisible=this.assembleListNavigationModeGetVisibleFunction(r);return r},assembleListNavigationModeGetVisibleFunction:function e(t){var a=this;return function(){if(!a.listNavigationMode){return true}if(!a.listNavigationModeCache[t.getId()]){a.listNavigationModeCache[t.getId()]=true;return false}else{return true}}},assembleObjectSuggestionLabels:function e(t){var s=[];var i=new a("",{text:{path:"label1"}});i.addEventDelegate({onAfterRendering:function e(){p.boldTagUnescaper(i.getDomRef())}},i);i.addStyleClass("sapUshellSearchObjectSuggestion-Label1");s.push(i);if(t.label2){var r=new a("",{text:{path:"label2"}});r.addEventDelegate({onAfterRendering:function e(){p.boldTagUnescaper(r.getDomRef())}},r);r.addStyleClass("sapUshellSearchObjectSuggestion-Label2");s.push(r)}var n=new d("",{content:s});n.addStyleClass("sapUshellSearchObjectSuggestion-Labels");return n},objectSuggestionItemFactory:function e(t,a){var s=this;var i=a.getObject();var r=[];if(i.imageExists&&i.imageUrl){if(i.imageUrl.startsWith("sap-icon://")){r.push(new u("",{src:i.imageUrl}).addStyleClass("sapUshellSearchObjectSuggestIcon"))}else{r.push(new L("",{src:{path:"imageUrl"},isCircular:{path:"imageIsCircular"}}))}}var o=this.assembleObjectSuggestionLabels(i);r.push(o);var l=new h("",{content:r});l.addStyleClass("sapUshellSearchObjectSuggestion-Container");l["getText"]=function(){return s.getValue()};var c=new n("",{cells:[l],type:D.Active});c.addStyleClass("searchSuggestion");c.addStyleClass("searchObjectSuggestion");return c},regularSuggestionItemFactory:function e(t,a){var i=this;var r=new u("",{src:{path:"icon"}}).addStyleClass("suggestIcon").addStyleClass("sapUshellSearchSuggestAppIcon").addStyleClass("suggestListItemCell");var c=new u("",{src:{path:"filterIcon"}}).addStyleClass("suggestIcon").addStyleClass("sapUshellSearchSuggestFilterIcon").addStyleClass("suggestListItemCell");var h=new l("",{shrinkFactor:1,minWidth:"4rem"});var d=new s("",{text:{path:"label"},layoutData:h,wrapping:false}).addStyleClass("suggestText").addStyleClass("suggestNavItem").addStyleClass("suggestListItemCell");var f=a.getModel().getProperty(a.getPath());d.addEventDelegate({onAfterRendering:function e(){if(f.uiSuggestionType===U.Recent){var t=d.getDomRef();var a=t.innerHTML;var s=a.slice(a.indexOf("&lt;span&gt;")+12,a.lastIndexOf("&lt;/span&gt;"));var i=a.slice(a.lastIndexOf("&lt;/span&gt;")+13);var r=p.boldTagUnescaperForStrings(i);t.innerHTML="<span>"+s+"</span>"+r}else{p.boldTagUnescaper(d.getDomRef())}}},d);var S=[r,d];if(f.filterIcon){S.push(c)}var v=new o("",{type:D.Active,content:new g("",{items:S,alignItems:x.Center})});v.addStyleClass("searchSuggestionCustomListItem");v["getText"]=function(){return typeof f.searchTerm==="string"?f.searchTerm:i.getValue()};var y=new n("",{cells:[v],type:D.Active});v.addStyleClass("searchSuggestionColumnListItem");if(f.uiSuggestionType===U.App){if(f.title&&f.title.indexOf("combinedAppSuggestion")>=0){y.addStyleClass("searchCombinedAppSuggestion")}else{y.addStyleClass("searchAppSuggestion")}}if(f.uiSuggestionType===U.DataSource){y.addStyleClass("searchDataSourceSuggestion")}if(f.uiSuggestionType===U.SearchTermData){y.addStyleClass("searchBOSuggestion")}if(f.uiSuggestionType===U.SearchTermHistory){y.addStyleClass("searchHistorySuggestion")}if(f.uiSuggestionType===U.Recent){y.addStyleClass("searchRecentSuggestion")}y.addStyleClass("searchSuggestion");return y},navigateToSearchApp:function e(){var t=this.getModel();if(p.isSearchAppActive()||!t.config.isUshell){t._firePerspectiveQuery()}else{t.resetSearchResultItemMemory();var a=t.renderSearchURL();window.location.hash=a}},getAriaDescriptionIdForNoResults:function e(){return this._ariaDescriptionIdNoResults},onAfterRendering:function e(a){t.prototype.onAfterRendering.call(this,a);$(this.getDomRef()).find("input").attr("autocomplete","off");$(this.getDomRef()).find("input").attr("autocorrect","off");$(this.getDomRef()).find("input").attr("type","search");$(this.getDomRef()).find("input").attr("name","search");var s=jQuery('<form action=""></form>').on("submit",function(){return false});$(this.getDomRef()).children("input").parent().append(s);$(this.getDomRef()).children("input").detach().appendTo(s)},onValueRevertedByEscape:function e(){if(p.isSearchAppActive()){return}this.setValue(" ")}});return H})})();
//# sourceMappingURL=SearchInput.js.map