/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["../sina/AttributeSemanticsType","../sina/SearchResultSetItemAttribute","../sina/SearchResultSetItemAttributeGroup","./errors"],function(e,t,r,a){function n(e,t){var r=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=i(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var a=0;var n=function(){};return{s:n,n:function(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u=true,o=false,l;return{s:function(){r=r.call(e)},n:function(){var e=r.next();u=e.done;return e},e:function(e){o=true;l=e},f:function(){try{if(!u&&r.return!=null)r.return()}finally{if(o)throw l}}}}function i(e,t){if(!e)return;if(typeof e==="string")return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(e,t)}function u(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}function s(e,t,r){if(t)l(e.prototype,t);if(r)l(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}
/*!
   * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
   */var f=e["AttributeSemanticsType"];var c=t["SearchResultSetItemAttribute"];var v=r["SearchResultSetItemAttributeGroup"];var g=a["NoJSONDateError"];var p=a["TimeOutError"];function d(e,t){return Object.prototype.hasOwnProperty.apply(e,t)}function h(e,t){var r=function r(){var a=this;var n=arguments;return new Promise(function(r,i){var u=false;var o=setTimeout(function(){u=true;i(new p)},t);return e.apply(a,n).then(function(e){if(u){return}clearTimeout(o);r(e)},function(e){if(u){return}clearTimeout(o);i(e)})})};return r}function m(e){var t=0;var r=function r(){var a=++t;return e.apply(this,arguments).then(function(e){return new Promise(function(r){if(a!==t){return}r(e)})},function(e){return new Promise(function(r,n){if(a!==t){return}n(e)})})};r.abort=function(){++t};return r}function y(e,t){if(typeof window==="undefined"){return null}if(!t){t=window.location.href}e=e.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),a=r.exec(t);if(!a){return null}if(!a[2]){return""}return decodeURIComponent(a[2].replace(/\+/g," "))}function b(e,t){for(var r=0;r<t.length;++r){var a=t[r];var n=0;while(n>=0){n=e.indexOf(a);if(n>=0){e=e.slice(0,n)+e.slice(n+a.length)}}}return e}function T(){var e=function e(t,r){var a="000000000"+t;return a.substr(a.length-r)};var t=new Date;return""+t.getUTCFullYear()+e(t.getUTCMonth()+1,2)+e(t.getUTCDate(),2)+e(t.getUTCHours(),2)+e(t.getUTCMinutes(),2)+e(t.getUTCSeconds(),2)+e(t.getUTCMilliseconds(),3)}var w=function(){function e(t){o(this,e);t=t||{};this.timeDelay=t.timeDelay||1e3;this.consumer=t.consumer||function(){};this.consumerContext=t.consumerContext||null;this.objects=[]}s(e,[{key:"add",value:function e(t){this.objects.push(t);if(this.objects.length===1){setTimeout(this.consume.bind(this),this.timeDelay)}}},{key:"consume",value:function e(){this.consumer.apply(this.consumerContext,[this.objects]);this.objects=[]}}]);return e}();function x(e){return{type:"Timestamp",value:e.toJSON()}}function O(e){if(e.type!=="Timestamp"){throw new g("Not a timestampe "+e)}return new Date(e.value)}function S(e){if(e.items){var t=e.items;for(var r=0;r<t.length;r++){var a=t[r];a=M(a);var n=a.detailAttributes;for(var i=0;i<n.length;i++){var u=n[i];N(u)}}}return e}function N(e){if(e instanceof c){_(e)}else if(e instanceof v){C(e)}}function C(e){var t=n(e.attributes),r;try{for(t.s();!(r=t.n()).done;){var a=r.value;var i=a.attribute;if(!(i instanceof c)){continue}var u=i.metadata;var o=i.sina;var l=i.value;if(u.semantics==f.HTTPURL){i.setDefaultNavigationTarget(o._createNavigationTarget({text:l,targetUrl:l,target:"_blank"}))}}}catch(e){t.e(e)}finally{t.f()}}function _(e){var t=e.sina;var r=e.value;var a=e.metadata;if(typeof r==="string"&&e.metadata.type!=="ImageUrl"){var n=r.match(/^[^\0-\x20,:;<>@\[\\\]^_`]+@[^\0-,.-@\[\\\]^_`\{\|\}~]+\.[^\0-,.-@\[\\\]^_`\{\|\}~]+$/g);var i=r.match(/^https?:\/\/(?=[^\/])\S+$/gi);if(a.semantics==f.EmailAddress){e.setDefaultNavigationTarget(t._createNavigationTarget({text:r,targetUrl:"mailto:"+r}))}else if(a.semantics==f.PhoneNr){e.setDefaultNavigationTarget(t._createNavigationTarget({text:r,targetUrl:"tel:"+r}))}else if(a.semantics==f.HTTPURL){e.setDefaultNavigationTarget(t._createNavigationTarget({text:r,targetUrl:r,target:"_blank"}))}else if(n!==null&&n.length===1){e.setDefaultNavigationTarget(t._createNavigationTarget({text:n[0],targetUrl:"mailto:"+n[0]}))}else if(i!==null&&i[0].match(/\w\w\w/)!==null){e.setDefaultNavigationTarget(t._createNavigationTarget({text:i[0],targetUrl:i[0],target:"_blank"}))}}}function A(e){var t=e.sina.getDataSource(e.query.filter.dataSource.id);for(var r=0;r<e.facets.length;r++){var a=e.facets[r].query.dimension;var n=t.attributeMetadataMap[a];if(n&&n.usage.AdvancedSearch&&n.usage.Facet===undefined){e.facets.splice(r,1);r=r-1}}return e}function D(e,t,r){var a=false;var n,i,u,o,l,s;var f=e.id;var c=e.value;if(f.match(/latitude/i)!==null){if(!isNaN(c)){l=f;n=c;u=r}a=true}else if(f.match(/longitude/i)!==null){if(!isNaN(c)){s=f;i=c;o=r}a=true}else if(f.match(/LOC_4326/)){o=r;u=r;var v=JSON.parse(c);var g=v.coordinates;if(g&&g.length>1){i=g[0];n=g[1]}a=true}if(t===undefined||t===true){return a}return{lat:n,lon:i,latAttribName:l,lonAttribName:s,latIndex:u,lonIndex:o}}function M(e){var t,r,a,n,i,u;var o=e.detailAttributes;for(var l=0;l<o.length;l++){t=D(o[l],false,l);r=t.lat?t.lat:r;a=t.lon?t.lon:a;i=t.latIndex?t.latIndex:i;u=t.lonIndex?t.lonIndex:u;if(r&&a){break}}if(r&&a){if(i===u){o.splice(i,1)}else if(i>u){o.splice(i,1);o.splice(u,1)}else{o.splice(u,1);o.splice(i,1)}var s={sina:e.sina,type:"GeoJson",id:"LOC_4326",label:"LOC_4326",isCurrency:false,IsBoolean:false,IsKey:false,IsSortable:true,isUnitOfMeasure:false,semanticObjectType:[],usage:{Map:"coordinates"}};var f='{ "type": "Point", "coordinates": ['+a+", "+r+", 0] }";var c={id:"LOC_4326",label:"LOC_4326",isHighlighted:false,value:f,valueFormatted:f,valueHighlighted:e.sina,metadata:s,sina:e.sina};o.push(c);n=e.sina.getDataSource(e.dataSource.id);if(!n.attributeMetadataMap.LOC_4326){n.attributesMetadata.push(s);n.attributeMetadataMap.LOC_4326=s}else{n.attributeMetadataMap.LOC_4326.type="GeoJson";n.attributeMetadataMap.LOC_4326.usage={Map:"coordinates"}}}return e}function U(e){var t={};return function(r){if(Object.prototype.hasOwnProperty.call(t,r)){return t[r]}var a=e.apply(this,[r]);t[r]=a;return a}}function I(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function R(e,t){var r=new RegExp("{{([^{}]*)}}");var a=function e(t){var a=r.exec(t);if(!a){return null}return a[1]};var n=function e(t,r,a){var n=new RegExp("{{"+I(r)+"}}","g");t=t.replace(n,a);return t};var i=function e(r){var i=a(r);if(!i){return r}r=n(r,i,t[i]);return e(r)};return i(e)}var P=new RegExp("<b>(.*?)<\\/b>","g");function j(e){var t;var r=[];do{t=P.exec(e);if(t){r.push(t[1])}}while(t);return r}function E(e,t){for(var r=0;r<t.length;++r){var a=t[r];if(e.indexOf(a)<0){e.push(a)}}}var L=["\\","-","(",")","~","^","?",'"',":","'","[","]"];var k=["AND","OR","NOT"];var J=["\\",'"',"*","?","'"];function $(e,t,r){return e.split(t).join(r)}function F(e){var t=e.trim();var r=n(L),a;try{for(r.s();!(a=r.n()).done;){var i=a.value;if(i==="'"){t=$(t,i,"''")}else{t=$(t,i,"\\"+i)}}}catch(e){r.e(e)}finally{r.f()}var u=n(k),o;try{for(u.s();!(o=u.n()).done;){var l=o.value;if(t===l){t='"'+l+'"'}if(t.startsWith(l+" ")){t='"'+l+'" '+t.substring(l.length+1)}if(t.endsWith(" "+l)){t=t.substring(0,t.length-(l.length+1))+' "'+l+'"'}t=$(t," "+l+" ",' "'+l+'" ')}}catch(e){u.e(e)}finally{u.f()}if(t===""){t="*"}return t}function H(e){var t=e.trim();var r=n(J),a;try{for(r.s();!(a=r.n()).done;){var i=a.value;if(i==="'"){t=$(t,i,"''")}else{t=$(t,i,"\\"+i)}}}catch(e){r.e(e)}finally{r.f()}if(t===""){t="*"}return t}var G={__esModule:true};G.hasOwnProperty=d;G.timeoutDecorator=h;G.refuseOutdatedResponsesDecorator=m;G.getUrlParameter=y;G.filterString=b;G.generateTimestamp=T;G.DelayedConsumer=w;G.dateToJson=x;G.dateFromJson=O;G.addPotentialNavTargets=S;G.removePureAdvancedSearchFacets=A;G.isMapsAttribute=D;G.addGeoDataIfAvailable=M;G.cacheDecorator=U;G.escapeRegExp=I;G.evaluateTemplate=R;G.extractRegExp=P;G.extractHighlightedTerms=j;G.appendRemovingDuplicates=E;G.escapeQuery=F;G.escapeFilterCondition=H;return G})})();
//# sourceMappingURL=util.js.map