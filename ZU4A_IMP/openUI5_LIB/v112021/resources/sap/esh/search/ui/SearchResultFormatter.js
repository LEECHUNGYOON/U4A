/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["./SearchResultBaseFormatter","./sinaNexTS/sina/SearchResultSetItemAttribute","./sinaNexTS/sina/NavigationTarget"],function(t,e,a){function i(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}function n(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}function o(t,e,a){if(e)n(t.prototype,e);if(a)n(t,a);Object.defineProperty(t,"prototype",{writable:false});return t}function u(t,e){if(typeof e!=="function"&&e!==null){throw new TypeError("Super expression must either be null or a function")}t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:true,configurable:true}});Object.defineProperty(t,"prototype",{writable:false});if(e)l(t,e)}function l(t,e){l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function t(e,a){e.__proto__=a;return e};return l(t,e)}function s(t){var e=d();return function a(){var i=c(t),r;if(e){var n=c(this).constructor;r=Reflect.construct(i,arguments,n)}else{r=i.apply(this,arguments)}return f(this,r)}}function f(t,e){if(e&&(typeof e==="object"||typeof e==="function")){return e}else if(e!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return v(t)}function v(t){if(t===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t}function d(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(t){return false}}function c(t){c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function t(e){return e.__proto__||Object.getPrototypeOf(e)};return c(t)}var p=i(t);var g=e["SearchResultSetItemAttribute"];var b=a["NavigationTarget"];var h=function(t){u(a,t);var e=s(a);function a(t){var i;r(this,a);i=e.call(this,t);i.model=t;return i}o(a,[{key:"format",value:function t(e,a,i){i=i||{};i.suppressHighlightedValues=i.suppressHighlightedValues||false;var r=e.sina;var n={};var o=[];var u=e.items;for(var l=0;l<u.length;l++){var s=u[l];var f={};var v=[];for(var d=0;d<s.detailAttributes.length;d++){var c=s.detailAttributes[d];var p="";var t="";var b=undefined;if(c instanceof g){p=c.value;t=c.metadata.format;b=c.defaultNavigationTarget}switch(c.metadata.type){case r.AttributeType.ImageBlob:if(p&&p.trim().length>0){p="data:;base64,"+p}break;case r.AttributeType.ImageUrl:f.imageUrl=p;f.imageFormat=t?t.toLowerCase():undefined;if(b){f.imageNavigation=b}break;case r.AttributeType.GeoJson:f.geoJson={value:p,label:c.label};break;case r.AttributeType.Group:{var h=this._formatAttributeGroup(c,i,d);v.push(h);break}case r.AttributeType.Double:case r.AttributeType.Integer:case r.AttributeType.String:case r.AttributeType.Date:case r.AttributeType.Time:case r.AttributeType.Timestamp:{var m=this._formatSingleAttribute(c,i,d);v.push(m);break}}}f.key=s.key;f.keystatus=s.keystatus;f.dataSource=s.dataSource;f.dataSourceName=s.dataSource.label;f.attributesMap=s.attributesMap;f.sinaItem=s;var y=s.hierarchyNodePaths;if(Array.isArray(y)===true&&y.length>0){f.hierarchyNodePath=y[0]}if(s.titleAttributes){var T=void 0,A=void 0,S=void 0;var _=[];for(var O=0;O<s.titleAttributes.length;O++){T=s.titleAttributes[O];if(T.metadata.type===r.AttributeType.Group){A=this._formatAttributeGroup(T,i,O)}else if(T.metadata.type===r.AttributeType.ImageUrl){A=this._formatSingleAttribute(T,i,O);f.titleIconUrl=T.value;A.value=""}else{A=this._formatSingleAttribute(T,i,O)}if(T.infoIconUrl){f.titleInfoIconUrl=T.infoIconUrl;A.value=""}S=A.value;_.push(S)}f.title=_.join(" ")}else{f.title=i.suppressHighlightedValues?s.title:s.titleHighlighted}if(s.titleDescriptionAttributes&&s.titleDescriptionAttributes.length>0){var w=void 0,R=void 0,I=void 0;var N=[];var U=[];for(var x=0;x<s.titleDescriptionAttributes.length;x++){w=s.titleDescriptionAttributes[x];if(w.metadata.type===r.AttributeType.Group){R=this._formatAttributeGroup(w,i,x)}else{R=this._formatSingleAttribute(w,i,x)}I=R.value;N.push(I);U.push(R.name)}f.titleDescription=N.join(" ");f.titleDescriptionLabel=U.join(" ")}f.itemattributes=v;if(s.defaultNavigationTarget){f.titleNavigation=s.defaultNavigationTarget;if(!f.title||f.title.length===0){f.title=s.defaultNavigationTarget.text}}if(s.navigationTargets&&s.navigationTargets.length>0){f.navigationObjects=[];for(var D=0;D<s.navigationTargets.length;D++){var k=s.navigationTargets[D];f.navigationObjects.push(k)}}var F=n[s.dataSource.id]||{};n[s.dataSource.id]=F;f.layoutCache=F;f.selected=f.selected||false;f.expanded=f.expanded||false;var P={};this._formatResultForDocuments(s,P);this._formatResultForNotes(s,P);f.additionalParameters=P;f.positionInList=l;f.resultSetId=e.id;o.push(f)}return o}},{key:"_formatAttributeGroup",value:function t(e,a,i){var r,n;if(e.attributes.length===2&&typeof e.attributes[1].attribute.value==="string"&&e.attributes[1].attribute.value.startsWith("sap-icon://")){var o=this._formatSingleAttribute(e.attributes[0].attribute,a,i);o.iconUrl=e.attributes[1].attribute.value;o.key=e.id;o.isTitle=false;o.isSortable=e.metadata.isSortable;o.attributeIndex=i;o.displayOrder=e.metadata.usage.Detail&&e.metadata.usage.Detail.displayOrder;return o}var u={};var l={};u.name=e.label;var s=false;var f=false;var v=e.metadata._private;var d,c;for(var p=0;p<e.attributes.length;p++){var g=e.attributes[p];var h=g.attribute;var m=g.metadata.nameInGroup;var y=void 0;if(h.metadata.type===h.sina.AttributeType.Group){y=this._formatAttributeGroup(h,a,i)}else{y=this._formatSingleAttribute(h,a,i)}if(v){if(v.parentAttribute===h.metadata){d=y}else if(v.childAttribute===h.metadata){c=y}}if(y.value!==undefined&&y.value.length>0){l[m]=y;s=s||y.whyfound;f=f||y.longtext!==undefined}}u.value="";u.valueRaw=undefined;u.valueWithoutWhyfound="";u.whyfound=false;if(Object.keys(l).length>0){var T=true;if(v&&d&&c&&(v.isUnitOfMeasure||v.isCurrency||v.isDescription)){var A=d.value;var S=c.value;A=A!==undefined&&A.trim().length>0?A:undefined;S=S!==undefined&&S.trim().length>0?S:undefined;if(!(A&&S)){if(v.isUnitOfMeasure||v.isCurrency){if(A&&!S){u.value=d.value;u.valueRaw=d.valueRaw;u.valueWithoutWhyfound=d.valueWithoutWhyfound;T=false}}else if(v.isDescription){var _=v.textArrangement;var O=e.sina;if(_===O.AttributeGroupTextArrangement.TextFirst){if(!A&&S){u.value=c.value;u.valueRaw=c.valueRaw;u.valueWithoutWhyfound=c.valueWithoutWhyfound;T=false}}else if(_===O.AttributeGroupTextArrangement.TextLast){if(A&&!S){u.value=d.value;u.valueRaw=d.valueRaw;u.valueWithoutWhyfound=d.valueWithoutWhyfound;T=false}}else if(_===O.AttributeGroupTextArrangement.TextOnly){if(!S){T=false}}}}}if(T){u.value=this._formatBasedOnGroupTemplate(e.template,l,"value");u.valueRaw=this._formatBasedOnGroupTemplate(e.template,l,"valueRaw");u.valueWithoutWhyfound=this._formatBasedOnGroupTemplate(e.template,l,"valueWithoutWhyfound")}u.whyfound=s}u.key=e.id;u.isTitle=false;u.isSortable=e.metadata.isSortable;u.attributeIndex=i;u.displayOrder=e.metadata.usage.Detail&&e.metadata.usage.Detail.displayOrder;if(f){u.longtext=u.value}if(!(u.defaultNavigationTarget instanceof b)){var w,R;if(((w=d)===null||w===void 0?void 0:w.defaultNavigationTarget)instanceof b){u.defaultNavigationTarget=d.defaultNavigationTarget}else if(((R=c)===null||R===void 0?void 0:R.defaultNavigationTarget)instanceof b){u.defaultNavigationTarget=c.defaultNavigationTarget}}if((r=d)!==null&&r!==void 0&&r.tooltip){u.tooltip=d.tooltip}else if((n=c)!==null&&n!==void 0&&n.tooltip){u.tooltip=c.tooltip}if(!u.iconUrl){var I,N;if((I=d)!==null&&I!==void 0&&I.iconUrl){u.iconUrl=d.iconUrl}else if((N=c)!==null&&N!==void 0&&N.iconUrl){u.iconUrl=c.iconUrl}}return u}},{key:"_formatSingleAttribute",value:function t(e,a,i){var r={};var n=e.sina;r.name=e.label;r.valueRaw=e.value;r.value=a.suppressHighlightedValues?e.valueFormatted:e.valueHighlighted;r.valueWithoutWhyfound=e.valueFormatted;r.key=e.id;r.isTitle=false;r.isSortable=e.metadata.isSortable;r.attributeIndex=i;r.displayOrder=e.metadata.usage.Detail&&e.metadata.usage.Detail.displayOrder;r.whyfound=e.isHighlighted;if(e.defaultNavigationTarget instanceof b){r.defaultNavigationTarget=e.defaultNavigationTarget}if(typeof e.tooltip==="string"&&e.tooltip.length>0){r.tooltip=e.tooltip}if(typeof e.iconUrl==="string"&&e.iconUrl.length>0&&e.iconUrl.startsWith("sap-icon://")){r.iconUrl=e.iconUrl}if(e.metadata.format&&(e.metadata.format===n.AttributeFormatType.MultilineText||e.metadata.format===n.AttributeFormatType.LongText)){r.longtext=e.valueHighlighted}return r}},{key:"_formatBasedOnGroupTemplate",value:function t(e,a,i){if(!(e&&a&&i)){return""}var r=/{\w+}/gi;var n="";var o=0;var u;while((u=r.exec(e))!==null){n+=e.substring(o,u.index);var l=u[0].slice(1,-1);n+=a[l]&&a[l][i]||"";o=r.lastIndex}n+=e.substring(o);return n}},{key:"_formatResultForDocuments",value:function t(e,a){var i="";a.isDocumentConnector=false;var r;for(var n=0;n<e.detailAttributes.length;n++){r=e.detailAttributes[n];if(r.metadata.id==="FILE_PROPERTY"){a.isDocumentConnector=true}if(r.metadata.isKey===true){if(i.length>0){i+=";"}i=i+r.metadata.id+"="+r.value}}if(a.isDocumentConnector===true){var o=";o=sid("+e.dataSource.system+"."+e.dataSource.client+")";var u=e.dataSource.id;a.imageUrl="/sap/opu/odata/SAP/ESH_SEARCH_SRV"+o+"/FileLoaderFiles(ConnectorId='"+u+"',FileType='ThumbNail',SelectionParameters='"+i+"')/$value";a.titleUrl="/sap/opu/odata/SAP/ESH_SEARCH_SRV"+o+"/FileLoaderFiles(ConnectorId='"+u+"',FileType='BinaryContent',SelectionParameters='"+i+"')/$value";var l="/sap/opu/odata/SAP/ESH_SEARCH_SRV"+o+"/FileLoaderFiles(ConnectorId='"+u+"',FileType='SUVFile',SelectionParameters='"+i+"')/$value";a.suvlink="/sap/bc/ui5_ui5/ui2/ushell/resources/sap/fileviewer/viewer/web/viewer.html?file="+encodeURIComponent(l);if(!e.navigationObjects){e.navigationObjects=[]}var s={text:"Show Document",targetUrl:a.suvlink,target:"_blank"};var f=this.model.sinaNext._createNavigationTarget(s);e.navigationObjects.push(f);for(var v=0;v<e.detailAttributes.length;v++){r=e.detailAttributes[v];if(r.id==="PHIO_ID_THUMBNAIL"&&r.value){a.containsThumbnail=true}if(r.id==="PHIO_ID_SUV"&&r.value){a.containsSuvFile=true}}}}},{key:"_formatResultForNotes",value:function t(e,a){}}]);return a}(p);return h})})();
//# sourceMappingURL=SearchResultFormatter.js.map