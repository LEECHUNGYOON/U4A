/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["../i18n","sap/ui/model/json/JSONModel","sap/esh/search/ui/SearchModel"],function(e,t,r){function n(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function a(e,t){var r=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=i(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var n=0;var a=function(){};return{s:a,n:function(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,s=false,u;return{s:function(){r=r.call(e)},n:function(){var e=r.next();o=e.done;return e},e:function(e){s=true;u=e},f:function(){try{if(!o&&r.return!=null)r.return()}finally{if(s)throw u}}}}function i(e,t){if(!e)return;if(typeof e==="string")return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}function o(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function c(e,t,r){if(t)u(e.prototype,t);if(r)u(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}function l(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function")}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});Object.defineProperty(e,"prototype",{writable:false});if(t)f(e,t)}function f(e,t){f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return f(e,t)}function d(e){var t=p();return function r(){var n=v(e),a;if(t){var i=v(this).constructor;a=Reflect.construct(n,arguments,i)}else{a=n.apply(this,arguments)}return h(this,a)}}function h(e,t){if(t&&(typeof t==="object"||typeof t==="function")){return t}else if(t!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return y(e)}function y(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function p(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function v(e){v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function e(t){return t.__proto__||Object.getPrototypeOf(t)};return v(e)}var S=n(e);var b=function(e){l(n,e);var t=d(n);function n(){s(this,n);return t.apply(this,arguments)}c(n,[{key:"asyncInit",value:function e(){var t=this;if(this.initializePromise){return this.initializePromise}this.searchModel=r.getModelSingleton({},"flp");this.initializePromise=this.searchModel.initAsync().then(function(){if(!t.searchModel.config.searchBusinessObjects){t.setProperty("/isSearchPrefsActive",false);t.setProperty("/isPersonalizedSearchEditable",false);t.setProperty("/personalizedSearch",false);t.setProperty("/resetButtonWasClicked",false);return undefined}t.setProperty("/isSearchPrefsActive",true);t.setProperty("/isMyFavoritesAvailable",t.searchModel.isMyFavoritesAvailable());var e=t.searchModel.sinaNext;if(t.searchModel.isMyFavoritesAvailable()){t.initSubDataSources()}t.setProperty("/isPersonalizedSearchAreaVisible",e.provider.id==="multi"?false:true);return e.getConfigurationAsync({forceReload:true}).then(function(e){t.configuration=e;t.setProperty("/isPersonalizedSearchEditable",e.isPersonalizedSearchEditable);t.setProperty("/personalizedSearch",e.personalizedSearch);t.setProperty("/resetButtonWasClicked",false)})});return this.initializePromise}},{key:"reload",value:function e(){return this.asyncInit()}},{key:"initSubDataSources",value:function e(){var t=this;var r=[];this.searchModel.getUserCategoryManager().then(function(e){t.userCategoryManager=e;t.userCategory=e.getCategory("MyFavorites");var n=t.searchModel.sinaNext.dataSources;n.filter(function(e){return(e.type===t.searchModel.sinaNext.DataSourceType.BusinessObject||e===t.searchModel.appDataSource)&&e.id!=="CD$ALL~ESH_TRANSACTION~"}).forEach(function(e){if(e===t.searchModel.appDataSource){r.unshift({id:e.id,label:e.labelPlural,selected:t.userCategory.isIncludeApps(),undefined:false})}else{r.push({id:e.id,label:e.labelPlural,selected:t.userCategory.hasSubDataSource(e.id),undefined:false})}});var i=t.userCategory.getUndefinedSubDataSourceIds().reverse();var o=a(i),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;r.unshift({id:u,label:u+" "+S.getText("sp.connectorNotExists"),selected:true,undefined:true})}}catch(e){o.e(e)}finally{o.f()}t.setProperty("/favActive",t.userCategoryManager.isFavActive());t.setProperty("/subDataSources",r);t.setProperty("/dataSourceCount",t.getNumberSubDataSources());t.setProperty("/selectedDataSourceCount",t.getNumberSelectedSubDataSources())})}},{key:"getNumberSubDataSources",value:function e(){return this.getProperty("/subDataSources").length}},{key:"getNumberSelectedSubDataSources",value:function e(){return this.getProperty("/subDataSources").filter(function(e){return e.selected}).length}},{key:"saveSubDataSources",value:function e(){var t=this.getProperty("/subDataSources");this.userCategory.setIncludeApps(false);this.userCategoryManager.setFavActive(this.getProperty("/favActive"));this.userCategory.clearSubDataSources();this.userCategory.clearUndefinedSubDataSourceIds();var r=a(t),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.selected===true){if(i.id===this.searchModel.appDataSource.id){this.userCategory.setIncludeApps(true)}else{var o=this.userCategoryManager.sina.getDataSource(i.id);if(o){this.userCategory.addSubDataSource(o)}else{this.userCategory.addUndefinedSubDataSourceId(i.id)}}}}}catch(e){r.e(e)}finally{r.f()}this.userCategoryManager.save()}},{key:"shortStatus",value:function e(){var t=this;return this.asyncInit().then(function(){return t.getProperty("/personalizedSearch")?S.getText("sp.on"):S.getText("sp.off")})}},{key:"isPersonalizedSearchActive",value:function e(){var t=this;return this.asyncInit().then(function(){return t.getProperty("/personalizedSearch")})}},{key:"isSearchPrefsActive",value:function e(){var t=this;return this.asyncInit().then(function(){return t.getProperty("/isSearchPrefsActive")})}},{key:"isMultiProvider",value:function e(){var t=this;return this.asyncInit().then(function(){return t.searchModel.sinaNext.provider.id==="multi"})}},{key:"savePreferences",value:function e(){var t=this;if(this.searchModel.isMyFavoritesAvailable()){this.saveSubDataSources()}if(this.configuration.isPersonalizedSearchEditable){this.configuration.setPersonalizedSearch(this.getProperty("/personalizedSearch"));return this.configuration.saveAsync().then(function(){t.setProperty("/resetButtonWasClicked",false)})}else{this.setProperty("/resetButtonWasClicked",false);return Promise.resolve()}}},{key:"cancelPreferences",value:function e(){this.setProperty("/personalizedSearch",this.configuration.personalizedSearch);this.setProperty("/resetButtonWasClicked",false)}},{key:"resetProfile",value:function e(){var t=this;return this.configuration.resetPersonalizedSearchDataAsync().then(function(){t.setProperty("/resetButtonWasClicked",true)})}}]);return n}(t);return b})})();
//# sourceMappingURL=SearchPrefsModel.js.map