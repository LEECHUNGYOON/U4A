/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["./i18n","sap/ui/model/Sorter","sap/ui/core/format/NumberFormat","sap/ui/core/library","./hierarchydynamic/SearchHierarchyDynamicFacet","./SearchFacetDialogHelperDynamicHierarchy","./sinaNexTS/sina/SimpleCondition","sap/ui/core/format/DateFormat"],function(e,t,n,a,r,i,o,l){function g(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}function s(e,t){var n=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=u(e))||t&&e&&typeof e.length==="number"){if(n)e=n;var a=0;var r=function(){};return{s:r,n:function(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i=true,o=false,l;return{s:function(){n=n.call(e)},n:function(){var e=n.next();i=e.done;return e},e:function(e){o=true;l=e},f:function(){try{if(!i&&n.return!=null)n.return()}finally{if(o)throw l}}}}function u(e,t){if(!e)return;if(typeof e==="string")return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(e,t)}function C(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function d(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function c(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}function f(e,t,n){if(t)c(e.prototype,t);if(n)c(e,n);Object.defineProperty(e,"prototype",{writable:false});return e}var T=g(e);var v=a["MessageType"];var O=g(r);var A=i["updateDetailPageforDynamicHierarchy"];var m=o["SimpleCondition"];var S=function(){function e(){d(this,e);throw new Error("Cannot instantiate static class 'SearchFacetDialogHelper'")}f(e,null,[{key:"injectSearchAdvancedCondition",value:function t(n){e.searchAdvancedCondition=n}},{key:"init",value:function t(a){e.POS_FACET_LIST=0;e.POS_TOOLBAR_SEARCHFIELD=0;e.POS_TOOLBAR_TOGGLEBUTTON=1;e.POS_SETTING_CONTAINER=0;e.POS_ATTRIBUTE_LIST_CONTAINER=1;e.POS_ICONTABBAR=0;e.POS_TABBAR_LIST=0;e.POS_TABBAR_CONDITION=1;e.POS_SORTING_SELECT=0;e.POS_SHOWONTOP_CHECKBOX=1;e.POS_ADVANCED_CHECKBOX=0;e.POS_ADVANCED_INPUT_LAYOUT=1;e.POS_ADVANCED_BUTTON=2;e.bResetFilterIsActive=false;var r={decimals:2};e.oFloatNumberFormat=n.getFloatInstance(r);e.oIntegernumberFormat=n.getIntegerInstance();e.oDateFormatOptions={pattern:"yyyy/MM/dd",UTC:false};e.oTimestampFormatOptions={pattern:"yyyy-MM-dd HH:mm:ss.SSSSSSS",UTC:true};e.oDateFormat=l.getDateTimeInstance(e.oDateFormatOptions);e.oTimestampFormat=l.getDateTimeInstance(e.oTimestampFormatOptions);e.dialog=a}},{key:"getFacetList",value:function t(){var n=e.dialog.oSplitContainer.getMasterPages()[0];return n.getContent()[e.POS_FACET_LIST]}},{key:"updateDetailPage",value:function t(n,a,r){var i=e.dialog.getModel();var o=e.dialog.getModel("searchModel");var l=n.getBindingContext().sPath;var g=i.getProperty(l);var s=i.getAttributeDataType(g);var u=e.getFacetList().indexOfAggregation("items",n);var C=e.dialog.oSplitContainer.getDetailPages()[u];var d=C.getBindingContext().getObject();if(d.facetType==="hierarchy"){var c=d;A(i,c,i.aFilters);e.dialog.oSplitContainer.toDetail(C.getId(),"show",null,null);return}var f,T,v,O;if(s==="string"||s==="text"){f=C.getContent()[e.POS_ICONTABBAR].getAggregation("items")[e.POS_TABBAR_LIST].getContent()[0].getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER];T=C.getContent()[e.POS_ICONTABBAR].getAggregation("items")[e.POS_TABBAR_LIST].getContent()[0].getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];v=C.getContent()[e.POS_ICONTABBAR].getAggregation("items")[e.POS_TABBAR_CONDITION].getContent()[0];O=C.getContent()[e.POS_ICONTABBAR].getAggregation("items")[e.POS_TABBAR_LIST].getContent()[0].getContent()[e.POS_SETTING_CONTAINER]}else{f=C.getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER];T=C.getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];v=C.getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER];O=C.getContent()[e.POS_SETTING_CONTAINER]}var m=C.getId();e.dialog.oSplitContainer.toDetail(m,"show",null,null);e.dialog.resetIcons(i,l,e.dialog);f.setBusy(true);var S={sAttribute:g.dimension,sBindingPath:l,sAttributeLimit:1e3,bInitialFilters:r};if(s==="number"){S.sAttributeLimit=20}if(!i.chartQuery){i.chartQuery=i.sinaNext.createChartQuery({filter:i.getProperty("/uiFilter").clone(),dimension:g.dimension,top:1e3})}e.applyChartQueryFilter(u);if(a){var _=i.sinaNext.createSimpleCondition({attribute:g.dimension,operator:i.sinaNext.ComparisonOperator.Bw,value:a});if(!e.bResetFilterIsActive){i.chartQuery.filter.autoInsertCondition(_)}}else{if(a===undefined&&(s==="string"||s==="text")){C.getContent()[e.POS_ICONTABBAR].getAggregation("items")[e.POS_TABBAR_LIST].getContent()[0].getSubHeader().getContent()[e.POS_TOOLBAR_SEARCHFIELD].setValue("")}}i.chartQuery.filter.searchTerm=o.getSearchBoxTerm();i.facetDialogSingleCall(S).then(function(){var t=i.getProperty(C.getBindingContext().getPath()).items;if(v.data("initial")){e.initiateAdvancedConditions(v,t,v.data("dataType"))}var n=O.getItems()[e.POS_SHOWONTOP_CHECKBOX];if(T.getSelectedContexts().length>0){n.setEnabled(true)}e.updateDetailPageListItemsSelected(T,v);e.dialog.updateDetailPageCharts(t)})}},{key:"applyChartQueryFilter",value:function t(n){var a=e.dialog.getModel();a.resetChartQueryFilterConditions();var r=e.dialog.oSplitContainer.getDetailPages();for(var i=0;i<r.length;i++){var o=r[i];if(i===n||o.getContent().length===0){continue}var l=o.getBindingContext().getObject();if(l instanceof O){this.applyDynamicHierarchyChartQueryFilter(l,a);continue}var g=void 0;if(!o.getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER]){g=o.getContent()[e.POS_ICONTABBAR].getAggregation("items")[e.POS_TABBAR_LIST].getContent()[0].getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0]}else{g=o.getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0]}for(var s=0;s<g.getItems().length;s++){var u=g.getItems()[s];var C=u.getBindingContext().getObject();var d=C.filterCondition;if(d.attribute||d.conditions){if(u.getSelected()&&!e.bResetFilterIsActive){a.chartQuery.filter.autoInsertCondition(d)}}}e.applyAdvancedCondition(o,e.getFacetList().getItems()[i].getBindingContext().getObject(),e.dialog.getModel())}}},{key:"applyDynamicHierarchyChartQueryFilter",value:function e(t,n){var a=s(n.aFilters),r;try{for(a.s();!(r=a.n()).done;){var i=r.value;var o=i;var l=o.filterCondition;if(l instanceof m&&l.attribute===t.attributeId){n.chartQuery.filter.autoInsertCondition(l.clone())}}}catch(e){a.e(e)}finally{a.f()}}},{key:"resetChartQueryFilters",value:function t(){var n=e.dialog.getModel();n.resetChartQueryFilterConditions();var a=e.dialog.oSplitContainer.getDetailPages();for(var r=0;r<a.length;r++){if(a[r].getContent().length===0){continue}var i=a[r].getBindingContext().getObject();if(i instanceof O){continue}var o=void 0;if(!a[r].getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER]){o=a[r].getContent()[e.POS_ICONTABBAR].getAggregation("items")[e.POS_TABBAR_LIST].getContent()[0].getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0]}else{o=a[r].getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0]}for(var l=0;l<o.getItems().length;l++){var g=o.getItems()[l];var s=g.getBindingContext().getObject();var u=s.filterCondition;if(u.attribute||u.conditions){if(g.getSelected()){g.setSelected(false)}}}}}},{key:"applyAdvancedCondition",value:function t(n,a,r){var i=e.dialog.getModel();var o,l,g,s,u,C,d,c;if(n.getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER]){var f=n.getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER];o=f.data("dataType");l=f.getContent();switch(o){case"timestamp":case"date":e.oDateTimeFormat=o==="timestamp"?e.oTimestampFormat:e.oDateFormat;for(g=1;g<l.length;g++){s=l[g];u=s.getContent()[e.POS_ADVANCED_CHECKBOX];var O=s.getContent()[e.POS_ADVANCED_INPUT_LAYOUT];if(u.getSelected()&&O.getDateValue()&&O.getSecondDateValue()){var A=new Date(O.getSecondDateValue().getFullYear(),O.getSecondDateValue().getMonth(),O.getSecondDateValue().getDate(),23,59,59);var m=e.oDateTimeFormat.format(O.getDateValue());var S=e.oDateTimeFormat.format(A);C=i.sinaNext.createSimpleCondition({attribute:a.dimension,attributeLabel:a.title,operator:i.sinaNext.ComparisonOperator.Ge,value:o==="timestamp"?O.getDateValue():m,valueLabel:m});d=i.sinaNext.createSimpleCondition({attribute:a.dimension,attributeLabel:a.title,operator:i.sinaNext.ComparisonOperator.Le,value:o==="timestamp"?A:S,valueLabel:S});c=i.sinaNext.createComplexCondition({valueLabel:O.getValue(),operator:i.sinaNext.LogicalOperator.And,conditions:[C,d],userDefined:true});if(!e.bResetFilterIsActive){r.addFilterCondition(c,false)}}}break;case"integer":case"number":e.oNumberFormat=o==="integer"?e.oIntegernumberFormat:e.oFloatNumberFormat;for(g=1;g<l.length;g++){s=l[g];u=s.getContent()[e.POS_ADVANCED_CHECKBOX];var _=s.getContent()[e.POS_ADVANCED_INPUT_LAYOUT].getContent()[0];var p=s.getContent()[e.POS_ADVANCED_INPUT_LAYOUT].getContent()[2];var I=s.getContent()[e.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];var N=e.oNumberFormat.parse(_.getValue());var b=e.oNumberFormat.parse(p.getValue());if(u.getSelected()){if(!isNaN(N)&&!isNaN(b)&&b>=N){C=i.sinaNext.createSimpleCondition({attribute:a.dimension,attributeLabel:a.title,operator:i.sinaNext.ComparisonOperator.Ge,value:N,valueLabel:e.oNumberFormat.format(N),userDefined:true});d=i.sinaNext.createSimpleCondition({attribute:a.dimension,attributeLabel:a.title,operator:i.sinaNext.ComparisonOperator.Le,value:b,valueLabel:e.oNumberFormat.format(b),userDefined:true});c=i.sinaNext.createComplexCondition({valueLabel:e.oNumberFormat.format(N)+I.getText()+e.oNumberFormat.format(b),operator:i.sinaNext.LogicalOperator.And,conditions:[C,d],userDefined:true});if(!e.bResetFilterIsActive){r.addFilterCondition(c,false)}}else{var y=e.dialog.getModel("searchModel");var P={type:v.Error,title:T.getText("filterInputErrorTitle"),description:T.getText("filterInputError")};y.pushUIMessage(P);e.dialog.bConditionValidateError=true}}}break;default:break}}else{var B=n.getContent()[e.POS_ICONTABBAR].getItems()[e.POS_TABBAR_CONDITION].getContent()[0];o=B.data("dataType");l=B.getContent();var h,E,D,L,R;switch(o){case"string":for(g=0;g<l.length-1;g++){s=l[g];h=s.getContent()[e.POS_ADVANCED_INPUT_LAYOUT].getContent()[0];E=s.getContent()[e.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];D=E.getValue();switch(h.getSelectedKey()){case"eq":R=i.sinaNext.ComparisonOperator.Eq;break;case"ew":R=i.sinaNext.ComparisonOperator.Ew;break;case"bw":R=i.sinaNext.ComparisonOperator.Bw;break;case"co":R=i.sinaNext.ComparisonOperator.Co;break;default:R=i.sinaNext.ComparisonOperator.Eq;break}if(E.getValue()){L=i.sinaNext.createSimpleCondition({attribute:a.dimension,attributeLabel:a.title,operator:R,value:D,valueLabel:D,userDefined:true});if(!e.bResetFilterIsActive){r.addFilterCondition(L,false)}}}break;case"text":for(g=0;g<l.length-1;g++){s=l[g];h=s.getContent()[e.POS_ADVANCED_INPUT_LAYOUT].getContent()[0];E=s.getContent()[e.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];D=E.getValue();switch(h.getSelectedKey()){case"co":R=i.sinaNext.ComparisonOperator.Co;break;default:R=i.sinaNext.ComparisonOperator.Eq}if(E.getValue()){L=i.sinaNext.createSimpleCondition({attribute:a.dimension,attributeLabel:a.title,operator:R,value:D,valueLabel:D,userDefined:true});if(!e.bResetFilterIsActive){r.addFilterCondition(L,false)}}}break;default:break}}}},{key:"initiateAdvancedConditions",value:function t(n,a,r){var i,o,l,g,s;var u=e.dialog.getModel();for(var C=a.length;C>0;C--){var d=a[C-1];if(d.advanced){i=n.getContent();if(r==="string"||r==="text"){o=i[i.length-2]}else{o=i[i.length-1]}l=o.getContent()[e.POS_ADVANCED_CHECKBOX];l.setSelected(true);g=o.getContent()[e.POS_ADVANCED_INPUT_LAYOUT];switch(r){case"integer":case"number":{var c=g.getContent()[0];var f=g.getContent()[2];if(d.filterCondition.conditions){for(var T=0;T<d.filterCondition.conditions.length;T++){var v=d.filterCondition.conditions[T];if(v.operator==="Ge"){c.setValue(v.valueLabel||e.oNumberFormat.format(v.value))}if(v.operator==="Le"){f.setValue(v.valueLabel||e.oNumberFormat.format(v.value))}}}break}case"string":s=d.filterCondition.operator;if(s==="Co"){g.getContent()[0].setSelectedKey("co")}else if(s==="Ew"){g.getContent()[0].setSelectedKey("ew")}else if(s==="Bw"){g.getContent()[0].setSelectedKey("bw")}g.getContent()[1].setValue(d.filterCondition.valueLabel);break;case"text":s=d.filterCondition.operator;if(s==="Co"){g.getContent()[0].setSelectedKey("co")}g.getContent()[1].setValue(d.filterCondition.valueLabel);break;default:g.setValue(d.label);break}e.insertNewAdvancedCondition(o,r);u.changeFilterAdvaced(d,true)}}n.data("initial",false)}},{key:"updateDetailPageListItemsSelected",value:function t(n,a){var r=a.data("dataType");e.sortingAttributeList(n.getParent().getParent());n.getParent().setBusy(false);if(r==="date"||r==="timestamp"||r==="number"||r==="integer"){n.focus()}}},{key:"removeAdvancedCondition",value:function t(n,a,r){var i=n.getContent();var o,l,g;if(r==="string"||r==="text"){for(var s=0;s<i.length-1;s++){o=i[s];l=o.getContent()[e.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];if(l.getProperty("value")){var u=l.getValue();var C=a.getBindingContext().getObject();if(u===C.filterCondition.value){g=s;break}}}}n.removeContent(g)}},{key:"sortingAttributeList",value:function n(a){var r=a.getContent()[e.POS_SETTING_CONTAINER];var i=r.getItems()[e.POS_SORTING_SELECT].getItems()[0];var o=r.getItems()[e.POS_SHOWONTOP_CHECKBOX];var l=a.getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];var g=l.data("dataType");var s=l.getBinding("items");var u=[];if(o.getSelected()){u.push(new t("selected",true,false))}switch(i.getSelectedKey()){case"sortName":u.push(new t("label",false,false));break;case"sortCount":u.push(new t("value",true,false));if(g==="string"||g==="text"){u.push(new t("label",false,false))}break;default:break}s.sort(u)}},{key:"insertNewAdvancedCondition",value:function t(n,a){var r=n.getParent();var i=new e.searchAdvancedCondition("",{type:a});if(a==="string"||a==="text"){var o=r.getContent().length-1;r.insertContent(i,o)}else{var l=r.indexOfContent(n);if(l===r.getContent().length-1){r.addContent(i)}}}},{key:"deleteAdvancedCondition",value:function t(n){var a=n.getParent();var r=n.getParent().getParent().getParent().getParent().getParent();a.removeContent(n);e.updateCountInfo(r)}},{key:"updateCountInfo",value:function t(n){var a=e.getFacetList();var r=a.getSelectedItem();if(!r){r=a.getItems()[0]}var i=r.getBindingContext().getModel();var o=r.getBindingContext().getPath();var l=i.getProperty(o).dimension;var g=i.aFilters;var u=0;var C=s(g),d;try{for(C.s();!(d=C.n()).done;){var c=d.value;if(!c.advanced&&c.facetAttribute===l){u++}}}catch(e){C.e(e)}finally{C.f()}var f;var T=i.getAttributeDataType(i.getProperty(o));if(T==="string"||T==="text"){f=n.getContent()[e.POS_ICONTABBAR].getItems()[e.POS_TABBAR_CONDITION].getContent()[0]}else{f=n.getContent()[e.POS_ATTRIBUTE_LIST_CONTAINER]}var v=f.getContent();var O=0;var A=s(v),m;try{for(A.s();!(m=A.n()).done;){var S=m.value;if(typeof S.getContent==="function"){var _=S.getContent()[0];if(_.getSelected()){O++}}}}catch(e){A.e(e)}finally{A.f()}var p=i.getProperty(o).facetType;if(p==="attribute"){var I=u+O;i.setProperty(o+"/count",I);e.dialog.resetEnabledForFilterResetButton()}}}]);return e}();return S})})();
//# sourceMappingURL=SearchFacetDialogHelper.js.map