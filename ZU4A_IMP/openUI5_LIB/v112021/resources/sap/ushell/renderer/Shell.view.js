// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/Device","sap/ushell/components/_HeaderManager/ControlManager","sap/ushell/components/_HeaderManager/ShellHeader.controller","sap/ushell/ui/launchpad/AccessibilityCustomData","sap/ushell/EventHub","sap/ushell/resources","sap/ushell/utils","sap/ushell/Config","sap/ui/model/json/JSONModel","sap/ui/core/mvc/View","sap/ui/core/mvc/XMLView","sap/ui/core/Fragment","sap/ui/core/Core","sap/ushell/renderer/ShellLayout","sap/ushell/renderer/Shell.controller"],function(e,t,n,i,a,o,l,r,s,h,d,u,g,c,p,f){"use strict";var y=p.LAYOUT_MAPPING;function S(e,t){return sap.ui.getCore().byId(t.getObject())}var v={Property:"Property",List:"List"};return d.extend("sap.ushell.renderer.Shell",{getControllerName:function(){return"sap.ushell.renderer.Shell"},waitForShellLayout:function(){if(!this._oShellLayoutPromise){this._oShellLayoutPromise=new Promise(function(e){this.getController().addDoable(o.once("ShellLayoutApplied").do(e))}.bind(this))}return this._oShellLayoutPromise},getShellModel:function(){return this.getViewData().shellModel},getHelperModel:function(){return this.getViewData().helperModel},getViewDataConfig:function(){var e=this.getViewData()||{};var t=e.config||{};return t},createContent:function(){this._allowUpToThreeActionInShellHeader();this.initBackgroundImage();var e=this.createShellHeader();this.setNavigationBarMinHeight();var t=this.createRendererRootView();this.setDisplayBlock(true);r.setPerformanceMark("FLP - Shell.view rendering started!");return Promise.all([t,e]).then(function(e){var t=e[0];this.initCanvasShapesManager();return t}.bind(this))},initBackgroundImage:function(){this.waitForShellLayout().then(function(){var e=document.getElementById(y.BackgroundImage);var t=["<div class='sapUiShellBackgroundImage sapUiGlobalBackgroundImageForce sapUshellShellBG sapContrastPlus'></div>","<div class='sapMShellBG sapUiGlobalBackgroundImage'></div>"].join("\n");e.insertAdjacentHTML("afterbegin",t)})},createRendererRootView:function(){var e=this.getController();return g.load({name:"sap.ushell.ui.RendererRootView",controller:e}).then(function(e){e.updateAggregation=this.updateShellAggregation;sap.ui.getCore().byId("viewPortContainer");return e}.bind(this))},createShellHeader:function(){var e=this.getViewDataConfig();var t=this.getShellModel();var a=s.createModel("/core/shellHeader",h);var o=new i;o.onInit();return g.load({name:"sap.ushell.ui.ShellHeader",controller:o}).then(function(i){i.updateAggregation=this.updateShellAggregation;n.init(e,o,t);if(e.appState==="embedded"){i.setNoLogo()}i.setModel(a);i.setModel(l.i18nModel,"i18n");this.addDanglingControl(i);this._oShellHeader=i;this.waitForShellLayout().then(function(){i.placeAt(y.ShellHeader,"only")})}.bind(this))},setNavigationBarMinHeight:function(){return sap.ushell.Container.getServiceAsync("Menu").then(function(e){return e.isMenuEnabled()}).then(function(e){if(!e){return}this.waitForShellLayout().then(function(){var e=document.getElementById(y.NavigationBar);e.classList.add("sapUshellMenuBarHeight")})}.bind(this)).catch(function(t){e.info("Could not apply min-height of the navigationBar",t)})},createRightFloatingContainer:function(){this.addPendingInitialization(new Promise(function(e){sap.ui.require(["sap/ushell/ui/shell/RightFloatingContainer"],function(t){var n=new t({id:"right-floating-container",top:"2",hideItemsAfterPresentation:true,visible:"{/currentState/showRightFloatingContainer}",floatingContainerItems:{path:"/currentState/RightFloatingContainerItems",factory:S}});n.updateAggregation=this.updateShellAggregation;n.setModel(this.getShellModel());this.addDanglingControl(n);this._oRightFloatingContainer=n;e();this.waitForShellLayout().then(function(){n.placeAt(y.RightFloatingContainer,"only")})}.bind(this))}.bind(this)))},initCanvasShapesManager:function(){this.bindFactory({model:this.getShellModel(),factory:this.createCanvasShapesManager.bind(this),bindingPath:"/enableBackGroundShapes",bindingType:v.Property,valueCheck:function(e){return!!e}})},createCanvasShapesManager:function(){var e=setInterval(function(){if(c.isThemeApplied()){clearInterval(e);sap.ui.require(["sap/ushell/CanvasShapesManager"],function(e){e.drawShapes()})}},200)},createSubHeader:function(){sap.ui.require(["sap/ushell/ui/shell/SubHeader"],function(e){var t=new e({id:"subhdr",content:{path:"/currentState/subHeader",factory:S}});t.updateAggregation=this.updateShellAggregation;t.setModel(this.getShellModel());this.addDanglingControl(t);this.waitForShellLayout().then(function(){t.placeAt(y.SubHeader,"only")})}.bind(this))},createFloatingContainer:function(){return new Promise(function(e,n){sap.ui.require(["sap/ushell/ui/shell/FloatingContainer","sap/ui/util/Storage"],function(n,i){var o=new n({id:"shell-floatingContainer",visible:"{helper>/shell/floatingContainerVisible}",content:{path:"/currentState/floatingContainerContent",factory:S}});o.updateAggregation=this.updateShellAggregation;if(t.system.desktop){o.addCustomData(new a({key:"tabindex",value:"-1",writeToDom:true}))}o.setModel(this.getShellModel());o.setModel(this.getHelperModel(),"helper");this.addDanglingControl(o);this.waitForShellLayout().then(function(){o.placeAt(y.FloatingContainer,"only");var t=new i(i.Type.local,"com.sap.ushell.adapters.local.FloatingContainer");var n=document.getElementById(y.FloatingContainer);var a=!n.classList.contains("sapUshellFloatingContainerWrapper");var l=t.get("floatingContainerStyle");if(a&&!l){var r=jQuery(".sapUshellShellHeadItm").position()?jQuery(".sapUshellShellHeadItm").position().left:0;var s=(jQuery(window).width()-jQuery("#shell-floatingContainer").width()-r)*100/jQuery(window).width();var h=jQuery(".sapUshellShellHeader").height()*100/jQuery(window).height();n.style.left=s+"%";n.style.top=h+"%";n.style.position="absolute";t.put("floatingContainerStyle",n.style.cssText)}else if(l){n.style.cssText=l}n.classList.add("sapUshellFloatingContainerWrapper");e()})}.bind(this))}.bind(this))},createSidePane:function(){sap.ui.require(["sap/ushell/ui/shell/SidePane"],function(e){var t=new e({id:"shell-sidePane",visible:"{/currentState/showPane}",content:{path:"/currentState/paneContent",factory:S}});t.updateAggregation=this.updateShellAggregation;t.setModel(this.getShellModel());this.addDanglingControl(t);this.waitForShellLayout().then(function(){t.placeAt(y.SidePane,"only")})}.bind(this))},createToolArea:function(){sap.ui.require(["sap/ushell/ui/shell/ToolArea"],function(e){var t=new e({id:"shell-toolArea",visible:"{/currentState/toolAreaVisible}",toolAreaItems:{path:"/currentState/toolAreaItems",factory:S}});t.updateAggregation=this.updateShellAggregation;t.setModel(this.getShellModel());this.addDanglingControl(t);this.waitForShellLayout().then(function(){t.placeAt(y.ToolArea,"only")})}.bind(this))},createFloatingActions:function(){sap.ui.require(["sap/ushell/ui/shell/ShellFloatingActions"],function(e){var t=new e({id:"shell-floatingActions",floatingActions:{path:"/currentState/floatingActions",factory:S}});t.updateAggregation=this.updateShellAggregation;t.setModel(this.getShellModel());this.addDanglingControl(t);this.waitForShellLayout().then(function(){t.placeAt(y.FloatingActions,"only")})}.bind(this))},initAllMyAppsView:function(){return sap.ushell.Container.getServiceAsync("AllMyApps").then(function(e){if(e.isEnabled()){return this.createAllMyAppsView()}}.bind(this))},createAllMyAppsView:function(){return u.create({id:"allMyAppsView",viewName:"sap.ushell.renderer.allMyApps.AllMyApps"}).then(function(e){e.setModel(this.getShellModel());e.setModel(l.i18nModel,"i18n");e.addCustomData(new a({key:"aria-label",value:l.i18n.getText("allMyApps_headerTitle"),writeToDom:true}));this.addDanglingControl(e);this.getShellHeader().getAppTitle().setAllMyApps(e)}.bind(this))},createPostCoreExtControls:function(){var e=this.getShellModel();sap.ui.require(["sap/ui/core/Popup"],function(e){e.setInitialZIndex(11)});this.bindFactory({model:e,factory:this.createRightFloatingContainer.bind(this),bindingPath:"/currentState/showRightFloatingContainer",bindingType:v.Property,valueCheck:function(e){return!!e}});this.bindFactory({model:e,factory:this.createSubHeader.bind(this),bindingPath:"/currentState/subHeader",bindingType:v.List,valueCheck:function(e){return!!e.length}});this.bindFactory({model:e,factory:this.createToolArea.bind(this),bindingPath:"/currentState/toolAreaVisible",bindingType:v.Property,valueCheck:function(e){return!!e}});this.bindFactory({model:e,factory:this.createSidePane.bind(this),bindingPath:"/currentState/showPane",bindingType:v.Property,valueCheck:function(e){return!!e}});(function(){this.bindFactory({model:e,factory:this.createFloatingActions.bind(this),bindingPath:"/currentState/floatingActions",bindingType:v.List,valueCheck:function(e){return!!e.length}})}).bind(this)();this.addPendingInitialization(this.initAllMyAppsView())},_allowUpToThreeActionInShellHeader:function(){var e=this.getViewDataConfig();if(Object.keys(e).length>3){var t=["moveAppFinderActionToShellHeader","moveUserSettingsActionToShellHeader","moveContactSupportActionToShellHeader","moveEditHomePageActionToShellHeader"];var n=0;var i;for(var a=0;a<5;a++){i=t[a];if(n===3){e[i]=false}else if(e[i]){n++}}}},getShellHeader:function(){return this._oShellHeader},getRightFloatingContainer:function(){return this._oRightFloatingContainer},updateShellAggregation:function(e){var t=this.mBindingInfos[e];var n=this.getMetadata().getJSONKeys()[e];var i;this[n._sGetter]().forEach(function(e){this[n._sRemoveMutator](e)}.bind(this));t.binding.getContexts().forEach(function(e,a){i=t.factory(this.getId()+"-"+a,e)?t.factory(this.getId()+"-"+a,e).setBindingContext(e,t.model):"";this[n._sMutator](i)}.bind(this))},bindFactory:function(e){var t=e.model;var n=e.factory;var i=e.bindingPath;var a=e.bindingType;var o=e.valueCheck;var l=t.getProperty(i);if(o(l)){n()}else{var r;switch(a){case v.List:r=t.bindList(i);break;default:r=t.bindProperty(i)}this.addDanglingBinding(r);r.attachChange(function(){l=r.getModel().getProperty(r.getPath());if(o(l)){this.removeDanglingBinding(r);r.destroy();n()}},this)}},addDanglingBinding:function(e){this.getController().addDanglingBinding(e)},removeDanglingBinding:function(e){this.getController().removeDanglingBinding(e)},addDanglingControl:function(e){this.getController().addDanglingControl(e)},addPendingInitialization:function(e){return this.getController().addPendingInitialization(e)}})});
//# sourceMappingURL=Shell.view.js.map