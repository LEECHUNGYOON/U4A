// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ushell/resources","sap/ushell/library"],function(jQuery,t,e){"use strict";var i=e.AllMyAppsProviderType;var a=function(){};a.prototype.loadAppsData=function(t,e,i){return sap.ushell.Container.getServiceAsync("AllMyApps").then(function(a){this.oPopover=e;if(!a.isEnabled()){return}this.iNumberOfProviders=0;this.oModel=t;if(a.isHomePageAppsEnabled()){this._handleGroupsData()}if(a.isExternalProviderAppsEnabled()){this._handleExternalProvidersData(t)}if(a.isCatalogAppsEnabled()){this._handleCatalogs(i)}if(!a.isCatalogAppsEnabled()||a.isCatalogAppsEnabled()&&i){var s=sap.ui.getCore().getEventBus();s.publish("launchpad","allMyAppsMasterLoaded")}}.bind(this))};a.prototype._handleGroupsData=function(){var e=this._getGroupsData();var a={title:t.i18n.getText("allMyApps_homeEntryTitle")};var s;return new Promise(function(t,i){e.done(t).fail(i)}).then(function(t){a.groups=t;a.type=i.HOME;if(t.length===0){return}s=this.oModel.getProperty("/AppsData");if(s){var e=this._getIndexByType(s,a.type);if(e!==undefined){s[e]=a}else{s.unshift(a)}}this.oModel.setProperty("/AppsData",s);this.iNumberOfProviders+=1}.bind(this))};a.prototype._getIndexByType=function(t,e){if(t.length<=0){return 0}for(var i=0;i<t.length;i++){if(t[i].type===e){return i}}};a.prototype._getGroupsData=function(){var t=new jQuery.Deferred;sap.ushell.Container.getServiceAsync("LaunchPage").then(function(t){return Promise.all([t.getDefaultGroup(),t.getGroups()])}).then(function(t){this.oDefaultGroup=t[0];var e=t[1];var i=[];e.forEach(function(t){i.push(this._getFormattedGroup(t))}.bind(this));return Promise.all(i)}.bind(this)).then(function(e){var i=e.filter(function(t){return t&&(t.apps.length>0||t.numberCustomTiles>0)});t.resolve(i)});return t.promise()};a.prototype._getFormattedGroup=function(e){var i;var a;var s;return sap.ushell.Container.getServiceAsync("LaunchPage").then(function(r){if(r.isGroupVisible(e)===false){return}if(r.getGroupId(e)===r.getGroupId(this.oDefaultGroup)){a=t.i18n.getText("my_group")}else{a=r.getGroupTitle(e)}i={};i.title=a;i.apps=[];s=r.getGroupTiles(e);return this._getFormattedGroupApps(s)}.bind(this)).then(function(e){if(!e){return}i.apps=e.aFormattedApps;i.numberCustomTiles=e.iNumberOfCustomTiles;if(e.iNumberOfCustomTiles===1){i.sCustomLabel=t.i18n.getText("allMyApps_customStringSingle");i.sCustomLink=t.i18n.getText("allMyApps_customLinkHomePageSingle")}else{i.sCustomLabel=t.i18n.getText("allMyApps_customString",[e.iNumberOfCustomTiles]);i.sCustomLink=t.i18n.getText("allMyApps_customLinkHomePage")}i.handlePress=this._onHandleGroupPress;return i}.bind(this))};a.prototype._getFormattedGroupApps=function(t){var e=[];var i=0;return sap.ushell.Container.getServiceAsync("LaunchPage").then(function(a){var s=[];t.forEach(function(t){if(a.isTileIntentSupported(t)){var r=this._getAppEntityFromTile(t).then(function(t){if(t){e.push(t)}else{i++}});s.push(r)}}.bind(this));return Promise.all(s)}.bind(this)).then(function(){return{iNumberOfCustomTiles:i,aFormattedApps:e}})};a.prototype._onHandleGroupPress=function(t,e){window.hasher.setHash("#Shell-home");this.oPopover.close();var i=sap.ui.getCore().getEventBus();i.subscribe("launchpad","dashboardModelContentLoaded",function(){i.publish("launchpad","scrollToGroupByName",{groupName:e.title,isInEditTitle:false})},this);i.publish("launchpad","scrollToGroupByName",{groupName:e.title,isInEditTitle:false})};a.prototype._handleExternalProvidersData=function(){var t=this;return sap.ushell.Container.getServiceAsync("AllMyApps").then(function(e){var a=e.getDataProviders();var s=Object.keys(a);var r;var o;var n;var l;var p;var u;if(s.length>0){for(p=0;p<s.length;p++){r=s[p];o=a[r];n=o.getTitle();l={};l.title=n;u=o.getData();u.done(function(e){if(e&&e.length>0){this.groups=e;this.type=i.EXTERNAL;t.oModel.setProperty("/AppsData/"+t.iNumberOfProviders,this);t.iNumberOfProviders+=1;var a=sap.ui.getCore().getEventBus();a.publish("launchpad","allMyAppsMasterLoaded")}}.bind(l))}}})};a.prototype._handleNotFirstCatalogsLoad=function(){var t=this.oModel.getProperty("/AppsData");var e=i.CATALOG;if(t.length&&t[t.length-1].type===e){this.bFirstCatalogLoaded=true;sap.ui.getCore().getEventBus().publish("launchpad","allMyAppsFirstCatalogLoaded",{bFirstCatalogLoadedEvent:true})}};a.prototype._handleCatalogs=function(e){if(!e){this._handleNotFirstCatalogsLoad();return Promise.resolve()}this.bFirstCatalogLoaded=false;this.aPromises=[];return sap.ushell.Container.getServiceAsync("LaunchPage").then(function(e){e.getCatalogs().done(function(){jQuery.when.apply(jQuery,this.aPromises).then(this._onDoneLoadingCatalogs.bind(this))}.bind(this)).fail(function(){this._onGetCatalogsFail(t.i18n.getText("fail_to_load_catalog_msg"))}.bind(this)).progress(this._addCatalogToModel.bind(this))}.bind(this))};a.prototype._addCatalogToModel=function(e){var a;var s={apps:[],numberCustomTiles:0,type:null};var r;var o=[sap.ushell.Container.getServiceAsync("LaunchPage")];if(this._oAddCatalogToModelPromise){o.push(this._oAddCatalogToModelPromise)}this._oAddCatalogToModelPromise=Promise.all(o).then(function(t){a=t[0];s.type=i.CATALOG;var r=a.getCatalogTiles(e);this.aPromises.push(r);return r}.bind(this)).then(function(t){var o;if(t.length===0){return}var n=a.getCatalogTitle(e);o=this.oModel.getProperty("/AppsData");for(r=0;r<o.length;r++){if(o[r].type===i.CATALOG&&o[r].title===n){s=o[r];break}}s.title=a.getCatalogTitle(e);return this._getFormattedGroupApps(t)}.bind(this)).then(function(e){if(!e){return}Array.prototype.push.apply(s.apps,e.aFormattedApps);s.numberCustomTiles=e.iNumberOfCustomTiles;if(s.numberCustomTiles===1){s.sCustomLabel=t.i18n.getText("allMyApps_customStringSingle");s.sCustomLink=t.i18n.getText("allMyApps_customLinkAppFinderSingle")}else{s.sCustomLabel=t.i18n.getText("allMyApps_customString",[s.numberCustomTiles]);s.sCustomLink=t.i18n.getText("allMyApps_customLinkAppFinder")}s.handlePress=function(t,e){this.oPopover.close();window.hasher.setHash("#Shell-home&/appFinder/catalog/"+JSON.stringify({catalogSelector:e.title,tileFilter:"",tagFilter:"[]",targetGroup:""}))}.bind(this);if(s.apps.length>0||s.numberCustomTiles>0){this.oModel.setProperty("/AppsData/"+r,s);if(this.bFirstCatalogLoaded===false){sap.ui.getCore().getEventBus().publish("launchpad","allMyAppsFirstCatalogLoaded",{bFirstCatalogLoadedEvent:true});this.bFirstCatalogLoaded=true}this.iNumberOfProviders+=1}}.bind(this));return this._oAddCatalogToModelPromise};a.prototype._onGetCatalogsFail=function(t){return sap.ushell.Container.getServiceAsync("Message").then(function(e){e.info(t)})};a.prototype._onDoneLoadingCatalogs=function(){var t=this.oModel.getProperty("/AppsData");t.sort(function(t,e){var i=t.title.toUpperCase();var a=e.title.toUpperCase();if(i<a){return-1}if(i>a){return 1}return 0});this.oModel.setProperty("/AppsData",t);var e=sap.ui.getCore().getEventBus();if(!this.bFirstCatalogLoaded){e.publish("launchpad","allMyAppsNoCatalogsLoaded")}};a.prototype._getAppEntityFromTile=function(t){return sap.ushell.Container.getServiceAsync("LaunchPage").then(function(e){var i;var a=e.getCatalogTilePreviewTitle(t);var s=e.getCatalogTilePreviewSubtitle(t);var r=e.getCatalogTileTargetURL(t);if(r&&(a||s)){i={};i.url=r;if(a){i.title=a;i.subTitle=s}else{i.title=s}return i}})};(function(){setTimeout(()=>{sap.ui.require(["sap/ushell/renderers/fiori2/allMyApps/AllMyAppsManager"],function(){})},0)})();return new a});
//# sourceMappingURL=AllMyAppsManager.js.map