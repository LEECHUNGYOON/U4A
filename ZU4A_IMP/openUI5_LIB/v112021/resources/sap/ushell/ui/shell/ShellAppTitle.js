// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/Bar","sap/m/Button","sap/m/Label","sap/m/HBox","sap/m/VBox","sap/m/library","sap/m/Popover","sap/m/ResponsivePopover","sap/m/Title","sap/m/ToggleButton","sap/ui/core/Core","sap/ui/core/Icon","sap/ui/core/IconPool","sap/ui/Device","sap/ui/performance/Measurement","sap/ushell/Config","sap/ushell/library","sap/ushell/resources","sap/ushell/ui/launchpad/AccessibilityCustomData"],function(e,t,o,l,s,i,p,n,a,r,h,u,c,v,y,A,d,f,g){"use strict";var M=d.AppTitleState;var S=d.AllMyAppsState;var P=i.PlacementType;var T=t.extend("sap.ushell.ui.shell.ShellAppTitle",{metadata:{library:"sap.ushell",properties:{title:{type:"string",group:"Data",defaultValue:null},subTitle:{type:"string",group:"Data",defaultValue:null},icon:{type:"sap.ui.core.URI",group:"Appearance",defaultValue:"sap-icon://folder"}},associations:{navigationMenu:{type:"sap.ushell.ui.shell.ShellNavigationMenu"},allMyApps:{type:"sap.ui.core.mvc.View"}},events:{textChanged:{deprecated:true}}},renderer:{apiVersion:2,render:function(e,t){var o=t._getControlVisibilityAndState();var l=t.getText();e.openStart("h1");e.class("sapUiPseudoInvisibleText");e.attr("aria-level","1");e.openEnd();e.text(l||"");e.close("h1");e.openStart("div",t);e.class("sapUshellHeadTitle");if(o||v.system.phone){e.class("sapUshellAppTitleClickable")}e.openEnd();e.openStart("div",t.getId()+"-button");e.class("sapUshellAppTitle");if(o||v.system.phone){e.attr("tabindex","0")}if(t.getTooltip_AsString()){e.attr("title",t.getTooltip_AsString())}if(o){e.attr("role","button");e.attr("aria-haspopup","dialog");e.attr("aria-label",l)}e.openEnd();if(v.media.getCurrentRange(v.media.RANGESETS.SAP_STANDARD).name!=="Phone"){e.openStart("span");e.class("sapUshellAppTitleText");e.openEnd();e.text(l||"");e.close("span")}if(o&&l){e.openStart("span");e.class("sapUshellShellHeadAction");e.openEnd();e.renderControl(t.oIcon);e.close("span")}e.close("div");e.close("div")}}});T.prototype.init=function(){t.prototype.init.apply(this,arguments);this.oIcon=c.createControlByURI(c.getIconURI("slim-arrow-down"));this.oIcon.addStyleClass("sapUshellAppTitleMenuIcon");if(v.system.desktop){this.addEventDelegate({onkeydown:function(e){if(e.altKey&&e.keyCode===40){this.onclick(e)}}.bind(this)})}};T.prototype.getFocusDomRef=function(){return this.getDomRef("button")};T._getCurrentState=function(){return A.last("/core/shellHeader/ShellAppTitleState")};T.prototype.onclick=function(e){e.preventDefault();this.firePress();if(!this._getControlVisibilityAndState()){if(v.system.phone){window.hasher.setHash(A.last("/core/shellHeader/rootIntent"))}return}if(T._getCurrentState()===M.AllMyAppsOnly){y.start("FLP:ShellAppTitle.onClick","Click ShellAppTitle in HOME state, Launching AllMyApps","FLP");this._openCloseAllMyAppsPopover();return}this._openCloseNavMenuPopover()};T.prototype._openCloseAllMyAppsPopover=function(){if(!this.oAllMyAppsPopover){this.oAllMyAppsPopover=this._createAllMyAppsPopover()}if(this.oAllMyAppsPopover){if(this.oAllMyAppsPopover.isOpen()){this.oAllMyAppsPopover.close()}else{this.oAllMyAppsPopover.openBy(this)}}};T.prototype._openCloseNavMenuPopover=function(){if(!this.oNavMenuPopover){this.oNavMenuPopover=this._createNavMenuPopover()}this.getModel().setProperty("/ShellAppTitleState",M.ShellNavMenu);if(this.oNavMenuPopover.isOpen()){this.oNavMenuPopover.close()}else{this.oNavMenuPopover.openBy(this)}if(this.oNavMenuPopover.getFooter()){var e=A.last("/core/shell/model/currentState/stateName");this.oNavMenuPopover.getFooter().setVisible(e==="home"||e==="app")}};T.prototype._getControlVisibilityAndState=function(){y.start("FLP:ShellAppTitle.getControlVisibilityAndState","Check AllMyApps and NavShellMenu visibility","FLP");var e=this.getModel();var t=A.last("/core/shell/model/currentState/stateName");var o=this._isNavMenuEnabled();var l=o;if(!e){return false}if(t==="app"||t==="home"){var s=A.last("/core/services/allMyApps/enabled");l=s||o;if(s&&o){e.setProperty("/ShellAppTitleState",M.ShellNavMenu)}else if(!s&&o){e.setProperty("/ShellAppTitleState",M.ShellNavMenuOnly)}else if(s&&!o){e.setProperty("/ShellAppTitleState",M.AllMyAppsOnly)}}else{e.setProperty("/ShellAppTitleState",M.ShellNavMenuOnly)}y.end("FLP:ShellAppTitle.getControlVisibilityAndState");return l};T.prototype._createAllMyAppsPopover=function(){var e=h.byId(this.getAllMyApps());if(!e){return null}var t=new n("sapUshellAllMyAppsPopover",{placement:P.Bottom,title:"",showArrow:true,customHeader:this._getPopoverHeader(),verticalScrolling:false,showHeader:{path:"/ShellAppTitleState",formatter:function(e){return e!==M.ShellNavMenu}},content:[e],contentHeight:"28rem",contentWidth:"56rem"}).addStyleClass("sapContrastPlus");t.setModel(this.getModel());t.attachAfterOpen(function(){e.getController()._afterOpen();var o=t.getCustomHeader();var l=o.getContentLeft()[0];var s=o.getContentLeft()[1];if(s.getVisible()){s.firePress();s.setPressed(true)}l.focus()});t.attachAfterClose(this._afterCloseAllMyAppsPopover.bind(this));return t};T.prototype._afterCloseAllMyAppsPopover=function(){this._bPressedSpace=false;if(this._bOpenNavigationMenu===true){this._bOpenNavigationMenu=false;this.oNavMenuPopover.openBy(this)}else if(!v.system.phone){this.focus()}};T.prototype._createNavMenuPopover=function(){var e=h.byId(this.getNavigationMenu());this.oTitle=new a("navMenuInnerTitle",{wrapping:true,text:"{/application/title}"});this.oSecondTitle=new o("navMenuInnerSecondTitle",{text:"{/title}",visible:"{= !!${/title}}",wrapping:true});this.oIconControl=new u({src:"{/application/icon}"});const t=new s({items:[this.oTitle,this.oSecondTitle]}).addStyleClass("sapUshellNavTitleBox");const i=new s({items:[this.oIconControl]}).addStyleClass("sapUiContentPadding");const n=new l("navMenuTitleBar",{width:"100%",items:[i,t]});var r=new p("sapUshellAppTitlePopover",{placement:P.Bottom,showArrow:true,showHeader:false,contentWidth:"20rem",horizontalScrolling:false,content:[n,e]}).addStyleClass("sapContrastPlus");if(A.last("/core/services/allMyApps/enabled")){r.setFooter(this._getPopoverFooterContent())}r.addStyleClass("sapUshellAppTitleNavigationMenuPopover");r.setModel(this.getModel());A.emit("/core/shell/model/allMyAppsMasterLevel",S.FirstLevel);r.attachBeforeOpen(function(){e._beforeOpen()});r.attachAfterOpen(function(){e.$().on("touchmove.scrollFix",function(e){e.stopPropagation()});e._afterOpen()});r.attachAfterClose(this._afterCloseNavigationMenuPopover.bind(this));return r};T.prototype._afterCloseNavigationMenuPopover=function(){this._bPressedSpace=false;if(this._bOpenAllMyApps){this._bOpenAllMyApps=false;this._openCloseAllMyAppsPopover()}else if(!v.system.phone){this.focus()}};T.prototype._setAllMyAppsTitle=function(e){var t=A.last("/core/shellHeader");if(t.title&&(t.ShellAppTitleState==="AllMyAppsOnly"||t.ShellAppTitleState==="AllMyApps")){e=e+" - "+t.title}a.prototype.setText.apply(this,[e])};T.prototype._getPopoverHeader=function(){var t=new a({text:f.i18n.getText("allMyApps_headerTitle"),level:"H1"});t.setText=this._setAllMyAppsTitle.bind(t);var o=new e("sapUshellShellAppPopoverHeader",{contentLeft:[this._createPopoverBackButton(),this._createPopoverToggleButton()],contentMiddle:[t]});return o};T.prototype.onAfterRendering=function(){var e=h.byId("shell-header");if(e){e.refreshLayout()}};T.prototype._createPopoverBackButton=function(){var e=new t("sapUshellAppTitleBackButton",{icon:c.getIconURI("nav-back"),press:[this._popoverBackButtonPressHandler,this],tooltip:f.i18n.getText("backBtn_tooltip"),visible:this.getAllMyAppsController().getBackButtonVisible()});e.addStyleClass("sapUshellCatalogNewGroupBackButton");return e};T.prototype._popoverBackButtonPressHandler=function(){var e=this.getAllMyAppsController();var t=e.getCurrentState();if(t===S.FirstLevel||t===S.FirstLevelSpread){if(T._getCurrentState()!==M.AllMyAppsOnly){this.getModel().setProperty("/ShellAppTitleState",M.ShellNavMenu);this.oAllMyAppsPopover.close();this._bOpenNavigationMenu=true}}else if(t===S.SecondLevel){e.switchToInitialState()}else{e.handleSwitchToMasterAreaOnPhone()}e.updateHeaderButtonsState()};T.prototype._createPopoverToggleButton=function(){var e=this.getAllMyAppsController();var t=new r("sapUshellAllMyAppsToggleListButton",{icon:c.getIconURI("sap-icon://menu2"),press:function(t){e.switchToInitialState();this.setTooltip(t.getParameter("pressed")?f.i18n.getText("ToggleButtonHide"):f.i18n.getText("ToggleButtonShow"))},tooltip:f.i18n.getText("ToggleButtonShow"),visible:e.getToggleListButtonVisible()});v.media.attachHandler(function(){t.setVisible(e.getToggleListButtonVisible())},this,v.media.RANGESETS.SAP_STANDARD);t.addStyleClass("sapUshellAllMyAppsToggleListButton");return t};T.prototype._getPopoverFooterContent=function(){var o=new t("allMyAppsButton",{text:f.i18n.getText("allMyApps_launchingButtonTitle"),press:this._allMyAppsButtonPressHandler.bind(this),visible:{path:"/ShellAppTitleState",formatter:function(e){return e===M.ShellNavMenu}}});var l=new e("shellpopoverFooter",{contentMiddle:[o]});this.addCustomData(o,"role","button");this.addCustomData(o,"aria-label",f.i18n.getText("allMyApps_launchingButtonTitle"));return l};T.prototype._allMyAppsButtonPressHandler=function(){if(h.byId(this.getAllMyApps())){y.start("FLP:ShellNavMenu.footerClick","Click the footer of ShellNavMenu, Launching AllMyApps","FLP");this.getModel().setProperty("/ShellAppTitleState",M.AllMyApps);this.oNavMenuPopover.close();this._bOpenAllMyApps=true}};T.prototype._isNavMenuEnabled=function(){var e=h.byId(this.getNavigationMenu());return e?e.getItems()&&e.getItems().length>0:false};T.prototype.addCustomData=function(e,t,o){e.addCustomData(new g({key:t,value:o,writeToDom:true}))};T.prototype.close=function(){if(this.oNavMenuPopover&&this.oNavMenuPopover.isOpen()){this.oNavMenuPopover.close()}if(this.oAllMyAppsPopover&&this.oAllMyAppsPopover.isOpen()){this.oAllMyAppsPopover.close()}};T.prototype.setTooltip=function(e){this.setAggregation("tooltip",e);this.oIcon.setTooltip(e)};T.prototype.getAllMyAppsController=function(){var e=h.byId(this.getAllMyApps());return e.getController()};T.prototype.onkeyup=function(e){if(e.keyCode===32){this.onclick(e)}};T.prototype.onsapenter=T.prototype.onclick;T.prototype.exit=function(){var e=h.byId(this.getNavigationMenu());var t=h.byId(this.getAllMyApps());if(e){e.destroy()}if(t){t.destroy()}if(this.oAllMyAppsPopover){this.oAllMyAppsPopover.destroy()}if(this.oNavMenuPopover){this.oNavMenuPopover.destroy()}if(this.oIcon){this.oIcon.destroy()}};return T},true);
//# sourceMappingURL=ShellAppTitle.js.map