// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
prepareUshellConfig();prepareModules();sap.ui.define(["sap/base/i18n/Formatting","sap/base/i18n/Localization","sap/ui/core/Core","sap/base/Log","sap/base/util/ObjectPath","sap/base/util/deepExtend","sap/base/util/isEmptyObject","sap/m/library","sap/ui/core/BusyIndicator","sap/ui/core/ComponentContainer","sap/ui/core/Popup","sap/ui/core/routing/History","sap/ui/thirdparty/hasher","sap/ui/thirdparty/jquery","sap/ui/thirdparty/URI","sap/ushell/appRuntime/ui5/AppCommunicationMgr","sap/ushell/appRuntime/ui5/AppRuntimeService","sap/ushell/appRuntime/ui5/performance/FesrEnhancer","sap/ushell/appRuntime/ui5/renderers/fiori2/AccessKeysAgent","sap/ushell/appRuntime/ui5/services/AppConfiguration","sap/ushell/appRuntime/ui5/services/AppLifeCycleAgent","sap/ushell/appRuntime/ui5/services/ShellUIService","sap/ushell/appRuntime/ui5/SessionHandlerAgent","sap/ushell/EventHub","sap/ushell/iconfonts","sap/ushell/UI5ComponentType","sap/ushell/ui5service/UserStatus","sap/ushell/utils/UrlParsing","sap/ushell/utils/WindowUtils","sap/ushell/appRuntime/ui5/AppRuntimeContext","sap/ui/core/Configuration","sap/ushell/renderer/utils","sap/ushell/appRuntime/ui5/renderers/fiori2/Renderer"],function(e,t,n,i,a,s,r,o,p,u,l,c,h,jQuery,f,d,m,g,v,C,y,A,S,R,b,I,P,w,U,F,H,D,L){"use strict";var M=o.URLHelper;g.init();var O,k=(new f).search(true),T=false,N,E=false,B=false,x=false,_=false,W;function j(){this.main=function(){var e,t=Promise.resolve(),n=Promise.resolve(),a=Promise.resolve(),s=O._getURI();jQuery("body").css("height","100%").css("width","100%");d.init(true);this.getPageConfig(s);O.setModulePaths();e=O.loadAdditionalLibs();if(s.hasOwnProperty("sap-remote-intent")){t=m.sendMessageToOuterShell("sap.ushell.services.UserInfo.getLocaleData",undefined,undefined,3e3,{})}F.setAppLifeCycleAgent(y);y.expandSapIntentParams(O._getURI()).then(function(s){var r,o;if(s.hasOwnProperty("sap-remote-intent")===true){F.setIsScube(true);o=s["sap-remote-intent"];if(o===undefined){i.error("Application cannot be opened. 'sAppIntent' is undefined")}F.setRemoteSystemId(s["sap-remote-system"]);O.adjustIframeURL()}else{r=s["sap-ui-app-id"]}O.init();var p=new Promise(function(e){sap.ui.require(["sap/ushell/appRuntime/ui5/services/UserInfo"],e)});if(F.getIsScube()===true){a=O.initServicesContainer()}else{n=O.initServicesContainer()}e.push(a);Promise.all(e).then(function(){if(F.getIsScube()===true){sap.ushell.Container.getServiceAsync("CommonDataModel")}Promise.all([n,O.getAppInfo(r,o),p,t]).then(function(e){var t=e[1].oResolvedHashFragment,n=e[1].oParsedHash,i=e[3]||{};O._setUI5LocaleAttributes(i);S.init();v.init();O._setInitialAppRoute();O.createApplication(r,s,t,o,n).then(function(e){O.renderApplication(e)})})})})};this._setUI5LocaleAttributes=function(n){if(Object.keys(n).length>0){if(n.calendarType){e.setCalendarType(n.calendarType)}if(n.dateFormatShort){e.setDatePattern("short",n.dateFormatShort)}if(n.dateFormatMedium){e.setDatePattern("medium",n.dateFormatMedium)}if(n.numberFormatGroup){e.setNumberSymbol("group",n.numberFormatGroup)}if(n.numberFormatDecimal){e.setNumberSymbol("decimal",n.numberFormatDecimal)}if(n.timeFormatShort){e.setTimePattern("short",n.timeFormatShort)}if(n.timeFormatMedium){e.setTimePattern("medium",n.timeFormatMedium)}if(n.calendarMapping){e.setCustomIslamicCalendarData(n.calendarMapping)}if(n.timeZone){t.setTimezone(n.timeZone)}if(n.currencyFormats){e.setCustomCurrencies(n.currencyFormats)}}};this._setInitialAppRoute=function(){var e=w.parseShellHash(h.getHash());if(e&&e.appSpecificRoute&&e.appSpecificRoute.length>0){m.sendMessageToOuterShell("sap.ushell.services.CrossApplicationNavigation.setInnerAppRoute",{appSpecificRoute:e.appSpecificRoute})}};this._getURI=function(){return(new f).query(true)};this.init=function(){b.registerFiori2IconFont();_=this._getURIParams()["sap-manifest-width"];C.setFullWidthFromManifest(_);d.registerCommHandlers({"sap.ushell.appRuntime":{oServiceCalls:{hashChange:{executeServiceCallFn:function(e){var t=e.oMessageData.body.sHash;if(typeof t==="string"){var n=w.parseShellHash(t),i=w.parseShellHash(h.getHash());if(n&&i&&n.semanticObject===i.semanticObject&&n.action===i.action){h.replaceHash(t)}}return(new jQuery.Deferred).resolve().promise()}},setDirtyFlag:{executeServiceCallFn:function(e){var t=e.oMessageData.body.bIsDirty;if(t!==sap.ushell.Container.getDirtyFlag()){sap.ushell.Container.setDirtyFlag(t)}return(new jQuery.Deferred).resolve().promise()}},getDirtyFlag:{executeServiceCallFn:function(e){return(new jQuery.Deferred).resolve(sap.ushell.Container.getDirtyFlag()).promise()}},themeChange:{executeServiceCallFn:function(e){var t=e.oMessageData.body.currentThemeId;sap.ushell.Container.getUser().setTheme(t);return(new jQuery.Deferred).resolve().promise()}},buttonClick:{executeServiceCallFn:function(e){L.handleHeaderButtonClick(e.oMessageData.body.buttonId);return(new jQuery.Deferred).resolve().promise()}},executeLogoutFunctions:{executeServiceCallFn:function(e){return sap.ushell.Container.executeAsyncAndSyncLogoutFunctions()}},uiDensityChange:{executeServiceCallFn:function(e){var t=e.oMessageData.body.isTouch;jQuery("body").toggleClass("sapUiSizeCompact",t==="0").toggleClass("sapUiSizeCozy",t==="1");return(new jQuery.Deferred).resolve().promise()}},handleDirtyStateProvider:{executeServiceCallFn:function(e){return(new jQuery.Deferred).resolve(sap.ushell.Container.handleDirtyStateProvider(e.oMessageData.body.oNavigationContext)).promise()}}}},"sap.ushell.services.MessageBroker":{oServiceCalls:{_execute:{executeServiceCallFn:function(e){return sap.ushell.Container.getServiceAsync("MessageBroker").then(function(t){return t.handleMessage(e.oMessageData.body)})}}}}})};this.handleLinkElementOpen=function(e,t){try{if(t.isDefaultPrevented&&t.isDefaultPrevented()===true){return}var n=t.target;if(n&&n.tagName==="A"&&n.href&&n.href.indexOf("#")>0){if(n.target==="_blank"){const i=n.href.split("#");if(i[0].length===0||i[0]===document.URL.split("#")[0]){O.rebuildNewAppUrl(n.href,e).then(e=>{U.openURL(e)});t.preventDefault()}}else if(n.target===undefined||n.target===""||n.target==="_top"||n.target==="_self"){var i=n.href.split("#"),a=document.URL.split("#");if(i[0]===a[0]){var s=i[1]&&i[1].split("&/"),r=a[1]&&a[1].split("&/");if(typeof s[0]==="string"&&typeof r[0]==="string"&&s[0]!==r[0]){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(e){e.toExternal({target:{shellHash:i[1]}})});t.preventDefault()}}}}}catch(e){}};this.rebuildNewAppUrl=async function(e,t){const n=e.split("#");if(n[0].length===0||n[0]===document.URL.split("#")[0]){if(F.getIsScube()){const e=await F.checkIntentsConversionForScube([{intent:"#"+n[1]}]);return t+e[0].intent}else{return t+"#"+n[1]}}return e};this.getPageConfig=function(e){window["sap-ushell-config"]=s({},z(),window["sap-ushell-config"]);if(e.hasOwnProperty("sap-remote-intent")){var t=window["sap-ushell-config"].bootstrapPlugins;if(t&&t.hasOwnProperty("WAPluginAgent")&&t["WAPluginAgent"].hasOwnProperty("config")){delete t["WAPluginAgent"].config["sap-plugin-agent"]}}};this.setModulePaths=function(){if(window["sap-ushell-config"].modulePaths){var e=Object.keys(window["sap-ushell-config"].modulePaths),t;for(var n in e){t=e[n];(function(e){var t={};t[e.replace(/\./g,"/")]=window["sap-ushell-config"].modulePaths[e];sap.ui.loader.config({paths:t})})(t)}}};this.loadAdditionalLibs=function(){var e=a.get("ui5.libs",window["sap-ushell-config"])||{},t=[];Object.keys(e).forEach(function(i){if(e[i]===true){t.push(n.loadLibrary(i,{async:true}))}});return t};this.adjustIframeURL=function(){};this.initServicesContainer=function(){return new Promise(function(e){sap.ui.require(["sap/ushell/appRuntime/ui5/services/Container"],function(t){t.bootstrap("apprt",{apprt:"sap.ushell.appRuntime.ui5.services.adapters"}).then(function(){sap.ushell.Container.getFLPUrlAsync().then(function(e){jQuery(document).on("click.appruntime",O.handleLinkElementOpen.bind(O,e));jQuery(document).on("keydown.appruntime",function(t){if(t.code==="Enter"){return O.handleLinkElementOpen(e,t)}})});sap.ushell.Container.getServiceAsync("ShellNavigation").then(function(t){W=t;W.init(function(){});y.setShellNavigationService(W);O._enableHistoryEntryReplacedDetection();e()})})})})};this._enableHistoryEntryReplacedDetection=function(){this._fnOriginalSetHash=h.setHash;this._fnOriginalReplaceHash=h.replaceHash;h.setHash=function(){if(h.disableCFLPUpdate===true){return this._fnOriginalSetHash.apply(h,arguments)}if(F.checkDataLossAndContinue()){return this._fnOriginalSetHash.apply(h,arguments)}}.bind(this);h.replaceHash=function(){if(h.disableCFLPUpdate===true){return this._fnOriginalReplaceHash.apply(h,arguments)}if(F.checkDataLossAndContinue()){return this._fnOriginalReplaceHash.apply(h,arguments)}}.bind(this)};this._getURIParams=function(){return k};this.getAppInfo=function(e,t){var n,i,a;if(e){n=window["sap-ushell-config"].ui5appruntime.config.appIndex.data;i=window["sap-ushell-config"].ui5appruntime.config.appIndex.module;a=window["sap-ushell-config"].ui5appruntime.config.appIndex.enableCache}return new Promise(function(s){if(e&&n&&!r(n)){y.init(i,O.createApplication.bind(O),O.renderApplication.bind(O),a,e,n);s({oResolvedHashFragment:n})}else{y.init(i,O.createApplication.bind(O),O.renderApplication.bind(O),a);y.getAppInfo(e,document.URL,t).then(s)}})};this.setHashChangedCallback=function(){if(B===true){return}function e(e,t){if(h.disableCFLPUpdate===true){return}if(e&&typeof e==="string"&&e.length>0){if(t&&typeof t==="string"&&t.length>0){var n=w.compareHashes(e,t);if(!n.sameIntent||!n.sameParameters){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(t){t.toExternal({target:{shellHash:e}})});return}}m.sendMessageToOuterShell("sap.ushell.appRuntime.hashChange",{newHash:e,direction:c.getInstance().getDirection()})}}h.changed.add(e.bind(this),this);B=true};this.createApplication=function(e,t,n,a,s){var r=w.getHash(window.location.href);return new Promise(function(o){var p="";if(t.hasOwnProperty("sap-history-dir")){p=t["sap-history-dir"];W.hashChanger.fireEvent("hashReplaced",{hash:W.hashChanger.getHash(),direction:p});i.debug("AppRuntime.createApplication :: Informed by the FLP, to change the History direction "+"property in the Iframe to: "+p)}var c=new u({id:(F.getIsScube()===true?a:e)+"-content",width:"100%",height:"100%"});c.addStyleClass("sapAppRuntimeBaseStyle");var h="0";if(k.hasOwnProperty("sap-touch")){h=k["sap-touch"];if(h!=="0"&&h!=="1"){h="0"}}jQuery("body").toggleClass("sapUiSizeCompact",h==="0").toggleClass("sapUiSizeCozy",h==="1");if(x===false){var f=new A({scopeObject:c,scopeType:"component"});f.setBackNavigation();new P({scopeObject:c,scopeType:"component"});y.setShellUIService(f);D.init();if(l.attachBlockLayerStateChange){l.attachBlockLayerStateChange(function(e){m.sendMessageToOuterShell("sap.ushell.services.ShellUIService.showShellUIBlocker",{bShow:e.getParameters().visible})})}x=true}(F.getIsScube()?Promise.resolve(""):y.getApplicationParameters(t)).then(function(i){n.url+=i;O.setHashChangedCallback();Promise.all([sap.ushell.Container.getServiceAsync("Ui5ComponentLoader"),sap.ushell.Container.getServiceAsync("AppLifeCycle")]).then(function(i){var p=i[0];var u=i[1];if(n.asyncHints&&Array.isArray(n.asyncHints.libs)){n.asyncHints.libs=n.asyncHints.libs.filter(function(e){return e.name!=="sap.ushell"})}var l,h;if(F.getIsScube()===true){l=n;h=s}else{l={ui5ComponentName:e,applicationDependencies:n,url:n.url};h=w.parseShellHash(r)}p.createComponent(l,h,[],I.Application).then(function(e){var n;if(F.getIsScube()===true){try{if(r&&r.indexOf("Shell-startIntent")===0){n=e.componentHandle.getMetadata().getManifestEntry("/sap.app/title");if(typeof n==="string"){setTimeout(function(){m.sendMessageToOuterShell("sap.ushell.services.ShellUIService.setTitle",{sTitle:n})},2e3)}}}catch(e){}}c.setComponent(e.componentHandle.getInstance());g.setAppShortId(e.componentHandle);u.prepareCurrentAppObject("UI5",e.componentHandle.getInstance(),false,undefined);O.getCurrentAppInfo(u,t,l,n);O.considerChangingTheDefaultFullWidthVal(e);O.overrideUrlHelperFuncs();o({oComponentContainer:c,oResolutionResultWithComponentHandle:e,sAppIntent:a||"",ui5ComponentName:l.ui5ComponentName})})})})})};this.getCurrentAppInfo=function(e,t,n,i){var a=["appFrameworkVersion","appVersion"];if(!t["sap-startup-params"]||t["sap-startup-params"].indexOf("sap-fiori-id")===-1){a.push("appId")}if(!t["sap-startup-params"]||t["sap-startup-params"].indexOf("sap-ach")===-1){a.push("appSupportInfo")}var s=e.getCurrentApplication();s.getInfo(a).then(function(e){for(var t in e){if(e[t]===undefined||e[t]===""){delete e[t]}}e.appFrameworkId="UI5";e.technicalAppComponentId=n.ui5ComponentName;if(typeof i==="string"){e.appTitle=i}y.setCurrentAppAttributes(e);setTimeout(function(){m.sendMessageToOuterShell("sap.ushell.services.AppLifeCycle.updateCurrentAppInfo",{info:e})},500)})};this.considerChangingTheDefaultFullWidthVal=function(e){if(_===true||_==="true"){R.emit("appWidthChange",false)}var t=e.componentHandle.getInstance();var n=t.getMetadata();if(n){var i=t.getMetadata().getManifestEntry("/sap.ui/fullWidth");var a=t.getMetadata().getManifestEntry("/sap.ui5/config/fullWidth");if(i===true||i==="true"||a===true||a==="true"){R.emit("appWidthChange",true)}else if(i===false||i==="false"||a===false||a==="false"){R.emit("appWidthChange",false)}}};this.overrideUrlHelperFuncs=function(){if(T===true){return}T=true;if(M){M.triggerEmail=function(e,t,n,i,a){m.sendMessageToOuterShell("sap.ushell.services.ShellUIService.sendEmail",{sTo:e,sSubject:t,sBody:n,sCc:i,sBcc:a,sIFrameURL:document.URL,bSetAppStateToPublic:true})};N=M.redirect;M.redirect=function(e,t){if(e&&t===true&&e.indexOf("#")>=0){sap.ushell.Container.getFLPUrlAsync().then(function(n){O.rebuildNewAppUrl(e,n).then(e=>{N.call(M,e,t)})})}else{N.call(M,e,t)}}}};this.loadPlugins=function(){if(E===true){return}E=true;sap.ushell.Container.getServiceAsync("PluginManager").then(function(e){o(e);if(F.getIsScube()===false){H(e)}e.loadPlugins("RendererExtensions")})};function o(e){e.registerPlugins({RTAPluginAgent:{component:"sap.ushell.appRuntime.ui5.plugins.rtaAgent",url:sap.ui.require.toUrl("sap/ushell/appRuntime/ui5/plugins/rtaAgent"),config:{"sap-plugin-agent":true}}})}function H(e){e.registerPlugins({WAPluginAgent:{component:"sap.ushell.appRuntime.ui5.plugins.scriptAgent",url:sap.ui.require.toUrl("sap/ushell/appRuntime/ui5/plugins/scriptAgent"),config:{"sap-plugin-agent":true,scube:false}}})}this.renderApplication=function(e){e.oComponentContainer.placeAt("content");p.hide();setTimeout(function(){if(e.oResolutionResultWithComponentHandle.componentHandle.getInstance().active){e.oResolutionResultWithComponentHandle.componentHandle.getInstance().active()}O.loadPlugins()},0);y.setCurrentApp(e.oComponentContainer,e.sAppIntent,e.ui5ComponentName)}}function z(){return{services:{CrossApplicationNavigation:{module:"sap.ushell.appRuntime.ui5.services.CrossApplicationNavigation",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},NavTargetResolution:{module:"sap.ushell.appRuntime.ui5.services.NavTargetResolution",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},ShellNavigation:{module:"sap.ushell.appRuntime.ui5.services.ShellNavigation",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},ClientSideTargetResolution:{adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},AppConfiguration:{module:"sap.ushell.appRuntime.ui5.services.AppConfiguration"},Bookmark:{module:"sap.ushell.appRuntime.ui5.services.Bookmark",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},BookmarkV2:{module:"sap.ushell.appRuntime.ui5.services.Bookmark",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},LaunchPage:{module:"sap.ushell.appRuntime.ui5.services.LaunchPage",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},UserInfo:{module:"sap.ushell.appRuntime.ui5.services.UserInfo",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},UserDefaultParameters:{module:"sap.ushell.appRuntime.ui5.services.UserDefaultParameters",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},AppState:{module:"sap.ushell.appRuntime.ui5.services.AppState",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},PluginManager:{config:{isBlueBox:true}},CommonDataModel:{module:"sap.ushell.appRuntime.ui5.services.CommonDataModel",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},ReferenceResolver:{module:"sap.ushell.appRuntime.ui5.services.ReferenceResolver"},MessageBroker:{module:"sap.ushell.appRuntime.ui5.services.MessageBroker"},Ui5ComponentLoader:{config:{loadDefaultDependencies:false}}},ushell:{customPreload:{enabled:false}}}}var q=new j;q._prepareUshellConfig=prepareUshellConfig;O=q;q.main();return q});function prepareUshellConfig(){"use strict";const e=sap.ui.require("sap/base/util/ObjectPath");let t={};const n=document.querySelector("meta[name='sap.ushellConfig.ui5appruntime']");if(n){t=JSON.parse(n.content)}const i=new URLSearchParams(window.location.search);if(i.has("sap-spaces")&&i.get("sap-spaces")==="true"){e.set("ushell.spaces.enabled",true,t)}if(i.has("sap-personalization")&&i.get("sap-personalization")==="false"){e.set("renderers.fiori2.componentData.config.enablePersonalization",false,t)}window["sap-ushell-config"]=t;_migrateV2ServiceConfig(window["sap-ushell-config"])}function _migrateV2ServiceConfig(e){"use strict";var t=sap.ui.require("sap/base/util/ObjectPath");[{from:"services.Bookmark",to:"services.BookmarkV2"},{from:"services.CrossApplicationNavigation",to:"services.Navigation"},{from:"services.Notifications",to:"services.NotificationsV2"},{from:"services.Personalization",to:"services.PersonalizationV2"},{from:"services.LaunchPage",to:"services.FlpLaunchPage"},{from:"services.ShellNavigation",to:"services.ShellNavigationInternal"}].forEach(n=>{const i=n.from.split(".")[1];const a=t.get(n.from,e);const s=t.get(n.to,e);if(a&&!s){const s={...a};if(s.module===`sap.ushell.services.${i}`){delete s.module}t.set(n.to,s,e)}})}function prepareModules(){"use strict";sap.ui.require(["sap/ui/core/BusyIndicator"],function(e){try{if(apprtBIdiv){document.body.classList.remove("apprtBIbg");apprtBIdiv.parentNode.removeChild(apprtBIdiv);apprtBIstyle.parentNode.removeChild(apprtBIstyle)}e.show(0)}catch(t){e.show(0)}});if(document.URL.indexOf("ui5appruntime")>0){sap.ui.define("sap/ushell/URLTemplateProcessor",[],function(){return{}});sap.ui.define("sap/ushell/_ApplicationType/wdaResolution",[],function(){return{}});sap.ui.define("sap/ushell/_ApplicationType/guiResolution",[],function(){return{}});if(document.URL.indexOf("sap-ui-app-id=")>0){sap.ui.define("sap/ushell/ApplicationType",[],function(){return{URL:{type:"URL"},WDA:{type:"WDA"},TR:{type:"TR"},NWBC:{type:"NWBC"},WCF:{type:"WCF"},SAPUI5:{type:"SAPUI5"}}})}sap.ui.define("sap/ushell/components/applicationIntegration/AppLifeCycle",[],function(){return{}});sap.ui.define("sap/ushell/services/appstate/WindowAdapter",[],function(){return function(){}});sap.ui.define("sap/ushell/services/appstate/SequentializingAdapter",[],function(){return function(){}});sap.ui.define("sap/ushell/services/appstate/Sequentializer",[],function(){return function(){}});sap.ui.define("sap/ushell/services/Configuration",[],function(){function e(){this.attachSizeBehaviorUpdate=function(){};this.hasNoAdapter=true}e.hasNoAdapter=true;return e});sap.ui.define("sap/ushell/services/_PluginManager/Extensions",[],function(){return function(){}});sap.ui.define("sap/ushell/services/_MessageBroker/MessageBrokerEngine",[],function(){return function(){}});sap.ui.define("sap/ushell/bootstrap/common/common.load.core-min",[],function(){return{loaded:false,load:function(e){}}})}}
//# sourceMappingURL=AppRuntime.js.map