// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/thirdparty/URI","sap/ui/model/resource/ResourceModel","sap/m/Dialog","sap/m/DialogType","sap/m/Button","sap/m/ButtonType","sap/m/Text"],function(jQuery,e,r,t,a,i,n,s){"use strict";var p=(new e).search(true);var o="/sap/fiori";var l="sap-ui-app-id";var u="/sap/bc";var c=/sv\/.+\/manifest/;var f;function v(e){return u+"/ui2/app_index/ui5_app_info_json?id="+e}function g(r){var t={};var a=r||document.URL;var i=new e(a);var n=i.query(true)["sap-startup-params"];var s=new e("?"+n).query(true);var p;Object.keys(s).forEach(function(e){t[e.toLowerCase()]=s[e]});if(t["sap-app-uri"]&&t["sap-app-name"]){var l=t["sap-app-uri"].replace(/\/$/,"");var u=t["sap-app-name"];f=o+"/"+u+"/";p=o+"/"+u+l}if(p){p=p.replace(".webapp","/webapp")}return p}function d(){if(!this.oErrorMessageDialog){var e=new r({bundleUrl:"/sap/fiori/appruntime/i18n/i18nApp.properties"});this.oErrorMessageDialog=new t({type:a.Message,title:e.getProperty("ERROR_DIALOG_TITLE"),state:sap.ui.core.ValueState.Error,content:new s({text:e.getProperty("MISSING_PARAMETERS_ERROR")}),contentWidth:"30%",beginButton:new i({type:n.Emphasized,text:e.getProperty("OK_BUTTON"),press:function(){this.oErrorMessageDialog.close();sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(e){e.toExternal({target:{semanticObject:"Shell",action:"home"}})})}.bind(this)})})}return this.oErrorMessageDialog}function h(e,r,t){if(f){var a=sap.ushell.cloudServices.interceptor.FilterManager.getInstance();var i=e.getFilter("sap.ushell.cloudServices.interceptor.filter.DoorWayMappingFilter");if(!a.isRegistered("sap.ushell.cloudServices.interceptor.filter.DoorWayMappingFilter")){a.register("sap.ushell.cloudServices.interceptor.filter.DoorWayMappingFilter")}i.addAppToStack(t,f);r.addAppToStack(t,f)}}function m(e,r){var t=new jQuery.Deferred;e=e||p[l];jQuery.ajax(v(e)).then(function(a){if(a&&!(Object.keys(a).length===0)){a=e in a?a[e]:a;var i=a&&a.asyncHints&&a.asyncHints.libs||[];i.forEach(function(e){if(e&&e.url&&e.url.final){e.url.url=o+e.url.url}});var n=a&&a.asyncHints&&a.asyncHints.components||[];n.forEach(function(e){if(e&&e.url&&e.url.final){e.url.url=o+e.url.url}});if("url"in a){a.url=o+a.url;f=a.url}else{a.url=g(r)}if(!a.url){this.oErrorMessageDialog=d.call(this);this.oErrorMessageDialog.open();return t.reject(new Error("sap-app-uri & sap-app-name parameters were not provided"))}var s;var p=sap.ushell.cloudServices.interceptor.FilterFactory.getInstance();var l=p.getFilter("sap.ushell.cloudServices.interceptor.filter.CacheBusterFilter");if("manifestUrl"in a){if(c.test(a.manifestUrl)){var u=c.exec(a.manifestUrl);var v=u[0].split("/");s=v[1]}}if(s){l.setTimestamp(s)}else{l.setTimestamp()}h(p,l,e);return t.resolve(a)}return t.reject(new Error("AppInfo from AppIndex is empty"))}).fail(function(e){t.reject(e)});return t.promise()}sap.ui.define("appInfoService",[],function(){return{getAppInfo:m}})});
//# sourceMappingURL=AppInfoService.js.map