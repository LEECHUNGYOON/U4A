// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils/UrlParsing","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/Sorter"],function(t,e,r,i){"use strict";var n=function(t,e,r){};n.prototype.search=function(t){return this._searchWithSearchableContentAndJsSearch(t)};n.prototype._searchWithSearchableContentAndJsSearch=function(t){return Promise.all([this._getNormalizedSearchableContentApps(t),this._loadJsSearchModule()]).then(function(e){var r=e[0];var i=e[1];var n=new i({objects:r,fields:["title","label","description","keywords"],shouldNormalize:!String.prototype.normalize,algorithm:{id:"contains-ranked",options:[50,49,40,39,5,4,51]}});var a={searchFor:t&&t.searchTerm||"*",top:Number.MAX_SAFE_INTEGER,skip:0};var o=n.search(a);var s=o.results.map(function(t){return t.object});return this._getPaginatedResult(this._applyFiltersAndSorter(s,t.filter,t.sort),t.skip||0,t.top||10)}.bind(this))};n.prototype._getPaginatedResult=function(t,e,r){return{data:t.slice(e,e+r),count:t.length}};n.prototype._getSearchableContent=function(t){var e=t&&{includeAppsWithoutVisualizations:!!t.includeAppsWithoutVisualizations,enableVisualizationPreview:t.enableVisualizationPreview!==false};return sap.ushell.Container.getServiceAsync("SearchableContent").then(function(t){return t.getApps(e)})};n.prototype._getNormalizedSearchableContentApps=function(t){return this._getSearchableContent(t).then(function(t){return this._normalizeSearchableContentServiceResult(t)}.bind(this))};n.prototype._normalizeSearchableContentServiceResult=function(t){if(!Array.isArray(t)){t=[]}var e=[];var r;var i;var n;t.forEach(function(t){if(t.visualizations&&t.visualizations.length>0){t.visualizations.forEach(function(a){r=a.vizConfig&&a.vizConfig["sap.app"]&&a.vizConfig["sap.app"].title||a.title||t.title;i=a.vizConfig&&a.vizConfig["sap.app"]&&a.vizConfig["sap.app"].subTitle||a.subtitle||t.subtitle;n=i?r+" - "+i:r;e.push({title:r,description:i,keywords:Array.isArray(a.keywords)?a.keywords.join(" "):"",icon:a.icon||"",label:n,visualization:a,url:a.targetURL,technicalAttributes:Array.isArray(t.technicalAttributes)?t.technicalAttributes.join(" "):""})})}else{r=t.title;i=t.subtitle;n=i?r+" - "+i:r;e.push({title:r,description:i,keywords:Array.isArray(t.keywords)?t.keywords.join(" "):"",icon:t.icon||"",label:n,url:t.targetURL,technicalAttributes:Array.isArray(t.technicalAttributes)?t.technicalAttributes.join(" "):""})}});return e};n.prototype._loadJsSearchModule=function(){this._loadJsSearchModulePromise=new Promise(function(t){sap.ui.getCore().loadLibrary("sap.esh.search.ui",{async:true}).then(function(){sap.ui.require(["sap/esh/search/ui/appsearch/JsSearch"],function(e){t(e)})})});return this._loadJsSearchModulePromise};n.prototype._createFilters=function(t){var e=null;if(t){if(typeof t==="object"){if(Array.isArray(t.filters)){t.filters=t.filters.map(function(t){return t instanceof r?t:new r(t)})}e=[t instanceof r?t:new r(t)]}}return e};n.prototype._createSorters=function(t){var e=null;if(t){if(typeof t==="object"&&!Array.isArray(t)){t=[t]}if(Array.isArray(t)){e=t.map(function(t){return t instanceof i?t:new i(t)})}}return e};n.prototype._applyFiltersAndSorter=function(t,r,i){if(!r&&!i){return t}var n=this._createFilters(r),a=this._createSorters(i),o=new e;o.setSizeLimit(Number.MAX_SAFE_INTEGER);o.setData(t);return o.bindList("/",null,a,n).getContexts().map(function(t){return t.getObject()})};return n},false);
//# sourceMappingURL=SearchCEPAdapter.js.map