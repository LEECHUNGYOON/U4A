// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/core/Configuration","sap/ushell/Config","sap/ushell/library","sap/ushell/utils/HttpClient"],function(e,t,n,i,s){"use strict";var r=i.ContentNodeType;var a="sap.ushell.adapters.cep.MenuAdapter";var o=function(t,n,i){if(i&&i.config&&i.config.serviceUrl&&i.config.siteId){this.httpClient=new s;this.serviceUrl=i.config.serviceUrl;this.siteId=i.config.siteId;this.oSiteDataPromise=this._doRequest(this.serviceUrl,this.siteId)}else{e.error("Invalid configuration provided.","",a)}};o.prototype.isMenuEnabled=function(){if(!n.last("/core/menu/enabled")){return Promise.resolve(false)}return this.getMenuEntries().then(function(e){return e.length>0})};o.prototype.getMenuEntries=function(){return this.oSiteDataPromise.then(this._getSpaces.bind(this)).then(this._buildMenuEntries.bind(this))};o.prototype.getContentNodes=function(){return this.oSiteDataPromise.then(this._getSpaces.bind(this)).then(this._buildContentNodes.bind(this))};o.prototype._buildMenuEntries=function(e){return e.filter(this._isSpaceNotEmpty.bind(null,"FLP menu")).map(function(e){var t={title:e.descriptor.value.title||e.id,"help-id":"Space-"+e.id,description:"",icon:undefined,type:"IBN",target:{semanticObject:"Launchpad",action:"openFLPPage",parameters:[{name:"spaceId",value:e.id},{name:"pageId",value:e.workPages.nodes[0].id}],innerAppRoute:undefined},menuEntries:[]};var n=e.workPages.nodes.map(function(t){t.contents=t.contents||{};t.contents.descriptor=t.contents.descriptor||{};t.contents.descriptor.value=t.contents.descriptor.value||{};return{title:t.contents.descriptor.value.title||t.id,"help-id":"Page-"+t.id,description:"",icon:undefined,type:"IBN",target:{semanticObject:"Launchpad",action:"openFLPPage",parameters:[{name:"spaceId",value:e.id},{name:"pageId",value:t.id}],innerAppRoute:undefined},menuEntries:[]}});if(n.length>1){t.menuEntries=n}return t})};o.prototype._buildContentNodes=function(e){return e.filter(this._isSpaceNotEmpty.bind(null,"content nodes")).map(function(e){return{id:e.id,label:e.descriptor.value.title||e.id,type:r.Space,isContainer:false,children:e.workPages.nodes.map(function(e){return{id:e.id,label:e.contents.descriptor.value.title||e.id,type:r.Page,isContainer:this._isTraditionalPage(e.contents.descriptor),children:[]}}.bind(this))}}.bind(this))};o.prototype.isWorkPage=function(e){return this.oSiteDataPromise.then(this._getSpaces.bind(this)).then(function(t){var n=t.flatMap(function(e){return e.workPages&&e.workPages.nodes||[]}).find(function(t){return t.id===e});if(n){return!this._isTraditionalPage(n.contents.descriptor)}return false}.bind(this))};o.prototype._isTraditionalPage=function(e){return!!(e.value&&e.value.pageType&&e.value.pageType.toLowerCase()===r.Page.toLowerCase())};o.prototype._doRequest=function(n,i){var s="{"+"spaces("+'siteId:"'+i+'"'+"){"+"nodes{"+"id,"+"descriptor{"+'value(select:["/title"])'+"},"+"workPages{"+"nodes{"+"id,"+'contents(queryInput:{selectProperties:["/descriptor"],selectDescriptorProperties:["/value/title","/value/pageType"]})'+"}"+"}"+"}"+"}"+"}";return this.httpClient.get(n+"?query="+s,{headers:{"Content-Type":"application/json",Accept:"application/json","Accept-Language":t.getLanguageTag()}}).then(function(t){if(t.status<200||t.status>=300){e.error(t.responseText,"",a);return Promise.reject("HTTP request to GraphQL service failed with status: "+t.status+" - "+t.statusText)}return JSON.parse(t.responseText||"{}")}).then(function(e){try{e.data.spaces.nodes=e.data.spaces.nodes.filter(function(e){return e.id!=="default_space"})}catch(e){}return e})};o.prototype._getSpaces=function(t){if(t.data&&t.data.spaces&&Array.isArray(t.data.spaces.nodes)){return t.data.spaces.nodes}e.warning("No spaces found for site-id: "+this.siteId,"",a);return[]};o.prototype._isSpaceNotEmpty=function(t,n){if(!n.workPages||!n.workPages.nodes||n.workPages.nodes.length===0){e.warning("FLP space "+n.id+" without page omitted in "+t+".","",a);return false}return true};return o});
//# sourceMappingURL=MenuAdapter.js.map