// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/util/deepExtend","sap/base/util/ObjectPath","sap/ui/thirdparty/URI","sap/ushell/_ApplicationType/systemAlias","sap/ushell/_ApplicationType/utils"],function(s,e,a,t,n){"use strict";function r(e,a){return new Promise(function(t,r){var i=s({},e);if(a.length>0){i["sap-ushell-defaultedParameterNames"]=[JSON.stringify(a)]}delete i["sap-system"];sap.ushell.Container.getServiceAsync("ShellNavigation").then(function(s){s.compactParams(i,["sap-xapp-state","sap-xapp-state-data","sap-ushell-defaultedParameterNames","sap-intent-params","sap-iframe-hint","sap-keep-alive","sap-wd-configId"],undefined,true).fail(function(s){r(s)}).done(function(s){var e=n.getURLParsing().paramsToString(s);t(e)})}).catch(function(s){r(s)})})}function i(s,e){var a=s.search();if(e){a=a+(a.indexOf("?")<0?"?":"&")+e}return s.search(a).toString()}function p(e,r,i,p,l){var m,c,f,d,y,v=s({},p);if(r){v["sap-wd-configId"]=r}if(v["sap-system"]){m=v["sap-system"][0];delete v["sap-system"]}if(v.hasOwnProperty("sap-system-src")){c=v["sap-system-src"][0];delete v["sap-system-src"]}y=n.getURLParsing().paramsToString(v);if(i){f=u(e,y)}else{f=o(e,y)}d=new a(f);return t.spliceSapSystemIntoURI(d,t.LOCAL_SYSTEM_ALIAS,m,c,"WDA",t.SYSTEM_ALIAS_SEMANTICS.apply,l)}function u(s,e){return"/ui2/nwbc/~canvas;window=app/wda/"+s+"/"+"?"+e}function o(s,e){var a=s.indexOf("/")!==0;if(a){s="sap/"+s}return"/webdynpro/"+s+"?"+e}function l(s,e,a,t){var r={"sap-system":a,url:e,text:s.title,applicationType:"WDA"};if(typeof t==="string"){r["sap-system-src"]=t}n.setSystemAlias(r,s.resolutionResult);["additionalInformation","applicationDependencies"].forEach(function(e){if(s.resolutionResult.hasOwnProperty(e)){r[e]=s.resolutionResult[e]}});r.url=n.appendParametersToUrl("sap-iframe-hint="+(r.url.indexOf("/ui2/nwbc/")>=0?"NWBC":"WDA"),r.url);return r}function m(s,a,t){var n=e.get("inbound.resolutionResult",s);var u=s.mappedIntentParamsPlusSimpleDefaults||{};var o=n.systemAlias;if(u["sap-system"]){o=u["sap-system"][0]}var m;if(u["sap-system-src"]){m=u["sap-system-src"][0]}var c={"sap-system":[o]};if(typeof m==="string"){c["sap-system-src"]=[m]}var f=n["sap.wda"].compatibilityMode;if(f===undefined){f=true}return Promise.all([p(n["sap.wda"].applicationId,n["sap.wda"].configId,f,c,t),r(u,s.mappedDefaultedParamNames)]).then(function(e){var a=e[0];var t=e[1];var n=i(a,t);var r=u["sap-system"]&&u["sap-system"][0];var p=u["sap-system-src"]&&u["sap-system-src"][0];var o=l(s.inbound,n,r,p);return o})}function c(s,e,n){var p=s.inbound,u=p&&p.resolutionResult,o=s.mappedIntentParamsPlusSimpleDefaults;var m=new a(e);var c=o["sap-system"]&&o["sap-system"][0];var f=o["sap-system-src"]&&o["sap-system-src"][0];return Promise.all([t.spliceSapSystemIntoURI(m,u.systemAlias,c,f,"WDA",u.systemAliasSemantics||t.SYSTEM_ALIAS_SEMANTICS.applied,n),r(o,s.mappedDefaultedParamNames)]).then(function(s){var e=s[0];var a=s[1];var t=i(e,a);var n=l(p,t,c,f);return n},function(s){return Promise.reject(s)})}function f(s,a,t,r){var i=s.params["sap-ui2-wd-app-id"][0];var u=(e.get("params.sap-ui2-wd-conf-id",s)||[])[0];var o=Object.keys(s.params).reduce(function(e,a){if(a!=="sap-ui2-wd-app-id"&&a!=="sap-ui2-wd-conf-id"){e[a]=s.params[a]}return e},{});return p(i,u,r,o,t).then(function(e){var t=s.params.hasOwnProperty("sap-system-src")&&s.params["sap-system-src"][0];var r=s.params.hasOwnProperty("sap-system")&&s.params["sap-system"][0];var p={url:e.toString(),applicationType:"WDA",text:i,additionalInformation:"","sap-system":r};if(typeof t==="string"){p["sap-system-src"]=t}if(a&&a.inbound&&a.inbound.resolutionResult&&a.inbound.resolutionResult["sap.platform.runtime"]){p["sap.platform.runtime"]=a.inbound.resolutionResult["sap.platform.runtime"]}p.url=n.appendParametersToUrl("sap-iframe-hint="+(p.url.indexOf("/ui2/nwbc/")>=0?"NWBC":"WDA"),p.url);return p})}function d(s,e,a){return new Promise(function(t,r){var i=s.inbound;var p=i&&i.resolutionResult;var u;if(i&&p){if(p["sap.wda"]){u=m(s,e,a)}else{u=c(s,e,a)}}if(u){u.then(function(e){e.extendedInfo=n.getExtendedInfo(s);n.checkOpenWithPost(s,e);n.addKeepAliveToURLTemplateResult(e);return e}).then(t,r)}else{t()}})}return{generateWDAResolutionResult:d,resolveEasyAccessMenuIntentWDA:f,constructFullWDAResolutionResult:m,constructWDAResolutionResult:c}});
//# sourceMappingURL=wdaResolution.js.map