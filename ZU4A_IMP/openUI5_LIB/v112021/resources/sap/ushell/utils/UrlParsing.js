// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/URI","sap/base/util/UriParameters","sap/base/Log","sap/base/util/deepEqual","sap/base/util/merge","sap/ushell/TechnicalParameters"],function(e,t,n,r,a,i){"use strict";function s(){}var o=/^(([A-Za-z0-9_/]+)-([A-Za-z0-9_/-]+)(~([A-Z0-9a-z=+/]+))?)?([?]([^&]|(&[^/]))*&?)?$/;s.getShellHash=function(e){var t=/[^#]*#(([^&]|&[^/])*)(&\/.*)?/,n=t.exec(e);if(n){return n[1]}return undefined};s.getHash=function(e){var t=/#(.*)/,n=t.exec(e);if(n){return n[1]}return undefined};s.isIntentUrl=function(e){return this._isIntentUrl(e,window.location.href)};s.isIntentUrlAsync=function(e){return new Promise(function(e,t){sap.ushell.Container.getFLPUrlAsync(true).done(e).fail(t)}).then(function(t){return this._isIntentUrl(e,t)}.bind(this))};s._isIntentUrl=function(t,n){var r=/^#/,a,i,o,c,u,p;if(typeof t!=="string"){return false}if(!r.test(t)){a=new e(t).normalize();o=a.protocol()+"://"+a.host()+a.pathname();i=new e(n).normalize();c=i.protocol()+"://"+i.host()+i.pathname();if(o!==c){return false}}u=s.getHash(t);if(!u){return false}p=s.parseShellHash(u);if(p&&p.semanticObject&&p.action){return true}return false};s.parseParameters=function(e){try{var r=t.fromQuery(e);var a=r.keys();var i=a.next();var s={};while(i.done===false){s[decodeURIComponent(i.value)]=r.getAll(i.value);i=a.next()}return s}catch(t){n.error("URL parsing - malformed URL parameters string:",e);return{}}};function c(e,t,n){var r,a,i,s,o,c="";t=t||"&";n=n||"=";r="";a=null;o=[];for(a in e){if(e.hasOwnProperty(a)){o.push(a)}}o.sort();for(i=0;i<o.length;i=i+1){a=o[i];if(Array.isArray(e[a])){for(s=0;s<e[a].length;s=s+1){c+=r+encodeURIComponent(a)+n+encodeURIComponent(e[a][s]);r=t}}else{c+=r+encodeURIComponent(a)+n+encodeURIComponent(e[a]);r=t}}return c}s.paramsToString=function(e){return c(e)};s.privparamsToString=function(e,t,n){return c(e,t,n)};s.parseShellHash=function(e){var t=o,n,r,a,i,c,u,p;if(!e){return undefined}n=s.splitHash(e);u=t.exec(n.shellPart);if(u){r=u[2];a=u[3];i=u[5];c=u[6];p=s.parseParameters(c);return{semanticObject:r,action:a,contextRaw:i,params:p,appSpecificRoute:n.appSpecificRoute}}if(n.appSpecificRoute){return{semanticObject:undefined,action:undefined,contextRaw:undefined,params:{},appSpecificRoute:n.appSpecificRoute}}return undefined};s.privstripLeadingHash=function(e){if(e[0]==="#"){return e.substring(1)}return e};s.splitHash=function(e){var t=/^(?:#|)([\S\s]*?)(&\/[\S\s]*)?$/,n,r,a;if(e===undefined||e===null||e===""){return{}}n=t.exec(e);r=n[1];if(r!==""&&!o.test(r)){return{}}a=n[2];if(r||a){return{shellPart:r,appSpecificRoute:a}}return{}};function u(e,t){if(t){return e+t}return e}s.constructShellHash=function(e){var t,r,a,i=null,o,c=[],p="?",f=null;if(!e){return""}if(!e.target){e.target={};e.target.semanticObject=e.semanticObject;e.target.action=e.action;e.target.contextRaw=e.contextRaw}if(e.target.shellHash||e.target.shellHash===""){a=s.privstripLeadingHash(e.target.shellHash);return u(a,e.appSpecificRoute)}if(e.target.semanticObject&&e.target.action){t=e.target.semanticObject+"-"+e.target.action.replace(/[?].*/,"")}else{return u("",e.appSpecificRoute)}if(e.target.contextRaw){t+="~"+e.target.contextRaw}p="?";f=null;c=[];for(f in e.params){if(e.params.hasOwnProperty(f)){c.push(f)}}r=e.params&&JSON.parse(JSON.stringify(e.params))||{};if(e.appStateKey){c.push("sap-xapp-state");r["sap-xapp-state"]=e.appStateKey}c.sort();for(o=0;o<c.length;o=o+1){f=c[o];if(Array.isArray(r[f])){if(r[f].length>1){n.error("Array startup parameters violate the designed intent of the Unified Shell Intent, use only single-valued parameters!")}for(i=0;i<r[f].length;i=i+1){t+=p+encodeURIComponent(f)+"="+encodeURIComponent(r[f][i]);p="&"}}else{t+=p+encodeURIComponent(f)+"="+encodeURIComponent(r[f]);p="&"}}return u(t,e.appSpecificRoute)};s.compareHashes=function(e,t){var n=this.parseShellHash(e)||{};var r=this.parseShellHash(t)||{};return{sameIntent:this.haveSameIntent(n,r),sameParameters:this.haveSameIntentParameters(n,r),sameAppSpecificRoute:n.appSpecificRoute===r.appSpecificRoute}};s.haveSameIntent=function(e,t){e=e||{};t=t||{};return e.semanticObject===t.semanticObject&&e.action===t.action&&e.contextRaw===t.contextRaw};s.haveSameIntentParameters=function(e,t){e=e||{};t=t||{};var n=a({},e.params);var r=a({},t.params);return!this._parametersChanged(this._removeNonIntentParameters(n),this._removeNonIntentParameters(r))};s._removeNonIntentParameters=function(e){var t=i.getParameters({isIntentParameter:false});var n;if(e){for(var r=0;r<t.length;r++){n=t[r];if(e[n.name]){delete e[n.name]}}}return e||{}};s._parametersChanged=function(e,t){return!r(e,t)};return s});
//# sourceMappingURL=UrlParsing.js.map