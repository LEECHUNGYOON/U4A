// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/util/ObjectPath","sap/ui/core/Core","sap/ui/Device","sap/ushell/components/_HeaderManager/PropertyStrategiesFactory","sap/ushell/components/StateHelper","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/utils","sap/base/util/deepClone"],function(e,t,a,r,n,o,i,l,s){"use strict";var d={application:{},centralAreaElement:null,headEndItems:[],headItems:[],headerVisible:true,showLogo:false,ShellAppTitleState:undefined,rootIntent:o.last("/core/shellHeader/rootIntent"),homeUri:o.last("/core/shellHeader/homeUri"),title:""};var c;var u;var h="endItemsOverflowBtn";var f;var m={blank:{},"blank-home":{},home:{headItems:[]},app:{headItems:["backBtn"]},minimal:{headItems:[]},standalone:{headItems:["backBtn"]},embedded:{headItems:["backBtn"]},"embedded-home":{headItems:[]},headerless:{headItems:["backBtn"],headerVisible:false},merged:{headItems:["backBtn"]},"headerless-home":{headerVisible:false},"merged-home":{},lean:{headItems:[]},"lean-home":{}};var p=[];function S(e,t){var r=e&&e.appState?e.appState:"home";c=O(e);u=t;f=a.media.getCurrentRange(a.media.RANGESETS.SAP_STANDARD).name;A();b();B(r);x()}function v(){g()}function b(){var e=i.on("setHeaderCentralAreaElement").do(function(e){y({propertyName:"centralAreaElement",value:e.id,aStates:n.getPassStates(e.states),bCurrentState:!!e.currentState,bDoNotPropagate:!!e.bDoNotPropagate})});p.push(e);p.push(i.on("updateHeaderOverflowState").do(I));a.media.attachHandler(I,this,a.media.RANGESETS.SAP_STANDARD);p.push(o.on("/core/shellHeader/headEndItems").do(N));p.push(o.on("/core/shell/model/currentSpaceAndPage").do(E))}function g(){if(p){p.forEach(function(e){e.off()})}a.media.detachHandler(I,this,a.media.RANGESETS.SAP_STANDARD)}function I(e){if(e&&e.name){f=e.name}A();N()}function A(e){var t=o.last("/core/shell/model/currentState/stateName");var a=t==="merged"||t==="headerless";var r=!a;y({propertyName:"showLogo",value:r,aStates:["home","app","blank","blank-home","minimal","lean"],bCurrentState:false,bDoNotPropagate:true})}function E(e){if(o.last("/core/spaces/enabled")&&o.last("/core/spaces/homeNavigationTarget")==="origin_page"){var t=e?encodeURI(e.hash):d.rootIntent;var a=this&&this.updateStates||y;a({propertyName:"homeUri",value:"#"+t})}}function N(e){var a=o.last("/core/shellHeader/headEndItems");var r=a.indexOf(h)>-1;var n=e&&e.name||f;if(n==="Phone"&&!r&&a.length>2){H([h],false,["home","app"])}else if(n!=="Phone"&&r){var i=t.byId("headEndItemsOverflow");if(i){i.destroy()}C([h],false,["home","app"])}}function H(e,t,a,r){y({propertyName:"headEndItems",value:e,aStates:a,bCurrentState:!!t,bDoNotPropagate:!!r})}function C(e,t,a){y({propertyName:"headEndItems",value:e,aStates:a,bCurrentState:!!t,action:"remove",bDoNotPropagate:false})}function P(e,t){var a={};Object.keys(e).forEach(function(r){var n=e[r];a[r]=Object.keys(n).reduce(function(e,t){e[t]=n[t];return e},s(t))});return a}function y(t){var a=t.propertyName;var i=!t.bCurrentState?n.getAllStateToUpdate(t.aStates,t.bDoNotPropagate):[];var l=o.last("/core/shellHeader");var s=o.last("/core/shell/model/currentState/stateName");var d=t.value;if(a.charAt(0)==="/"){a=a.substring(1)}var u=r(a,t.action);if(!u){return}if(!t.bCurrentState){c=T(c,a,u,i,d)}if(i.indexOf(s)>-1||t.bCurrentState){var h=e.get(a.split("/"),l);var f=u.execute(h,d);if(h!==f){e.set(a.split("/"),f,l);_(a,l)}}if(t.bCurrentState){w(a,u,d)}}function k(e){var t;for(t in e){if(e.hasOwnProperty(t)){l.updateProperties(c[t],e[t])}}}function B(e){var t=c[e];if(!t){throw new Error("the state ("+e+") does not exist")}o.emit("/core/shellHeader",s(t))}function x(e){var t=o.last("/core/shellHeader");var a;var r;if(u&&u.customShellState){a=u.customShellState.currentState}if(e&&u.extendedShellStates[e]){r=u.extendedShellStates[e].customState.currentState}o.emit("/core/shellHeader",D(t,a,r))}function D(e,t,a){var n={};Object.keys(e).forEach(function(o){var i=r(o);var l=s(e[o]);if(i){if(a){l=i.execute(l,a[o])}if(t){l=i.execute(l,t[o])}}n[o]=l});n.ShellAppTitleState=o.last("/core/shellHeader/ShellAppTitleState");return n}function O(e){if(e){d.rootIntent=e.rootIntent;d.homeUri="#"+e.rootIntent}var t=P(m,d);function a(e,t){for(var a in t){if(a==="blank"||a==="blank-home"){continue}if(e==="openCatalogBtn"&&(a==="lean"||a==="lean-home")){continue}if(e==="ContactSupportBtn"){if(["home","app","minimal","standalone","embedded","embedded-home","lean"].indexOf(a)===-1){continue}}var r=t[a].headEndItems.indexOf(e);if(r===-1){t[a].headEndItems.push(e)}}}function r(e,t){var a;for(a in t){t[a].title=e}}if(e){if(e.moveContactSupportActionToShellHeader){a("ContactSupportBtn",t)}if(e.moveAppFinderActionToShellHeader){a("openCatalogBtn",t)}if(e.title){r(e.title,t)}}return t}function T(t,a,r,n,o){if(n.length===0){return t}var i=s(t);n.forEach(function(t){var n=i[t];if(n){var l=r.execute(e.get(a.split("/"),n),o);e.set(a.split("/"),l,n)}});return i}function w(t,a,r){if(!u){return}var n=u.customShellState.currentState;var o=a.execute(e.get(t.split("/"),n),r);e.set(t.split("/"),o,n)}function _(e,t){var a=e.split("/").shift();o.emit("/core/shellHeader/"+a,t[a])}function R(e){var t;try{t=c[e]}catch(e){t=undefined}return t}function U(e,t){var a;try{a=R(e)[t]}catch(e){a=undefined}return a}function j(e){c=e}return{init:S,destroy:v,switchState:B,updateStates:y,recalculateState:x,extendStates:k,handleCurrentSpaceAndPage:E,handleEndItemsOverflow:N,validateShowLogo:A,_createInitialState:O,_generateBaseHeaderState:P,_getBaseState:R,_getBaseStateMember:U,_resetBaseStates:j}});
//# sourceMappingURL=HeaderManager.js.map