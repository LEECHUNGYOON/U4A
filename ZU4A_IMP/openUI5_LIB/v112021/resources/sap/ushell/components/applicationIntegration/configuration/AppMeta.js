// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/util/extend","sap/ushell/services/AppConfiguration","sap/ushell/components/applicationIntegration/elements/model","sap/ui/Device","sap/ushell/Config","sap/ushell/utils","sap/ushell/resources","sap/ushell/EventHub","sap/ushell/components/applicationIntegration/relatedShellElements/RelatedShellElements","sap/ui/performance/Measurement","sap/ui/util/Mobile","sap/ui/core/Core","sap/ui/core/Theming"],function(e,t,n,a,i,s,o,r,l,c,p,u,h){"use strict";function f(){var u;var f;var m;var d;this.getIsTitleChanged=function(){return u};this.getIsRelatedAppsChanged=function(){return d};this.getHierarchyDefaultValue=function(){var e=[];var t=i.last("/core/shell/model/currentState/stateName");if(t&&(t==="app"||t==="embedded")){e=[{icon:"sap-icon://home",title:o.i18n.getText("actionHomePage"),intent:m?"#"+m:"#"}];var n=i.last("/core/shell/model/currentSpaceAndPage");if(n!==undefined){e.splice(0,0,{icon:"sap-icon://space-navigation",title:n.pageTitle,subtitle:n.pageTitle!==n.spaceTitle?n.spaceTitle:undefined,intent:"#"+n.hash})}}return e};this.init=function(e){m=e};this.getIsHierarchyChanged=function(){return f};this.onHierarchyChange=function(t){f=true;var a=t.getParameters().data,s=[],o=i.last("/core/shell/model/currentState/stateName");if(!a){a=[]}var r=this.getHierarchyDefaultValue();a.forEach(function(t,n){s[n]=e({},t)});s=s.concat(r);if(o==="home"){n.updateStateProperty("application/hierarchy",s,false,["home"])}n.updateStateProperty("application/hierarchy",s,true)}.bind(this);this.onRelatedAppsChange=function(e){d=true;var t=e.getParameters().data,a=i.last("/core/shell/model/currentState/stateName");if(!t){t=[]}if(a==="home"){n.updateStateProperty("application/relatedApps",t,false,["home"])}n.updateStateProperty("application/relatedApps",t,true)};this.resetShellUIServiceHandlers=function(){d=false;f=false;u=false};this.onTitleChange=function(e){u=true;var t=e.getParameters().data;if(!t&&!(e.getParameters().bAcceptEmptyString===true)){t=this.getAppMeta().getTitleDefaultValue()}var a=i.last("/core/shell/model/currentState/stateName");if(a==="home"){n.updateStateProperty("application/title",t,false,["home"])}n.updateStateProperty("application/title",t,true);l.genericSetItem("application/title",t);window.document.title=t;s.setPerformanceMark("FLP -- title change");r.emit("TitleChanged",t)};this._getFavIcon=async function(){let[e]=await s.getThemingParameters(["sapUiShellFavicon"]);let t=false;if(e){var n=/url[\s]*\('?"?([^'")]*)'?"?\)/.exec(e);if(n){e=n[1];t=true}else if(e==="''"||e==="none"){e=null}}var a=i.last("/core/shell/favIcon");if(a&&(e===null||e===undefined)){e=a;t=true}if(!e){var o=sap.ui.require.toUrl("sap/ushell");e=o+"/themes/base/img/launchpad_favicon.ico"}return{favIcon:e,customFavIcon:t}};this.getAppIcon=function(){var e="sap-icon://folder",n=t.getMetadata();if(n&&n.icon){e=n.icon}return e};this.setAppIcons=function(){c.start("FLP:ShellController.setAppIcons","setValues","FLP");function e(){this.setValues()}h.attachApplied(e.bind(this));c.end("FLP:ShellController.setAppIcons")};this.setValues=async function(){var e=sap.ui.require.toUrl("sap/ushell");var t=e+"/themes/base/img/launchicons/57_iPhone_Desktop_Launch.png";var n=e+"/themes/base/img/launchicons/114_iPhone-Retina_Web_Clip.png";var a=e+"/themes/base/img/launchicons/72_iPad_Desktop_Launch.png";var i=e+"/themes/base/img/launchicons/144_iPad_Retina_Web_Clip.png";var s=await this._getFavIcon();var o=s.favIcon;if(s.customFavIcon){p.setIcons({phone:o,"phone@2":o,tablet:o,"tablet@2":o,favicon:o,precomposed:false})}else{p.setIcons({phone:t,"phone@2":n,tablet:a,"tablet@2":i,favicon:o,precomposed:false})}};this._applyContentDensityByPriority=function(e,n){return new Promise(function(i){sap.ushell.Container.getServiceAsync("UserInfo").then(function(s){var o;if(e===undefined){if(a.system.combi){var r=s.getUser(),l="autoDetect";if(r){l=r.getContentDensity()}switch(l){case"cozy":e=false;break;case"compact":e=true;break;default:o=t.getMetadata();if(o.compactContentDensity&&!o.cozyContentDensity){e=true}else{e=false}}}else{o=t.getMetadata();if(o.compactContentDensity&&!o.cozyContentDensity){e=true}else if(!o.compactContentDensity&&o.cozyContentDensity){e=false}else{e=this._isCompactContentDensityByDevice()}}}this._applyContentDensityClass(e,n).then(i)}.bind(this))}.bind(this))};this._applyContentDensityClass=function(e,t){return new Promise(function(n){function a(e){document.body.classList.toggle("sapUiSizeCompact",e);document.body.classList.toggle("sapUiSizeCozy",!e);if(t===true){sap.ui.require(["sap/ushell/components/applicationIntegration/application/PostMessageUtils"],function(t){t.postMessageToMultipleIframes("sap.ushell.appRuntime","uiDensityChange",{isTouch:e?"0":"1"})})}n()}if(e===undefined){sap.ushell.Container.getServiceAsync("UserInfo").then(function(e){var t=e.getUser?e.getUser():undefined;var n;if(t&&t.getContentDensity()==="compact"){n=true}else if(t&&t.getContentDensity()==="cozy"){n=false}else{n=this._isCompactContentDensityByDevice()}a(n)}.bind(this))}else{a(!!e)}}.bind(this))}.bind(this);this._isCompactContentDensityByDevice=function(){return!a.support.touch||a.system.combi};this.getTitleDefaultValue=function(){var e="",n=t.getMetadata();if(n&&n.title){e=n.title}return e};this.create=function(){};this.restore=function(){this._applyContentDensityByPriority();this.setAppIcons()};this.store=function(e){};this.destroy=function(e){}}return new f},true);
//# sourceMappingURL=AppMeta.js.map