/*!
 * Copyright (c) 2009-2023 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/f/GridContainer","sap/f/GridContainerSettings","sap/f/dnd/GridDropInfo","sap/m/IllustratedMessage","sap/m/IllustratedMessageSize","sap/m/IllustratedMessageType","sap/ui/core/Control","sap/ui/core/dnd/DragInfo","sap/ui/core/library","sap/ui/core/ResizeHandler","sap/ushell/ui/launchpad/ExtendedChangeDetection"],function(e,t,i,r,a,o,n,s,l,g,d){"use strict";var p=l.dnd.DropLayout;var u=l.dnd.DropPosition;var h=n.extend("sap.ushell.components.workPageBuilder.controls.WorkPageCell",{metadata:{library:"sap.ushell",properties:{deleteWidgetTooltip:{type:"string",defaultValue:"",bindable:true},addApplicationButtonText:{type:"string",defaultValue:"",bindable:true},editMode:{type:"boolean",defaultValue:false,bindable:true},tileMode:{type:"boolean",defaultValue:false,bindable:true},gridContainerGap:{type:"string",group:"Appearance",defaultValue:"0.5rem",bindable:true},gridContainerRowSize:{type:"string",group:"Appearance",defaultValue:"5.25rem",bindable:true},emptyIllustrationTitle:{type:"string",group:"Misc",defaultValue:"",bindable:true},emptyIllustrationMessage:{type:"string",group:"Misc",defaultValue:"",bindable:true}},defaultAggregation:"widgets",aggregations:{widgets:{type:"sap.ui.core.Control",multiple:true,singularName:"widget",bindable:true,dnd:true,forwarding:{getter:"getGridContainer",aggregation:"items"}},_gridContainer:{type:"sap.f.GridContainer",multiple:false,visibility:"hidden"},headerBar:{type:"sap.m.OverflowToolbar",multiple:false},_emptyIllustration:{type:"sap.m.IllustratedMessage",multiple:false,visibility:"hidden"}},events:{moveVisualization:{},gridColumnsChange:{},gridContainerBorderReached:{}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t);e.class("workPageCell");if(t.getTileMode()){e.class("workPageCellTileMode")}else{e.class("workPageCellCardMode")}e.openEnd();e.openStart("div");e.class("workpageCellWidgetToolbar");e.openEnd();e.renderControl(t.getHeaderBar());e.close("div");var i=t.getAggregation("widgets");if(i.length<=0){e.renderControl(t.getIllustratedMessage())}else{e.renderControl(t.getGridContainer())}e.close("div")}}});h.prototype.init=function(){this._aRegistrationIds=[];this._oWidgetsChangeDetection=new d("widgets",this);this._oWidgetsChangeDetection.attachItemAdded(this.invalidate,this);n.prototype.init.apply(this,arguments)};h.prototype.exit=function(){this._deregisterResizeHandles();this._oWidgetsChangeDetection.destroy();n.prototype.exit.apply(this,arguments)};h.prototype._deregisterResizeHandles=function(){if(this._aRegistrationIds.length>0){this._aRegistrationIds.forEach(function(e){g.deregister(e)});this._aRegistrationIds=[]}};h.prototype.insertAggregation=function(e,t,i,r){if(e==="widgets"&&t.isA("sap.ui.integration.widgets.Card")){this._aRegistrationIds.push(g.register(this,this._resizeCard.bind(this,t)))}n.prototype.insertAggregation.apply(this,arguments)};h.prototype._resizeCard=function(e,t){var i=this.getAggregation("_gridContainer")&&this.getAggregation("_gridContainer").getDomRef();if(!i){return}var r=parseFloat(window.getComputedStyle(i).width);if(r){e.setWidth(r+"px")}};h.prototype.getGridContainer=function(){var e=this.getAggregation("_gridContainer");if(!e){e=this._createGridContainer().attachColumnsChange(function(e){this.fireEvent("gridColumnsChange",e.getParameters())}.bind(this));this.setAggregation("_gridContainer",e.addStyleClass("workPageGridContainer"))}if(!this.getEditMode()||!this.getTileMode()||e.getItems().length===0){e.removeAllDragDropConfig()}else if(e.getDragDropConfig().length===0){e.addDragDropConfig(new s({groupName:"CellGridContainer",sourceAggregation:"items"})).addDragDropConfig(new i({groupName:"CellGridContainer",targetAggregation:"items",dropIndicatorSize:function(e){var t=2;if(e.getLayoutData()&&e.getLayoutData().getColumns()){t=e.getLayoutData().getColumns()}return{rows:1,columns:t}},dropPosition:u.Between,dropLayout:p.Horizontal,drop:this.onDrop.bind(this)}))}return e.setInlineBlockLayout(true).setSnapToRow(false).setLayout(new t({columnSize:this.getGridContainerRowSize(),gap:this.getGridContainerGap()}))};h.prototype._createGridContainer=function(){return new e(`${this.getId()}--workPageCellGridContainer`,{containerQuery:false,minHeight:"0",borderReached:this.onBorderReached.bind(this)})};h.prototype.onBorderReached=function(e){this.fireEvent("gridContainerBorderReached",e.getParameters())};h.prototype.onDrop=function(e){this.fireEvent("moveVisualization",e.getParameters())};h.prototype.getIllustratedMessage=function(){if(!this.getAggregation("_emptyIllustration")){this.setAggregation("_emptyIllustration",this._createIllustratedMessage())}return this.getAggregation("_emptyIllustration")};h.prototype._createIllustratedMessage=function(){return new r(`${this.getId()}-emptyCellMessage`,{illustrationType:o.NoColumnsSet,illustrationSize:a.Spot,title:this.getEmptyIllustrationTitle(),description:this.getEmptyIllustrationMessage(),visible:"{/editMode}"})};h.prototype.onfocusin=function(){if(!this.hasStyleClass("workPageCellFocused")){this.addStyleClass("workPageCellFocused")}};h.prototype.onfocusout=function(){if(this.hasStyleClass("workPageCellFocused")){this.removeStyleClass("workPageCellFocused")}};return h});
//# sourceMappingURL=WorkPageCell.js.map