// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/Core","sap/base/Log","sap/base/util/UriParameters","sap/ui/thirdparty/jquery","sap/ui/thirdparty/URI","sap/ushell/utils","sap/ushell/resources","sap/ushell/Config"],function(e,t,a,jQuery,r,i,s,n){"use strict";var l={};var o=l;l.renderIframeWithPOST=function(t,a,r,s){a.setProperty("iframeWithPost",true,true);a.oDeferredRenderer=new jQuery.Deferred;r=i.filterOutParamsFromLegacyAppURL(r);var n=i.getParamKeys(r);this.generateRootElementForIFrame(t,a,true);if(n.aAppStateNamesArray.length>0){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(i){i.getAppStateData(n.aAppStateKeysArray).then(function(i){var l;var p=jQuery("#"+a.getId());if(p.length>0){l=e.createRenderManager();o.buildHTMLElements(l,a,i,n.aAppStateNamesArray,r,s);l.flush(p[0]);l.destroy()}else{o.buildHTMLElements(t,a,i,n.aAppStateNamesArray,r,s)}setTimeout(a.oDeferredRenderer.resolve,0)},function(e){o.buildHTMLElements(t,a,undefined,n.aAppStateNamesArray,r,s);setTimeout(a.oDeferredRenderer.resolve,0)})})}else{o.buildHTMLElements(t,a,undefined,n.aAppStateNamesArray,r,s);setTimeout(a.oDeferredRenderer.resolve,0)}this.generateRootElementForIFrame(t,a,false)};l.generateRootElementForIFrame=function(e,t,a){if(a){e.openStart("div",t).attr("sap-iframe-app","true").class("sapUShellApplicationContainer").style("height",t.getHeight()).style("width",t.getWidth()).openEnd()}else{e.close("div")}};l.buildHTMLElements=function(e,t,l,o,u,d){var m=t.getId()+"-form",g="",h=false;if(l===undefined){l=[]}l.push([sap.ushell.Container.getFLPUrl(true)]);o.push("sap-flp-url");l.push([t.getSystemAlias()]);o.push("system-alias");var c="";var v={};o.forEach(function(e,t){if(l[t][0]){v[e]=l[t][0]}});var y=u;c=JSON.stringify(v);var S={};if(t.getIframePostAllParams()===true){S=a.fromURL(u);g=p(t,S,false);if(g!==""){u=f(u,S)}}t.fireEvent("applicationConfiguration");e.openStart("form").attr("id",m).attr("method","post").attr("name",m).attr("target",t.getId()+"-iframe").attr("action",u).style("display","none").openEnd();e.voidStart("input").attr("name","sap-flp-params").attr("value",c).voidEnd();if(t.getIframePostAllParams()===true){p(t,S,true,e)}e.close("form");var A=t.sId;if(t.hasStyleClass("sapUShellApplicationContainerIframeHidden")){h=true;t.toggleStyleClass("sapUShellApplicationContainerIframeHidden",false)}t.sId+="-iframe";e.openStart("iframe",t).attr("name",t.getId()).accessibilityState(t).attr("sap-orig-src",y).attr("title",s.i18n.getText("AppilcationContainer.IframeTitle")).attr("sap-iframe-idx",d).class("sapUShellApplicationContainer").style("height",t.getHeight()).style("width",t.getWidth());if(n.last("/core/shell/enableFeaturePolicyInIframes")===true){e.attr("allow",i.getIframeFeaturePolicies().replaceAll(";"," "+new r(u).origin()+";"))}e.openEnd().close("iframe");t.sId=A;if(h){t.toggleStyleClass("sapUShellApplicationContainerIframeHidden",true)}};function p(e,t,a,r){var i="";var s="";if(t.has("sap-iframe-hint")){i=t.get("sap-iframe-hint")}var n=t.mParams;if(e.getApplicationType()==="TR"||i==="GUI"){var l,o;for(l in n){if(l==="sap-iframe-hint"||l==="sap-keep-alive"){continue}o=n[l][0];if(a===true){r.voidStart("input").attr("name",l).attr("value",o).voidEnd()}else{s+="*"}}}return s}function f(e,t){var a=t.get("sap-iframe-hint"),i=t.get("sap-keep-alive"),s=new r(e).query("");if(typeof a==="string"){s.addSearch("sap-iframe-hint",a)}if(typeof i==="string"){s.addSearch("sap-keep-alive",i)}return s.toString()}return l},false);
//# sourceMappingURL=IframePOSTUtils.js.map