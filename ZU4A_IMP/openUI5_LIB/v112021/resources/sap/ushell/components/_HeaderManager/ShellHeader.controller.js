// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/library","sap/ui/core/Core","sap/ui/core/mvc/Controller","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ushell/components/applicationIntegration/AppLifeCycle","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/library","sap/ushell/ui/shell/OverflowListItem"],function(e,t,n,i,a,r,o,s,l,d){"use strict";var u=e.ListType;var f=l.FloatingNumberType;return n.extend("sap.ushell.components._HeaderManager.ShellHeader",{onInit:function(){this.aDoables=[];this.aDoables.push(s.on("navigateBack").do(this.pressNavBackButton.bind(this)));this.aDoables.push(s.on("showEndItemOverflow").do(this.pressEndItemsOverflow.bind(this)));this.aDoables.push(s.on("navigateFromShellApplicationNavigationMenu").do(this.navigateFromShellApplicationNavigationMenu.bind(this)))},shellUpdateAggItem:function(e,n){return t.byId(n.getObject())},pressNavBackButton:function(){s.emit("showUserActionsMenu",false);r.service().navigateBack()},pressEndItemsOverflow:function(e){var n=t.byId("headEndItemsOverflow"),i=t.byId(e),r=Promise.resolve(),l;if(!i){return}if(!n){r=new Promise(function(e,t){sap.ui.require(["sap/ui/core/Fragment"],function(n){n.load({name:"sap.ushell.renderer.HeadEndItemsOverflowPopover",type:"XML",controller:this}).then(e).catch(t)}.bind(this),t)}.bind(this)).then(function(e){n=e;var i=t.byId("headEndItemsOverflowList");i.enhanceAccessibilityState=function(e,t){if(e.getFloatingNumberType()!==f.None){t.describedby=e._oAriaDescribedbyText.getId()}return t};l=new a({headEndItems:o.last("/core/shellHeader/headEndItems")});n.setModel(l)})}r.then(function(){if(n.isOpen()){n.close()}else{if(t.byId("shellNotificationsPopover")){s.emit("showNotifications",false)}n.openBy(i)}})},headEndItemsOverflowItemFactory:function(e,n){var i=t.byId(n.getObject());var a=i.getBindingPath("floatingNumber");var r=i.getText();var o=i.getTooltip();var s=new d({id:e+"-"+i.getId(),icon:i.getIcon(),iconInset:true,tooltip:o!==r?o:null,title:r,type:u.Active,floatingNumber:a?{path:a}:undefined,floatingNumberMaxValue:i.getFloatingNumberMaxValue(),floatingNumberType:i.getFloatingNumberType(),press:function(){if(i){i.firePress();var e=i.getTarget();if(e){sap.ushell.Container.getServiceAsync("Navigation").then(function(t){t.navigate({target:{shellHash:e}})})}}var n=t.byId("headEndItemsOverflow");if(n.isOpen()){n.close()}}});if(i._oAriaLabel){s.addAriaLabelledBy(i._oAriaLabel)}if(a){s.setModel(i.getModel())}return s},destroyHeadEndItemsOverflow:function(e){e.getSource().destroy()},isHeadEndItemInOverflow:function(e){return e!=="ENDITEMSOVERFLOWBTN"&&!this.isHeadEndItemNotInOverflow(e)},isHeadEndItemNotInOverflow:function(e){var t=this.isHeadEndItemOverflow();var n=i.media.getCurrentRange(i.media.RANGESETS.SAP_STANDARD).name;if(e==="ENDITEMSOVERFLOWBTN"){return t}if(!t){return true}if(["USERACTIONSMENUHEADERBUTTON","BACKBTN"].indexOf(e)>-1){return true}if(n==="Phone"){return false}if(["SF","FLOATINGCONTAINERBUTTON"].indexOf(e)>-1){return true}if(n==="Desktop"&&e==="COPILOTBTN"){return true}return false},isHeadEndItemOverflow:function(){var e=0,n,a=o.last("/core/shellHeader/headEndItems");if(a.indexOf("endItemsOverflowBtn")===-1){return false}var r=i.media.getCurrentRange(i.media.RANGESETS.SAP_STANDARD).name;var s=3;if(r==="Phone"){s=1}for(var l=0;l<a.length;l++){n=t.byId(a[l]);if(n&&n.getVisible()){e++}}if(t.byId("endItemsOverflowBtn").getVisible()){return e>s+1}return e>s},navigateFromShellApplicationNavigationMenu:function(e){if(window.hasher.getHash()!==e.substr(1)){s.emit("centerViewPort",Date.now());window.hasher.setHash(e)}var n=t.byId("shellAppTitle");if(n){n.close()}},onExit:function(){this.aDoables.forEach(function(e){e.off()})}})});
//# sourceMappingURL=ShellHeader.controller.js.map