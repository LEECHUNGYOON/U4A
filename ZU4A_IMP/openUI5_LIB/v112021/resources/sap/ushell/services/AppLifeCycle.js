// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/ui/base/EventProvider","sap/ui/core/Core","sap/ui/thirdparty/hasher","sap/ushell/AppInfoParameters","sap/ushell/EventHub","sap/ushell/TechnicalParameters","sap/ui/core/Component","sap/ushell/services/AppConfiguration","sap/ushell/utils/UrlParsing","sap/ui/thirdparty/URI","sap/ushell/Config"],function(e,t,n,a,i,r,o,p,s,l,u,f){"use strict";var c="appLoaded";function h(l,h,g,d){var m;var A;var v;this.getCurrentApplication=function(){return m};this.attachAppLoaded=function(e,t,n){v.attachEvent(c,e,t,n)};this.detachAppLoaded=function(e,t){v.detachEvent(c,e,t)};this.prepareCurrentAppObject=function(e,t,n,a,i){w(e,t,n,a,i)};this.reloadCurrentApp=function(){r.emit("reloadCurrentApp",{sAppContainerId:A.getId(),sCurrentHash:a.getHash(),date:Date.now()})};this.setAppInfo=function(e,t){i.setCustomAttributes(e);if(f.last("/core/shell/enableMessageBroker")){sap.ushell.Container.getServiceAsync("MessageBroker").then(function(e){m.getAllAppInfo(true).then(function(n){e.publish("flp-app-info","FLP",Date.now().toString(),t===true?"new-app-info":"app-info-update","*",n)})})}};function C(e,t,n,a,i){if(n==="flp-app-info"&&a==="get-current-app-info"&&m){m.getAllAppInfo(true).then(function(n){e.publish("flp-app-info","FLP",Date.now().toString(),a,[t],n)})}}if(window.QUnit===undefined&&sap.ushell.Container.inAppRuntime()===false){if(f.last("/core/shell/enableMessageBroker")){sap.ushell.Container.getServiceAsync("MessageBroker").then(function(e){e.subscribe("FLP",[{channelId:"flp-app-info",version:"1.0"}],C.bind(undefined,e),function(){})})}}v=new t;if(sap.ushell.Container&&sap.ushell.Container.inAppRuntime()===false){if(sap.ushell.Container.getRenderer()){P()}else{var I=function(){P();sap.ushell.Container.detachRendererCreatedEvent(I)};sap.ushell.Container.attachRendererCreatedEvent(I)}}function P(){var t=n.byId("viewPortContainer");if(!t||typeof t.attachAfterNavigate!=="function"){e.error("Error during instantiation of AppLifeCycle service","Could not attach to afterNavigate event","sap.ushell.services.AppLifeCycle");return}t.attachAfterNavigate(function(e){var t;var n;var a;var i;var r;var o=false;if(e.mParameters.toId.indexOf("applicationShellPage")===0){n=e.mParameters.to.getApp()}else if(e.mParameters.toId.indexOf("application")===0){n=e.mParameters.to}if(n&&typeof n.getComponentHandle==="function"&&n.getComponentHandle()){i=n.getComponentHandle().getInstance()}else if(n){t=n.getAggregation("child");if(t){i=t.getComponentInstance()}}else{i=p.get(e.mParameters.to.getComponent())}if(i){r=i.getId();o=r.indexOf("Shell-home-component")!==-1||r.indexOf("pages-component")!==-1||r.indexOf("workPageRuntime-component")!==-1||r.indexOf("Shell-appfinder-component")!==-1||r.indexOf("homeApp-component")!==-1||r.indexOf("runtimeSwitcher-component")!==-1}a=n&&typeof n.getApplicationType==="function"&&n.getApplicationType();if((!a||a==="URL")&&i){a="UI5"}w(a,i,o,n)})}function y(e){var t=a.getHash();var n;if(!t){return Promise.reject("Could not identify current application hash")}var i=sap.ushell.Container.getServiceAsync("URLParsing");return i.then(function(a){n=a.parseShellHash(t);if(e===true&&A&&typeof A.getCurrentAppUrl==="function"){var i=A.getCurrentAppUrl();if(i){var r=new u(i).search(true);if(r.hasOwnProperty("sap-remote-intent")){n.semanticObject=r["sap-remote-intent"].split("-")[0];n.action=r["sap-remote-intent"].split("-")[1];delete n.params["sap-shell-so"];delete n.params["sap-shell-action"]}}}return n})}function b(){if(i.setCustomAttributes){i.setCustomAttributes()}}function w(e,t,n,a,p){if(!p){p=a&&typeof a.getFrameworkId==="function"&&a.getFrameworkId()||""}b();A=a;m={applicationType:e,applicationFramework:p,componentInstance:t,homePage:n,getTechnicalParameter:function(n){return o.getParameterValue(n,t,a,e)},getIntent:y,getInfo:function(e){return i.getInfo(e,m)},getAllAppInfo:function(n){return i.getAllAppInfo(n,m,t,a,e).then(function(e){if(n===true){e.applicationType=m.applicationType;e.homePage=m.homePage}else{e.applicationType={value:m.applicationType};e.homePage={value:m.homePage}}return e})},getSystemContext:function(){var e=s.getCurrentApplication()||{};var t=e.contentProviderId||"";return sap.ushell.Container.getServiceAsync("ClientSideTargetResolution").then(function(e){return e.getSystemContext(t)})},disableKeepAliveAppRouterRetrigger:function(e){y().then(function(t){r.emit("disableKeepAliveRestoreRouterRetrigger",{disable:e,intent:t,componentId:m.componentInstance.oContainer.sId,date:Date.now()})})}};setTimeout(function(){v.fireEvent(c,m);if(window.QUnit===undefined&&sap.ushell.Container.inAppRuntime()===false){if(f.last("/core/shell/enableMessageBroker")){sap.ushell.Container.getServiceAsync("MessageBroker").then(function(e){m.getAllAppInfo(true).then(function(t){e.publish("flp-app-info","FLP",Date.now().toString(),"new-app-info","*",t)})})}}},0)}}h.hasNoAdapter=true;return h},true);
//# sourceMappingURL=AppLifeCycle.js.map