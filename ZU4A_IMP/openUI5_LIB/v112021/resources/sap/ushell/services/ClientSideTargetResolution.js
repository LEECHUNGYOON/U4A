// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/isPlainObject","sap/base/util/ObjectPath","sap/base/util/extend","sap/ui/thirdparty/jquery","sap/ushell/ApplicationType","sap/ushell/navigationMode","sap/ushell/services/_ClientSideTargetResolution/Formatter","sap/ushell/services/_ClientSideTargetResolution/InboundIndex","sap/ushell/services/_ClientSideTargetResolution/InboundProvider","sap/ushell/services/_ClientSideTargetResolution/ParameterMapping","sap/ushell/services/_ClientSideTargetResolution/PrelaunchOperations","sap/ushell/services/_ClientSideTargetResolution/Search","sap/ushell/services/_ClientSideTargetResolution/StagedLogger","sap/ushell/services/_ClientSideTargetResolution/SystemContext","sap/ushell/services/_ClientSideTargetResolution/Utils","sap/ushell/services/_ClientSideTargetResolution/VirtualInbounds","sap/ushell/services/_ClientSideTargetResolution/XAppStateProcessing","sap/ushell/TechnicalParameters","sap/ushell/utils","sap/ushell/utils/UrlParsing"],function(e,t,n,r,jQuery,i,s,a,o,l,u,c,d,f,p,v,g,h,m,b,y){"use strict";function S(e,t,n,r){this._init.apply(this,arguments)}S.prototype._init=function(t,n,r,i){this._iLogId=0;if(!this._implementsServiceInterface(t)){e.error("Cannot get Inbounds","ClientSideTargetResolutionAdapter should implement getInbounds method","sap.ushell.services.ClientSideTargetResolution");return}this._oInboundProvider=new l(t.getInbounds.bind(t));this._oHaveEasyAccessSystemsDeferreds={userMenu:null,sapMenu:null};this._oServiceConfiguration=i;this._oAdapter=t};S.prototype._implementsServiceInterface=function(e){if(typeof e.getInbounds==="function"){return true}return false};S.prototype._extractInboundFilter=function(e){if(!this._oAdapter.hasSegmentedAccess){return undefined}if(typeof e!=="string"){return undefined}var t=e.indexOf("#")===0?e:"#"+e;var n=y.parseShellHash(t);if(!n||!n.semanticObject||!n.action){return undefined}return[{semanticObject:n.semanticObject,action:n.action}]};S.prototype.resolveHashFragment=function(e){var t=this;var n=new jQuery.Deferred;var r=this._oAdapter.resolveHashFragmentFallback&&this._oAdapter.resolveHashFragmentFallback.bind(this._oAdapter);var i=this._extractInboundFilter(e);this._oInboundProvider.getInbounds(i).then(function(i){t._resolveHashFragment(e,r,i).done(function(e){return n.resolve(e)}).fail(n.reject.bind(n))},function(){n.reject.apply(n,arguments)});return n.promise()};S.prototype.resolveTileIntent=function(e){var t=this;var n=new jQuery.Deferred;var r=this._extractInboundFilter(e);this._oInboundProvider.getInbounds(r).then(function(r){t._resolveTileIntent(e,undefined,r).done(n.resolve.bind(n)).fail(n.reject.bind(n))},function(){n.reject.apply(n,arguments)});return n.promise()};S.prototype.resolveTileIntentInContext=function(e,t){var n=new jQuery.Deferred;var r=o.createIndex(e.concat(g.getInbounds()));this._resolveTileIntent(t,undefined,r).done(n.resolve.bind(n)).fail(n.reject.bind(n));return n.promise()};S.prototype._resolveHashFragment=function(t,n,r){var i=this;var s=new jQuery.Deferred;var a=t.indexOf("#")===0?t:"#"+t;var o=y.parseShellHash(a);if(o===undefined){e.error("Could not parse shell hash '"+t+"'","please specify a valid shell hash","sap.ushell.services.ClientSideTargetResolution");return s.reject().promise()}o.formFactor=b.getFormFactor();this._getMatchingInbounds(o,r,{bExcludeTileInbounds:true}).fail(function(n){e.error("Could not resolve "+t,"_getMatchingInbounds promise rejected with: "+n,"sap.ushell.services.ClientSideTargetResolution");s.reject(n)}).done(function(r){var l;if(r.length===0){e.warning("Could not resolve "+t,"rejecting promise","sap.ushell.services.ClientSideTargetResolution");s.reject("Could not resolve navigation target");return}r=i._applySapNavigationScopeFilter(r,o);l=r[0];if(e.getLevel()>=e.Level.DEBUG){var u=function(e,t){return this[e]===undefined?"<undefined>":t};var c=function(e,t){return e==="_original"?undefined:u.call(this,e,t)};var d=JSON.stringify(l,c,"   ");e.debug("The following target will now be resolved",d,"sap.ushell.services.ClientSideTargetResolution")}i._resolveSingleMatchingTarget(l,n,a).done(s.resolve.bind(s)).fail(s.reject.bind(s))});return s.promise()};S.prototype._applySapNavigationScopeFilter=function(e,t){var r=t&&t.params&&t.params["sap-navigation-scope-filter"];if(!r){return e}var i=e.filter(function(e){var t=n.get("inbound.signature.parameters",e);var i=t&&t["sap-navigation-scope"];if(i){return r[0]===i.defaultValue.value}return undefined});return i.length>0?i:e};S.prototype._resolveSingleMatchingTarget=function(t,r,a){var o=this;var l=new jQuery.Deferred;var d=y.parseShellHash(a);var f=[d.semanticObject,d.action].join("-");var p=(t.inbound.resolutionResult||{}).applicationType;var v;if(this._oAdapter.resolveSystemAlias){v=this._oAdapter.resolveSystemAlias.bind(this._oAdapter)}var g=!!t.inbound.templateContext;var m=i.getEasyAccessMenuResolver(f,p);if(m&&!g){m(d,t,v,i.WDA.enableWdaCompatibilityMode).then(function(e){var n=s.getNavigationMode(e,(t.intentParamsPlusAllDefaults["sap-ushell-navmode"]||[])[0],(t.intentParamsPlusAllDefaults["sap-ushell-next-navmode"]||[])[0]);b.shallowMergeObject(e,n);e.inboundPermanentKey=t.inbound.permanentKey||t.inbound.id;l.resolve(e)},function(e){l.reject(e)});return l.promise()}var S=this._getReservedParameters(t);u.mapParameterNamesAndRemoveObjects(t);sap.ushell.Container.getServiceAsync("AppState").then(function(u){h.mixAppStateIntoResolutionResultAndRename(t,u).done(function(t){var u=function(){return o._constructFallbackResolutionResult(t,r,a)};if(i[p]){u=i[p].generateResolutionResult}delete t.intentParamsPlusAllDefaults["sap-tag"];delete t.mappedIntentParamsPlusSimpleDefaults["sap-tag"];t.mappedDefaultedParamNames=t.mappedDefaultedParamNames.filter(function(e){return e!=="sap-tag"});var d=n.get("inbound.resolutionResult.url",t);c.executePrelaunchOperations(t,S["sap-prelaunch-operations"]).then(function(){return u(t,d,v)}).then(function(n){var r=s.getNavigationMode(n,(t.intentParamsPlusAllDefaults["sap-ushell-navmode"]||[])[0],(t.intentParamsPlusAllDefaults["sap-ushell-next-navmode"]||[])[0]);b.shallowMergeObject(n,r);n.reservedParameters=S;n.inboundPermanentKey=t.inbound.permanentKey||t.inbound.id;e.debug("Intent was resolved to the following target",JSON.stringify(n,null,3),"sap.ushell.services.ClientSideTargetResolution");b.shallowMergeObject(t.resolutionResult,n);l.resolve(t.resolutionResult)},function(e){if(typeof e==="string"&&e.indexOf("fallback:")>=0){o._constructFallbackResolutionResult.call(this,t,r,a).then(function(e){b.shallowMergeObject(t.resolutionResult,e);l.resolve(t.resolutionResult)},l.reject.bind(l))}else{l.reject(e)}})})});return l.promise()};S.prototype._getReservedParameters=function(e){var t=m.getParameters({injectFrom:"startupParameter"}).map(function(e){return e.name});var n=v.extractParameters(t,e.intentParamsPlusAllDefaults);m.getParameters({injectFrom:"inboundParameter"}).forEach(function(t){var r=t.name;var i=e.inbound&&e.inbound.signature&&e.inbound.signature.parameters;if(i&&Object.keys(i).length>0){var s=i[r];var a=s&&s.defaultValue&&s.defaultValue.hasOwnProperty("value");var o=s&&s.filter&&s.filter.hasOwnProperty("value");if(s&&(o||a)){if(a){n[r]=s.defaultValue.value}else{n[r]=s.filter.value}}else{delete n[r]}delete e.intentParamsPlusAllDefaults[r];var l=e.defaultedParamNames.indexOf(r);if(l>=0){e.defaultedParamNames.splice(l,1)}}});return n};S.prototype._resolveTileIntent=function(t,n,r){var i=this;var s=new jQuery.Deferred;var a=t.indexOf("#")===0?t:"#"+t;var o=y.parseShellHash(a);if(o===undefined){e.error("Could not parse shell hash '"+t+"'","please specify a valid shell hash","sap.ushell.services.ClientSideTargetResolution");return s.reject("Cannot parse shell hash").promise()}o.formFactor=b.getFormFactor();this._getMatchingInbounds(o,r,{bExcludeTileInbounds:false}).fail(function(n){e.error("Could not resolve "+t,"_getMatchingInbounds promise rejected with: "+n,"sap.ushell.services.ClientSideTargetResolution");s.reject(n)}).done(function(r){var o;if(r.length===0){e.warning("Could not resolve "+t,"no matching targets were found","sap.ushell.services.ClientSideTargetResolution");s.reject("No matching targets found");return}o=r[0];i._resolveSingleMatchingTileIntent(o,n,a).done(s.resolve.bind(s)).fail(s.reject.bind(s))});return s.promise()};S.prototype._resolveSingleMatchingTileIntent=function(t,a,o){var l=new jQuery.Deferred;var c=(t.inbound.resolutionResult||{}).applicationType;var d=this;var f;if(this._oAdapter.resolveSystemAlias){f=this._oAdapter.resolveSystemAlias.bind(this._oAdapter)}u.mapParameterNamesAndRemoveObjects(t);sap.ushell.Container.getServiceAsync("AppState").then(function(u){h.mixAppStateIntoResolutionResultAndRename(t,u).done(function(t){var u=function(){return d._constructFallbackResolutionResult(t,a,o)};if(i[c]){u=i[c].generateResolutionResult}delete t.intentParamsPlusAllDefaults["sap-tag"];delete t.mappedIntentParamsPlusSimpleDefaults["sap-tag"];t.mappedDefaultedParamNames=t.mappedDefaultedParamNames.filter(function(e){return e!=="sap-tag"});var p=n.get("inbound.resolutionResult.url",t);u(t,p,f).then(function(n){b.shallowMergeObject(t.resolutionResult,n);var i=r({},t.inbound.tileResolutionResult);i.startupParameters=t.effectiveParameters;var a=s.getNavigationMode(n,(t.intentParamsPlusAllDefaults["sap-ushell-navmode"]||[])[0],(t.intentParamsPlusAllDefaults["sap-ushell-next-navmode"]||[])[0]);b.shallowMergeObject(i,a);l.resolve(i);e.debug("Tile Intent was resolved to the following target",JSON.stringify(i,null,3),"sap.ushell.services.ClientSideTargetResolution")},function(e){l.reject(e)})})});return l.promise()};S.prototype._constructFallbackResolutionResult=function(t,n,i){var s={};Object.keys(t.intentParamsPlusAllDefaults).forEach(function(e){if(Array.isArray(t.intentParamsPlusAllDefaults[e])){s[e]=t.intentParamsPlusAllDefaults[e]}});var a=t.mappedDefaultedParamNames||t.defaultedParamNames;if(a.length>0){s["sap-ushell-defaultedParameterNames"]=[JSON.stringify(a)]}if(typeof n!=="function"){e.error("Cannot resolve hash fragment",i+" has matched an inbound that cannot be resolved client side and no resolveHashFragmentFallback method was implemented in ClientSideTargetResolutionAdapter","sap.ushell.services.ClientSideTargetResolution");return Promise.reject("Cannot resolve hash fragment: no fallback provided.")}e.warning("Cannot resolve hash fragment client side",i+" has matched an inbound that cannot be resolved client side. Using fallback logic","sap.ushell.services.ClientSideTargetResolution");return new Promise(function(e,a){n(i,r({},t.inbound),s).done(function(t){var n={};["applicationType","additionalInformation","url","applicationDependencies","text"].forEach(function(e){if(t.hasOwnProperty(e)){n[e]=t[e]}});e(n)}).fail(a.bind(null))})};S.prototype.getDistinctSemanticObjects=function(){var e=new jQuery.Deferred;this._oInboundProvider.getInbounds().then(function(t){var n={};t.getAllInbounds().forEach(function(e){if(typeof e.semanticObject==="string"&&e.semanticObject!=="*"&&!e.hideIntentLink&&e.semanticObject.length>0){n[e.semanticObject]=true}});e.resolve(Object.keys(n).sort())},function(){e.reject.apply(e,arguments)});return e.promise()};S.prototype.getLinks=function(n){var i=this;var s=new jQuery.Deferred;var a;if(arguments.length===1&&t(arguments[0])){var o=arguments[0];a=r({},o);["action","semanticObject"].forEach(function(e){if(o.hasOwnProperty(e)){a[e]=o[e]}});if(a.appStateKey){a.params=a.params||{};a.params["sap-xapp-state"]=[a.appStateKey];delete a.appStateKey}}else if(arguments.length<=3){e.warning("Passing positional arguments to getLinks is deprecated","Please use nominal arguments instead","sap.ushell.services.ClientSideTargetResolution");var l=arguments[0];var u=arguments[1];var c=arguments[2];a={semanticObject:l,params:u,ignoreFormFactor:c}}else{return s.reject("invalid arguments for getLinks").promise()}this._oInboundProvider.getInbounds().then(function(e){i._getLinks(a,e).done(s.resolve.bind(s)).fail(s.reject.bind(s))},function(){s.reject.apply(s,arguments)});return s.promise()};S.prototype._validateGetSemanticObjectLinksArgs=function(t){var n=t.semanticObject;var r=t.action;var i=!t.hasOwnProperty("action");if(typeof n!=="undefined"||i){if(typeof n!=="string"){e.error("invalid input for _getLinks","the semantic object must be a string, got "+Object.prototype.toString.call(n)+" instead","sap.ushell.services.ClientSideTargetResolution");return"invalid semantic object"}if(i&&n.match(/^\s+$/)){e.error("invalid input for _getLinks","the semantic object must be a non-empty string, got '"+n+"' instead","sap.ushell.services.ClientSideTargetResolution");return"invalid semantic object"}if(!i&&n.length===0){e.error("invalid input for _getLinks","the semantic object must not be an empty string, got '"+n+"' instead","sap.ushell.services.ClientSideTargetResolution");return"invalid semantic object"}}if(typeof r!=="undefined"){if(typeof r!=="string"){e.error("invalid input for _getLinks","the action must be a string, got "+Object.prototype.toString.call(r)+" instead","sap.ushell.services.ClientSideTargetResolution");return"invalid action"}if(r.length===0){e.error("invalid input for _getLinks","the action must not be an empty string, got '"+r+"' instead","sap.ushell.services.ClientSideTargetResolution");return"invalid action"}}return undefined};S.prototype._getLinks=function(t,r){var i=t.semanticObject;var s=t.action;var a=t.params;var o=!!t.withAtLeastOneUsedParam;var l=!!t.treatTechHintAsFilter;var u=t.ignoreFormFactor;var c=t.hasOwnProperty("sortResultsBy")?t.sortResultsBy:"intent";if(t.hasOwnProperty("sortResultOnTexts")){e.warning("the parameter 'sortResultOnTexts' was experimental and is no longer supported","getLinks results will be sorted by '"+c+"'","sap.ushell.services.ClientSideTargetResolution")}var d={bExcludeTileInbounds:true};var f=this._validateGetSemanticObjectLinksArgs(t);if(t.tags){d.tags=t.tags}if(f){return(new jQuery.Deferred).reject(f).promise()}if(i==="*"){return jQuery.when([])}function p(e){var t=y.paramsToString(e);return t?"?"+t:""}var g=new jQuery.Deferred;var h=b.getFormFactor();var m=y.parseParameters(p(a));var S={semanticObject:i===""?undefined:i,action:s,formFactor:u?undefined:h,params:m};if(l){S.treatTechHintAsFilter=true}this._getMatchingInbounds(S,r,d).done(function(r){var s={};var a=r.map(function(e){var r=i||e.inbound.semanticObject;var a="#"+r+"-"+e.inbound.action;var l;if(r==="*"){return undefined}if(e.inbound.action==="*"){return undefined}if(e.inbound&&e.inbound.hasOwnProperty("hideIntentLink")&&e.inbound.hideIntentLink===true){return undefined}if(!s.hasOwnProperty(a)){s[a]={matchingInbound:e.inbound,count:1};if(e.inbound.signature.additionalParameters==="ignored"){l=v.filterObjectKeys(m,function(t){return t.indexOf("sap-")===0||e.inbound.signature.parameters.hasOwnProperty(t)},false)}else{l=m}if(o){var u=Object.keys(l).some(function(e){return e.indexOf("sap-")!==0});if(!u){s[a].hideReason="getLinks called with 'withAtLeastOneUsedParam = true', but the inbound had no business parameters defined.";return undefined}}var c=v.inboundSignatureMeetsParameterOptions(e.inbound.signature.parameters,t.paramsOptions||[]);if(!c){s[a].hideReason="inbound signature does not meet the requested parameter filter options";return undefined}var d={intent:a+p(l),text:e.inbound.title};if(e.inbound.icon){d.icon=e.inbound.icon}if(e.inbound.subTitle){d.subTitle=e.inbound.subTitle}if(e.inbound.shortTitle){d.shortTitle=e.inbound.shortTitle}var f=n.get("inbound.signature.parameters.sap-tag.defaultValue.value",e);if(f){d.tags=[f]}return d}s[a].count++;return undefined}).filter(function(e){return typeof e==="object"});if(c!=="priority"){a.sort(function(e,t){return e[c]<t[c]?-1:1})}if(a.length===0){e.debug("_getLinks returned no results")}else if(e.getLevel()>=e.Level.DEBUG){if(e.getLevel()>=e.Level.TRACE){var l=[];var u=[];a.forEach(function(e){var t=e.intent.split("?")[0];if(s[t].hideReason){u.push(["-",t+"("+s[t].hideReason+")\n"," text:",e.text+"\n"," full intent:",e.intent].join(" "))}else{l.push(["-",t,s[t].count>1?"("+(s[t].count-1)+" others matched)\n":"\n","text:",e.text+"\n","full intent:",e.intent].join(" "))}});e.debug("_getLinks filtered to the following unique intents:","\n"+l.join("\n"),"sap.ushell.services.ClientSideTargetResolution");e.debug("_getLinks would have also returned the following unique intents, but something prevented this:",u.join("\n"),"sap.ushell.services.ClientSideTargetResolution")}else{e.debug("_getLinks filtered to unique intents.","Reporting histogram: \n - "+Object.keys(s).join("\n - "),"sap.ushell.services.ClientSideTargetResolution")}}g.resolve(a)}).fail(g.reject.bind(g));return g.promise()};S.prototype._getMatchingInbounds=function(t,n,r){var i=this;var s;var o;var l;var u;var c=new jQuery.Deferred;if(r){s=r.tags;l=r.bExcludeTileInbounds}if(e.getLevel()>=e.Level.DEBUG){o=++i._iLogId}f.begin(function(){function e(e){var t=e.action||(typeof e.action==="undefined"?"<any>":"<invalid-value>");var n=e.semanticObject||(typeof e.semanticObject==="undefined"?"<any>":"<invalid-value>");return y.constructShellHash({semanticObject:n,action:t,params:e.params})}var n=e(t);return{logId:o,title:"Matching Intent '"+n+"' to inbounds (form factor: "+(t.formFactor||"<any>")+")",moduleName:"sap.ushell.services.ClientSideTargetResolution",stages:["STAGE1: Find matching inbounds","STAGE2: Resolve references","STAGE3: Rematch with references","STAGE4: Sort matched targets"]}});var p=t.semanticObject;var v=t.action;this._oShellHash=t;var g=s?n.getSegmentByTags(s):n.getSegment(p,v);if(l){u=g.filter(function(e){return!e.tileResolutionResult||!e.tileResolutionResult.isCustomTile})}else{u=g}var h=null;if(this._oAdapter.getContentProviderDataOriginsLookup){h=this._oAdapter.getContentProviderDataOriginsLookup.bind(this._oAdapter)}d.match(t,u,{},h,e.getLevel()>=e.Level.DEBUG).then(function(e){f.log(function(){return{logId:o,stage:1,prefix:"✘",lines:Object.keys(e.noMatchReasons||{}).map(function(t){return t+" "+e.noMatchReasons[t]})}});f.log(function(){var t=e.matchResults.map(function(e){return a.formatInbound(e.inbound)});return{logId:o,stage:1,prefix:t.length>0?"✅":"✘",lines:t.length>0?t:["No inbound was matched"]}});var t={};var n=false;var r=Object.keys(e.missingReferences);r.forEach(function(r){var i=Object.keys(e.missingReferences[r]);n=n||i.length>0;t[r]=i});r=r.filter(function(e){if(t[e].length>0){return true}delete t[e];return false});if(!n){f.log(function(){return{logId:o,stage:2,prefix:"✅",line:"No need to resolve references"}});return(new jQuery.Deferred).resolve({matchResults:e.matchResults,referencesToInclude:null}).promise()}r.forEach(function(e){f.log(function(){return{logId:o,stage:2,line:'@ Must resolve the following references with contentProviderId = "'+e+'":',prefix:"•",lines:t[e]}})});var i=new jQuery.Deferred;sap.ushell.Container.getServiceAsync("ReferenceResolver").then(function(e){var n=r.map(function(e){return this.getSystemContext(e)}.bind(this));return Promise.all(n).then(function(n){var i=r.map(function(r,i){return new Promise(function(s,a){e.resolveReferences(t[r],n[i]).done(s).fail(a)})});return Promise.all(i)})}.bind(this)).then(function(t){var n={matchResults:e.matchResults,referencesToInclude:{}};r.forEach(function(e,r){var i=t[r];n.referencesToInclude[e]=i;if(Object.keys(i).length>0){f.log(function(){return{logId:o,stage:2,line:'✅ resolved references with contentProviderId = "'+e+'" to the following values:',prefix:"•",lines:Object.keys(i).map(function(e){return e+": '"+i[e]+"'"})}})}});i.resolve(n)}).catch(function(e){f.log(function(){return{logId:o,stage:2,prefix:"❌",line:"Failed to resolve references: "+e}});c.resolve([])});return i.promise()}.bind(this)).then(function(e){var n=e.referencesToInclude;if(!n){f.log(function(){return{logId:o,stage:3,line:"rematch was skipped (no references to resolve)",prefix:"✅"}});return(new jQuery.Deferred).resolve(e).promise()}var r=e.matchResults;var i=r.map(function(e){return e.inbound});return d.match(t,i,n,h,0).then(function(e){f.log(function(){var t=e.matchResults||[];if(t.length>=1){return{logId:o,stage:3,line:"The following inbounds re-matched:",lines:t.map(function(e){return a.formatInbound(e.inbound)}),prefix:"✅"}}return{logId:o,stage:3,line:"No inbounds re-matched",prefix:"-"}});return e})}).then(function(e){var t=e.matchResults||[];if(t.length<=1){f.log(function(){return{logId:o,stage:4,line:"Nothing to sort"}});c.resolve(t);return}var n=d.sortMatchingResultsDeterministic(e.matchResults||[]);f.log(function(){var e=n.map(function(e){return a.formatInbound(e.inbound||{})+(e.matchesVirtualInbound?" (virtual)":"")+"\n[ Sort Criteria ] "+"\n * 1 * sap-priority: '"+e["sap-priority"]+"'"+"\n * 2 * Sort string: '"+e.priorityString+"\n * 3 * Deterministic blob: '"+d.serializeMatchingResult(e)+"'"});return{logId:o,stage:4,line:"Sorted inbounds as follows:",lines:e,prefix:".",number:true}});c.resolve(n)});return c.promise().then(function(e){f.end(function(){return{logId:o}});return e})};S.prototype._isIntentSupportedOne=function(e,t){var n=new jQuery.Deferred;var r=y.parseShellHash(e);if(e==="#"){n.resolve(true);return n.promise()}if(r===undefined){return n.reject("Could not parse shell hash '"+e+"'").promise()}r.formFactor=b.getFormFactor();this._getMatchingInbounds(r,t,{bExcludeTileInbounds:true}).done(function(e){n.resolve(e.length>0)}).fail(function(){n.reject()});return n.promise()};S.prototype.isIntentSupported=function(e){var t=this;var n=new jQuery.Deferred;this._oInboundProvider.getInbounds().then(function(r){t._isIntentSupported(e,r).done(n.resolve.bind(n)).fail(n.reject.bind(n))},function(){n.reject.apply(n,arguments)});return n.promise()};S.prototype._isIntentSupported=function(e,t){var n=this;var r=new jQuery.Deferred;var i={};r.resolve();function s(e,t){i[e]={supported:t}}var a=[];e.forEach(function(e){var i=n._isIntentSupportedOne(e,t);i.fail(function(e){a.push(e)});i.done(function(t){s(e,t)});r=jQuery.when(r,i)});var o=new jQuery.Deferred;r.done(function(){o.resolve(i)}).fail(function(){o.reject("One or more input intents contain errors: "+a.join(", "))});return o.promise()};S.prototype.getUserDefaultParameterNames=function(e){var t=this;var n=new jQuery.Deferred;this._oInboundProvider.getInbounds().then(function(r){t._getUserDefaultParameterNames(r.getAllInbounds(),e).then(function(e){n.resolve(e)},function(e){n.reject("Cannot get user default parameters from inbounds: "+e)})},function(){n.reject.apply(n,arguments)});return n.promise()};S.prototype._getUserDefaultParameterNames=function(e,t){var n={simple:{},extended:{}};e=e.filter(function(e){if(e.contentProviderId===undefined&&t.id===""){return true}return e.contentProviderId===t.id});return sap.ushell.Container.getServiceAsync("ReferenceResolver").then(function(t){e.forEach(function(e){var r=e.signature&&e.signature.parameters||[];Object.keys(r).forEach(function(e){var i=r[e];var s;if(i){if(i.filter&&i.filter.format==="reference"){s=i.filter.value}else if(i.defaultValue&&i.defaultValue.format==="reference"){s=i.defaultValue.value}if(typeof s==="string"){var a=t.extractUserDefaultReferenceName(s);if(typeof a==="string"){n.simple[a]={}}var o=t.extractExtendedUserDefaultReferenceName(s);if(typeof o==="string"){n.extended[o]={}}}}})});return n})};S.prototype.getEasyAccessSystems=function(r){var s={};r=r||"sapMenu";if(this._oHaveEasyAccessSystemsDeferreds[r]){return this._oHaveEasyAccessSystemsDeferreds[r].promise()}this._oHaveEasyAccessSystemsDeferreds[r]=new jQuery.Deferred;var o=this._oHaveEasyAccessSystemsDeferreds[r];function l(e,t,n){if(!e){return false}var i=[e.semanticObject,e.action].join("-");return n[r][i]&&e.deviceTypes&&t!==undefined&&e.deviceTypes[t]}var u=i.getEasyAccessMenuDefinitions().reduce(function(e,t){var n=t.easyAccessMenu.intent.split("-")[1];e[n]={appType:t.type,priority:t.easyAccessMenu.systemSelectionPriority};return e},{});var c={userMenu:i.getEasyAccessMenuDefinitions().reduce(function(e,t){var n=t.easyAccessMenu.intent;e[n]=t.easyAccessMenu.showSystemSelectionInUserMenu;return e},{}),sapMenu:i.getEasyAccessMenuDefinitions().reduce(function(e,t){var n=t.easyAccessMenu.intent;e[n]=t.easyAccessMenu.showSystemSelectionInSapMenu;return e},{})};this._oInboundProvider.getInbounds().then(function(r){var i={};r.getAllInbounds().filter(function(e){return l(e,b.getFormFactor(),c)}).forEach(function(r){var o;if(t(r.signature.parameters["sap-system"])&&r.signature.parameters["sap-system"].hasOwnProperty("filter")){o=n.get("signature.parameters.sap-system.filter.value",r)}if(typeof o==="string"){var l=u[r.action].priority;var c=u[r.action].appType;if(!s[o]){i[o]=-1;s[o]={appType:{}}}if(i[o]<l){s[o].text=r.title;i[o]=l}s[o].appType[c]=true}else{e.warning("Cannot extract sap-system from easy access menu inbound: "+a.formatInbound(r),"This parameter is supposed to be a string. Got '"+o+"' instead.","sap.ushell.services.ClientSideTargetResolution")}});o.resolve(s)},function(){o.reject.apply(o,arguments)});return o.promise()};S.prototype.getSystemContext=function(e){var t=e===undefined?"":e;return new Promise(function(e,n){var r;this._oAdapter.resolveSystemAlias(t).done(function(t){r=p.createSystemContextFromSystemAlias(t);e(r)}).fail(function(e){n(e)})}.bind(this))};S.hasNoAdapter=false;return S},true);
//# sourceMappingURL=ClientSideTargetResolution.js.map