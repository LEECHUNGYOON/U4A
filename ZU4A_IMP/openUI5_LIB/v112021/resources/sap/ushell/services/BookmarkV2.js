// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/Config","sap/ushell/library","sap/base/util/deepClone","sap/base/util/deepExtend","sap/base/Log","sap/ushell/utils"],function(e,t,o,r,a,s){"use strict";const n="sap.ushell.services.BookmarkV2";const i=t.ContentNodeType;function c(){this._getLaunchPageService=function(){if(!this._oLaunchPageServicePromise){this._oLaunchPageServicePromise=sap.ushell.Container.getServiceAsync("LaunchPage")}return this._oLaunchPageServicePromise};this._getPagesService=function(){if(!this._oPagesServicePromise){this._oPagesServicePromise=sap.ushell.Container.getServiceAsync("Pages")}return this._oPagesServicePromise};this._addBookmarkToContentNodes=function(e,t,o,r){const a=t.map(function(t){if(t&&t.hasOwnProperty("type")&&t.isContainer){switch(t.type){case i.Page:return this.addBookmarkToPage(e,t.id,r);case i.HomepageGroup:return this._getLaunchPageService().then(e=>s.promisify(e.getGroupById(t.id))).then(function(t){return this.addBookmarkToHomepageGroup(e,t,o,r)}.bind(this));default:return Promise.reject("Bookmark Service: The API needs to be called with a valid content node type. '"+t.type+"' is not supported.")}}return Promise.reject("Bookmark Service: Not a valid content node.")}.bind(this));return Promise.all(a)};this.addBookmark=function(t,o,r){const s=e.last("/core/shell/enablePersonalization");const i=e.last("/core/spaces/enabled");const c=e.last("/core/spaces/myHome/enabled");if(!s&&(!i||!c)){return Promise.resolve()}return this._checkBookmarkParameters(t).then(function(){if(typeof o==="undefined"&&i){return sap.ushell.Container.getServiceAsync("Menu").then(e=>e.getDefaultSpace()).then(e=>{const t=e&&e.children&&e.children[0];return t}).then(function(e){return this._addBookmarkToContentNodes(t,[e],false,r)}.bind(this))}if((typeof o==="undefined"||!o.hasOwnProperty("type"))&&!Array.isArray(o)){return this.addBookmarkToHomepageGroup(t,o,false,r)}const e=[].concat(o);return this._addBookmarkToContentNodes(t,e,false,r)}.bind(this)).catch(function(e){a.error("Error during Bookmark creation: ",e,n);throw e})};this.addCustomBookmark=function(e,t,a,s){const n=o(t);const i=r(n,{vizType:e,vizConfig:{"sap.flp":{chipConfig:n.chipConfig},"sap.platform.runtime":{includeManifest:!n.loadManifest}}});delete i.chipConfig;delete i.loadManifest;const c=[].concat(a);return this._addBookmarkToContentNodes(i,c,true,s)};this.addBookmarkToHomepageGroup=async function(t,o,r,a){if(e.last("/core/spaces/enabled")){return Promise.reject("Bookmark Service: The API is not available in spaces mode.")}const n=await this._getLaunchPageService();let i;if(r){i=await s.promisify(n.addCustomBookmark(t,o,a))}else{i=await s.promisify(n.addBookmark(t,o,a))}const c={tile:i,group:o};sap.ui.getCore().getEventBus().publish("sap.ushell.services.Bookmark","bookmarkTileAdded",c)};this.addBookmarkToPage=function(t,o,r){if(!e.last("/core/spaces/enabled")){return Promise.reject("Bookmark Service: 'addBookmarkToPage' is not valid in launchpad home page mode, use 'addBookmark' instead.")}const a=e.last("/core/shell/enablePersonalization");const s=e.last("/core/spaces/myHome/enabled");const n=e.last("/core/spaces/myHome/myHomePageId");if(!a&&(!s||s&&o!==n)){return Promise.reject("Bookmark Service: Add bookmark is not allowed as the personalization functionality is not enabled.")}if(t&&(typeof t.title!=="string"||typeof t.url!=="string")){return Promise.reject("Bookmark Service - Invalid bookmark data.")}return this._getPagesService().then(e=>e.addBookmarkToPage(o,t,undefined,r))};this.addBookmarkByGroupId=function(t,o,r){if(e.last("/core/spaces/enabled")){const e="Bookmark Service: The API 'addBookmarkByGroupId' is not supported in launchpad spaces mode.";return Promise.reject(e)}return this._getLaunchPageService().then(e=>s.promisify(e.getGroups())).then(function(e){const a=e.find(e=>e.id===o)||null;return this.addBookmark(t,a,r)}.bind(this))};this.getShellGroupIDs=function(t){if(e.last("/core/spaces/enabled")){const e="Bookmark Service: The API 'getShellGroupIDs' is not supported in launchpad spaces mode.";return Promise.reject(e)}return this._getLaunchPageService().then(e=>s.promisify(e.getGroupsForBookmarks(t)).then(t=>{t=t.map(t=>({id:e.getGroupId(t.object),title:t.title}));return t}))};this._isSameCatalogTile=function(e,t,o){const r=o.getCatalogTileId(t);if(r===undefined){return false}return r.indexOf(e)===0};this._checkBookmarkParameters=function(e){return Promise.resolve().then(function(){if(!e){throw new Error("Invalid Bookmark Data: No bookmark parameters passed.")}const t=e.dataSource;let o;if(t){if(t.type!=="OData"){throw new Error("Invalid Bookmark Data: Unknown data source type: "+t.type)}o=t.settings&&t.settings.odataVersion;const e=["2.0","4.0"];if(!e.includes(o)){throw new Error("Invalid Bookmark Data: Unknown OData version in the data source: "+o)}}if(e.serviceUrl){return sap.ushell.Container.getServiceAsync("ReferenceResolver").then(o=>{if(o.hasSemanticDateRanges(e.serviceUrl)&&!t){throw new Error("Invalid Bookmark Data: Provide a data source to use semantic date ranges.")}})}})};this.countBookmarks=function(t,o){if(e.last("/core/spaces/enabled")){return this._getPagesService().then(e=>e.countBookmarks({url:t,contentProviderId:o}))}return this._getLaunchPageService().then(e=>s.promisify(e.countBookmarks(t,o)))};this.countCustomBookmarks=function(t){if(!t||!t.url||!t.vizType){return Promise.reject("countCustomBookmarks: required parameters are missing.")}if(e.last("/core/spaces/enabled")){return this._getPagesService().then(e=>e.countBookmarks(t))}return this._getLaunchPageService().then(e=>e.countCustomBookmarks(t))};this.deleteBookmarks=function(t,o){if(e.last("/core/spaces/enabled")){return this._getPagesService().then(e=>e.deleteBookmarks({url:t,contentProviderId:o}))}return this._getLaunchPageService().then(e=>s.promisify(e.deleteBookmarks(t,o))).then(e=>{sap.ui.getCore().getEventBus().publish("sap.ushell.services.Bookmark","bookmarkTileDeleted",t);return e})};this.deleteCustomBookmarks=function(t){if(!t||!t.url||!t.vizType){return Promise.reject("deleteCustomBookmarks: Some required parameters are missing.")}if(e.last("/core/spaces/enabled")){return this._getPagesService().then(e=>e.deleteBookmarks(t))}return this._getLaunchPageService().then(e=>e.deleteCustomBookmarks(t)).then(()=>{sap.ui.getCore().getEventBus().publish("sap.ushell.services.Bookmark","bookmarkTileDeleted",t.url)})};this.updateBookmarks=function(t,o,r){if(e.last("/core/spaces/enabled")){return this._getPagesService().then(e=>e.updateBookmarks({url:t,contentProviderId:r},o))}return this._getLaunchPageService().then(e=>s.promisify(e.updateBookmarks(t,o,r)))};this.updateCustomBookmarks=function(t,o){if(!t||!t.url||!t.vizType){return Promise.reject("deleteCustomBookmarks: Some required parameters are missing.")}const a=r({},o,{vizConfig:{"sap.flp":{chipConfig:o.chipConfig},"sap.platform.runtime":{includeManifest:!o.loadManifest}}});delete a.chipConfig;delete a.loadManifest;if(e.last("/core/spaces/enabled")){return this._getPagesService().then(e=>e.updateBookmarks(t,a))}return this._getLaunchPageService().then(e=>e.updateCustomBookmarks(t,a))};this.getContentNodes=function(){if(e.last("/core/spaces/enabled")){return sap.ushell.Container.getServiceAsync("Menu").then(e=>e.getContentNodes())}return this._getLaunchPageService().then(e=>s.promisify(e.getGroupsForBookmarks()).then(t=>{const o=t.map(t=>({id:e.getGroupId(t.object),label:t.title,type:i.HomepageGroup,isContainer:true}));return o}))}}c.hasNoAdapter=true;return c},true);
//# sourceMappingURL=BookmarkV2.js.map