sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/base/ManagedObjectObserver","sap/ui/core/ResizeHandler","sap/ui/core/Configuration","sap/ui/core/Control","sap/ui/core/InvisibleText","sap/ui/Device","sap/ui/base/ManagedObject","sap/ui/core/delegate/ScrollEnablement","./ObjectPageSectionBase","./ObjectPageSection","./ObjectPageSubSection","./ObjectPageHeaderContent","./LazyLoading","./ObjectPageLayoutABHelper","./ThrottledTaskHelper","sap/ui/core/library","./library","./ObjectPageLayoutRenderer","sap/base/Log","sap/base/util/array/diff","sap/ui/dom/getScrollbarSize","sap/base/assert","sap/base/util/isEmptyObject","sap/base/util/merge","sap/ui/events/KeyCodes","sap/ui/dom/getFirstEditableInput","sap/ui/dom/units/Rem","sap/ui/base/Object"],(function(jQuery,e,t,i,o,n,r,s,a,h,l,c,d,g,_,p,u,S,b,y,T,H,f,A,C,I,P,B,v){"use strict";var O=u.TitleLevel,L=u.AccessibleLandmarkRole,E=S.ObjectPageSubSectionLayout,m=["toggleAnchorBar","_moveHeader"],R=o.extend("sap.uxap.ObjectPageLayout",{metadata:{library:"sap.uxap",properties:{showAnchorBar:{type:"boolean",defaultValue:!0},showAnchorBarPopover:{type:"boolean",defaultValue:!0},upperCaseAnchorBar:{type:"boolean",defaultValue:!0},backgroundDesignAnchorBar:{type:"sap.m.BackgroundDesign",group:"Appearance"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},enableLazyLoading:{type:"boolean",defaultValue:!1},subSectionLayout:{type:"sap.uxap.ObjectPageSubSectionLayout",defaultValue:E.TitleOnTop},sectionTitleLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:O.Auto},useIconTabBar:{type:"boolean",group:"Misc",defaultValue:!1},showHeaderContent:{type:"boolean",group:"Misc",defaultValue:!0},useTwoColumnsForLargeScreen:{type:"boolean",group:"Appearance",defaultValue:!1},showTitleInHeaderContent:{type:"boolean",group:"Appearance",defaultValue:!1},showOnlyHighImportance:{type:"boolean",group:"Behavior",defaultValue:!1},isChildPage:{type:"boolean",group:"Appearance",defaultValue:!1},alwaysShowContentHeader:{type:"boolean",group:"Behavior",defaultValue:!1},headerContentPinnable:{type:"boolean",group:"Behavior",defaultValue:!0},headerContentPinned:{type:"boolean",group:"Behavior",defaultValue:!1},toggleHeaderOnTitleClick:{type:"boolean",group:"Behavior",defaultValue:!0},preserveHeaderStateOnScroll:{type:"boolean",group:"Behavior",defaultValue:!1},showEditHeaderButton:{type:"boolean",group:"Behavior",defaultValue:!1},flexEnabled:{type:"boolean",group:"Misc",defaultValue:!1},showFooter:{type:"boolean",group:"Behavior",defaultValue:!1}},associations:{selectedSection:{type:"sap.uxap.ObjectPageSection",multiple:!1}},defaultAggregation:"sections",aggregations:{sections:{type:"sap.uxap.ObjectPageSection",multiple:!0,singularName:"section"},headerTitle:{type:"sap.uxap.IHeaderTitle",multiple:!1},headerContent:{type:"sap.ui.core.Control",multiple:!0,singularName:"headerContent"},footer:{type:"sap.m.IBar",multiple:!1},landmarkInfo:{type:"sap.uxap.ObjectPageAccessibleLandmarkInfo",multiple:!1},_anchorBar:{type:"sap.uxap.AnchorBar",multiple:!1,visibility:"hidden"},_iconTabBar:{type:"sap.m.IconTabBar",multiple:!1,visibility:"hidden"},_headerContent:{type:"sap.uxap.IHeaderContent",multiple:!1,visibility:"hidden"}},events:{headerContentPinnedStateChange:{parameters:{pinned:{type:"boolean"}}},toggleAnchorBar:{parameters:{fixed:{type:"boolean"}}},sectionChange:{parameters:{section:{type:"sap.uxap.ObjectPageSection"},subSection:{type:"sap.uxap.ObjectPageSubSection"}}},editHeaderButtonPress:{},beforeNavigate:{allowPreventDefault:!0,parameters:{section:{type:"sap.uxap.ObjectPageSection"},subSection:{type:"sap.uxap.ObjectPageSubSection"}}},navigate:{parameters:{section:{type:"sap.uxap.ObjectPageSection"},subSection:{type:"sap.uxap.ObjectPageSubSection"}}},subSectionVisibilityChange:{parameters:{visibleSubSections:{type:"object"}}}},dnd:{draggable:!1,droppable:!0},designtime:"sap/uxap/designtime/ObjectPageLayout.designtime"},renderer:b});function D(e){return 1===arguments.length?Array.isArray(e)?e.length>0:!!e:Array.prototype.slice.call(arguments).every((function(e){return D(e)}))}return R.HEADER_CALC_DELAY=350,R.DOM_CALC_DELAY=200,R.MAX_SNAP_POSITION_OFFSET=20,R.HEADER_MAX_ALLOWED_NON_SROLLABLE_PERCENTAGE=.6,R.TITLE_LEVEL_AS_ARRAY=Object.keys(O),R.EVENTS={TITLE_PRESS:"_titlePress",TITLE_MOUSE_OVER:"_titleMouseOver",TITLE_MOUSE_OUT:"_titleMouseOut",PIN_UNPIN_PRESS:"_pinUnpinPress",VISUAL_INDICATOR_MOUSE_OVER:"_visualIndicatorMouseOver",VISUAL_INDICATOR_MOUSE_OUT:"_visualIndicatorMouseOut",HEADER_VISUAL_INDICATOR_PRESS:"_headerVisualIndicatorPress",TITLE_VISUAL_INDICATOR_PRESS:"_titleVisualIndicatorPress"},R.BREAK_POINTS={DESKTOP:1439,TABLET:1024,PHONE:600},R.MEDIA={PHONE:"sapUxAPObjectPageLayout-Std-Phone",TABLET:"sapUxAPObjectPageLayout-Std-Tablet",DESKTOP:"sapUxAPObjectPageLayout-Std-Desktop",DESKTOP_XL:"sapUxAPObjectPageLayout-Std-Desktop-XL"},R.DYNAMIC_HEADERS_MEDIA={PHONE:"sapFDynamicPage-Std-Phone",TABLET:"sapFDynamicPage-Std-Tablet",DESKTOP:"sapFDynamicPage-Std-Desktop",DESKTOP_XL:"sapFDynamicPage-Std-Desktop-XL"},R.DIV="div",R.HEADER="header",R.FOOTER="section",R.HEADER_CONTENT_PADDING_BOTTOM=B.toPx("1rem"),R.SHOW_FOOTER_CLASS_NAME="sapUxAPObjectPageFloatingFooterShow",R.HIDE_FOOTER_CLASS_NAME="sapUxAPObjectPageFloatingFooterHide",R.NO_NAVIGATION_CLASS_NAME="sapUxAPObjectPageNoNavigation",R.ARIA={LABEL_TOOLBAR_FOOTER_ACTIONS:"ARIA_LABEL_TOOLBAR_FOOTER_ACTIONS"},R.prototype._getFirstEditableInput=function(e){var t=this.getDomRef(e);return P(t)},R.prototype._focusFirstEditableInput=function(e){this._getFirstEditableInput(e).focus()},R._getNextTitleLevelEntry=function(e){var t=R.TITLE_LEVEL_AS_ARRAY.indexOf(e),i=-1!==t,o=i&&t!==R.TITLE_LEVEL_AS_ARRAY.length-1;return i?R.TITLE_LEVEL_AS_ARRAY[o?t+1:t]:O.Auto},R._getLibraryResourceBundle=function(){return sap.ui.getCore().getLibraryResourceBundle("sap.uxap")},R.prototype.init=function(){this.oCore=sap.ui.getCore(),this._bFirstRendering=!0,this._bDomReady=!1,this._bPinned=!1,this._bStickyAnchorBar=!1,this._bHeaderInTitleArea=!1,this._bHeaderExpanded=!0,this._bHeaderBiggerThanAllowedHeight=!1,this._bDelayDOMBasedCalculations=!0,this._iStoredScrollTop=0,this._oStoredScrolledSubSectionInfo={},this._bAllContentFitsContainer=!1,this._bIsFooterAanimationGoing=!1,this._bInternalAnchorBarVisible=!0,this._oVisibleSubSections=0,this._$footerWrapper=[],this._$opWrapper=[],this._$anchorBar=[],this._$titleArea=[],this._$stickyAnchorBar=[],this._$headerContent=[],this._$stickyHeaderContent=[],this._bMobileScenario=!1,this._oSectionInfo={},this._aSectionBases=[],this._sScrolledSectionId="",this._iScrollToSectionDuration=600,this._$spacer=[],this.iHeaderContentHeight=0,this.iStickyHeaderContentHeight=0,this.iHeaderTitleHeight=0,this.iHeaderTitleHeightStickied=0,this.iAnchorBarHeight=0,this.iFooterHeight=0,this.iTotalHeaderSize=0,this._iHeaderContentPaddingBottom=0,this._oScrollContainerLastState={},this._iREMSize=parseInt(jQuery("body").css("font-size")),this._iOffset=parseInt(.25*this._iREMSize),this._iResizeId=null,this._iAfterRenderingDomReadyTimeout=null,this._oABHelper=new _(this),this._initializeScroller(),this._attachSnapListeners()},R.prototype.onBeforeRendering=function(){var e,t;this._deregisterScreenSizeListener(),this._deregisterTitleSizeListener(),this._oLazyLoading&&this._oLazyLoading.destroy(),this._oLazyLoading=new g(this),this._deregisterCustomEvents(),this.getVisible()&&(this.getSelectedSection()||(this._bHeaderExpanded=!0),this._bMobileScenario=S.Utilities.isPhoneScenario(this._getCurrentMediaContainerRange()),this._bTabletScenario=S.Utilities.isTabletScenario(this._getCurrentMediaContainerRange()),this._checkAlwaysShowContentHeader()&&(this._bHeaderExpanded=!0),this._bHeaderInTitleArea=this._shouldPreserveHeaderInTitleArea(),this._createHeaderContent(),this._getHeaderContent().setContentDesign(this._getHeaderDesign()),this._oABHelper._getAnchorBar().setProperty("upperCase",this.getUpperCaseAnchorBar(),!0),this._storeScrollLocation(),this._applyUxRules(),!A(this._oSectionInfo)&&this._bFirstRendering&&(this._preloadSectionsOnBeforeFirstRendering(),this._bFirstRendering=!1),this._bStickyAnchorBar=this._shouldPreserveHeaderInTitleArea(),this._handleExpandButtonPressEventLifeCycle(!1),this._attachTitlePressHandler(),(e=this._getHeaderContent())&&e.supportsPinUnpin()&&(t=this.getHeaderContentPinnable()&&!this.getPreserveHeaderStateOnScroll(),this._getHeaderContent().setPinnable(t),t&&this._attachPinPressHandler()),this._attachVisualIndicatorsPressHandlers(this._handleDynamicTitlePress,this),r.system.desktop&&(this._attachVisualIndicatorMouseOverHandlers(this._addHoverClass,this._removeHoverClass,this),this._attachTitleMouseOverHandlers(this._addHoverClass,this._removeHoverClass,this)),this.getFooter()&&this._bIsFooterAanimationGoing&&this._onToggleFooterAnimationEnd(this.getFooter()),this._$titleArea=[],this._setFooterAriaLabelledBy())},R.prototype._setFooterAriaLabelledBy=function(){var e=this.getFooter();e&&!e.getAriaLabelledBy().length&&(this._oInvisibleText=new n({id:e.getId()+"-FooterActions-InvisibleText",text:R._getLibraryResourceBundle().getText(R.ARIA.LABEL_TOOLBAR_FOOTER_ACTIONS)}).toStatic(),e.addAriaLabelledBy(this._oInvisibleText))},R.prototype._destroyInvisibleText=function(){this._oInvisibleText&&(this._oInvisibleText.destroy(),this._oInvisibleText=null)},R.prototype.setBackgroundDesignAnchorBar=function(e){return this.getBackgroundDesignAnchorBar()===e||(this.setProperty("backgroundDesignAnchorBar",e),this._oABHelper._getAnchorBar().setBackgroundDesign(e)),this},R.prototype.setToggleHeaderOnTitleClick=function(e){var t=this.getHeaderTitle(),i=this.setProperty("toggleHeaderOnTitleClick",e,!0);return t&&t.supportsToggleHeaderOnTitleClick()?(e=this.getProperty("toggleHeaderOnTitleClick"),this._updateToggleHeaderVisualIndicators(),this._updateTitleVisualState(),i):(y.warning("Setting toggleHeaderOnTitleClick will not take effect as it is not supported in the ObjectPageHeader, read the API Doc for more information",this),i)},R.prototype._attachTitlePressHandler=function(){var e=this.getHeaderTitle();D(e)&&!this._bAlreadyAttachedTitlePressHandler&&(e.attachEvent(R.EVENTS.TITLE_PRESS,this._handleDynamicTitlePress,this),this._bAlreadyAttachedTitlePressHandler=!0)},R.prototype._attachSnapListeners=function(){m.forEach((function(e){this.attachEvent(e,(function(){this.fireEvent("_snapChange")}))}),this)},R.prototype._toggleHeaderVisibility=function(e){var t=this._getHeaderContent();D(t)&&t.$().toggleClass("sapUxAPObjectPageHeaderContentHidden",!e)},R.prototype._snapHeader=function(e,t){var i=this._getHeaderContent();if(i&&i.supportsPinUnpin()&&this._bPinned&&(this._unPin(t),i.getAggregation("_pinButton").setPressed(!1),e=!0),this._toggleHeaderTitle(!1,!0),this._toggleHeaderVisibility(e),this._moveAnchorBarToTitleArea(),e)return this._moveHeaderToContentArea(),this._bHeaderExpanded=!1,this._updateToggleHeaderVisualIndicators(),this._adjustHeaderHeights(),this._requestAdjustLayout(!0),void(this._$opWrapper.scrollTop()<=this._getSnapPosition()+1&&this._scrollTo(this._getSnapPosition()+1));this._bHeaderExpanded=!1,this._updateToggleHeaderVisualIndicators(),this._adjustHeaderHeights(),this._requestAdjustLayout()},R.prototype._expandHeader=function(e){if(this._toggleHeaderTitle(!0,!0),this._toggleHeaderVisibility(!0),e)return this._moveAnchorBarToTitleArea(),this._moveHeaderToTitleArea(),this._bHeaderExpanded=!0,this._updateToggleHeaderVisualIndicators(),this._adjustHeaderHeights(),void this._requestAdjustLayout();this._moveAnchorBarToContentArea(),this._moveHeaderToContentArea(),this._scrollTo(0,0),this._bHeaderExpanded=!0,this._adjustHeaderHeights(),this._updateToggleHeaderVisualIndicators(),this._isHeaderPinnable()&&this._getHeaderContent()._getPinButton().setVisible(!this._headerBiggerThanAllowedToBeExpandedInTitleArea())},R.prototype._handleDynamicTitlePress=function(){var e,t,i;this.getToggleHeaderOnTitleClick()&&this._hasVisibleDynamicTitleAndHeader()&&(!this._bHeaderExpanded?(e=this._$opWrapper.scrollTop()<=this._getSnapPosition()+1,t=!this._headerBiggerThanAllowedToBeExpandedInTitleArea()&&(this._shouldPreserveHeaderInTitleArea()||!e),this._expandHeader(t),t||this._scrollTo(0,0)):(i=!this._shouldPreserveHeaderInTitleArea()&&(!this._bAllContentFitsContainer||this._headerBiggerThanAllowedToBeExpandedInTitleArea()),this._snapHeader(i,!0)),this.getHeaderTitle()._getFocusSpan().trigger("focus"))},R.prototype._attachPinPressHandler=function(){var e=this._getHeaderContent();D(e)&&!this._bAlreadyAttachedPinPressHandler&&(e.attachEvent(R.EVENTS.PIN_UNPIN_PRESS,this._onPinUnpinButtonPress,this),this._bAlreadyAttachedPinPressHandler=!0)},R.prototype._handleExpandButtonPressEventLifeCycle=function(e){var t,i=this.getHeaderTitle(),o=this._hasDynamicTitle();i&&!o&&(t=i.getAggregation("_expandButton"))&&t[e?"attachPress":"detachPress"](this._handleExpandButtonPress,this)},R.prototype._adjustSelectedSectionByUXRules=function(){var e=this.oCore.byId(this.getSelectedSection());if(!(e&&this._sectionCanBeRenderedByUXRules(e))){if(!this._oFirstVisibleSection)return void this.setAssociation("selectedSection",null,!0);e=this._oFirstVisibleSection,this.setAssociation("selectedSection",e.getId(),!0)}},R.prototype._sectionCanBeRenderedByUXRules=function(e){return e instanceof h&&(!!(e.getBindingInfo("subSections")||e.getVisible()&&e._getInternalVisible())&&this._aSectionBases.map((function(e){return e.getId()})).indexOf(e.getId())>-1)},R.prototype._getSectionsToRender=function(){this._adjustSelectedSectionByUXRules();var e=this.oCore.byId(this.getSelectedSection());return this.getUseIconTabBar()&&e?[e]:this.getSections()},R.prototype._preloadSectionsOnBeforeFirstRendering=function(){var e=this._getSectionsToPreloadOnBeforeFirstRendering();this._connectModelsForSections(e),this.getEnableLazyLoading()&&e.forEach((function(e){this.fireEvent("subSectionPreload",{subSection:e})}),this)},R.prototype._getSectionsToPreloadOnBeforeFirstRendering=function(){var e,t,i;if(!this.getEnableLazyLoading())return this._getSectionsToRender();if(this.getUseIconTabBar())return this._oLazyLoading.getSubsectionsToPreload(this._grepCurrentTabSectionBases());if(this._adjustSelectedSectionByUXRules(),!(t=this.oCore.byId(this.getSelectedSection()))||t===this._oFirstVisibleSection)return this._oLazyLoading.getSubsectionsToPreload(this._aSectionBases);i=this.indexOfSection(t);var o=function(e){var t=e.isA("sap.uxap.ObjectPageSection")?e:e.getParent();return this.indexOfSection(t)>=i}.bind(this);return e=this._aSectionBases.filter(o),this._oLazyLoading.getSubsectionsToPreload(e)},R.prototype._grepCurrentTabSectionBases=function(){var e,t,i,o,n=[];return this._adjustSelectedSectionByUXRules(),(e=this.oCore.byId(this.getSelectedSection()))&&(t=e.getId(),this._aSectionBases.forEach((function(e){i=e.getParent(),o=i&&i.getId(),e.getId()!==t&&o!==t||n.push(e)}))),n},R.prototype.onAfterRendering=function(){var e=this._getHeaderContent(),i=this._getWidth(this);this._bInvalidatedAndNotRerendered=!1,this._ensureCorrectParentHeight(),this._cacheDomElements(),this._iResizeId=t.register(this,this._onUpdateScreenSize.bind(this)),this._iTitleResizeId=t.register(this._$titleArea.get(0),this._adjustTitlePositioning.bind(this)),this._hasDynamicTitle()&&this.addStyleClass("sapUxAPObjectPageHasDynamicTitle"),i>0&&this._updateMedia(i,R.MEDIA),this._$opWrapper.on("scroll.OPL",this._onScroll.bind(this)),this._bDomReady&&0===this.$().parents(":hidden").length?this._onAfterRenderingDomReady():(this._iAfterRenderingDomReadyTimeout&&clearTimeout(this._iAfterRenderingDomReadyTimeout),this._iAfterRenderingDomReadyTimeout=setTimeout(this._onAfterRenderingDomReady.bind(this),this._getDOMCalculationDelay()),this._adjustTitlePositioning()),e&&e.supportsPinUnpin()&&this._updatePinButtonState(),this._handleExpandButtonPressEventLifeCycle(!0)},R.prototype._onAfterRenderingDomReady=function(){var e,t,i,o=this._getWidth(this);this._bIsBeingDestroyed||(this._adjustSelectedSectionByUXRules(),e=this.getSelectedSection(),t=this.oCore.byId(e),this._iAfterRenderingDomReadyTimeout=null,this._bDomReady=!0,this._adjustHeaderHeights(),this._initAnchorBarScroll(),e&&(this.getUseIconTabBar()?(this._setSelectedSectionId(e),this._setCurrentTabSection(t),this._bAllContentFitsContainer=this._hasSingleVisibleFullscreenSubSection(t),this._checkSubSectionVisibilityChange()):this.scrollToSection(e,0)),this._toggleScrolling(this._shouldAllowScrolling()),this._registerOnContentResize(),this.getHeaderTitle()&&this._shiftHeaderTitle(),this.getFooter()&&this._shiftFooter(),this._setSectionsFocusValues(),this.getPreserveHeaderStateOnScroll()&&this._overridePreserveHeaderStateOnScroll(),this._bHeaderExpanded||(i=!this._shouldPreserveHeaderInTitleArea()&&!this._bAllContentFitsContainer,this._snapHeader(i)),this._restoreScrollPosition(),this.oCore.getEventBus().publish("sap.ui","ControlForPersonalizationRendered",this),this._updateMedia(o,R.MEDIA),this._hasDynamicTitle()&&this._updateMedia(o,R.DYNAMIC_HEADERS_MEDIA),this._updateToggleHeaderVisualIndicators(),this._updateTitleVisualState(),this.fireEvent("onAfterRenderingDOMReady"))},R.prototype._toggleScrolling=function(e){this._$opWrapper.length&&(this._$opWrapper.get(0).style.overflowY=e?"auto":"hidden")},R.prototype._shouldAllowScrolling=function(){return!this._bAllContentFitsContainer||!this._getFirstVisibleSubSection()?._hasRestrictedHeight()},R.prototype._shiftFooter=function(){var e=this.$("footerWrapper"),t=this._calculateShiftOffset();e.css(t.sStyleAttribute,t.iMarginalsOffset+"px")},R.prototype._calculateShiftOffset=function(){var e,t=0,i=this.oCore.getConfiguration().getRTL()?"left":"right",o=this._hasVerticalScrollBar(),n=this._iOffset;return r.system.desktop&&(t=e=H().width,o||(t=0,n+=e)),{sStyleAttribute:i,iActionsOffset:n,iMarginalsOffset:t}},R.prototype._getDOMCalculationDelay=function(){return this._bDelayDOMBasedCalculations?R.HEADER_CALC_DELAY:0},R.prototype.exit=function(){this._oScroller&&(this._oScroller.destroy(),this._oScroller=null),this._oLazyLoading&&(this._oLazyLoading.destroy(),this._oLazyLoading=null),this._destroyInvisibleText(),this._deregisterScreenSizeListener(),this._deregisterTitleSizeListener(),this._iContentResizeId&&t.deregister(this._iContentResizeId),this._iAfterRenderingDomReadyTimeout&&clearTimeout(this._iAfterRenderingDomReadyTimeout),this._oObserver&&(this._oObserver.disconnect(),this._oObserver=null),this._deregisterCustomEvents(),this._oFirstVisibleSection=null,this._oFirstVisibleSubSection=null},R.prototype.setShowOnlyHighImportance=function(e){return this.getShowOnlyHighImportance()!==e&&(this.setProperty("showOnlyHighImportance",e,!0),this.getSections().forEach((function(e){e._updateImportance()}))),this},R.prototype.setIsHeaderContentAlwaysExpanded=function(e){var t=this.getAlwaysShowContentHeader(),i=r.system.phone||r.system.tablet;return t!==e&&this.setProperty("alwaysShowContentHeader",e,i),this},R.prototype.setShowEditHeaderButton=function(e){var t=this.getShowEditHeaderButton(),i=this.getAggregation("_headerContent");return t!==e&&(this.setProperty("showEditHeaderButton",e,!0),i&&i.invalidate()),this},R.prototype._initializeScroller=function(){this._oScroller||(this._oScroller=new a(this,this.getId()+"-scroll",{horizontal:!1,vertical:!0}),this._oScroller.setOnAfterScrollToElement(this._onAfterScrollToElement.bind(this)))},R.prototype._onAfterScrollToElement=function(){var e=this._$opWrapper.scrollTop(),t=this._bStickyAnchorBar;this._onScroll({target:{scrollTop:e}}),this._bStickyAnchorBar&&!t&&this._$opWrapper.scrollTop()===e&&this._$opWrapper.scrollTop(e-this.iAnchorBarHeight)},R.prototype.setSelectedSection=function(e){var t,i;if(e instanceof h)e=e.getId();else if(null!=e&&"string"!=typeof e)return f(!1,"setSelectedSection(): sId must be a string, an instance of sap.uxap.ObjectPageSection or null"),this;return e===this.getSelectedSection()?this:null===e?(this.setAssociation("selectedSection",null,!0),this._expandHeader(this._bHeaderInTitleArea),this._selectFirstVisibleSection(),this):(this.scrollToSection(e),i=(t=l._getClosestSection(e))instanceof l?t.getId():t,this.setDirectScrollingToSection(i),this.setAssociation("selectedSection",i,!0))},R.prototype._selectFirstVisibleSection=function(){this.getUseIconTabBar()&&this._oFirstVisibleSection?(this._adjustSelectedSectionByUXRules(),this._setCurrentTabSection(this._oFirstVisibleSection),this._bAllContentFitsContainer=this._hasSingleVisibleFullscreenSubSection(this._oFirstVisibleSection),this._preloadSectionsOnBeforeScroll(this._oFirstVisibleSection),this._updateSelectionOnScroll(0),this._checkSubSectionVisibilityChange()):this.$().is(":visible")&&(this._scrollTo(0,0),this._bInvalidatedAndNotRerendered||(this._sScrolledSectionId=null,this._updateSelectionOnScroll(0)))},R.prototype._ensureCorrectParentHeight=function(){this._bCorrectParentHeightIsSet||(this.getParent().getHeight&&-1!==["","auto"].indexOf(this.getParent().getHeight())&&this.$().parent().css("height","100%"),this._bCorrectParentHeightIsSet=!0)},R.prototype._cacheDomElements=function(){this._$footerWrapper=this.$("footerWrapper"),this._$titleArea=this.$("headerTitle"),this._$anchorBar=this.$("anchorBar"),this._$stickyAnchorBar=this.$("stickyAnchorBar"),this._$opWrapper=this.$("opwrapper"),this._$spacer=this.$("spacer"),this._$headerContent=this.$("headerContent"),this._$stickyHeaderContent=this.$("stickyHeaderContent"),this._$contentContainer=this.$("scroll"),this._$sectionsContainer=this.$("sectionsContainer"),this._oScroller._$Container=this._$opWrapper,this._bDomElementsCached=!0},R.prototype._handleExpandButtonPress=function(e){this._expandHeader(!0)},R.prototype._toggleHeaderTitle=function(e,t){var i=this.getHeaderTitle(),o=this._oABHelper._getAnchorBar();this._$titleArea.length&&(this._$titleArea.toggleClass("sapUxAPObjectPageHeaderStickied",!e),this._$titleArea.toggleClass("sapUxAPObjectPageHeaderSnappedTitleOnMobile",this._hasDynamicTitleWithSnappedTitleOnMobile()&&!e)),e?i&&i.unSnap(t):i&&i.snap(t),o.scrollToCurrentlySelectedSection()},R.prototype._moveHeaderToTitleArea=function(){this._$headerContent.children().appendTo(this._$stickyHeaderContent),this._bHeaderInTitleArea=!0,this.fireEvent("_moveHeader",{fixed:!0}),this._bSupressModifyOnScrollOnce=!0},R.prototype._moveHeaderToContentArea=function(){this._bHeaderInTitleArea&&(this._$headerContent.append(this._$stickyHeaderContent.children()),this._$stickyHeaderContent.children().remove(),this._bHeaderInTitleArea=!1,this.fireEvent("_moveHeader",{fixed:!1}))},R.prototype._updateNavigation=function(){this.getShowAnchorBar()&&this._oABHelper._buildAnchorBar()},R.prototype._applyUxRules=function(e){var t,i,o,n,r,s,a,h,l,d,g,_={};t=this.getSections()||[],n=0,r=this.getShowAnchorBar(),s=this.getUseIconTabBar(),a=null,this._cleanMemory(),t.forEach((function(t){if(!t.getVisible())return!0;this._registerSectionBaseInfo(t),i=t.getSubSections()||[],o=0,h=null,i.forEach((function(t){if(!t.getVisible())return!0;this._registerSectionBaseInfo(t),0===t.getVisibleBlocksCount()?(t._setInternalVisible(!1,e),y.info("ObjectPageLayout :: noVisibleBlock UX rule matched","subSection "+t.getTitle()+" forced to hidden")):(t._setInternalVisible(!0,e),_[t.getId()]=!0,o++,h||(h=t),this._shouldApplySectionTitleLevel(t)&&t._setInternalTitleLevel(this._determineSectionBaseInternalTitleLevel(t,!a),e))}),this),o>1&&i.forEach((function(e){e._setBorrowedTitleDomId("")})),0==o?(t._setInternalVisible(!1,e),y.info("ObjectPageLayout :: noVisibleSubSection UX rule matched","section "+t.getTitle()+" forced to hidden")):(t._setInternalVisible(!0,e),_[t.getId()]=!0,a||(a=t,g=o),this.getSubSectionLayout()===E.TitleOnTop&&1===o&&""!==h.getTitle().trim()?(y.info("ObjectPageLayout :: TitleOnTop.sectionGetSingleSubSectionTitle UX rule matched","section "+t.getTitle()+" is taking its single subsection title "+h.getTitle()),t._setInternalTitle(h.getTitle(),e),_[h.getId()]=!1,h._setBorrowedTitleDomId(t.getId()+"-title")):t._setInternalTitle("",e),1!==o||h.getTitle().trim()||h._setBorrowedTitleDomId(t.getId()+"-title"),this._shouldApplySectionTitleLevel(t)&&t._setInternalTitleLevel(this._determineSectionBaseInternalTitleLevel(t),e),n++),s&&(_[t.getId()]=!1)}),this),n<=1?(r=!1,y.info("ObjectPageLayout :: notEnoughVisibleSection UX rule matched","anchorBar forced to hidden"),s&&a&&(_[a.getId()]=!0)):a&&r&&(l=!0,_[a.getId()]=!1,y.info("ObjectPageLayout :: firstSectionTitleHidden UX rule matched","section "+a.getTitle()+" title forced to hidden")),this.toggleStyleClass(R.NO_NAVIGATION_CLASS_NAME,n<=1),Object.keys(_).forEach(function(t){let i=this.oCore.byId(t)||void 0;void 0!==i?._setInternalTitleVisible&&i._setInternalTitleVisible(_[t],e)}.bind(this)),r&&this._oABHelper._buildAnchorBar(),this._setInternalAnchorBarVisible(r,e),this._oFirstVisibleSection=a,this._oFirstVisibleSubSection=this._getFirstVisibleSubSection(a),this._bAllContentFitsContainer=1===n&&1===o&&this._oFirstVisibleSubSection.hasStyleClass(c.FIT_CONTAINER_CLASS),l&&1===g&&(d=this.getAggregation("_anchorBar").getContent()).length&&this._oFirstVisibleSubSection._setBorrowedTitleDomId(d[0].getId()+"-content"),this._checkSubSectionVisibilityChange()},R.prototype._checkSubSectionVisibilityChange=function(){var e=this.getUseIconTabBar()&&sap.ui.getCore().byId(this.getSelectedSection()),t=e?[e]:this._getVisibleSections(),i={};t.forEach((function(e){e.getSubSections().forEach((function(e){e.getVisible()&&e._getInternalVisible()&&(i[e.getId()]=e)}))})),T(Object.keys(this._oVisibleSubSections),Object.keys(i)).length&&(this._oVisibleSubSections=i,this.fireEvent("subSectionVisibilityChange",{visibleSubSections:i}))},R.prototype.setUseIconTabBar=function(e){return e!=this.getUseIconTabBar()&&this._applyUxRules(),this.setProperty("useIconTabBar",e),this.toggleStyleClass("sapUxAPObjectPageLayoutIconTabBar",e),this},R.prototype._setCurrentTabSection=function(e,t){var i;e&&(v.isObjectA(e,"sap.uxap.ObjectPageSubSection")?(i=e,e=e.getParent()):i=this._getFirstVisibleSubSection(e),this._oCurrentTabSection!==e&&(this._renderSection(e),this._oCurrentTabSection=e),this._oCurrentTabSubSection=i)},R.prototype._renderSection=function(e){var t,i=this.$().find(".sapUxAPObjectPageContainer");e&&i.length&&(t=this.oCore.createRenderManager(),this.getSections().forEach((function(i){i.getId()===e.getId()?t.renderControl(e):t.cleanupControlWithoutRendering(i)})),t.flush(i[0]),t.destroy())},R.prototype.setShowAnchorBarPopover=function(e,t){var i=this.getProperty("showAnchorBarPopover"),o=(e=this.validateProperty("showAnchorBarPopover",e),this.getSelectedSection());return e===i?this:(this._oABHelper._getAnchorBar().setShowPopover(e),this._oABHelper._buildAnchorBar(),this._setSelectedSectionId(o),this.setProperty("showAnchorBarPopover",e,!0))},R.prototype._getInternalAnchorBarVisible=function(){return this._bInternalAnchorBarVisible},R.prototype._setInternalAnchorBarVisible=function(e,t){e!=this._bInternalAnchorBarVisible&&(this._bInternalAnchorBarVisible=e,!0===t&&this.invalidate())},R.prototype.setUpperCaseAnchorBar=function(e){return this._oABHelper._getAnchorBar().setProperty("upperCase",e),this.setProperty("upperCaseAnchorBar",e,!0)},R.prototype._requestAdjustLayout=function(e){return this._oLayoutTask||(this._oLayoutTask=new p(this._updateScreenHeightSectionBasesAndSpacer,R.DOM_CALC_DELAY,this)),e||y.debug("ObjectPageLayout :: _requestAdjustLayout","delayed by "+R.DOM_CALC_DELAY+" ms because of dom modifications"),this._oLayoutTask.reSchedule(e,{}).catch((function(e){}))},R.prototype._requestAdjustLayoutAndUxRules=function(e){return this._setSectionInfoIsDirty(!0),this._oUxRulesTask||(this._oUxRulesTask=new p(this._adjustLayoutAndUxRules,R.DOM_CALC_DELAY,this)),e||y.debug("ObjectPageLayout :: _requestAdjustLayoutAndUxRules","delayed by "+R.DOM_CALC_DELAY+" ms because of dom modifications"),this._oUxRulesTask.reSchedule(e,{}).catch((function(e){}))},R.prototype._adjustLayoutAndUxRules=function(){var e,t,i;y.debug("ObjectPageLayout :: _requestAdjustLayout","refreshing ux rules"),this._applyUxRules(!0),this._adjustSelectedSectionByUXRules(),e=this.getSelectedSection(),(t=this.oCore.byId(e))&&(this._setSelectedSectionId(e),this.getUseIconTabBar()&&(this._setCurrentTabSection(t),this._bAllContentFitsContainer=this._hasSingleVisibleFullscreenSubSection(t)),this._requestAdjustLayout(!0),this.getEnableLazyLoading()&&this._oLazyLoading&&this._oLazyLoading.doLazyLoading(),this._isClosestScrolledSection(e)&&!this._hasOngoingScrollToSection()||(i=e,t.indexOfSubSection(this.oCore.byId(this.getOngoingScrollToSectionBaseId()))>-1&&(i=this.getOngoingScrollToSectionBaseId()),this.scrollToSection(i,null,0,!1,!0)))},R.prototype._isClosestScrolledSection=function(e){var t=this._$opWrapper.length>0?this._$opWrapper.scrollTop():0,i=this.iScreenHeight,o=this._getClosestScrolledSectionBaseId(t,i),n=this.oCore.byId(o),r=l._getClosestSection(n);return r&&e===r.getId()},R.prototype._hasOngoingScrollToSection=function(e){return this._oScroller._$Container&&this._oScroller._$Container.is(":animated")&&this.getOngoingScrollToSectionBaseId()},R.prototype._setSelectedSectionId=function(e){var t=this.getAggregation("_anchorBar"),i=e&&this._oSectionInfo[e];i&&t&&i.buttonId&&(t.setSelectedButton(i.buttonId),this.setAssociation("selectedSection",e,!0))},R.prototype.isFirstRendering=function(){return this._bFirstRendering},R.prototype._cleanMemory=function(){var e=this.getAggregation("_anchorBar");e&&e._resetControl(),this._oSectionInfo={},this._aSectionBases=[]},R.prototype._registerSectionBaseInfo=function(e){this._oSectionInfo[e.getId()]={$dom:[],positionTop:0,buttonId:"",isSection:e instanceof l,sectionReference:e},this._aSectionBases.push(e)},R.prototype._triggerVisibleSubSectionsEvents=function(){this._bDelayDOMBasedCalculations=!1,this.getEnableLazyLoading()&&this._oLazyLoading&&this._oLazyLoading._triggerVisibleSubSectionsEvents()},R.prototype.scrollToSection=function(e,t,o,n,r){var s,a,h,d,g,_,p=this.oCore.byId(e),u=i.getAnimationMode()!==i.AnimationMode.none;if(this.getDomRef())if(p)if(this._oSectionInfo[e]&&p._getInternalVisible())if(this.bIsDestroyed)y.debug("ObjectPageLayout :: scrollToSection","scrolling canceled as page is being destroyed");else{if(this.getUseIconTabBar()){var S=l._getClosestSection(p),b=this._bAllContentFitsContainer;this._bAllContentFitsContainer=this._hasSingleVisibleFullscreenSubSection(S),this._bAllContentFitsContainer!==b&&!this._bHeaderExpanded&&(this._snapHeader(!this._bAllContentFitsContainer),this._bSupressModifyOnScrollOnce=!0),this._oCurrentTabSection&&this._oCurrentTabSection._allowPropagationToLoadedViews(!1),S._allowPropagationToLoadedViews(!0),this._setCurrentTabSection(p),this.getAggregation("_anchorBar").setSelectedButton(this._oSectionInfo[S.getId()].buttonId),this.setAssociation("selectedSection",S.getId(),!0),this._checkSubSectionVisibilityChange()}a=p instanceof c?p:this._getFirstVisibleSubSection(p),!this._bHeaderInTitleArea||this._shouldPreserveHeaderInTitleArea()||this._bAllContentFitsContainer||(this._moveHeaderToContentArea(),this._toggleHeaderTitle(!1),this._bHeaderExpanded=!1,this._updateToggleHeaderVisualIndicators()),o=o||0,p._expandSection(),this._requestAdjustLayout(!0),t=this._computeScrollDuration(t,p),h=u&&t>0;var T=this._computeScrollPosition(p);(this._sCurrentScrollId!=e||r)&&(this._sCurrentScrollId=e,this._iCurrentScrollTimeout&&(clearTimeout(this._iCurrentScrollTimeout),this._$contentContainer&&this._$contentContainer.parent().stop(!0,!1)),this._bDomElementsCached&&(this._iCurrentScrollTimeout=setTimeout(function(){this._sCurrentScrollId=void 0,this._iCurrentScrollTimeout=void 0}.bind(this),t)),this._preloadSectionsOnBeforeScroll(p),T+=o,!this._bStickyAnchorBar&&this._shouldSnapHeaderOnScroll(T)&&(s=this._getSnapPosition(),this._scrollTo(s,0),0===s&&this._toggleHeader(!0)),d=h&&this.getEnableLazyLoading()&&this._oLazyLoading,g=function(e,t,i){t&&this.setOngoingScrollToSectionBaseId(e),i&&this._oLazyLoading.suppress()}.bind(this,e,h,d),_=function(e){e===this.getOngoingScrollToSectionBaseId()&&(this.setOngoingScrollToSectionBaseId(null),this._resumeLazyLoading())}.bind(this,e),this._scrollTo(T,t,g,_),n&&this.fireNavigate({section:l._getClosestSection(p),subSection:a}))}else y.warning("scrollToSection aborted: section is hidden by UX rules",e,this);else y.warning("scrollToSection aborted: unknown section",e,this);else y.warning("scrollToSection can only be used after the ObjectPage is rendered",this)},R.prototype.onAnchorBarTabPress=function(e){var t,i,o=sap.ui.getCore().byId(e.getParameter("sectionBaseId")),n=o instanceof S.ObjectPageSubSection;o&&(t=n?o.getParent():o,i=n?o:this._getFirstVisibleSubSection(o),this.fireBeforeNavigate({section:t,subSection:i})&&(this.setDirectScrollingToSection(t.getId()),this.scrollToSection(o.getId(),null,0,!0),t.setAssociation("selectedSubSection",i,!0),this.setAssociation("selectedSection",t,!0)))},R.prototype._hasSingleVisibleFullscreenSubSection=function(e){var t=e.getSubSections().filter((function(e){return e.getVisible()&&e._getInternalVisible()&&e.getBlocks().length>0}));return 1===t.length&&t[0].hasStyleClass(c.FIT_CONTAINER_CLASS)},R.prototype._computeScrollDuration=function(e,t){var i=parseInt(e);return i=i>=0?i:this._iScrollToSectionDuration,this.getUseIconTabBar()&&(t instanceof l||this._isFirstVisibleSectionBase(t))&&this._bStickyAnchorBar&&(i=0),i},R.prototype._computeScrollPosition=function(e){var t=this._oSectionInfo[e.getId()].positionTop;return!this._bStickyAnchorBar&&this._isFirstVisibleSectionBase(e)&&(t=0),t},R.prototype._preloadSectionsOnBeforeScroll=function(e){var t,i=e.getId();if(!this.getEnableLazyLoading()&&this.getUseIconTabBar()&&(t=e instanceof l?e:e.getParent(),this._connectModelsForSections([t])),this.getEnableLazyLoading()){var o=this.getUseIconTabBar()?this._grepCurrentTabSectionBases():this._aSectionBases;t=this._oLazyLoading.getSubsectionsToPreload(o,i),r.system.desktop?setTimeout(function(){this._connectModelsForSections(t),this._fireSubSectionEnteredViewPortEvent(t)}.bind(this),50):(this._connectModelsForSections(t),this._fireSubSectionEnteredViewPortEvent(t))}},R.prototype._fireSubSectionEnteredViewPortEvent=function(e){e.forEach((function(e){this.fireEvent("subSectionEnteredViewPort",{subSection:e})}),this)},R.prototype.getScrollingSectionId=function(){return this._sScrolledSectionId},R.prototype.setDirectScrollingToSection=function(e){this.sDirectSectionId=e},R.prototype.getDirectScrollingToSection=function(){return this.sDirectSectionId},R.prototype.setOngoingScrollToSectionBaseId=function(e){this.sOngoingScrollToSectionBaseId=e},R.prototype.getOngoingScrollToSectionBaseId=function(){return this.sOngoingScrollToSectionBaseId},R.prototype.clearDirectScrollingToSection=function(){this.sDirectSectionId=null},R.prototype._scrollTo=function(e,t,i,o){return this._oScroller&&this._bDomReady&&!this._bSuppressScroll&&(y.debug("ObjectPageLayout :: scrolling to "+e),0===t&&this._shouldSnapHeaderOnScroll(e)&&this._toggleHeader(!0),i&&i(),this._oScroller.scrollTo(0,e,t,o)),this},R.prototype._resumeLazyLoading=function(){this._oLazyLoading&&(this._oLazyLoading.resume(),this._oLazyLoading.lazyLoadDuringScroll(!0))},R.prototype._scrollBelowCollapseVisualIndicator=function(){var e,t,i,o,n=this._getHeaderContent();D(n)&&D(this._$opWrapper)&&(t=(e=n._getCollapseButton().getDomRef()).getBoundingClientRect().height,i=this._$opWrapper[0].getBoundingClientRect().height,o=e.offsetTop+t-i,this._scrollTo(o))},R.prototype._updateMedia=function(e,t){if(e){var i=function(e){Object.keys(t).forEach((function(i){var o=t[i],n=e===o;this.toggleStyleClass(o,n)}),this)}.bind(this),o=R.BREAK_POINTS;e<=o.PHONE?i(t.PHONE):e<=o.TABLET?i(t.TABLET):e<=o.DESKTOP?i(t.DESKTOP):i(t.DESKTOP_XL)}},R.prototype._updateScreenHeightSectionBasesAndSpacer=function(){var e,t,i,o,n,r,s,a,h,d=this._bHeaderInTitleArea||!this._bHeaderExpanded,g=this.getDomRef(),_=this.getUseIconTabBar(),p=this.oCore.byId(this.getSelectedSection());if(!g||!this._bDomReady)return!1;if(y.debug("ObjectPageLayout :: _updateScreenHeightSectionBasesAndSpacer","re-evaluating dom positions"),this.iScreenHeight=this._getDOMRefHeight(g),0!==this.iScreenHeight){_&&p&&(this._bAllContentFitsContainer=this._hasSingleVisibleFullscreenSubSection(p)),this.iFooterHeight=this._getFooterHeight();var u=-1;return this._aSectionBases.forEach((function(e){var i,r=this._oSectionInfo[e.getId()],d=e.$(),g=!1;if(r&&d.length){r.isSection||u++,r.$dom=d;var p=S.Utilities.getChildPosition(d,this._$contentContainer).top;if(r.positionTop=Math.ceil(p),!r.isSection&&(i=e.getParent())&&(g=e._getTitleDomId()===i.getId()+"-title")){var b=i.$().position().top;r.positionTop=Math.ceil(b)}if(this._bStickyAnchorBar||this._bHeaderInTitleArea||(r.positionTop-=this.iAnchorBarHeight),r.sectionReference.toggleStyleClass("sapUxAPObjectPageSubSectionPromoted",g),this._bMobileScenario){var y=e.getParent();if(y instanceof l&&y._getIsHidden())return;n&&(this._oSectionInfo[n].positionBottom=r.positionTop),n=e.getId(),t=e}else r.isSection?(n&&(this._oSectionInfo[n].positionBottom=r.positionTop,o&&(this._oSectionInfo[o].positionBottom=r.positionTop)),n=e.getId(),o=null):(o&&(this._oSectionInfo[o].positionBottom=r.positionTop),o=e.getId(),t=e);r.isSection||(a=_||e.getParent()===this._oFirstVisibleSection,s=a&&0===u,h=e.hasStyleClass(c.FIT_CONTAINER_CLASS),e._setHeight(this._computeSubSectionHeight(s,h,e)))}}),this),t&&(e=this._computeLastVisibleHeight(t),this._bMobileScenario&&n?this._oSectionInfo[n].positionBottom=this._oSectionInfo[n].positionTop+e:(o&&(this._oSectionInfo[o].positionBottom=this._oSectionInfo[o].positionTop+e),n&&o&&(this._oSectionInfo[n].positionBottom=this._oSectionInfo[o].positionTop+e)),r=this._bStickyAnchorBar||u>0||this._checkContentBottomRequiresSnap(t),this._bAllContentFitsContainer&&(r=!1),r&&!this._shouldPreserveHeaderInTitleArea()&&(d=!0),i=this._computeSpacerHeight(t,e,r,d),this._$spacer.height(i+"px"),y.debug("ObjectPageLayout :: bottom spacer is now "+i+"px"),C(this._oScrollContainerLastState,{iScrollableContentLength:Math.round(this._getScrollableContentLength()),iSpacerHeight:i})),this._adjustTitlePositioning(),this._setSectionInfoIsDirty(!1),this._updateSelectionOnScroll(this._$opWrapper.scrollTop()),this._toggleScrolling(this._shouldAllowScrolling()),!0}},R.prototype._computeSubSectionHeight=function(e,t,i){var o,n;if(!t)return"";var r=this._bAllContentFitsContainer?this._bHeaderExpanded:e;return o=this._getSectionsContainerHeight(r),this._bAllContentFitsContainer&&(n=this._$sectionsContainer[0].getBoundingClientRect(),o-=i.getDomRef().getBoundingClientRect().top-n.top+(this.iFooterHeight+this._iREMSize)),o+"px"},R.prototype._computeScrollableContentSize=function(e){var t=0;return this._$contentContainer&&this._$contentContainer.length&&(t=this._$contentContainer[0].scrollHeight),!this._bStickyAnchorBar&&e&&(t-=this.iAnchorBarHeight),this._bStickyAnchorBar&&!e&&(t+=this.iAnchorBarHeight),t},R.prototype._computeLastVisibleHeight=function(e){var t=this._bStickyAnchorBar||this._bHeaderInTitleArea,i=this._getSectionPositionTop(e,t);return Math.floor(this._$spacer.position().top)-i},R.prototype._getStickyAreaHeight=function(e){return e?this.iHeaderTitleHeightStickied+this.iAnchorBarHeight:this.iHeaderTitleHeight},R.prototype._getScrollableViewportHeight=function(e){return this.getDomRef().getBoundingClientRect().height-this._getStickyAreaHeight(e)},R.prototype._getSectionsContainerHeight=function(e){var t=!e,i=this._getScrollableViewportHeight(t);return t||this._bHeaderInTitleArea||(i-=this.iHeaderContentHeight+this.iAnchorBarHeight),i},R.prototype._getSectionPositionTop=function(e,t){var i=this._oSectionInfo[e.getId()].positionTop;return this._bStickyAnchorBar||this._bHeaderInTitleArea||(i+=this.iAnchorBarHeight),i},R.prototype._getSectionPositionBottom=function(e,t){var i=this._oSectionInfo[e.getId()].positionBottom;return t||(i+=this.iAnchorBarHeight),i},R.prototype._determineSectionBaseInternalTitleLevel=function(e,t){var i=this.getSectionTitleLevel(),o=e instanceof l;return i===O.Auto?o||t&&!o?O.H3:O.H4:o?i:R._getNextTitleLevelEntry(i)},R.prototype._shouldApplySectionTitleLevel=function(e){return e.getTitleLevel()===O.Auto},R.prototype._checkContentBottomRequiresSnap=function(e){return this._getSectionPositionBottom(e,false)>this._getScrollableViewportHeight(false)+this._getSnapPosition()},R.prototype._computeSpacerHeight=function(e,t,i,o){var n,r;return 1===Object.keys(this._oVisibleSubSections).length&&this._bHeaderExpanded?n=0:(r=this._getScrollableViewportHeight(o),i?(r=Math.ceil(r),t=Math.floor(t)):t=this._$spacer.position().top,n=t<r?r-t:0),this.iFooterHeight>n&&(n+=this.iFooterHeight),n},R.prototype._isFirstVisibleSectionBase=function(e){var t,i,o,n=this.getSelectedSection(),r=this.getUseIconTabBar();if(e&&e.getParent())return t=e.getId(),!(!r||t!==n)||(r&&e.getParent().getId()===n?(i=sap.ui.getCore().byId(n),(o=this._getFirstVisibleSubSection(i))&&o.getId()===t):!(!this._oFirstVisibleSection||!this._oFirstVisibleSubSection)&&(t===this._oFirstVisibleSection.getId()||t===this._oFirstVisibleSubSection.getId()))},R.prototype._getFirstVisibleSubSection=function(e){var t;if(e||(e=this.getUseIconTabBar()?this._oCurrentTabSection:this._oFirstVisibleSection))return this._aSectionBases.every((function(i){return!i.getParent()||i.getParent().getId()!==e.getId()||(t=i,!1)})),t},R.prototype._initAnchorBarScroll=function(){var e,t=this.oCore.byId(this.getSelectedSection());this._requestAdjustLayout(!0),e=t?this._computeScrollPosition(t):0,this._sScrolledSectionId="",this._sCurrentScrollId="",this._onScroll({target:{scrollTop:e}},!0)},R.prototype._setAsCurrentSection=function(e){var t,i,o;this._sScrolledSectionId!==e&&(y.debug("ObjectPageLayout :: current section is "+e),this._sScrolledSectionId=e,o=(t=this.getAggregation("_anchorBar"))&&this._getInternalAnchorBarVisible(),(i=this.oCore.byId(e))&&i instanceof c&&(""===i.getTitle().trim()||!i._getInternalTitleVisible()||i.getParent()._getIsHidden())&&(e=i.getParent().getId(),y.debug("ObjectPageLayout :: current section is a subSection with an empty or hidden title, selecting parent "+e)),i&&this._oSectionInfo[e]&&(o&&t.setSelectedButton(this._oSectionInfo[e].buttonId),this.setAssociation("selectedSection",l._getClosestSection(e).getId(),!0),this._setSectionsFocusValues(e)))},R.prototype._registerOnContentResize=function(){var e=this._$contentContainer.length&&this._$contentContainer[0];e&&(this._iContentResizeId&&t.deregister(this._iContentResizeId),this._iContentResizeId=t.register(e,this._onUpdateContentSize.bind(this)))},R.prototype._onUpdateContentSize=function(e){var t=e.size;this.iContentHeight=t.height,0!==t.height&&0!==t.width?(this.getPreserveHeaderStateOnScroll()&&this._overridePreserveHeaderStateOnScroll(),this._adjustHeaderHeights(),this._requestAdjustLayout(!0)):y.info("ObjectPageLayout :: not triggering calculations if height or width is 0")},R.prototype.triggerPendingLayoutUpdates=function(){this._hasPendingLayoutUpdate()&&this._requestAdjustLayout(!0)},R.prototype._hasPendingLayoutUpdate=function(){return this._oLayoutTask&&this._oLayoutTask.isPending()||this._$contentContainer.length&&this._$contentContainer.get(0).offsetHeight!==this.iContentHeight},R.prototype._adjustTitlePositioning=function(e){if(this._$titleArea.length&&this._$opWrapper.length){var t,i=this._$opWrapper.get(0),o=this._$titleArea.get(0),n=o.getBoundingClientRect().height,r=o.getBoundingClientRect().width,s=H().width;i.style.paddingTop=n+"px",i.style.scrollPaddingTop=n+"px",this._oScroller&&this._oScroller.setScrollPaddingTop(n),t="polygon(0px "+n+"px, "+Math.floor(r)+"px "+n+"px, "+Math.floor(r)+"px 0, 100% 0, 100% 100%, 0 100%)",this.oCore.getConfiguration().getRTL()&&(t="polygon(0px 0px, "+s+"px 0px, "+s+"px "+n+"px, 100% "+n+"px, 100% 100%, 0 100%)"),i.style.clipPath=t,this.getHeaderTitle()&&this._shiftHeaderTitle()}},R.prototype._onUpdateScreenSize=function(e){var t,i=this.getHeaderTitle(),o=this._getHeaderContent(),n=e.size.width,r=e.size.height,s=e.oldSize.height,a=r!==s,h=o&&o.supportsAlwaysExpanded()&&this.getAlwaysShowContentHeader();0!==e.size.height&&0!==e.size.width?(this._bMobileScenario=S.Utilities.isPhoneScenario(this._getCurrentMediaContainerRange()),this._bTabletScenario=S.Utilities.isTabletScenario(this._getCurrentMediaContainerRange()),this._bDomReady?(this._oLazyLoading.setLazyLoadingParameters(),setTimeout(function(){h&&this._bHeaderInTitleArea!=this._checkAlwaysShowContentHeader()&&this.invalidate(),this._bHeaderInTitleArea&&this._headerBiggerThanAllowedToBeExpandedInTitleArea()?(this._isHeaderPinnable()&&this._updatePinButtonState(),this._expandHeader(!1),this._scrollTo(0,0)):this._isHeaderPinnable()&&!this._headerBiggerThanAllowedToBeExpandedInTitleArea()&&this._updatePinButtonState(),i&&i.isDynamic()&&(i._onResize(n),this._updateMedia(n,R.DYNAMIC_HEADERS_MEDIA)),this._updateMedia(n,R.MEDIA),this._adjustHeaderHeights(),this._requestAdjustLayout(!0),this.getFooter()&&this.getShowFooter()&&this._shiftFooter(),t=this.getSelectedSection(),0===s&&a&&!this._isClosestScrolledSection(t)&&(null!==t?this.scrollToSection(t,0):this._selectFirstVisibleSection()),this._scrollTo(this._$opWrapper.scrollTop(),0),0===s&&a&&this.getEnableLazyLoading()&&this._oLazyLoading&&!this._bDelayDOMBasedCalculations&&this._oLazyLoading.doLazyLoading()}.bind(this),this._getDOMCalculationDelay())):y.info("ObjectPageLayout :: cannot _onUpdateScreenSize before dom is ready")):y.info("ObjectPageLayout :: not triggering calculations if height or width is 0")},R.prototype._onUpdateHeaderTitleSize=function(e){0!==e.size.height&&0!==e.size.width?this._bDomReady?(this._adjustHeaderHeights(),this._requestAdjustLayout()):y.info("ObjectPageLayout :: cannot _onUpdateTitleSize before dom is ready"):y.info("ObjectPageLayout :: not triggering calculations if height or width is 0")},R.prototype._applyContextualSettings=function(e){var t=e.contextualWidth;return this._hasDynamicTitle()&&this._updateMedia(t,R.DYNAMIC_HEADERS_MEDIA),this._updateMedia(t,R.MEDIA),s.prototype._applyContextualSettings.call(this,e)},R.prototype._shouldSnapHeaderOnScroll=function(e){return e>0&&e>=this._getSnapPosition()&&!this._shouldPreserveHeaderInTitleArea()},R.prototype._getScrollableContentLength=function(){return this._$contentContainer.length?this._getDOMRefHeight(this._$contentContainer[0]):0},R.prototype._isContentScrolledToBottom=function(){return this._oScrollContainerLastState.iScrollableContentLength<=this._oScrollContainerLastState.iScrollTop+this._oScrollContainerLastState.iScrollableViewportHeight},R.prototype._isContentLengthDecreased=function(e){if(e)return e.iScrollableContentLength>this._oScrollContainerLastState.iScrollableContentLength&&e.iSpacerHeight===this._oScrollContainerLastState.iSpacerHeight},R.prototype._canReachScrollTop=function(e,t){return t=t||0,this._oScrollContainerLastState.iScrollableContentLength+t+this._$contentContainer.get(0).offsetTop-this._oScrollContainerLastState.iScrollableViewportHeight>=e},R.prototype._deregisterCustomEvents=function(){this._$opWrapper.length&&this._$opWrapper.off(".OPL")},R.prototype._deregisterScreenSizeListener=function(){this._iResizeId&&(t.deregister(this._iResizeId),this._iResizeId=null)},R.prototype._deregisterTitleSizeListener=function(){this._iTitleResizeId&&(t.deregister(this._iTitleResizeId),this._iTitleResizeId=null)},R.prototype._onScroll=function(e,t){var i,o=Math.max(Math.ceil(e.target.scrollTop),0),n=this._$opWrapper.length&&this._$opWrapper[0],r=this._$spacer.length&&this._$spacer[0],s=this._$spacer.height(),a=this.getHeaderTitle(),h=this._shouldSnapHeaderOnScroll(o),l=this._shouldPreserveHeaderInTitleArea(),c=!1,d=this._oScrollContainerLastState;if(this._oScrollContainerLastState={iScrollTop:o,iScrollableContentLength:Math.round(this._getScrollableContentLength()),iScrollableViewportHeight:n.offsetHeight,iSpacerHeight:s},(!this._bSupressModifyOnScrollOnce||(this._bSupressModifyOnScrollOnce=!1,t))&&n&&r&&0!==(i=this.iScreenHeight)&&!this._getSectionInfoIsDirty()){if(d&&this._isContentScrolledToBottom()&&this._isContentLengthDecreased(d)){var g=d.iScrollableContentLength-this._oScrollContainerLastState.iScrollableContentLength;if(!this._canReachScrollTop(d.iScrollTop)&&this._canReachScrollTop(d.iScrollTop,g)){var _,p=d.iScrollTop+this._oScrollContainerLastState.iScrollableViewportHeight-this._oScrollContainerLastState.iScrollableContentLength;if(p>0)return _=s+p,this._$spacer.height(_+"px"),void this._scrollTo(d.iScrollTop)}}h&&!l&&(i-=this.iAnchorBarHeight+this.iHeaderTitleHeightStickied),this._bHeaderInTitleArea&&!l&&(this._moveHeaderToContentArea(),this._toggleHeaderTitle(!1),this._bHeaderExpanded=!1,this._updateToggleHeaderVisualIndicators(),this._requestAdjustLayout()),!l&&(a&&this.getShowHeaderContent()||this.getShowAnchorBar())&&this._toggleHeader(h,!(!e||"scroll"!==e.type)),l||this._adjustHeaderTitleBackgroundPosition(o),y.debug("ObjectPageLayout :: lazy loading : Scrolling at "+o,"----------------------------------------"),this._updateSelectionOnScroll(o),this.getEnableLazyLoading()&&this._oLazyLoading.lazyLoadDuringScroll(t,o,e.timeStamp,i),a&&a.supportsTitleInHeaderContent()&&this.getShowHeaderContent()&&this.getShowTitleInHeaderContent()&&a.getShowTitleSelector()&&(0===o?(this.$("scroll").css("z-index","1000"),c=!1):c||(c=!0,this.$("scroll").css("z-index","0")))}},R.prototype._updateSelectionOnScroll=function(e){var t,i,o,n,r=this.iScreenHeight;if(0!==r&&(t=this._getClosestScrolledSectionBaseId(e,r),o=(i=l._getClosestSection(t))?i.getId():null,n=this._getClosestScrolledSectionBaseId(e,r,!0),t)){var s=this.getDirectScrollingToSection(),a=this.oCore.byId(s);if(t!==this._sScrolledSectionId){if(y.debug("ObjectPageLayout :: closest id "+t,"----------------------------------------"),(s=this.getDirectScrollingToSection())&&s!==o&&a&&a.getDomRef()&&!this.isFirstRendering())return;this.clearDirectScrollingToSection(),this._setAsCurrentSection(t)}else o===this.getDirectScrollingToSection()&&this.clearDirectScrollingToSection();if(n!==this._sScrolledSubSectionId){var h=l._getClosestSection(t),c=this.oCore.byId(n);this._sScrolledSubSectionId=n,this.fireEvent("_sectionChange",{section:h,subSection:c}),this.fireEvent("sectionChange",{section:h,subSection:c})}}},R.prototype._getSnapPosition=function(){var e=this.iHeaderContentHeight,t=this._getTitleHeightDelta();return e-=Math.max(t,this._iHeaderContentPaddingBottom)},R.prototype._getTitleHeightDelta=function(){var e=this.iHeaderTitleHeightStickied-this.iHeaderTitleHeight;return e=Math.max(e,0),e=Math.min(e,R.MAX_SNAP_POSITION_OFFSET)},R.prototype._getClosestScrolledSectionBaseId=function(e,t,i){i=!!i;var o,n=(e=Math.ceil(e))+t,r=i||this._bMobileScenario;return jQuery.each(this._oSectionInfo,function(t,s){var a,h,c,d,g=this.getSelectedSection();if(h=(a=s.sectionReference.getParent())instanceof l&&a._getIsHidden(),this.getUseIconTabBar()&&g){if(!(d=this.oCore.byId(g)))return;if(s.isSection&&s.sectionReference!=d)return!0;if(!s.isSection&&d.indexOfSubSection(s.sectionReference)<0)return!0}if(s.isSection||r&&!h){if(o||!0!==s.sectionReference._getInternalVisible()||(c=this._getFirstVisibleSubSection(s.sectionReference),o=s.isSection&&i&&c?c.getId():t),s.isSection&&i)return!0;s.positionTop<=n&&e<=s.positionBottom&&s.positionTop<=e+1&&s.positionBottom>e&&(o=t)}}.bind(this)),this.oCore.byId(o)?o:null},R.prototype._toggleHeader=function(e,t){var i;e!==this._bStickyAnchorBar&&(i=this.getHeaderTitle(),this._shouldPreserveHeaderInTitleArea()||this._bHeaderInTitleArea||this._toggleHeaderTitle(!e,t),!this._bStickyAnchorBar&&e?(this._restoreFocusAfter(this._moveAnchorBarToTitleArea),i&&i.snap(),this._bHeaderExpanded=!1,this._adjustHeaderHeights(),this._updateToggleHeaderVisualIndicators()):this._bStickyAnchorBar&&!e&&(this._restoreFocusAfter(this._moveAnchorBarToContentArea),i&&i.unSnap(),this._bHeaderExpanded=!0,this._adjustHeaderHeights(),this._updateToggleHeaderVisualIndicators(),this._isHeaderPinnable()&&this._getHeaderContent()._getPinButton().setVisible(!this._headerBiggerThanAllowedToBeExpandedInTitleArea())))},R.prototype._restoreFocusAfter=function(e){var t=this.oCore.byId(this.oCore.getCurrentFocusedControlId());return e.call(this),!0!==r.system.phone&&(this.oCore.byId(this.oCore.getCurrentFocusedControlId())||t&&t.$().trigger("focus")),this},R.prototype._moveAnchorBarToTitleArea=function(){return this._$anchorBar.children().appendTo(this._$stickyAnchorBar),this._toggleHeaderStyleRules(!0),this.iHeaderTitleHeight!=this.iHeaderTitleHeightStickied&&this._adjustHeaderBackgroundSize(),this},R.prototype._moveAnchorBarToContentArea=function(){if(!this._shouldPreserveHeaderInTitleArea()){var e=this._$opWrapper.scrollTop();this._$anchorBar.css("height","auto").append(this._$stickyAnchorBar.children()),this._$opWrapper.scrollTop(e),this._toggleHeaderStyleRules(!1)}return this},R.prototype._toggleHeaderStyleRules=function(e){var t=(e=!!e)?"hidden":"inherit";this._bStickyAnchorBar=e,this._$headerContent.css("overflow",t),this._$headerContent.toggleClass("sapContrastPlus",!e),this._$headerContent.toggleClass("sapUxAPObjectPageHeaderDetailsHidden",e),this._$anchorBar.css("visibility",t),D(this._$stickyAnchorBar)&&this._$stickyAnchorBar.attr("aria-hidden",!e),this.fireToggleAnchorBar({fixed:e}),e||this.iAnchorBarHeight||this._requestAdjustLayout()},R.prototype.getScrollDelegate=function(){return this._oScroller},R.prototype.setHeaderTitle=function(t,i){return t&&"function"==typeof t.addEventDelegate&&t.addEventDelegate({onAfterRendering:this._onAfterHeaderTitleRendering.bind(this)}),this.setAggregation("headerTitle",t,i),this._oObserver&&this._oObserver.disconnect(),this._oObserver=new e(this._onModifyHeaderTitle.bind(this)),this._oObserver.observe(t,{aggregations:["headerTitle"],properties:["backgroundDesign"]}),t&&this._createHeaderContent(),this._hasDynamicTitle()&&(this._iHeaderContentPaddingBottom=R.HEADER_CONTENT_PADDING_BOTTOM),this},R.prototype._onAfterHeaderTitleRendering=function(){var e,t=this.getHeaderTitle(),i=t&&t.$();t&&i.length&&(e=i.height())!==this._iCachedHeaderTitleHeight&&(this._adjustHeaderHeights(),this._iCachedHeaderTitleHeight=e)},R.prototype._onModifyHeaderTitle=function(e){var t=this.getAggregation("_headerContent");t&&e.current&&t.setBackgroundDesign(e.current)},R.prototype.invalidate=function(e){this._bInvalidatedAndNotRerendered=!0,this.getUseIconTabBar()&&e&&e instanceof l&&!e.isActive()&&this._oSectionInfo[e.getId()]||(this._iAfterRenderingDomReadyTimeout&&(clearTimeout(this._iAfterRenderingDomReadyTimeout),this._iAfterRenderingDomReadyTimeout=null),o.prototype.invalidate.apply(this,arguments))},R.prototype._createHeaderContent=function(){var e,t,i=this.getHeaderTitle(),o=this.getAggregation("_headerContent"),n=i?i.getCompatibleHeaderContentClass():d;o instanceof n||((e=this.getAggregation("_headerContent"))&&e.destroy(),(t=n.createInstance(this.getAggregation("headerContent"),this.getShowHeaderContent(),"",this.getHeaderContentPinnable(),this.getId()+"-OPHeaderContent")).getContent().forEach(this._replaceHeaderContentParent,this),this.setAggregation("_headerContent",t,!0))},R.prototype._adjustHeaderBackgroundSize=function(){var e=this.getHeaderTitle();e&&"Dark"==e.getHeaderDesign()&&(this._shouldPreserveHeaderInTitleArea()?(this.iTotalHeaderSize=this.iHeaderTitleHeight-this._$stickyAnchorBar.height(),this._$stickyHeaderContent.css("background-size","100% "+this.iTotalHeaderSize+"px")):(this.iTotalHeaderSize=this.iHeaderTitleHeight+this.iHeaderContentHeight,this._$headerContent.css("background-size","100% "+this.iTotalHeaderSize+"px")),e.$().css("background-size","100% "+this.iTotalHeaderSize+"px"),this._adjustHeaderTitleBackgroundPosition(0))},R.prototype._adjustHeaderTitleBackgroundPosition=function(e){var t=this.getHeaderTitle();t&&"Dark"==t.getHeaderDesign()&&(this._bStickyAnchorBar?t.$().css("background-position","0px "+-1*(this.iTotalHeaderSize-this.iHeaderTitleHeightStickied)+"px"):this._shouldPreserveHeaderInTitleArea()?t.$().css("background-position","0px 0px"):t.$().css("background-position","0px "+(this.iHeaderTitleHeight+this.iHeaderContentHeight-this.iTotalHeaderSize-e)+"px"))},R.prototype._adjustHeaderHeights=function(){var e=this.getHeaderTitle(),t=!0;e&&!e.supportsAdaptLayoutForDomElement()&&(t=!1),this._$titleArea.length>0?(this.iHeaderContentHeight=this._$headerContent.length?Math.round(this._getDOMRefHeight(this._$headerContent[0])):0,this.iStickyHeaderContentHeight=this._$stickyHeaderContent.height(),this.iAnchorBarHeight=this._bStickyAnchorBar?this._$stickyAnchorBar.outerHeight():this._$anchorBar.outerHeight(),this._bHeaderExpanded?(this.iHeaderTitleHeight=this._$titleArea.is(":visible")?this._$titleArea.height():0,this.iHeaderTitleHeightStickied=this._obtainSnappedTitleHeight(t)):(this.iHeaderTitleHeightStickied=this._$titleArea.height()-this.iAnchorBarHeight,this.iHeaderTitleHeight=this._obtainExpandedTitleHeight(t)),this._adjustHeaderBackgroundSize(),this._adjustTitlePositioning(),y.info("ObjectPageLayout :: adjustHeaderHeight","headerTitleHeight: "+this.iHeaderTitleHeight+" - headerTitleStickiedHeight: "+this.iHeaderTitleHeightStickied+" - headerContentHeight: "+this.iHeaderContentHeight)):y.debug("ObjectPageLayout :: adjustHeaderHeight","skipped as the objectPageLayout is being rendered")},R.prototype._appendTitleCloneToDOM=function(e){var t=this.getHeaderTitle().$(),i=t.clone();return i.css({left:"-10000px",top:"-10000px",width:t.width()+"px",position:"absolute"}),i.toggleClass("sapUxAPObjectPageHeaderStickied",e),i.appendTo(this._$titleArea.parent()),e&&this.getHeaderTitle()&&this.getHeaderTitle()._adaptObjectPageHeaderIndentifierLine(i),i},R.prototype._obtainSnappedTitleHeight=function(e){var t,i,o=this.getHeaderTitle();return o?(e?(i=(t=this._appendTitleCloneToDOM(!0)).height(),t.remove()):o.snap&&(i=this._obtainTitleHeightViaStateChange(!0)),i):0},R.prototype._obtainExpandedTitleHeight=function(e){var t,i,o=this.getHeaderTitle();return o?(e?(i=(t=this._appendTitleCloneToDOM(!1)).is(":visible")?t.height():0,t.remove()):o.unSnap&&(i=this._obtainTitleHeightViaStateChange(!1)),i):0},R.prototype._obtainTitleHeightViaStateChange=function(e){var t,i,o=this.getHeaderTitle(),n=this._$sectionsContainer.height(),r=e?o.snap:o.unSnap,s=e?o.unSnap:o.snap;return r.call(o,!1),t=o.$().outerHeight(),s.call(o,!1),i=this._$sectionsContainer.height(),this._adjustSpacerHeightUponUnsnapping(n,i),t},R.prototype._adjustSpacerHeightUponUnsnapping=function(e,t){var i;e!=t&&(i=this._$spacer.height()-(t-e),this._$spacer.height(i))},R.prototype._getHeaderDesign=function(){var e=this.getHeaderTitle(),t=S.ObjectPageHeaderDesign.Light;return null!=e&&(t=e.getHeaderDesign()),t},R.prototype._getVisibleSections=function(){return this.getSections().filter((function(e){return e.getVisible()&&e._getInternalVisible()}))},R.prototype._setSectionsFocusValues=function(e){var t,i,o=this._getVisibleSections()||[],n="tabindex",r=o[0];return o.forEach((function(o){t=o.$(),e===o.getId()?(t.attr(n,"0"),i=o,o._setSubSectionsFocusValues()):(t.attr(n,"-1"),o._disableSubSectionsFocus())})),!i&&o.length>0&&(r.$().attr(n,"0"),r._setSubSectionsFocusValues(),i=r),i},R.prototype.setShowHeaderContent=function(e){var t,i=this.getShowHeaderContent();return i!==e&&(i&&this._bHeaderInTitleArea&&!this._shouldPreserveHeaderInTitleArea()&&(this._moveHeaderToContentArea(),this._toggleHeaderTitle(!1)),this.setProperty("showHeaderContent",e,!0),this._updateTitleVisualState(),t=this._getHeaderContent(),this.$().toggleClass("sapUxAPObjectPageLayoutNoHeaderContent",!e||!t),t&&t.setProperty("visible",e)),this},R.prototype._headerTitleChangeHandler=function(e){var t;this.getShowTitleInHeaderContent()&&(e&&this._getHeaderContent()._destroyObjectImage(!0),t=this.oCore.createRenderManager(),this.getRenderer()._rerenderHeaderContentArea(t,this),this._getHeaderContent().invalidate(),t.destroy())},R.prototype._replaceHeaderContentParent=function(e){if(e.getParent().isA(["sap.uxap.ObjectPageHeaderContent","sap.uxap.ObjectPageDynamicHeaderContent"])){if(e.isA(["sap.uxap.ObjectPageHeaderContent","sap.uxap.ObjectPageDynamicHeaderContent"]))return;if(e._sOriginalParentAggregationName)return;e._sOriginalParentAggregationName=e.sParentAggregationName,e.sParentAggregationName="headerContent",e.getParent=function(){return this}.bind(this),e.destroy=function(){this._restoreParent(e),e.getMetadata().getClass().prototype.destroy.apply(e,arguments)}.bind(this)}},R.prototype._restoreParent=function(e){e&&e._sOriginalParentAggregationName&&(e.sParentAggregationName=e._sOriginalParentAggregationName,e.getParent=e.getMetadata().getClass().prototype.getParent,e.destroy=e.getMetadata().getClass().prototype.destroy,e._sOriginalParentAggregationName=null)},R.prototype.getHeaderContent=function(){return this._getHeaderContent()?this._getHeaderContent().getAggregation("content",[]):this.getAggregation("headerContent",[])},R.prototype.insertHeaderContent=function(e,t,i){return this._getHeaderContent()?(this._getHeaderContent().insertAggregation("content",e,t,i),this._replaceHeaderContentParent(e),this):this.insertAggregation("headerContent",e,t,i)},R.prototype.addHeaderContent=function(e,t){return this._getHeaderContent()?(this._getHeaderContent().addAggregation("content",e,t),this._replaceHeaderContentParent(e),this):this.addAggregation("headerContent",e,t)},R.prototype.removeAllHeaderContent=function(e){var t;return this._getHeaderContent()?((t=this._getHeaderContent().removeAllAggregation("content",e)).forEach((function(e){this._restoreParent(e)}),this),t):this.removeAllAggregation("headerContent",e)},R.prototype.removeHeaderContent=function(e,t){return this._getHeaderContent()?(this._getHeaderContent().removeAggregation("content",e,t),this._restoreParent(e),this):this.removeAggregation("headerContent",e,t)},R.prototype.destroyHeaderContent=function(e){return this._getHeaderContent()?this._getHeaderContent().destroyAggregation("content",e):this.destroyAggregation("headerContent",e)},R.prototype.indexOfHeaderContent=function(e){return this._getHeaderContent()?this._getHeaderContent().indexOfAggregation("content",e):this.indexOfAggregation("headerContent",e)},R.prototype._getHeaderContent=function(){return this.getAggregation("_headerContent")},R.prototype._getHeaderContentDomRef=function(){var e=this._getHeaderContent();return e&&this.getShowHeaderContent()?this._bStickyAnchorBar&&!this._bHeaderInTitleArea?this.$().find(".sapUxAPObjectPageHeaderTitle .sapUxAPObjectPageHeaderDetails").get(0):e.getDomRef():null},R.prototype._connectModelsForSections=function(e){(e=e||[]).forEach((function(e){e.connectToModels()}))},R.prototype._getHeightRelatedParameters=function(){return{iHeaderContentHeight:this.iHeaderContentHeight,iScreenHeight:this.iScreenHeight,iAnchorBarHeight:this.iAnchorBarHeight,iHeaderTitleHeightStickied:this.iHeaderTitleHeightStickied,iStickyHeaderContentHeight:this.iStickyHeaderContentHeight,iScrollTop:this._$opWrapper.scrollTop()}},R.prototype._hasVerticalScrollBar=function(){var e=this._$opWrapper.length&&this._$opWrapper.get(0);return e&&e.scrollHeight>e.offsetHeight},R.prototype._shiftHeaderTitle=function(){var e=this._calculateShiftOffset(),t=e.sStyleAttribute,i=e.iMarginalsOffset;this.$().find(".sapUxAPObjectPageHeaderTitle").css(t,i+"px")},R.prototype._isFirstSection=function(e){return e===this._getVisibleSections()[0]},R.prototype._isValidStoredSubSectionInfo=function(){var e,t=this.getSelectedSection(),i=this.oCore.byId(t);return!(!i||!this._oStoredScrolledSubSectionInfo)&&((e=this.oCore.byId(this._oStoredScrolledSubSectionInfo.sSubSectionId))&&this._sectionCanBeRenderedByUXRules(e)&&i.indexOfSubSection(e)>=0)},R.prototype._restoreScrollPosition=function(){var e;this._isValidStoredSubSectionInfo()?(e=this._computeScrollPosition(this.oCore.byId(this._oStoredScrolledSubSectionInfo.sSubSectionId))+this._oStoredScrolledSubSectionInfo.iOffset,this._scrollTo(e,0)):this.scrollToSection(this.getSelectedSection(),0)},R.prototype._storeScrollLocation=function(){if(this.getDomRef()&&this._bDomReady&&this._oScroller){this.triggerPendingLayoutUpdates();var e,t=this._$opWrapper.scrollTop(),i=this._getClosestScrolledSectionBaseId(this._oScroller.getScrollTop(),this.iScreenHeight,!0);i&&(e=t-this._computeScrollPosition(this.oCore.byId(i))),this._iStoredScrollTop=t,this._oStoredScrolledSubSectionInfo={sSubSectionId:i,iOffset:e},this._oCurrentTabSection=null}},R.prototype.onkeyup=function(e){var t,i;e.which===I.TAB&&(i=(t=this.oCore.getCurrentFocusedControlId())&&this.oCore.byId(t))&&this._isFirstSection(i)&&this._scrollTo(0,0)},R.prototype.setShowFooter=function(e){var t=this.setProperty("showFooter",e,!0);return this._toggleFooter(e),this.$().toggleClass("sapUxAPObjectPageLayoutFooterVisible",e),t},R.prototype.destroyFooter=function(){return this._destroyInvisibleText(),this.destroyAggregation("footer")},R.prototype._toggleFooter=function(e){var t=this.getFooter(),o=this.oCore.getConfiguration().getAnimationMode();D(t)&&D(this._$footerWrapper)&&(o!==i.AnimationMode.none&&o!==i.AnimationMode.minimal?this._toggleFooterAnimation(e,t):this._$footerWrapper.toggleClass("sapUiHidden",!e),this._requestAdjustLayout())},R.prototype._toggleFooterAnimation=function(e,t){this._$footerWrapper.on("webkitAnimationEnd animationend",this._onToggleFooterAnimationEnd.bind(this,t)),this._bIsFooterAanimationGoing=!0,e&&this._$footerWrapper.removeClass("sapUiHidden"),t.toggleStyleClass(R.SHOW_FOOTER_CLASS_NAME,e),t.toggleStyleClass(R.HIDE_FOOTER_CLASS_NAME,!e)},R.prototype._onToggleFooterAnimationEnd=function(e){this._$footerWrapper.off("webkitAnimationEnd animationend"),e.hasStyleClass(R.HIDE_FOOTER_CLASS_NAME)?(this._$footerWrapper.addClass("sapUiHidden"),e.removeStyleClass(R.HIDE_FOOTER_CLASS_NAME)):e.removeStyleClass(R.SHOW_FOOTER_CLASS_NAME),this._bIsFooterAanimationGoing=!1},R.prototype.clone=function(){var e,t,i;return Object.keys(this.mAggregations).forEach(this._cloneProxiedAggregations,this),e=o.prototype.clone.apply(this,arguments),t=this._getHeaderContent(),(i=e._getHeaderContent())&&i.destroy(),t&&e.setAggregation("_headerContent",t.clone(),!0),e},R.prototype._cloneProxiedAggregations=function(e){var t=this.mAggregations[e];Array.isArray(t)&&0===t.length&&(t=this["get"+e.charAt(0).toUpperCase()+e.slice(1)]()),this.mAggregations[e]=t},R.prototype._shouldPreserveHeaderInTitleArea=function(){return this._bPinned||this._preserveHeaderStateOnScroll()||this._checkAlwaysShowContentHeader()},R.prototype._checkAlwaysShowContentHeader=function(){return!this._hasDynamicTitle()&&!this._bMobileScenario&&!this._bTabletScenario&&this.getShowHeaderContent()&&this.getAlwaysShowContentHeader()},R.prototype._headerBiggerThanAllowedToBeFixed=function(){var e=this._getOwnHeight();return this._getEntireHeaderHeight()>R.HEADER_MAX_ALLOWED_NON_SROLLABLE_PERCENTAGE*e},R.prototype._headerBiggerThanAllowedToBeExpandedInTitleArea=function(){return this._getEntireHeaderHeight()>=this._getOwnHeight()},R.prototype._getOwnHeight=function(){return this._getHeight(this)},R.prototype._getHeight=function(e){return e instanceof o&&e.$().outerHeight()||0},R.prototype._getEntireHeaderHeight=function(){var e=0,t=0,i=this.getHeaderTitle(),o=this._getHeaderContent();return D(i)&&(e=i.$().outerHeight()),D(o)&&(t=o.$().outerHeight()),e+t},R.prototype._onPinUnpinButtonPress=function(){this._bPinned?this._unPin(!0):(this._pin(!0),this._restorePinButtonFocus())},R.prototype._restorePinButtonFocus=function(){var e=this._getHeaderContent();D(e)&&e.supportsPinUnpin()&&e._focusPinButton()},R.prototype._pin=function(e){this._bPinned||(this._bPinned=!0,e&&(this.setProperty("headerContentPinned",!0,!0),this.fireEvent("headerContentPinnedStateChange",{pinned:!0})),this._toggleHeaderTitle(!0),this._moveAnchorBarToTitleArea(),this._moveHeaderToTitleArea(),this._adjustHeaderHeights(),this._requestAdjustLayout(),this._updateToggleHeaderVisualIndicators(),this.addStyleClass("sapUxAPObjectPageLayoutHeaderPinned"))},R.prototype._unPin=function(e){this._bPinned&&(this._bPinned=!1,e&&(this.setProperty("headerContentPinned",!1,!0),this.fireEvent("headerContentPinnedStateChange",{pinned:!1})),this._updateToggleHeaderVisualIndicators(),this.removeStyleClass("sapUxAPObjectPageLayoutHeaderPinned"))},R.prototype._isHeaderPinnable=function(){var e=this._getHeaderContent();return e&&e.supportsPinUnpin()&&e.getPinnable()},R.prototype._shouldPinUnpinHeader=function(){return this._bHeaderExpanded&&!this.getPreserveHeaderStateOnScroll()&&!this._headerBiggerThanAllowedToBeExpandedInTitleArea()},R.prototype._updatePinButtonState=function(){var e=this._isHeaderPinnable(),t=e&&this.getHeaderContentPinned()&&this._shouldPinUnpinHeader(),i=this._getHeaderContent();i._togglePinButton(t),this.$().toggleClass("sapUxAPObjectPageLayoutHeaderPinnable",e),i._getPinButton().setVisible(!this._headerBiggerThanAllowedToBeExpandedInTitleArea()),t?this._pin():this._unPin()},R.prototype._preserveHeaderStateOnScroll=function(){return this._hasDynamicTitle()&&this.getPreserveHeaderStateOnScroll()&&!this._bHeaderBiggerThanAllowedHeight},R.prototype._overridePreserveHeaderStateOnScroll=function(){var e,t=this._bHeaderBiggerThanAllowedHeight;this._bHeaderBiggerThanAllowedHeight=this._headerBiggerThanAllowedToBeFixed(),e=t!==this._bHeaderBiggerThanAllowedHeight,this._bHeaderBiggerThanAllowedHeight&&e&&(this._bHeaderExpanded?(this._moveAnchorBarToContentArea(),this._moveHeaderToContentArea(!0)):this._snapHeader(!0),this._adjustHeaderHeights(),this._requestAdjustLayout())},R.prototype._hasDynamicTitle=function(){var e=this.getHeaderTitle();return e&&e.isDynamic()},R.prototype._attachVisualIndicatorsPressHandlers=function(e,t){var i=this.getHeaderTitle(),o=this._getHeaderContent();D(i)&&!this._bAlreadyAttachedTitleIndicatorPressHandler&&(i.attachEvent(R.EVENTS.TITLE_VISUAL_INDICATOR_PRESS,(function(){e.call(t),this._headerBiggerThanAllowedToBeExpandedInTitleArea()&&this._scrollBelowCollapseVisualIndicator(),this._focusCollapseVisualIndicator()}),this),this._bAlreadyAttachedTitleIndicatorPressHandler=!0),D(o)&&!this._bAlreadyAttachedHeaderIndicatorPressHandler&&(o.attachEvent(R.EVENTS.HEADER_VISUAL_INDICATOR_PRESS,(function(){e.call(t),this._focusExpandVisualIndicator()}),this),this._bAlreadyAttachedHeaderIndicatorPressHandler=!0)},R.prototype._hasVisibleDynamicTitleAndHeader=function(){var e=this.getHeaderTitle(),t=this.getHeaderContent();return this._hasVisibleDynamicTitle(e)&&this._hasVisibleHeaderContent(t)},R.prototype._hasVisibleDynamicTitle=function(e){return D(e)&&e.isDynamic()&&e.getVisible()},R.prototype._hasVisibleHeaderContent=function(e){return D(e)&&e.length>0&&this.getShowHeaderContent()},R.prototype._hasDynamicTitleWithSnappedTitleOnMobile=function(){var e=this.getHeaderTitle();return D(e)&&e.isDynamic()&&!!e.getSnappedTitleOnMobile()&&r.system.phone},R.prototype._updateToggleHeaderVisualIndicators=function(){var e,t,i,o=this._hasVisibleDynamicTitleAndHeader();this.getToggleHeaderOnTitleClick()&&o?(t=e=this._bHeaderExpanded,i=!e&&!this._hasDynamicTitleWithSnappedTitleOnMobile()):(t=!1,i=!1),this._toggleCollapseVisualIndicator(t),this._toggleExpandVisualIndicator(i)},R.prototype._updateTitleVisualState=function(){var e=this.getHeaderTitle(),t=this._hasVisibleDynamicTitleAndHeader()&&this.getToggleHeaderOnTitleClick()&&!this._hasDynamicTitleWithSnappedTitleOnMobile();this.$().toggleClass("sapUxAPObjectPageLayoutTitleClickEnabled",t),D(e)&&e._toggleFocusableState(t)},R.prototype._focusCollapseVisualIndicator=function(){var e=this._getHeaderContent();D(e)&&e._focusCollapseButton()},R.prototype._focusExpandVisualIndicator=function(){var e=this.getHeaderTitle();D(e)&&e._focusExpandButton()},R.prototype._toggleExpandVisualIndicator=function(e){var t=this.getHeaderTitle();D(t)&&t._toggleExpandButton(e)},R.prototype._toggleCollapseVisualIndicator=function(e){var t=this._getHeaderContent();D(t)&&t._toggleCollapseButton(e)},R.prototype._attachVisualIndicatorMouseOverHandlers=function(e,t,i){var o=this._getHeaderContent();D(o)&&!this._bAlreadyAttachedVisualIndicatorMouseOverOutHandler&&(o.attachEvent(R.EVENTS.VISUAL_INDICATOR_MOUSE_OVER,e,i),o.attachEvent(R.EVENTS.VISUAL_INDICATOR_MOUSE_OUT,t,i),this._bAlreadyAttachedVisualIndicatorMouseOverOutHandler=!0)},R.prototype._attachTitleMouseOverHandlers=function(e,t,i){var o=this.getHeaderTitle();D(o)&&!this._bAlreadyAttachedTitleMouseOverOutHandler&&(o.attachEvent(R.EVENTS.TITLE_MOUSE_OVER,e,i),o.attachEvent(R.EVENTS.TITLE_MOUSE_OUT,t,i),this._bAlreadyAttachedTitleMouseOverOutHandler=!0)},R.prototype._suppressScroll=function(){this._bSuppressScroll=!0},R.prototype._resumeScroll=function(){this._bSuppressScroll=!1,this._iStoredScrollTop?this._scrollTo(this._iStoredScrollTop,0):this._onScroll({target:{scrollTop:this._$opWrapper.scrollTop()}})},R.prototype._addHoverClass=function(){var e=this.$();e&&e.addClass("sapUxAPObjectPageLayoutTitleForceHovered")},R.prototype._removeHoverClass=function(){var e=this.$();e&&e.removeClass("sapUxAPObjectPageLayoutTitleForceHovered")},R.prototype._getHeight=function(e){return e instanceof o&&e.$().outerHeight()||0},R.prototype._getWidth=function(e){var t=e.getDomRef();return e instanceof o&&t&&t.offsetWidth||0},R.prototype._getSectionInfoIsDirty=function(){return this.bSectionInfoIsDirty},R.prototype._setSectionInfoIsDirty=function(e){this.bSectionInfoIsDirty=e},R.prototype._getAriaLabelText=function(e,t){var i,o=this.getHeaderTitle(),n=o?o.getTitleText():null;return o&&n&&"ROOT"!==e?(i=n,t&&(i+=" "+R._getLibraryResourceBundle().getText(e+"_ARIA_LABEL_WITH_TITLE"))):i=R._getLibraryResourceBundle().getText(e+"_ARIA_LABEL_WITHOUT_TITLE"),i},R.prototype._getFooterHeight=function(){if(this.getFooter()&&this.getShowFooter()){var e=this.$("footerWrapper").get(0);return this._getDOMRefHeight(e)+(e?parseFloat(getComputedStyle(e).marginBottom):0)}return 0},R.prototype._getDOMRefHeight=function(e){return e&&e.parentElement?e.getBoundingClientRect().height:0},R.prototype._updateAriaLabels=function(){var e=this.getLandmarkInfo(),t=this._getAriaLabelText("ROOT",!0),i=this._getAriaLabelText("HEADER",!0),o=this._getAriaLabelText("NAVIGATION",!1),n=this._getAriaLabelText("NAVTOOLBAR",!0),r=e&&e.getHeaderLabel(),s=e&&e.getRootLabel(),a=e&&e.getNavigationLabel();s||this.$().attr("aria-label",t),r||this.$("headerTitle").attr("aria-label",i),a||(this.$("anchorBar").attr("aria-label",o),this.$("stickyAnchorBar").attr("aria-label",o)),this.$("anchBar").attr("aria-label",n)},R.prototype._formatLandmarkInfo=function(e,t){if(e){var i=e["get"+t+"Role"]()||"",o=e["get"+t+"Label"]()||"";return i===L.None&&(i=""),{role:i.toLowerCase(),label:o}}return{}},R.prototype._getHeaderTag=function(e){return e&&e.getHeaderRole()!==L.None?R.DIV:R.HEADER},R.prototype._getFooterTag=function(e){return e&&e.getFooterRole()!==L.None?R.DIV:R.FOOTER},R}));