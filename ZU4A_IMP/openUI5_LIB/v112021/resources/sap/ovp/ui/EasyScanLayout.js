/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ovp/cards/CommonUtils","sap/ovp/ui/UIActions","sap/ui/Device","sap/ui/core/Control","sap/ui/core/ResizeHandler","sap/ovp/app/resources","sap/ui/events/F6Navigation","sap/ui/events/KeyCodes","sap/ovp/cards/jUtils","sap/ui/core/Core","sap/ui/core/Component","sap/ui/dom/jquery/Selectors"],function(jQuery,t,e,a,i,n,s,r,o,l,d,u){"use strict";var p=function(t){this.init(t)};p.prototype.init=function(t){t.beforeDragCallback=this._beforeDragHandler.bind(this);t.dragStartCallback=this._dragStartHandler.bind(this);t.dragMoveCallback=this._dragMoveHandler.bind(this);t.dragEndCallback=this._dragEndHandler.bind(this);t.endCallback=this._endHandler.bind(this);this.layout=t.layout;this.afterReplaceElements=t.afterReplaceElements||function(){};this.settings=t;delete t.afterReplaceElements;this.destroy();this.uiActions=new e(this.settings).enable();this.aCardsOrder=null;this.verticalMargin=null;this.horizontalMargin=null;this.columnCount=null;this.top=null;this.left=null;this.width=null;this.layoutOffset=null;this.jqLayout=null;this.jqLayoutInner=null;this.isRTLEnabled=null;this.lastCollidedEl=null;this.lastCollisionTop=null;this.SCROLL_OFFSET=16};p.prototype.findCollision=function(t,e,a){var i;for(var n=0;n<a.length;n++){var s=a[n];var r=!(s.posDnD.right<t||s.posDnD.left>t);var o=!(s.posDnD.bottom<e||s.posDnD.top>e);if(r&&o){i=s;break}}return i};p.prototype.isCollisionTop=function(t,e,a){var i=(a.posDnD.bottom-a.posDnD.top)/2+a.posDnD.top;var n=!(i<e||a.posDnD.top>e);return n};p.prototype._dragMoveHandler=function(t,e){var a=t.element;var i=t.moveX-this.layoutOffset.left;var n=t.moveY-this.jqLayout.get(0).getBoundingClientRect().top+this.jqLayout.scrollTop();if(!e){var s=document.getElementsByClassName("sapFDynamicPageContentWrapper")[0];var r=s.offsetHeight;var o=s.getBoundingClientRect();if(t.evt.clientY-s.offsetTop+this.SCROLL_OFFSET>r){s.scrollTop=s.scrollTop+this.SCROLL_OFFSET}else if(t.evt.clientY-s.offsetTop<o.top+this.SCROLL_OFFSET&&s.scrollTop!==0){s.scrollTop=s.scrollTop-this.SCROLL_OFFSET}}var l=this.findCollision(i,n,this.aCardsOrder);if(!l){return}var d=this.isCollisionTop(i,n,l);if(l===a){this.lastCollidedEl=l;return}if(l===this.lastCollidedEl){if(this.lastCollisionTop===d){return}if(this.lastCollisionTop){this.lastCollisionTop=d;if(a.posDnD.top>l.posDnD.top){return}}else{this.lastCollisionTop=d;if(a.posDnD.top<l.posDnD.top){return}}}if(this.lastCollidedEl&&this.lastCollidedEl!==l&&this.lastCollidedEl!==a&&this.lastCollidedEl.posDnD.left===l.posDnD.left&&this.lastCollidedEl.posDnD.left===a.posDnD.left){l=this.lastCollidedEl}this.dragAndDropElement(a,l);this.lastCollidedEl=this.findCollision(i,n,this.aCardsOrder);if(this.lastCollidedEl){this.lastCollisionTop=this.isCollisionTop(i,n,this.lastCollidedEl)}};p.prototype.dragAndDropElement=function(t,e){if(t&&e){this.aCardsOrder=this.dragAndDropSwapElement(t,e,this.aCardsOrder);this.drawLayout(this.aCardsOrder)}};p.prototype.dragAndDropSwapElement=function(t,e,a){var i=a.slice();var n=a.indexOf(t);var s=a.indexOf(e);i[s]=t;i[n]=e;if(!!this.positionChanges&&e&&e.children){var r=e.children[0].getAttribute("id");this.positionChanges.push({changeType:"position",content:{cardId:r.substring(r.indexOf("mainView--")+10,r.length),position:n,oldPosition:s},isUserDependent:true})}return i};p.prototype.dragAndDropSwapElementForKeyboardNavigation=function(t,e){if(t&&e){var a=this.layout.getVisibleLayoutItems().map(function(t){return t.$().parent()[0]});var i=0;for(var n=0;n<a.length;n++){if(a[n]===t){a[n]=e;i++;continue}if(a[n]===e){a[n]=t;i++;continue}}if(i===2){this.afterReplaceElements(a)}}};p.prototype.initCardsSettingsForDragAndDrop=function(){this.jqLayout=this.layout.$();this.jqLayoutInner=this.jqLayout&&this.jqLayout.children().first();var t=this.jqLayout.scrollTop();var e=this.jqLayoutInner.height();this.isRTLEnabled=d.getConfiguration().getRTL()?1:-1;this.aCardsOrder=[];this.layoutOffset=this.jqLayout.offset();if(a.system.tablet===true&&a.system.desktop===false){this.jqLayout.css("height",this.jqLayoutInner.height())}var i=this.layout.getVisibleLayoutItems();if(!i){return}this.aCardsOrder=i.map(function(t){var e=t.$().parent()[0];e.posDnD={width:e.offsetWidth,height:e.offsetHeight};e.style.width=e.offsetWidth+"px";return e});var n=this.jqLayoutInner&&this.jqLayoutInner.children().first();var s=this.isRTLEnabled===1?"margin-left":"margin-right";this.verticalMargin=parseInt(n.css(s),10);var r=this.aCardsOrder[0];this.horizontalMargin=parseInt(getComputedStyle(r)["margin-bottom"],10);this.columnCount=this.layout.getColumnCount();this.top=r.getBoundingClientRect().top-this.jqLayoutInner[0].getBoundingClientRect().top;this.left=r.getBoundingClientRect().left-this.jqLayoutInner[0].getBoundingClientRect().left;this.width=r.offsetWidth;l.addStyleToAllElements(this.aCardsOrder,"position","absolute");this.drawLayout(this.aCardsOrder);this.jqLayoutInner.height(e);this.jqLayout.scrollTop(t)};p.prototype.drawLayout=function(t){var e=[];for(var a=0;a<this.columnCount;a++){e[a]=0}for(var i=0;i<t.length;i++){var n=i%this.columnCount;var s=e[n]++;var r=this.left-this.isRTLEnabled*(n*this.verticalMargin+n*this.width);var o=this.top;var l=t[i];for(var d=0;d<s;d++){o+=this.horizontalMargin;var u=i-(d+1)*this.columnCount;o+=t[u].posDnD.height}l.posDnD.top=o;l.posDnD.bottom=o+l.posDnD.height;l.posDnD.left=r;l.posDnD.right=r+l.posDnD.width;this.updateElementCSS(t[i])}};p.prototype.updateElementCSS=function(t){l.addStyleToAllElements(t,"top",t.posDnD.top);l.addStyleToAllElements(t,"left",t.posDnD.left)};p.prototype._dragStartHandler=function(t,e){this.positionChanges=[];if(a.system.desktop){l.addClassToAllElements(document.querySelectorAll("body"),"sapOVPDisableUserSelect");l.addClassToAllElements(document.querySelectorAll("body"),"sapOVPDisableImageDrag")}if(window.getSelection){var i=window.getSelection();i.removeAllRanges()}this.initCardsSettingsForDragAndDrop()};p.prototype._beforeDragHandler=function(t,e){if(a.browser.mobile){this.selectableElemets=jQuery(e).find(".sapUiSelectable");this.selectableElemets.removeClass("sapUiSelectable")}jQuery(this.settings.wrapper).addClass("dragAndDropMode")};p.prototype._dragEndHandler=function(t,e){this.lastCollidedEl=null;if(t.type=="mouseup"||t.type=="touchend"){if(this.aCardsOrder){this.afterReplaceElements(this.aCardsOrder)}}if(a.system.desktop){l.addClassToAllElements(document.querySelectorAll("body"),"sapOVPDisableUserSelect");l.addClassToAllElements(document.querySelectorAll("body"),"sapOVPDisableImageDrag")}jQuery(this.settings.wrapper).removeClass("dragAndDropMode");if(this.jqLayoutInner){this.jqLayoutInner.removeAttr("style")}if(this.aCardsOrder){jQuery(this.aCardsOrder).removeAttr("style")}this.uiActions.removeClone()};p.prototype._endHandler=function(t,e){if(a.browser.mobile&&this.selectableElemets){this.selectableElemets.addClass("sapUiSelectable")}};p.prototype.getSwapItemsFunction=function(){return this.dragAndDropSwapElementForKeyboardNavigation.bind(this)};p.prototype.destroy=function(){if(this.uiActions){this.uiActions.disable();this.uiActions=null}};var h={buildReplaceItemsInstance:function(t){var e={containerSelector:".sapUshellEasyScanLayoutInner",wrapper:".sapUshellEasyScanLayout",draggableSelector:".easyScanLayoutItemWrapper",placeHolderClass:"easyScanLayoutItemWrapper-placeHolder",cloneClass:"easyScanLayoutItemWrapperClone",moveTolerance:10,switchModeDelay:800,isTouch:!a.system.desktop,debug:false};t=Object.assign({},e,t);return new p(t)}};var c=function(t,e){this.init(t,e)};c.prototype.init=function(t,e){this.easyScanLayout=t;this.swapItemsFunction=typeof e==="function"?e:function(){};this.keyCodes=o;this.jqElement=t.$();this.jqElement.on("keydown",this.keydownHandler.bind(this));this.jqElement.on("keyup",this.keyupHandler.bind(this));this.jqElement.find(".after").on("focus.keyboardNavigation",this.afterFocusHandler.bind(this));this.jqElement.find(".sapUshellEasyScanLayoutInner").on("focus.keyboardNavigation",this.layoutFocusHandler.bind(this));this.jqElement.on("focus.keyboardNavigation",".easyScanLayoutItemWrapper",this.layoutItemFocusHandler.bind(this));this._ignoreSelfFocus=false;this.swapSourceElement=null;this.lastFocussedElement=null;this.lastFocussedClassId=null;this.jqElement.on("keyup",this.ctrlArrowUpDownHandler.bind(this))};c.prototype.ctrlArrowUpDownHandler=function(t){switch(t.keyCode){case this.keyCodes.PAGE_UP:if(t.ctrlKey){this.ctrlArrowHandler(t);this.pageUpDownHandler(t,true)}break;case this.keyCodes.PAGE_DOWN:if(t.ctrlKey){this.ctrlArrowHandler(t);this.pageUpDownHandler(t,false)}break;default:break}};c.prototype.destroy=function(){if(this.jqElement){this.jqElement.off(".keyboardNavigation");this.jqElement.find(".after").off(".keyboardNavigation");this.jqElement.find(".sapUshellEasyScanLayoutInner").off(".keyboardNavigation")}delete this.jqElement;delete this.easyScanLayout};c.prototype.getVisibleLayoutItems=function(){var t=this.easyScanLayout.getContent();var e=t.filter(function(t){return t.getVisible()});return e};c.prototype.afterFocusHandler=function(){if(this._ignoreSelfFocus){this._ignoreSelfFocus=false;return}var t=this.jqElement.find(".easyScanLayoutItemWrapper:sapTabbable").first();var e=t.find(":sapTabbable").last();if(!e.length){e=t}e.focus()};c.prototype.layoutFocusHandler=function(){if(this._ignoreSelfFocus){this._ignoreSelfFocus=false;return}this.jqElement.find(".easyScanLayoutItemWrapper:sapTabbable").first().focus();this.handleScrollBar(true)};c.prototype.layoutItemFocusHandler=function(){var t=jQuery(document.activeElement);if(t){var e,a="";if(t.find(".valueStateText").length==1){var i=t.find(".valueStateText").find(".sapMObjectNumberText").text();var n=t.find(".valueStateText").find(".sapUiInvisibleText").text();t.find(".valueStateText").attr("aria-label",i+" "+n);t.find(".valueStateText").attr("aria-labelledby","")}t.find("[role='listitem']").attr("aria-label","");if(t.hasClass("easyScanLayoutItemWrapper")){var r="";var o=t.find(".cardCount");if(o.length===0){r="countDiv_"+(new Date).getTime();var l='<div id="'+r+'" class="cardCount"'+'" hidden></div>';t.append(l)}else{r=o[0].id}a+=r+" ";var d=t.find(".cardType");if(d.length!==0){a+=d[0].id+" "}}if(t.hasClass("sapOvpCardHeader")&&!t.hasClass("sapOvpStackCardContent")){var u="";var p=t.find(".cardHeaderType");if(p.length===0){var h=s.getText("CardHeaderType");u="cardHeaderType_"+(new Date).getTime();var c='<div id="'+u+'" class="cardHeaderType" aria-label="'+h+'" hidden></div>';t.append(c)}else{u=p[0].id}a+=u+" "}var f,y;if(t.hasClass("easyScanLayoutItemWrapper")){y=t.find(".sapOvpCardHeader");f=y.find("[aria-label]")}else{f=t.find("[aria-label]")}var m=t.find(".sapOvpStackCardHeader").length!==1;var g=t.find(".sapOvpExtendedBarListHBox,.sapOvpBarCondensedList,.sapOvpObjectListItem,.sapOvpStandardListItem").length===0;if(m&&g){for(e=0;e<f.length;e++){a+=f[e].id+" "}}if(t.hasClass("sapOvpCardHeader")){var v=t.find(".cardHeaderText");if(v.length!==0){for(var e=0;e<v.length;e++){if(a.indexOf(v[e].id)===-1){a+=v[e].id+" "}}}}if(a.length){t.attr("aria-labelledby",a)}if(t.prop("nodeName")==="LI"&&t.find(".linkListHasPopover").length!==0){if(t.find("#hasDetails").length===0){t.append("<div id='hasDetails' hidden>"+s.getText("HAS_DETAILS")+"</div>");t.attr("aria-describedby","hasDetails")}}var C=t.attr("id");if(C&&C.indexOf("ovpTable")!=-1&&t.find("[role='Link']")&&!t.hasClass("sapUiCompSmartLink")){var b=t.closest("td").attr("data-sap-ui-column"),S=t.closest("tbody").siblings().children().filter("tr").children();for(var e=0;e<S.length;e++){if(S[e].getAttribute("data-sap-ui")==b&&S[e].hasChildNodes("span")){var E=S[e].firstElementChild.getAttribute("id");t.attr("aria-labelledby",E)}}}}};c.prototype._getLayoutItemIndex=function(t){if(!t.hasClass("easyScanLayoutItemWrapper")){return false}var e=t.children().attr("id");var a=false;this.getVisibleLayoutItems().forEach(function(t,i){if(e==t.getId()){a=i}});return a};c.prototype._changeItemsFocus=function(t){var e=document.querySelectorAll(".easyScanLayoutItemWrapper");l.addAttributeToAllElements(e,"tabindex","-1");t.attr("tabindex",0);setTimeout(function(){t.focus()},500)};c.prototype._swapItemsFocus=function(t,e,a){t.preventDefault();e.attr("tabindex","-1");setTimeout(function(){a.attr("tabindex","0").focus()},0)};c.prototype.tabButtonHandler=function(t){var e=jQuery(document.activeElement);this.lastFocussedElement=e;if(e.hasClass("easyScanLayoutItemWrapper")){return}var a=e.closest(".easyScanLayoutItemWrapper");if(!a.length){return}var i=a.find(jQuery(".lastElement"));if(e.is(i)){t.stopPropagation();t.stopImmediatePropagation();var n=this.jqElement.scrollTop();this._ignoreSelfFocus=true;this.jqElement.find(".after").focus();this.jqElement.scrollTop(n)}};c.prototype.f7Handler=function(t){var e=jQuery(document.activeElement);if(e.hasClass("easyScanLayoutItemWrapper")){e.find(":sapTabbable").first().focus()}else{e.closest(".easyScanLayoutItemWrapper").focus()}t.preventDefault()};c.prototype.shiftTabButtonHandler=function(t){var e=jQuery(document.activeElement);if(e.hasClass("after")){this.lastFocussedElement.focus();return}if(!e.hasClass("easyScanLayoutItemWrapper")){return}this._ignoreSelfFocus=true;this.jqElement.find(".sapUshellEasyScanLayoutInner").focus()};c.prototype.arrowUpDownHandler=function(t,e){t.preventDefault();var a=e?"prev":"next";var i=jQuery(document.activeElement);if(!i.hasClass("sapOvpCardHeader")){var n=jQuery(i)[a](".easyScanLayoutItemWrapper");if(!n.is(i)){this._swapItemsFocus(t,i,n)}}};c.prototype.arrowRightLeftHandler=function(t,e){var a=e?1:-1;var i=jQuery(document.activeElement);var n=this._getLayoutItemIndex(i);if(n===false){return}var s=this.getVisibleLayoutItems()[n+a];if(s){this._swapItemsFocus(t,i,s.$().parent())}};c.prototype.altPageUpAndHomeHandler=function(t){var e=jQuery(document.activeElement);var a=this._getLayoutItemIndex(e);if(a===false){return}var i=this.easyScanLayout.getColumnCount();var n=a%i;var s;var r=this.getVisibleLayoutItems();if(n==0){s=r[0]}else{s=r[a-n]}this._swapItemsFocus(t,e,s.$().parent())};c.prototype.altPageDownAndEndHandler=function(t){var e=jQuery(document.activeElement);var a=this._getLayoutItemIndex(e);if(a===false){return}var i=this.easyScanLayout.getColumnCount();var n=a%i;var s;var r=this.getVisibleLayoutItems();if(n==i-1||a+(i-n)>r.length){s=r[r.length-1]}else{s=r[a+(i-n-1)]}this._swapItemsFocus(t,e,s.$().parent())};c.prototype.ctrlHomeHandler=function(t){var e=jQuery(document.activeElement);var a=this._getLayoutItemIndex(e);if(a===false){return}var i=this.easyScanLayout.getColumnCount();var n=a%i;var s=this.getVisibleLayoutItems();var r=s[n];var o=r.$().parent();if(o.is(e)){o=s[0].$().parent()}this._swapItemsFocus(t,e,o)};c.prototype.ctrlEndHandler=function(t){var e=jQuery(document.activeElement);var a=this._getLayoutItemIndex(e);if(a<0){return}var i=this.easyScanLayout.getColumnCount();var n=a%i;var s;var r=this.getVisibleLayoutItems();for(var o=r.length-1;o>=0;o--){if(o%i==n){s=r[o];break}}var l=s.$().parent();if(l.is(e)){l=r[r.length-1].$().parent()}this._swapItemsFocus(t,e,l)};c.prototype.pageUpDownHandler=function(t,e){var a=e?"prev":"next";var i=jQuery(document.activeElement);if(!i.hasClass("easyScanLayoutItemWrapper")){return}if(!i[a]().length){return}var n=false;var s=i;var r=jQuery(window).height();while(!n){var o=s[a]();if(!o.length){n=s;break}if(!e&&o.offset().top>r){n=o;break}var l=o.offset().top;var d=0;if(l){d=l<0?-1:1}if(e&&d<=0){n=o;break}s=o}this._swapItemsFocus(t,i,n)};c.prototype.ctrlArrowHandler=function(t){if(this.swapSourceElement==null){this.swapSourceElement=jQuery(document.activeElement);if(!this.swapSourceElement.hasClass("easyScanLayoutItemWrapper")){this.endSwap()}else{this.jqElement.on("keyup.keyboardNavigation",this.keyupHandler.bind(this));this.jqElement.addClass("dragAndDropMode");this.swapSourceElement.addClass("dragHovered")}}};c.prototype.keyupHandler=function(t){if(this.swapSourceElement!=null&&t.keyCode===this.keyCodes.CONTROL){var e=jQuery(document.activeElement);if(e.hasClass("easyScanLayoutItemWrapper")){this.swapItemsFunction(this.swapSourceElement[0],e[0]);this._changeItemsFocus(this.swapSourceElement)}this.endSwap()}else if(t.keyCode===this.keyCodes.SPACE){this.spacebarHandler(t)}else if(t.keyCode===this.keyCodes.F6){if(t.shiftKey){var a=document.getElementsByClassName("sapUshellEasyScanLayoutInner");var i=a[0].firstElementChild;if(i.firstElementChild){document.getElementsByClassName(i.firstElementChild.className)[0].focus()}this.handleScrollBar(true)}}};c.prototype.endSwap=function(t){this.swapSourceElement.removeClass("dragHovered");this.jqElement.removeClass("dragAndDropMode");this.swapSourceElement=null;this.jqElement.off("keyup.keyboardNavigation")};c.prototype.checkIfSwapInterrupted=function(t){if(this.swapSourceElement!=null&&t.keyCode!=this.keyCodes.ARROW_LEFT&&t.keyCode!=this.keyCodes.ARROW_RIGHT&&t.keyCode!=this.keyCodes.ARROW_UP&&t.keyCode!=this.keyCodes.ARROW_DOWN){this.endSwap()}};c.prototype.spacebarHandler=function(t){var e=d.byId(t.target.id);if(e&&e.mEventRegistry.hasOwnProperty("press")){var a="#"+t.target.id;l.addClassToAllElements(document.querySelectorAll(a),"sapMLIBActive");e.firePress()}};c.prototype.keydownHandler=function(t){this.checkIfSwapInterrupted(t);switch(t.keyCode){case this.keyCodes.TAB:t.shiftKey?this.shiftTabButtonHandler(t):this.tabButtonHandler(t);break;case this.keyCodes.F6:if(t.shiftKey){this._ignoreSelfFocus=true;this.jqElement.find(".sapUshellEasyScanLayoutInner").focus();r.handleF6GroupNavigation(t)}else{this._ignoreSelfFocus=true;var e=this.jqElement.scrollTop();this.jqElement.find(".after").focus();r.handleF6GroupNavigation(t);this.jqElement.scrollTop(e);this.handleScrollBar(true)}break;case this.keyCodes.F7:this.f7Handler(t);break;case this.keyCodes.ARROW_UP:if(t.ctrlKey==true){this.ctrlArrowHandler(t)}this.arrowUpDownHandler(t,true);this.handleScrollBar(false);break;case this.keyCodes.ARROW_DOWN:if(t.ctrlKey==true){this.ctrlArrowHandler(t)}this.arrowUpDownHandler(t,false);break;case this.keyCodes.ARROW_RIGHT:if(t.ctrlKey==true){this.ctrlArrowHandler(t)}this.arrowRightLeftHandler(t,true);break;case this.keyCodes.ARROW_LEFT:if(t.ctrlKey==true){this.ctrlArrowHandler(t)}this.arrowRightLeftHandler(t,false);break;case this.keyCodes.HOME:t.ctrlKey==true?this.ctrlHomeHandler(t):this.altPageUpAndHomeHandler(t);break;case this.keyCodes.END:t.ctrlKey==true?this.ctrlEndHandler(t):this.altPageDownAndEndHandler(t);break;case this.keyCodes.PAGE_UP:t.altKey==true?this.altPageUpAndHomeHandler(t):this.pageUpDownHandler(t,true);if(t.ctrlKey){this.ctrlArrowHandler(t);this.pageUpDownHandler(t,true)}break;case this.keyCodes.PAGE_DOWN:t.altKey==true?this.altPageDownAndEndHandler(t):this.pageUpDownHandler(t,false);if(t.ctrlKey){this.ctrlArrowHandler(t);this.pageUpDownHandler(t,false)}break;case this.keyCodes.ENTER:this.spacebarHandler(t);break;default:break}};c.prototype.handleScrollBar=function(t){var e=this.easyScanLayout._sOwnerId+"---mainView--ovpMain";if(e){var a=d.byId(e);if(a){setTimeout(function(){var e=a.getScrollDelegate();if(e){var i=document.activeElement.getBoundingClientRect().height;var n=e.getScrollTop();var s=t?0:n-i-32;e.scrollTo(0,s)}},0)}}};var f=i.extend("sap.ovp.ui.EasyScanLayout",{metadata:{designTime:true,library:"sap.ovp",aggregations:{content:{type:"sap.ui.core.Control",multiple:true,singularName:"content"}},defaultAggregation:"content",events:{afterRendering:{},afterDragEnds:{},afterColumnUpdate:{}},properties:{useMediaQueries:{group:"Misc",type:"boolean",defaultValue:false},dragAndDropRootSelector:{group:"Misc",type:"string"},dragAndDropEnabled:{group:"Misc",type:"boolean",defaultValue:true},debounceTime:{group:"Misc",type:"int",defaultValue:150}}},renderer:{render:function(t,e){var a=u.get(e._sOwnerId)&&u.get(e._sOwnerId).oOvpConfig.cards;t.openStart("div",e);t.class("sapUshellEasyScanLayout");t.openEnd();t.openStart("div");t.class("sapUshellEasyScanLayoutInner");t.attr("role","list");t.attr("aria-label","Cards");if(a&&a.length>0){t.attr("tabindex",0)}t.openEnd();var i=e.columnCount;var n=Array.apply(null,new Array(i)).map(function(){return[]});var s=e.getContent().filter(function(t){return t.getVisible()});for(var r=0;r<s.length;r++){n[r%i].push(s[r])}var o=1;n.forEach(function(e){t.openStart("div");t.class("easyScanLayoutColumn");t.accessibilityState(undefined,{role:"list"});t.openEnd();e.forEach(function(e,a){t.openStart("div");if(o===1){t.attr("tabindex",0)}else{t.attr("tabindex",-1)}t.class("easyScanLayoutItemWrapper");t.accessibilityState(undefined,{role:"listitem"});t.attr("aria-setsize",s.length);t.attr("aria-posinset",o);o++;t.openEnd();t.renderControl(e);t.openStart("div").class("lastElement").accessibilityState(undefined,{role:"none"}).attr("tabindex",0).openEnd();t.close("div");t.close("div")});t.close("div")});t.close("div");t.openStart("div");t.class("after");if(a&&a.length>0){t.attr("tabindex",0).accessibilityState(undefined,{role:"none"})}t.openEnd();t.close("div")}}});var y=function(){return[{minWidth:0,styleClass:"columns-blank",columnCount:1},{minWidth:240,styleClass:"columns-block",columnCount:1},{minWidth:352,styleClass:"columns-narrow",columnCount:1},{minWidth:433,styleClass:"columns-wide",columnCount:1},{minWidth:704,styleClass:"columns-narrow",columnCount:2},{minWidth:864,styleClass:"columns-wide",columnCount:2},{minWidth:1024,styleClass:"columns-narrow",columnCount:3},{minWidth:1280,styleClass:"columns-wide",columnCount:3},{minWidth:1440,styleClass:"columns-narrow",columnCount:4},{minWidth:1800,styleClass:"columns-wide",columnCount:4},{minWidth:2560,styleClass:"columns-narrow",columnCount:5},{minWidth:3008,styleClass:"columns-wide",columnCount:5},{minWidth:3600,styleClass:"columns-narrow",columnCount:4},{minWidth:3840,styleClass:"columns-wide",columnCount:4},{minWidth:5120,styleClass:"columns-wide",columnCount:5},{minWidth:6016,styleClass:"columns-wide",columnCount:5}]};f.prototype.init=function(){this.columnResolutionList=y();this.columnCount=this.columnResolutionList[0].columnCount;this.columnStyle="";this.updateColumnClass(this.columnResolutionList[0].styleClass);var t=a.browser.msie&&a.browser.version>9;if(t&&this.getUseMediaQueries()){this.mediaQueryList=this.initMediaListeners(this.columnResolutionList)}else{this.resizeHandlerId=this.initResizeHandler(this.columnResolutionList)}if(u.get(this._sOwnerId)&&u.get(this._sOwnerId).oOvpConfig.cards.length===0){this.data("sap-ui-fastnavgroup","false",false)}else{this.data("sap-ui-fastnavgroup","true",true)}};var m;var g=function(t,e,a){var i=function(t,e){this.updateColumnClass(e);this.refreshColumnCount(t,this.getContent())};if(a.matches){window.clearTimeout(m);m=window.setTimeout(i.bind(this,t,e),this.getDebounceTime())}};var v=function(t,e){var a=t.minWidth;var i=e&&e.minWidth;return"(min-width: "+a+"px)"+(i?" and (max-width: "+(i-1)+"px)":"")};f.prototype.initMediaListeners=function(t){var e=[];for(var a=0;a<t.length;a++){var i=v(t[a],t[a+1]);var n=window.matchMedia(i);var s=g.bind(this,t[a].columnCount,t[a].styleClass);n.addListener(s);n.bindedListener=s;s(n);e.push(n)}return e};f.prototype.initResizeHandler=function(t){var e;var a=this.getDebounceTime();var i=function(){window.clearTimeout(e);e=window.setTimeout(this.oControl.resizeHandler.bind(this,t),a)};return n.register(this,i)};f.prototype.resizeHandler=function(t){var e=this.iWidth;var a=this;var i=this.oControl;var n;if(document.querySelectorAll(".ovpWrapper .sapFDynamicPageContent").length>0){e=window.innerWidth}for(var s=0;s<t.length;s++){if(!t[s+1]){n=t[s];break}if(t[s].minWidth<=e&&t[s+1].minWidth>e){n=t[s];break}}i.refreshColumnCount(n.columnCount,i.getContent(),a);i.updateColumnClass(n.styleClass);i.fireAfterColumnUpdate(n)};f.prototype.getColumnWidth=function(t){var e;switch(t){case"columns-blank":e=0;break;case"columns-narrow":e=20;break;case"columns-wide":e=25;break;default:break}return e};f.prototype.refreshColumnCount=function(t,e,a){this.columnCount=t;var i=jQuery();for(var n=0;n<t;n++){i=i.add("<div class='easyScanLayoutColumn'></div>")}var s=e.filter(function(t){return t.getVisible()});var r=1;for(var o=0;o<s.length;o++){jQuery(s[o].getDomRef()).parent().attr("aria-posinset",r);r++;i.get(o%t).appendChild(s[o].getDomRef().parentNode)}this.$().children(".sapUshellEasyScanLayoutInner").empty().append(i);if(a&&a.iWidth){this.headerMargin(a)}};f.prototype.headerMargin=function(e){var i=0,n=0;var s=e.iWidth;var r,o,l,d=0,u,p=0;var h=y();var c=t.getPixelPerRem();var f=parseInt(window.getComputedStyle(document.querySelector(".ovpWrapper .sapFDynamicPageTitleWrapper"),null).getPropertyValue("width").split("px")[0],10)*1/c;if(document.querySelectorAll(".ovpWrapper .sapFDynamicPageContent").length>0){s=window.innerWidth}for(var m=0;m<h.length;m++){if(!h[m+1]){r=h[m];break}if(h[m].minWidth<=s&&h[m+1].minWidth>s){r=h[m];break}}u=this.getColumnWidth(r.styleClass);l=r.columnCount*u+(r.columnCount-1)*1;o=(f-l)/2;if(a.system.desktop){jQuery(".ovpWrapper .sapFDynamicPageTitle").css({"margin-left":o+"rem","margin-right":o+"rem"});jQuery(".ovpWrapper .sapFDynamicPageHeader").css({"margin-left":o+"rem","margin-right":o+"rem"})}if(a.system.desktop){f=document.body.clientWidth;if(document.querySelectorAll(".ovpWrapper .sapFDynamicPageContentFitContainer").length>0){i=document.querySelectorAll(".ovpWrapper .sapFDynamicPageContentFitContainer")[0].clientWidth}if(f===i){var g=document.querySelector(".ovpWrapper .sapFDynamicPageTitle")||undefined;var v=g&&getComputedStyle(g)["margin-left"];var C=g&&getComputedStyle(g)["margin-right"];if(typeof v==="string"||v instanceof String){v=v.length>0?parseInt(v.split("px")[0],10):0}if(typeof C==="string"||C instanceof String){C=C.length>0?parseInt(C.split("px")[0],10):0}d=jQuery(".ovpWrapper .sapFDynamicPageScrollBar").css("width");if(typeof d==="string"||d instanceof String){p=d.length>0?parseInt(d.split("px")[0],10):0}d=p;n=d/2;v=(v+n)/(c*1);C=(C+n)/(c*1);jQuery(".ovpWrapper .sapFDynamicPageTitle").css({"margin-left":v+"rem","margin-right":C+"rem",visibility:"visible"});jQuery(".ovpWrapper .sapFDynamicPageHeader").css({"margin-left":v+"rem","margin-right":C+"rem"})}}};f.prototype.getColumnCount=function(){return this.columnCount};f.prototype.getVisibleLayoutItems=function(){var t=this.getContent();var e=t.filter(function(t){return t.getVisible()});return e};f.prototype.updateColumnClass=function(t){if(this.columnStyle===t){return}this.removeStyleClass(this.columnStyle);this.addStyleClass(t);this.columnStyle=t};f.prototype.afterDragAndDropHandler=function(t){var e=this.removeAllAggregation("content",true);var a=[];var i=0;t.forEach(function(t,e){var i=t.children[0].getAttribute("id");var n=d.byId(i);a.push(n);jQuery(t).attr("aria-posinset",e+1)});for(var n=0;n<e.length;n++){if(e[n].getVisible()){this.addAggregation("content",a[i],true);i++}else{this.addAggregation("content",e[n],true)}}this.fireAfterDragEnds({positionChanges:this.layoutDragAndDrop.positionChanges});this.refreshColumnCount(this.getColumnCount(),this.getContent())};f.prototype.setActive=function(t){if(t){this.removeStyleClass("ovpOverlay")}else{this.addStyleClass("ovpOverlay")}};f.prototype.getActive=function(){return!this.hasStyleClass("ovpOverlay")};f.prototype.onAfterRendering=function(){if(!this.getDragAndDropRootSelector()){this.setDragAndDropRootSelector("#"+this.getId())}if(this.layoutDragAndDrop){this.layoutDragAndDrop.destroy()}if(this.getDragAndDropEnabled()){this.layoutDragAndDrop=h.buildReplaceItemsInstance({afterReplaceElements:this.afterDragAndDropHandler.bind(this),rootSelector:this.getDragAndDropRootSelector(),layout:this})}if(this.keyboardNavigation){this.keyboardNavigation.destroy()}var t=this.layoutDragAndDrop?this.layoutDragAndDrop.getSwapItemsFunction():null;this.keyboardNavigation=new c(this,t);this.fireAfterRendering()};f.prototype.exit=function(){if(this.mediaQueryList){this.mediaQueryList.forEach(function(t){t.removeListener(t.bindedListener)});delete this.mediaQueryList}if(this.resizeHandlerId){n.deregister(this.resizeHandlerId)}if(this.layoutDragAndDrop){this.layoutDragAndDrop.destroy();delete this.layoutDragAndDrop}};return f});
//# sourceMappingURL=EasyScanLayout.js.map