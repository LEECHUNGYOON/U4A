/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/ovp/cards/generic/base/analytical/BaseAnalyticalChart.controller","sap/ovp/cards/v4/charts/VizAnnotationManager","sap/ovp/cards/charts/VizAnnotationManager","sap/ovp/cards/OVPCardAsAPIUtils","sap/ovp/app/resources","sap/base/util/each","sap/ovp/cards/Filterhelper","sap/ovp/cards/generic/base/analytical/Utils","sap/ovp/filter/FilterUtils","sap/ui/Device","sap/ui/model/json/JSONModel"],function(t,e,a,i,r,s,o,n,l,d,h){"use strict";return t.extend("sap.ovp.cards.charts.v4.analytical.analyticalChart",{onInit:function(){t.prototype.onInit.apply(this,arguments);var e=new h({error:false});this.getView().setModel(e,"oAnalyticalCardErrorModel")},onAfterRendering:function(){t.prototype.onAfterRendering.apply(this,arguments);if(!i.checkIfAPIIsUsed(this)){var e=this.getCardPropertiesModel();var a=this.getOwnerComponent().getModel("ui").getData().cards;var r=this.getEntitySet()&&this.getEntitySet()["$Type"];var s=r&&this.getMetaModel().getContext("/"+r);if(s){this.selectionVaraintFilter=o.getSelectionVariantFilters(a,e,this.getEntityType())}var n=this.oCardComponentData.mainComponent;var d=[];if(n.getGlobalFilter()){d=n.oGlobalFilter.getFilters()}if(n.getMacroFilterBar()){d=n.aFilters}l.applyFiltersToV4AnalyticalCard(d,this)}},onDataReceived:function(t){if(n.checkIfDataExistInEvent(t)){var i=this;var o=this.getView().byId("analyticalChart");var l=this.getView().byId("bubbleText");var g=r.getText("BUBBLESIZE");var p=i.getMetaModel().getData()["$Annotations"];this.oDataSet.bindData("analyticalmodel>/","");o.setDataset(this.oDataSet);var c=o.getParent();if(!this.isVizPropSet){e.buildVizAttributes(o,c,this);this.isVizPropSet=true;if(l!=undefined){var u=o.getFeeds();s(u,function(t,e){if(u[t].getUid()=="bubbleWidth"){l.setText(g+" "+u[t].getValues())}})}a.hideDateTimeAxis(o)}if(this.getCardPropertiesModel()&&this.getCardPropertiesModel().getData()&&this.getCardPropertiesModel().getData().colorPalette&&o.getVizType()==="stacked_column"){var v=o.getDataset().getDimensions(),f=o.getFeeds(),y,b;for(var C=0;C<f.length;C++){if(f[C].getUid()==="color"){y=f[C].getValues()[0];break}}for(var M=0;M<v.length;M++){if(v[M].getName()===y){b=v[M];break}}if(y&&b){var D={};D["bDescending"]=true;b.setSorter(D)}}var m=t?t.getSource().getCurrentContexts().map(function(t){return t&&t.getObject()}):null;e.setChartUoMTitle(o,m,p);if(this.bFlag==true){this.bFlag=false;this.vbLayout.setBusy(false)}else{setTimeout(function(){i.vbLayout.setBusy(false);i.bdataLoadedToEnableAddToInsight=true},0)}a.checkNoData(t,this.getCardContentContainer(),o);if(d.system.phone){if(this.getCardPropertiesModel().getProperty("/layoutDetail")==="resizable"){var V=this.oDashboardLayoutUtil.dashboardLayoutModel.getCardById(this.cardId);var P=Math.max(V.dashboardLayout.rowSpan,this.iPreviousRowSpan);this.iPreviousRowSpan=P}if(n.isDataSetEmpty(t)){o.setHeight(50+"px")}else{var A=this._calculateVizFrameHeight();if(A!==undefined&&typeof A==="number"){o.setHeight(A+"px")}}}}else if(t&&t.getParameters().error){this.vbLayout.setBusy(false);var F=new h({error:true});this.getView().setModel(F,"oAnalyticalCardErrorModel")}}})});
//# sourceMappingURL=analyticalChart.controller.js.map