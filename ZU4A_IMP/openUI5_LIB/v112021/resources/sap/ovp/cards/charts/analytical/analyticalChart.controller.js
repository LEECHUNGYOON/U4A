/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
sap.ui.define(["sap/ovp/cards/generic/base/analytical/BaseAnalyticalChart.controller","sap/ovp/cards/charts/VizAnnotationManager","sap/ovp/app/resources","sap/base/util/each","sap/ovp/filter/FilterUtils","sap/ui/core/Core","sap/ui/Device","sap/ovp/cards/generic/base/analytical/Utils"],function(t,e,a,i,s,r,o,n){"use strict";return t.extend("sap.ovp.cards.charts.analytical.analyticalChart",{onInit:function(){t.prototype.onInit.apply(this,arguments);var e=this;this.eventhandler=function(t,a,i){s.applyFiltersToV2Card(i,e)};this.GloabalEventBus=r.getEventBus();if(this.oMainComponent&&this.oMainComponent.isMacroFilterBar){this.GloabalEventBus.subscribe("OVPGlobalfilter","OVPGlobalFilterSeacrhfired",e.eventhandler)}},onDataReceived:function(t){var s=this;var r=this.getView().byId("analyticalChart");var l=this.getView().byId("bubbleText");var d=a.getText("BUBBLESIZE");this.oDataSet.bindData("analyticalmodel>/","");r.setDataset(this.oDataSet);var h=r.getParent();if(!this.isVizPropSet){e.buildVizAttributes(r,h,this);this.isVizPropSet=true;if(l!=undefined){var u=r.getFeeds();i(u,function(t,e){if(u[t].getUid()=="bubbleWidth"){l.setText(d+" "+u[t].getValues())}})}e.hideDateTimeAxis(r)}if(this.getCardPropertiesModel()&&this.getCardPropertiesModel().getData()&&this.getCardPropertiesModel().getData().colorPalette&&r.getVizType()==="stacked_column"){var p=r.getDataset().getDimensions(),c=r.getFeeds(),g,b;for(var v=0;v<c.length;v++){if(c[v].getUid()==="color"){g=c[v].getValues()[0];break}}for(var f=0;f<p.length;f++){if(p[f].getName()===g){b=p[f];break}}if(g&&b){var y={};y["bDescending"]=true;b.setSorter(y)}}var C=t?t.getParameter("data"):null;e.setChartUoMTitle(r,C);if(this.bFlag==true){this.bFlag=false;this.vbLayout.setBusy(false)}else{setTimeout(function(){s.vbLayout.setBusy(false);s.bdataLoadedToEnableAddToInsight=true},0)}e.checkNoData(t,this.getCardContentContainer(),r);if(o.system.phone){if(this.getCardPropertiesModel().getProperty("/layoutDetail")==="resizable"){var D=this.oDashboardLayoutUtil.dashboardLayoutModel.getCardById(this.cardId);var m=Math.max(D.dashboardLayout.rowSpan,this.iPreviousRowSpan);this.iPreviousRowSpan=m}if(n.isDataSetEmpty(t)){r.setHeight(50+"px")}else{var P=this._calculateVizFrameHeight();if(P!==undefined&&typeof P==="number"){r.setHeight(P+"px")}}}}})});
//# sourceMappingURL=analyticalChart.controller.js.map