/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 * Any function that needs to be exported(used outside this file) via namespace should be defined as
 * a function and then added to the return statement at the end of this file
 */
sap.ui.define(["sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/ovp/cards/CommonUtils","sap/ui/model/odata/AnnotationHelper","sap/ui/model/odata/v4/AnnotationHelper","sap/ui/Device","sap/ovp/app/resources","sap/base/strings/formatMessage","sap/base/util/isPlainObject","sap/base/util/each","sap/ovp/cards/MetadataAnalyser","sap/base/util/merge","sap/ovp/app/OVPLogger","sap/base/util/isEmptyObject","sap/ui/comp/odata/type/FiscalDate","sap/ui/comp/odata/FiscalFormat","sap/ui/core/library","sap/ovp/cards/Constants","sap/ovp/helpers/V4/MetadataAnalyzer","sap/ovp/app/OVPUtils","sap/ovp/cards/Filterhelper"],function(e,t,r,a,i,n,o,l,u,s,f,c,p,v,g,m,h,y,P,d,C){"use strict";var T=y.errorMessages;var b={TEXT:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT:"com.sap.vocabularies.UI.v1.TextArrangement",UOM:"Org.OData.Measures.V1.Unit",ISO_CURRENCY:"Org.OData.Measures.V1.ISOCurrency"};var D={TEXT_LAST:"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast",TEXT_FIRST:"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst",TEXT_ONLY:"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly",TEXT_SEPARATE:"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeparate"};var I=new p("OVP.cards.AnnotationHelper");function O(e,t){if(!t){return""}var r=Je(e);if(t.Label){return r?t.Label:t.Label.String}var a=e.getSetting&&e.getSetting("ovpCardProperties");var i=a&&a.getProperty("/metaModel");var n=a&&a.getProperty("/entityType");if(!i||!n){return""}var o;if(t.Value){o=r?t.Value.$Path:t.Value.Path}if(t.Target){var l=r?"/"+L(n.$Type,t,e):L(n.$path,t,e);var u=l&&i.getProperty(l);o=r?u&&u.Value.$Path:u&&u.Value.Path}if(!o||!o.length>0||o===" "){return""}var s=r?i.getData()["$Annotations"][n.$Type+"/"+o]:i.getODataProperty(n,o);if(!s){return""}var f="";if(r){f=s["@com.sap.vocabularies.Common.v1.Label"]||""}else{f=s["sap:label"]||(s["com.sap.vocabularies.Common.v1.Label"]||"").String||""}return f}O.requiresIContext=true;function V(e){if(e.EdmType==="Edm.DateTime"||e.EdmType==="Edm.DateTimeOffset"){return"Right"}return"Left"}V.requiresContext=true;function F(e,t){if(e.getSetting){var r=e.getSetting("_ovpCache");if(r){return r[t]}}return undefined}function S(e,t,r){if(e.getSetting){var a=e.getSetting("_ovpCache");if(a){a[t]=r}}}function N(e,t,r){var a,i;if(t){a=t.None;i=r?e&&e.$EnumMember:e&&e.EnumMember;if(i){if(A(i,"Negative")){a=t.Negative}else if(A(i,"Critical")){a=t.Critical}else if(A(i,"Positive")){a=t.Positive}}}return a}function x(e){if(e=="Error"){e=1}else if(e=="Warning"){e=2}else if(e=="Success"){e=3}else{e=0}return e}function A(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1}function E(t,r,a,i,n,o,l,u){if(typeof t=="string"&&u){t=e.getIntegerInstance().parse(t)}var s={};s.EnumMember="None";var f=Number.NEGATIVE_INFINITY;var c=Number.POSITIVE_INFINITY;if(!n&&n!==0&&(a||a===0)){n=a}if(!o&&o!==0&&(i||i===0)){o=i}if(!a&&a!==0){a=f}if(!i&&i!==0){i=c}if(t!==undefined){t=Number(t);if(A(r,"Minimize")||A(r,"Minimizing")){if((o||o===0)&&(i||i===0)){if(t<=parseFloat(o)){s.EnumMember="Positive"}else if(t>parseFloat(i)){s.EnumMember="Negative"}else{s.EnumMember="Critical"}}}else if(A(r,"Maximize")||A(r,"Maximizing")){if((n||n===0)&&(a||a===0)){if(t>=parseFloat(n)){s.EnumMember="Positive"}else if(t<parseFloat(a)){s.EnumMember="Negative"}else{s.EnumMember="Critical"}}}else if(A(r,"Target")){if((o||o===0)&&(i||i===0)&&(n||n===0)&&(a||a===0)){if(t>=parseFloat(n)&&t<=parseFloat(o)){s.EnumMember="Positive"}else if(t<parseFloat(a)||t>parseFloat(i)){s.EnumMember="Negative"}else{s.EnumMember="Critical"}}}}return N(s,l,false)}function R(t,r,a,i,n){if(n&&typeof t=="string"){t=e.getIntegerInstance().parse(t)}if(!t||!r){return}t=Number(t);if(!i&&t-r>=0){return"Up"}if(!a&&t-r<=0){return"Down"}if(r&&i&&t-r>=i){return"Up"}if(r&&a&&t-r<=a){return"Down"}}function M(e,t){var r=e.getPath(0)+"-DataFields-Sorted";var a=F(e,r);var i=Je(e);if(!a){var n=U(e,t);var o=n.map(function(e){return i?e.Value.$Path:e.Value.Path});o=o.filter(function(e){return!!e});var l,u,s;a=t.filter(function(e){s=e&&e.Value||{};l=(i?s.$Path:s.Path)||"";u=(i?e.$Type:e.RecordType)||"";return u==="com.sap.vocabularies.UI.v1.DataField"&&o.indexOf(l)===-1});a=H(a,e);S(e,r,a)}return a}M.requiresIContext=true;function U(e,t,r){var a=e.getPath(0)+"-DataPoints-Sorted";var i=F(e,a);var n=Je(e);if(!i){if(r){i=t.filter(function(e){return _(e,n)})}else{i=t.filter(function(e){return $(e,n)})}i=H(i,e);var o;for(var l=0;l<i.length;l++){o=e.getPath(0).substr(0,e.getPath(0).lastIndexOf("/")+1);i[l]=e.getModel(0).getProperty(L(o,i[l],e));o=""}S(e,a,i)}return i}U.requiresIContext=true;function $(e,t){var r=t?e&&e.$Type:e&&e.RecordType;var a=e&&e.Target||{};var i=(t?a.$AnnotationPath:a.AnnotationPath)||"";return r==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&i.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/)}function _(e,t){var r=t?e&&e.$Type:e&&e.RecordType||"";var a=e&&e.Target||{};var i=(t?a.$AnnotationPath:a.AnnotationPath)||"";return r==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&i.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/)||r==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&i.match(/@com.sap.vocabularies.Communication.v1.Contact.*/)}function w(e){if(!e||!e.Criticality||!e.Criticality.Path){return}return"{path:'"+e.Criticality.Path+"'}"}function L(e,t,r){var a=Je(r);if(a){return e+t.Target.$AnnotationPath}if(e&&!A(e,"/")){e+="/"}return e+t.Target.AnnotationPath.slice(1)}function q(e,t){var r,a;var i=Je(t);var n=i?e["@com.sap.vocabularies.UI.v1.Importance"]:e["com.sap.vocabularies.UI.v1.Importance"];if(n){r=i?n.$EnumMember:n.EnumMember;switch(r){case"com.sap.vocabularies.UI.v1.ImportanceType/High":a=1;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Medium":a=2;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Low":a=3;break}}else{a=4}return a}function H(e,t){if(e.length<2){return e}var r=parseInt(e.length/2,10);var a=e.slice(0,r);var i=e.slice(r,e.length);return j(H(a,t),H(i,t),t)}function j(e,t,r){var a=[];while(e.length&&t.length){var i=q(e[0],r),n=q(t[0],r);if(i<=n){a.push(e.shift())}else{a.push(t.shift())}}while(e.length){a.push(e.shift())}while(t.length){a.push(t.shift())}return a}function B(e,t,r){var a=M(e,t)[r];if(a){return K(e,a)}return""}function k(e,t,r){var a=M(e,t)[r];return O(e,a)}function Y(e,t,r){var a=t.filter($);a=H(a,e);if(!a||!a.length||!a.length>0){return""}return O(e,a[0])}function G(e,t,r,a){var i=U(e,t)[r];if(!i){return""}var n=e.getSetting("ovpCardProperties");var o=n.getProperty("/entityType");var l=n.getProperty("/metaModel");return J(e,i,o,l,a)}function X(e,t,r){var a=U(e,t)[r];return a&&a.Criticality?true:false}function z(e,t,r){var a=U(e,t)[r];var i=a.Criticality.Path;return"{path:'"+i+"'}"}function J(e,t,r,a,i){if(!t||!t.Value){return""}var n=e.getSetting("ovpCardProperties");var o=false;if(n){var l=n.getProperty("/ignoreSapText");o=l==undefined?o:l}var u=a.getODataProperty(r,t.Value.Path);var s=false;if(o==true){if(u&&(u["com.sap.vocabularies.Analytics.v1.Measure"]||u["sap:aggregation-role"]=="measure")){s=true}}if(!s&&u){var f;if(u[b.TEXT]){f=u[b.TEXT].String?u[b.TEXT].String:u[b.TEXT].Path}else if(u["sap:text"]){f=u["sap:text"]}if(f){u=a.getODataProperty(r,f);t={Value:{Path:u.name}}}}return K(e,t,i)}function K(e,t,r,i){if(t.Value.Apply){return a.format(e,t.Value)}var n=e.getSetting("ovpCardProperties");var o=n.getProperty("/entityType");var l=n.getProperty("/metaModel");return Z(e,t,o,l,r,i)}K.requiresIContext=true;function W(e,t,r,i){if(!r||typeof i!=="string"){return i}var n=r[b.TEXT]||r["sap:text"];if(!n){return i}var o,l;o=r[b.TEXT_ARRANGEMENT];l=o&&o.EnumMember;if(!l){o=n&&n[b.TEXT_ARRANGEMENT];l=o&&o.EnumMember}if(!l){o=t&&t[b.TEXT_ARRANGEMENT];l=o&&o.EnumMember}var u;if(typeof n==="object"){u=a.format(e,n)}else{u=a.format(e,{Path:n})}if(!u||u===" "){return i}if(!l){return i+" ("+u+")"}var s;switch(l){case D.TEXT_FIRST:s=u+" ("+i+")";break;case D.TEXT_LAST:s=i+" ("+u+")";break;case D.TEXT_ONLY:s=u;break;case D.TEXT_SEPARATE:s=i+" ("+u+")";break;default:s=i;break}return s}function Z(e,t,r,i,n,o,l){if(t.Value.Apply){return a.format(e,t.Value)}var u=t.Value.Path?t.Value.Path:t.Value.String;var s=i.getODataProperty(r,u),f="",c,p;var v=e.getSetting("ovpCardProperties");var g=v&&v.getProperty("/contentFragment");if(!o){if(t.Value.Path&&t.Value.Path.split("/").length>1){s=ie(i,r,t.Value.Path,e)}if(!s){return""}if(s["type"]==="Edm.DateTime"||s["type"]==="Edm.DateTimeOffset"){var m={relative:true,relativeScale:"auto"},h=v&&v.getProperty("/showDateInRelativeFormat");if(h!==undefined&&!h){m={style:"medium"}}c="sap.ovp.cards.AnnotationHelper.formatDate";p={dateFormat:m,bUTC:s["type"]==="Edm.DateTime"?true:false,functionName:c};f=ee([t.Value.Path?t.Value.Path:s.name],c,p)}else if(t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits||s["scale"]){var y=t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits?t.ValueFormat.NumberOfFractionalDigits.Int:0,P;var d=t.ValueFormat&&t.ValueFormat.ScaleFactor&&t.ValueFormat.ScaleFactor.Decimal;if(s[b.ISO_CURRENCY]){P=s[b.ISO_CURRENCY].Path?s[b.ISO_CURRENCY].Path:s[b.ISO_CURRENCY].String}else if(s[b.UOM]){P=s[b.UOM].Path?s[b.UOM].Path:s[b.UOM].String}else if(s["sap:unit"]){P=s["sap:unit"]}var C=P?i.getODataProperty(r,P):null,T=[t.Value.Path?t.Value.Path:s.name];if(y>2){y=2}p={numberOfFractionalDigits:y,scaleFactor:d};if(s[b.ISO_CURRENCY]){var D=s[b.ISO_CURRENCY];if(D.Path){c="sap.ovp.cards.AnnotationHelper.formatCurrency";T.push(D.Path)}else if(D.String){p.currencyString=D.String;c="sap.ovp.cards.AnnotationHelper.formatCurrency"}}else if(C&&(C[b.ISO_CURRENCY]||C["sap:semantics"]==="currency-code")){c="sap.ovp.cards.AnnotationHelper.formatCurrency";T.push(P)}else{c="sap.ovp.cards.AnnotationHelper.formatNumberCalculation"}p.functionName=c;f=ee(T,c,p)}else{if(l){f=a.simplePath(e,t.Value)}else{var I=a.format(e.getModel()?e:e.getInterface(0),t.Value);var O=I.split(",");var V=[];if(O.length>1){for(var F=0;F<O.length;F++){if(O[F].indexOf("path:")>=0||O[F].indexOf("type:")>=0){V.push(O[F])}}if(V.length>0){f=f+V.join(",");if(f.substring(f.length-1)!=="}"){f=f+"}"}}}else{f=I}}}if(g){f=W(e,r,s,f)}if(s&&s[b.UOM]){var S=s[b.UOM];if(S.Path){f+=" "+ee([S.Path]);f+=" "+Q(S.Path,i,r,e)}else if(S.String){if(S.String!=="%"){f+=" "}f+=S.String}}}if(!n){if(s[b.ISO_CURRENCY]){var D=s[b.ISO_CURRENCY];if(D){if(D.Path){f+=" "+ee([D.Path]);f+=" "+Q(D.Path,i,r,e)}else if(D.String){f+=" "+D.String}}}}if(f[0]===" "){f=f.substring(1)}return f}function Q(e,t,r,a){if(e){var i,n,o;var l=Je(a);if(e.split("/").length>1){i=ie(t,r,e,a);n=me(t,r,e,a)}else{i=l?Ht(t,r,e):t.getODataProperty(r,e)}if(i){o=l?i["@"+b.TEXT]&&i["@"+b.TEXT].$Path:i[b.TEXT]&&i[b.TEXT].Path||i["sap:text"]}if(o&&n){o=n+"/"+o}if(o){return" ({"+o+"})"}return""}}function ee(e,t,r,a){var i="",n=e.length;if(n>1||r){i="{parts:[";for(var o=0;o<n;o++){if(a){i+="{path: '"+e[o]+"',type:'sap.ui.model.odata.type.String'}"+(o===n-1&&!r?"]":", ")}else{i+="{path: '"+e[o]+"'}"+(o===n-1&&!r?"]":", ")}}if(r){var l="{value:"+JSON.stringify(r)+", model: 'ovpCardProperties'}";i+=l+"]"}}else{i="{path: '"+e[0]+"'"}i+=(t?", formatter: '"+t+"'":"")+"}";return i}function te(){var t=arguments[arguments.length-1],r=arguments[0];var a=e.getFloatInstance({style:"short",showMeasure:false,shortRefNumber:t.scaleFactor,minFractionDigits:t.numberOfFractionalDigits,maxFractionDigits:t.numberOfFractionalDigits});if(typeof r=="string"&&t.bODataV4){r=e.getIntegerInstance().parse(r)}return a.format(Number(r))}function re(){var e=arguments[arguments.length-1],r=arguments[0];var a=t.getInstance(e.dateFormat);if(!r){r="";return r}return a.format(new Date(r),e.bUTC)}function ae(){var t=arguments[arguments.length-1],r=Number(arguments[0]),a=arguments[1];var i="";var n=e.getCurrencyInstance({style:"short",showMeasure:false,shortRefNumber:t.scaleFactor,minFractionDigits:t.numberOfFractionalDigits,maxFractionDigits:t.numberOfFractionalDigits});if(typeof r=="string"&&t.bODataV4){r=e.getIntegerInstance().parse(r)}if(a){i=n.format(r,a)}else{i=t.currencyString?n.format(r,t.currencyString):n.format(r)}return i}function ie(e,t,r,a){var i=r.split("/");var n=Je(a);if(i.length>1){if(n){for(var o=0;o<i.length-1;o++){t=e.getProperty("/"+t.$Type)[i[o]]}return Ht(e,t,i[i.length-1])}else{for(var o=0;o<i.length-1;o++){var l=e.getODataAssociationEnd(t,i[o]);if(l){t=e.getODataEntityType(l.type)}}return e.getODataProperty(t,i[i.length-1])}}}function ne(e,t,r){var a=U(e,t);var i=y.Criticality.StateValues;var n=a[r];if(!n){return i.None}if(n.Criticality){return se(e,n,i)}return ce(e,n,i)}function oe(e,t,r){var a=U(e,t);if(a&&a.length){var i=a[0];if(i&&(i.Criticality||i.CriticalityCalculation)){return true}}return false}function le(e,t,r){if(oe(e,t,r)){return""}return"sapUiChartPaletteQualitativeHue1"}le.requiresIContext=true;function ue(e,t,r){var a=U(e,t),i=y.Criticality.ColorValues;var n=i.None;if(a.length>r){var o=a[r];if(o&&o.Criticality){n=se(e,o,i)}else{n=ce(e,o,i)}}return n}function se(e,t,r){var n=r.None;var o;var u=t.Criticality;var s=Je(e);if(u){o="'{'= ({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Negative'') || ({0} === ''1'') || ({0} === 1) ? ''"+r.Negative+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Critical'') || ({0} === ''2'') || ({0} === 2) ? ''"+r.Critical+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Positive'') || ({0} === ''3'') || ({0} === 3) ? ''"+r.Positive+"'' : "+"''"+r.None+"'' '}'";if(u.Path&&!s){var f="$"+a.simplePath(e,u);n=l(o,f)}else if(s&&u.$Path){var f="$"+i.format(u,{context:e});n=l(o,f)}else if(u.EnumMember||u.$EnumMember){var c=s?u.$EnumMember:u.EnumMember;var p="'"+c+"'";n=l(o,p)}else{I.warning("Case not supported, returning the default Neutral state")}}else{I.warning("Case not supported, returning the default Neutral state")}return n}function fe(e,t,r){var a=U(e,t);var i="None";if(a.length>r){var n=a[r];if(n&&n.Criticality&&n.Criticality.Path){i=z(e,t,r)}else{i=ce(e,n,y.Criticality.StateValues);i=x(i)}}return i}function ce(e,t,r,a){var i=Je(e);var n=r.None;var o=t&&t.Value||{};var l=i?o.$Path:o.Path;if(t.Criticality){n=N(t.Criticality,r,i)}else if(t.CriticalityCalculation&&l){n=pe(e,t,r,a)}return n}function pe(e,t,r,a){var i=Je(e);var n=Ve(t.Value,i,a);var o=i?t.CriticalityCalculation.ImprovementDirection.$EnumMember:t.CriticalityCalculation.ImprovementDirection.EnumMember;var l=Ve(t.CriticalityCalculation.DeviationRangeLowValue,i,a);var u=Ve(t.CriticalityCalculation.DeviationRangeHighValue,i,a);var s=Ve(t.CriticalityCalculation.ToleranceRangeLowValue,i,a);var f=Ve(t.CriticalityCalculation.ToleranceRangeHighValue,i,a);var c=ge(l);var p=ge(u);var v=ge(s);var g=ge(f);var m="sap.ovp.cards.AnnotationHelper.formatColor";var h={deviationLow:l,deviationHigh:u,toleranceLow:s,toleranceHigh:f,bIsDeviationLowBinding:c,bIsDeviationHighBinding:p,bIsToleranceLowBinding:v,bIsToleranceHighBinding:g,sImprovementDirection:o,oCriticalityConfigValues:r,functionName:m,bODataV4:i};var y="{value:"+JSON.stringify(h)+", model: 'ovpCardProperties'}";var P="parts: ["+n;P+=c?","+l:"";P+=p?","+u:"";P+=v?","+s:"";P+=g?","+f:"";P+=","+y;P+="]";return"{"+P+", formatter: '"+m+"'}"}function ve(){var e=arguments[arguments.length-1];var t=1;if(e&&e.bODataV4){return E(arguments[0],e.sImprovementDirection,e.bIsDeviationLowBinding?parseFloat(arguments[t++].split(",").join("")):e.deviationLow,e.bIsDeviationHighBinding?parseFloat(arguments[t++].split(",").join("")):e.deviationHigh,e.bIsToleranceLowBinding?parseFloat(arguments[t++].split(",").join("")):e.toleranceLow,e.bIsToleranceHighBinding?parseFloat(arguments[t++].split(",").join("")):e.toleranceHigh,e.oCriticalityConfigValues,e.bODataV4)}return E(arguments[0],e.sImprovementDirection,e.bIsDeviationLowBinding?arguments[t++]:e.deviationLow,e.bIsDeviationHighBinding?arguments[t++]:e.deviationHigh,e.bIsToleranceLowBinding?arguments[t++]:e.toleranceLow,e.bIsToleranceHighBinding?arguments[t++]:e.toleranceHigh,e.oCriticalityConfigValues,e.bODataV4)}function ge(e){return typeof e==="string"&&e.charAt(0)==="{"}function me(e,t,r,a){var i="";var n=r.split("/");var o=Je(a);if(n.length>1){if(o){n.pop();i=n.join("/")}else{for(var l=0;l<n.length-1;l++){var u=e.getODataAssociationEnd(t,n[l]);if(u){t=e.getODataEntityType(u.type);if(i){i=i+"/"}i=i+n[l]}else{return i}}}}return i}function he(e){var t;if(e&&typeof e.getData==="function"){var r=e.getData();if(r.tabs){var a=0;var i=r.selectedKey;if(i&&r.tabs.length>=i){a=i-1}t=r.tabs[a].mFilterPreference}else{t=r.mFilterPreference}}return!!t}function ye(e,t){var r=e.getSetting("ovpCardProperties");var a=r.getProperty("/addODataSelect");var i=r.getProperty("/metaModel");var n=i.getODataEntityType(t.entityType);var o=n[r.getProperty("/selectionAnnotationPath")];var l=n[r.getProperty("/presentationAnnotationPath")];var u="/"+t.name;var s=Array.prototype.slice.call(arguments,2);var c=e.getSetting("ovpCardProperties"),p=c.getProperty("/parameters");var v=Je(e);if(o||!!p){if(o&&o.Parameters&&o.Parameters.length>0||!!p){u=f.resolveParameterizedEntitySet(e.getSetting("dataModel"),t,o,p)}}if(r.getProperty("/cardLayout")&&r.getProperty("/cardLayout/noOfItems")){var g="{path: '"+u+"', length: "+ +r.getProperty("/cardLayout/noOfItems")}else{var g="{path: '"+u+"', length: "+Fe(r)}var m=[];if(a){m=de(e,i,n,s);var h=r.getProperty("/template");if(h!="sap.ovp.cards.charts.analytical"&&h!="sap.ovp.cards.charts.smart.chart"){var y=be(l);for(var P=0;P<y.length;P++){if(m.indexOf(y[P])===-1){m.push(y[P])}}}}var d=Pe(i,n,s,e);var T=he(r);var b=false;if(T||m.length>0||d.length>0){g=g+", parameters: {"}if(m.length>0||d.length>0){if(m.length>0){g=g+"select: '"+m.join(",")+"'";b=true}if(d.length>0){if(m.length>0){g=g+", "}g=g+"expand: '"+d.join(",")+"'";b=true}if(T){g=g+", "}}if(T){g=g+"custom: {cardId: '"+r.getProperty("/cardId")+"'"+", _requestFrom: 'ovp_internal'}";b=false}else if(!g.includes(", parameters: {")){g=g+", parameters: {custom: {_requestFrom: 'ovp_internal'}}";b=false}else if(b){g=g+", custom: {_requestFrom: 'ovp_internal'}"}if(T||m.length>0||d.length>0){g=g+"}"}var D=Te(r,l,v);if(D.length>0){g=g+", sorter:"+JSON.stringify(D)}var I=C.getFilters(r,o);if(I.length>0){I=C.createExcludeFilters(I,r);g=g+", filters:"+JSON.stringify(I)}g=g+"}";return g}ye.requiresIContext=true;function Pe(e,t,r,a){var i=[];var n,o,l,u;for(var s=0;s<r.length;s++){if(!r[s]){continue}n=t.$path+"/"+r[s];o=e.createBindingContext(n);l=o.getObject();l=l?l:[];for(var f=0;f<l.length;f++){if(l[f].Value&&l[f].Value.Path){u=me(e,t,l[f].Value.Path,a);if(u&&i.indexOf(u)===-1){i.push(u)}var c=e.getODataProperty(t,l[f].Value.Path);if(c){var p;if(c[b.UOM]){p=c[b.UOM].Path}else if(c[b.ISO_CURRENCY]){p=c[b.ISO_CURRENCY].Path}else if(c[b.TEXT]){p=c[b.TEXT].Path}if(p&&p.split("/").length>1){u=me(e,t,p,a);if(u&&i.indexOf(u)===-1){i.push(u)}}else{var v=e.getODataProperty(t,p);if(v){var g=v[b.TEXT]&&v[b.TEXT].Path;if(g&&g.split("/").length>1){u=me(e,t,g,a);if(u&&i.indexOf(u)===-1){i.push(u)}}}}}}}}return i}function de(e,t,i,n){var o=[];var l,s,f;for(var p=0;p<n.length;p++){if(!n[p]){continue}l=i.$path+"/"+n[p];s=t.createBindingContext(l);var v={};if(e&&e.bDummyContext){c(v,e,s,true)}else{v=e}f=s.getObject();if(!f){f=[]}else if(u(f)){if(f.Data){f=f.Data}else{f=[]}}var g;var m;var h;var y;for(var P=0;P<f.length;P++){m=[];g=f[P];h="";y=g.RecordType;if(y==="com.sap.vocabularies.UI.v1.DataField"){h=Z(v,g,i,t,undefined,undefined,true)}else if(y==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){var d=L(i.$path,g,e);h=J(v,t.getProperty(d),i,t);var C=w(t.getProperty(d));if(C&&C.length>0){h+=C}}else if(y==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"&&g.Url){var T;if(!g.Url.UrlRef){T=a.format(v,g.Url)}if(T&&T.substring(0,2)==="{="){h=T}}if(h){var b=a.simplePath(v,g.Value);if(h.indexOf("(")<0&&h!==b){h=[].concat(b,h).join(" ")}m=Ce(h)}if(m&&m.length>0){var D;for(var I=0;I<m.length;I++){D=m[I];if(!o[D]){o[D]=true;var O=r.getUnitColumn(D,i);if(O&&O!==D){o[O]=true}var V=Lt(t,i,D,e);if(V&&V!==D){o[V]=true}}}}}}return Object.keys(o)}function Ce(e){var t,r=0,a=e.length,i="",n;for(t=0;t<a;t++){n=e.charAt(t);if(!n){return}switch(n){case"{":r++;break;case"}":r--;break;default:if(r<=0){continue}break}i+=n}e=i;var o=/\${([a-zA-Z0-9\_|\/]*)/g;var l=/[^[{]*[a-zA-Z0-9\_]/g;var u=/path *\: *\'([a-zA-Z0-9\_]+)*\'/g;var s,f,c=[];if(e.indexOf("{parts:[")!==-1){e=e.replace("{parts:[","");e=e.replace("]","");e=e.replace(e.lastIndexOf("}",""))}if(e.substring(0,2)==="{="){s=o;f=1}else if(e.indexOf("path")!==-1){if(e.indexOf("{value")>0){var p=0;var t=e.indexOf("{value")+5;var v;while(t<a){if(e[t]==="}"&&p===0){v=t;break}if(e[t]==="{"){p+=1}if(e[t]==="}"){p-=1}t++}e=e.slice(0,e.indexOf("{value"))+e.slice(v)}if(e.indexOf("constraints:{")!==-1){var p=0;var t=e.indexOf("constraints:{")+12;var v;while(t<a){if(e[t]==="{"){p+=1}if(e[t]==="}"){p-=1;if(p===0){v=t;break}}t++}e=e.slice(0,e.indexOf("constraints:{")-1)+e.slice(v+1)}var g=l.exec(e);while(g){if(g[0].indexOf("path")===-1&&g[0].indexOf("@i18n")!==0&&g[0].indexOf("model: 'ovpCardProperties'")<=-1){c.push(g[0])}g=l.exec(e)}s=u;f=1}else{s=l;f=0}var m=s.exec(e);while(m){if(m[f]&&m[f].indexOf("@i18n")!==0){c.push(m[f])}m=s.exec(e)}return c}function Te(e,t,r){var a=[];var i,n;var o=e.getProperty("/sortBy");if(o){var l=e.getProperty("/sortOrder");if(l&&l.toLowerCase()!=="descending"){n=false}else{n=true}i={path:o,descending:n};a.push(i)}var u=t&&t.SortOrder||undefined;var s,o;if(u){for(var f=0;f<u.length;f++){s=u[f];o=r?s.Property.$PropertyPath:s.Property.PropertyPath;n=C.getBooleanValue(s.Descending,true);i={path:o,descending:n};a.push(i)}}return a}function be(e){var t=[];var r=e&&e.RequestAtLeast||undefined;if(r){for(var a=0;a<r.length;a++){if(r[a].PropertyPath){t.push(r[a].PropertyPath)}}}return t}function De(e,t){var r=e.getProperty("/selectionAnnotationPath");var a,i;if(t&&r){var n=e.getProperty("/entityType");var o=e.getProperty("/metaModel");a=o.getObject("/"+n.$Type+"/@");r="@"+r}else{a=e.getProperty("/entityType")}i=r&&a[r];return{filters:C.getFilters(e,i,t),parameters:Oe(i,t)}}function Ie(e,t){if(!e){return}var r=e.getProperty("/entityType");var a=r[e.getProperty("/presentationAnnotationPath")];var i=Te(e,a,t);var n=[];var o,l=i.length;for(o=0;o<l;o++){if(!i[o].path){continue}n.push({Property:i[o].path,Descending:i[o].descending})}if(n.length>0){return{SortOrder:n}}}function Oe(e,t){var r,a=[];if(!e||!e.Parameters){return a}var i=e.Parameters.length;for(var n=0;n<i;n++){r=e.Parameters[n];if(!r.PropertyName||!r.PropertyName.PropertyPath){continue}if(!r.PropertyValue){I.error("Missing value for parameter "+r.PropertyName.PropertyPath);continue}a[a.length]={path:r.PropertyName.PropertyPath,value:C.getPrimitiveValue(r.PropertyValue,t)}}return a}function Ve(e,t,r){if(e){var a=t?e.$Path:e.Path;if(a){return r?"{path:'"+a+"Agg"+"', type:'sap.ui.model.odata.type.Decimal'}":"{path:'"+a+"'}"}else{return C.getPrimitiveValue(e,t)}}else{return""}}function Fe(e){var t=e.getProperty("/contentFragment");var r=e.getProperty("/listType");var a=e.getProperty("/listFlavor");var i;var o="desktop";if(n.system.phone){o="phone"}else if(n.system.tablet){o="tablet"}if(t=="sap.ovp.cards.list.List"){if(r=="extended"){if(a=="bar"){i=y.ItemLength["List_extended_bar"]}else{i=y.ItemLength["List_extended"]}}else if(a=="bar"){i=y.ItemLength["List_condensed_bar"]}else{i=y.ItemLength["List_condensed"]}}else if(t=="sap.ovp.cards.table.Table"){i=y.ItemLength["Table"]}else if(t=="sap.ovp.cards.stack.Stack"){if(e.getProperty("/objectStreamCardsNavigationProperty")){i=y.ItemLength["Stack_complex"]}else{i=y.ItemLength["Stack_simple"]}}if(i){return i[o]}return 5}function Se(e){var t=e.getObject();var r=U(e,t,true);var a,i;var n=Je(e);var o,l;var u=r.map(function(e){a=e&&e.Value;i=e&&e.fn;if(a&&(a.Path||a.$Path)){return n?a.$Path:a.Path}else if(i&&(i.Path||i.$Path)){return n?i.$Path:i.Path}});t.filter(function(e,r){o=n?e.$Type:e.RecordType;l=n?e.Value&&e.Value.$Path:e.Value&&e.Value.Path;if(o==="com.sap.vocabularies.UI.v1.DataField"&&u.indexOf(l)>-1){t.splice(r,1)}});if(n){return e.sPath}}Se.requiresIContext=true;function Ne(e,t){var r=U(e,t);return r.length}Ne.requiresIContext=true;function xe(e,t){return Ae(e,t,0)}xe.requiresIContext=true;function Ae(e,t,r){var a=U(e,t),i=a[r],n=i&&i.Value,o=Je(e),l=o?n&&n.$Path:n&&n.Path;return l||""}function Ee(e,t){return k(e,t,0)}Ee.requiresIContext=true;function Re(e,t){return k(e,t,1)}Re.requiresIContext=true;function Me(e,t){return k(e,t,2)}Me.requiresIContext=true;function Ue(e,t,r){return B(e,t,r)}Ue.requiresIContext=true;function $e(e,t,r){return G(e,t,r)}$e.requiresIContext=true;function _e(e,t,r,a){var i=Ne(e,t);if(i>0){return $e(e,t,r)}else{return Ue(e,t,a)}}_e.requiresIContext=true;function we(e,t,r){return tt(e,t,r)}we.requiresIContext=true;function Le(e,t){return Y(e,t,0)}Le.requiresIContext=true;function qe(e,t){var r=Je(e);var n;for(var o=0;o<t.length;o++){var l=t[o];n=r?l.$Type:l.RecordType;if(n==="com.sap.vocabularies.UI.v1.DataField"){if(l.IconUrl&&l.IconUrl.String){return l.IconUrl.String}if(r&&l.IconUrl&&l.IconUrl.$Path){return i.format(l.IconUrl,{context:e})}if(!r&&l.IconUrl&&l.IconUrl.Path){return a.simplePath(e,l.IconUrl)}}}}qe.requiresIContext=true;function He(e,t,r){var a="";var i;if(Array.isArray(t)){i=U(e,t)[r]}else{var n=Object.assign({},t);var o=Object.assign({},e);i=Qe(o,n)}if(!i||!i.Value){return a}var l=e.getSetting("ovpCardProperties");var u=l&&l.getProperty("/entityType");var s=l&&l.getProperty("/metaModel");var f=Je(e);var c=f?s&&s.getData()["$Annotations"][u.$Type+"/"+i.Value.$Path]:s&&s.getODataProperty(u,i.Value.Path);var p=f?c&&c["@"+b.ISO_CURRENCY]:c&&c[b.ISO_CURRENCY];if(p&&!f){if(p.Path){a+=" "+ee([p.Path]);a+=" "+Q(p.Path,s,u,e)}else if(p.String){a+=" "+p.String}}else if(p&&f){if(p.$Path){a+=" "+ee([p.$Path])}else{a+=" "+p}a+=" "+Q(p.$Path,s,u,e)}return a}He.requiresIContext=true;function je(e,t,r,a){return G(e,t,r,a)}je.requiresIContext=true;function Be(e,t){return ne(e,t,0)}Be.requiresIContext=true;function ke(e,t){return ue(e,t,0)}ke.requiresIContext=true;function Ye(e,t){return ne(e,t,1)}Ye.requiresIContext=true;function Ge(e,t){return ne(e,t,2)}Ge.requiresIContext=true;function Xe(e,t){return fe(e,t,0)}Xe.requiresIContext=true;function ze(e){var t={};t.EnumMember="None";if(Number(e)===1){t.EnumMember="Negative"}else if(Number(e)===2){t.EnumMember="Critical"}else if(Number(e)===3){t.EnumMember="Positive"}return N(t,y.Criticality.ColorValues,false)}function Je(e){var t=e&&typeof e.getModel==="function"&&e.getModel(0)&&e.getModel(0).oModel;return t&&r.isODataV4(t)||false}function Ke(e,t){var r=Je(e),a=t&&t.Criticality||{},i=r?a.$Path:a.Path;if(i&&r){return"{parts: [{path:'"+i+"Agg', type:'sap.ui.model.odata.type.Decimal'}], formatter: 'sap.ovp.cards.AnnotationHelper.kpiValueCriticality'}"}else if(i&&!r){return"{parts: [{path:'"+t.Criticality.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.kpiValueCriticality'}"}else{return ce(e,t,y.Criticality.ColorValues,r)}}Ke.requiresIContext=true;function We(e,t){return X(e,t,0)}We.requiresIContext=true;function Ze(e,t){var r=U(e,t)[0];return r&&(r.Criticality||r.CriticalityCalculation)?true:false}Ze.requiresIContext=true;function Qe(e,t){var r=e.getPath(0);var a=r.slice(0,r.lastIndexOf("/"));a=a.slice(0,a.lastIndexOf("/"));var i=L(a,t,e);t=e.getModel(0).getProperty(i);return t}function et(e,t){if(!t){return""}return K(e,t)}et.requiresIContext=true;function tt(e,t,r,n){var o;var l=Je(e);var u=n==undefined?r:M(e,r)[n];var s=e.getSetting("ovpCardProperties");var f=s.getProperty("/metaModel");var c=l?t.$Type:f.getODataEntityType(t.entityType);var p=l?f.getData()["$Annotations"][c+"/"+u.Value.$Path]:c.property;if(p&&l){o=p["@com.sap.vocabularies.Common.v1.SemanticObject"];if(o){return i.format(o,e.getModel()?{context:e}:{context:e.getInterface(0)})}else{return""}}if(p&&!l){for(var v=0;v<p.length;v++){if(u.Value.Path===p[v].name){o=p[v]["com.sap.vocabularies.Common.v1.SemanticObject"];if(o){return a.format(e,o)}else{return""}}}}}function rt(e,t,r){var a=Je(e);var i=t&&t.Value;var n=t&&t[r]&&t[r].Value;var o=a?i&&i.$Path:i&&i.Path;var l=a?n&&n.$Path:n&&n.Path;var u=r===undefined?o:l;var s=u.indexOf("/")!=-1?u.split("/")[0]:"";return s}rt.requiresIContext=true;function at(e,t){var r=e.getSetting("ovpCardProperties");var a=r.getProperty("/metaModel");var i=Je(e);var n=i?a.getData()["$Annotations"][t.$Type]:a.getODataEntityType(t.entityType);var o="com.sap.vocabularies.Communication.v1.Contact";if(i){o="@"+o}return n&&n[o]?true:false}at.requiresIContext=true;function it(e,t,r){if(!t){return""}var a=e.getSetting("ovpCardProperties");var i=a.getProperty("/entityType");var n=a.getProperty("/metaModel");var o=Object.assign({},t);var l=Object.assign({},e);t=Qe(l,o);return J(e,t,i,n,r)}it.requiresIContext=true;function nt(e,t){var r=Object.assign({},t);var a=Object.assign({},e);var i="None",n=y.Criticality.StateValues;t=Qe(a,r);if(t&&t.Criticality){i=se(e,t,n)}else{i=ce(e,t,n)}return i}nt.requiresIContext=true;function ot(e,t){var r=Object.assign({},t);var a=Object.assign({},e);t=Qe(a,r);if(t&&t.Criticality){return true}}ot.requiresIContext=true;function lt(e,t){var r=Object.assign({},t);var a=Object.assign({},e);var i=e.getSetting("ovpCardProperties");var n=i.getProperty("/entityType");var o=i.getProperty("/metaModel");var l=Je(e);t=Qe(a,r);if(!t){return}var u=l?o.getProperty("/"+n.$Type)[t.Value.$Path]:o.getODataProperty(n,t.Value.Path);var s=l?u&&u.$Type:u&&u.type;if(t&&s=="Edm.String"&&(t.Criticality||t.CriticalityCalculation)){return"Center"}if(u&&(s=="Edm.DateTime"||s=="Edm.DateTimeOffset")){return"Right"}}lt.requiresIContext=true;function ut(e,t){var r=Object.assign({},t);var a=Object.assign({},e);t=Qe(a,r);var i="None";if(t&&t.Criticality&&t.Criticality.Path){i="{path:'"+t.Criticality.Path+"'}"}else{i=ce(e,t,y.Criticality.StateValues);i=x(i)}return i}ut.requiresIContext=true;function st(e,t){var r;var a=Je(e);var i;for(var n=0;n<t.length;n++){r=t[n];i=a?r.$Type:r.RecordType;if(i==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||i==="com.sap.vocabularies.UI.v1.DataFieldForAction"||i==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){return true}}return false}st.requiresIContext=true;function ft(e,t){var r=U(e,t)[0];var a=Je(e);var i=r&&r.Value;var n=a?i&&i.$Path:i&&i.Path;if(n){var o=e.getPath(0).substr(0,e.getPath(0).lastIndexOf("/")+1);var l=e.getModel(0);var u;if(!a){u=l.getProperty(o)}var s=a?l.getData(n):l.getODataProperty(u,n);var f=o.substr(1,o.length-2);if(s&&s[b.UOM]&&!a){return s[b.UOM].String==="%"}if(a&&s&&s[f][r.Value.$Path][b.UOM]){return s[b.UOM].String==="%"}}return false}ft.requiresIContext=true;function ct(e){var t=e.getObject();var r=e.getModel();var a=r.getProperty("/metaModel");var i=a.getODataEntitySet(r.getProperty("/entitySet"));var n=a.getODataEntityType(i.entityType);t=n.$path+"/"+t;return a.createBindingContext(t)}function pt(e,t,r){var a=e.getServiceMetadata().dataServices.schema[0].association;for(var i=0;i<a.length;i++){if(r+"."+a[i].name===t){return a[i]}}}function vt(e,t,r){var a=Je(e);var i=t.filter(function(e){return a?e.$Type==="com.sap.vocabularies.UI.v1.DataField":e.RecordType==="com.sap.vocabularies.UI.v1.DataField"});var n=H(i,e);if(n){return n[r]}return}function gt(e,t,r){if(!r||!r.length||r.length===0){return false}r=vt(e,r,0);return tt(e,t,r)}gt.requiresIContext=true;function mt(e,t,r){if(!r||!r.length||r.length===0){return false}r=vt(e,r,1);return tt(e,t,r)}mt.requiresIContext=true;function ht(e,t,r){var a=Je(e);var i,n,o;var l=t.filter(function(e){i=a?e.$Type:e.RecordType;o=e&&e.Target||{};n=a?o.$AnnotationPath:o.AnnotationPath||"";return i==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&n.indexOf("@com.sap.vocabularies.Communication.v1.Contact")!==-1});var u=H(l,e);if(u){return u[r]}return}function yt(e,t){if(!t||!t.length||t.length===0){return false}var r=ht(e,t,0);if(r){return true}return false}yt.requiresIContext=true;function Pt(e,t,a,i){var n,o,l;if(a&&a.Value&&a.Value.Path){n=a.Value.Path}else if(a&&a.Description&&a.Description.Value&&a.Description.Value.Path){n=a.Description.Value.Path}if(a&&a.Description&&a.Description.Path){o=a.Description.Path}else if(a&&a.Title&&a.Title.Path){l=a.Title.Path}var u="";var s=i&&i.Parameters;var c="";var p=e.getSetting("ovpCardProperties"),v=p.getProperty("/parameters");s=s||!!v;if(s){var g=e.getSetting("dataModel");var m=f.resolveParameterizedEntitySet(g,t,i,v);u+="{path: '"+m+"'"}else{u+="{path: '/"+t.name+"'"}u+=", length: 1";var h=e.getSetting("ovpCardProperties");var y=h.getProperty("/entityType");var P=r.getUnitColumn(n,y);var d=C.getFilters(h,i);if(d.length>0){d=C.createExcludeFilters(d,h);c+=", filters: "+JSON.stringify(d)}var T=[];T.push(n);if(o){T.push(o)}else if(l){T.push(l)}if(a&&a.Criticality&&a.Criticality.Path){T.push(a.Criticality.Path)}if(a&&a.CriticalityCalculation&&a.CriticalityCalculation.DeviationRangeLowValue&&a.CriticalityCalculation.DeviationRangeLowValue.Path){T.push(a.CriticalityCalculation.DeviationRangeLowValue.Path)}if(a&&a.CriticalityCalculation&&a.CriticalityCalculation.ToleranceRangeLowValue&&a.CriticalityCalculation.ToleranceRangeLowValue.Path){T.push(a.CriticalityCalculation.ToleranceRangeLowValue.Path)}if(a&&a.CriticalityCalculation&&a.CriticalityCalculation.DeviationRangeHighValue&&a.CriticalityCalculation.DeviationRangeHighValue.Path){T.push(a.CriticalityCalculation.DeviationRangeHighValue.Path)}if(a&&a.CriticalityCalculation&&a.CriticalityCalculation.ToleranceRangeHighValue&&a.CriticalityCalculation.ToleranceRangeHighValue.Path){T.push(a.CriticalityCalculation.ToleranceRangeHighValue.Path)}if(P){T.push(P)}if(a&&a.TrendCalculation&&a.TrendCalculation.ReferenceValue&&a.TrendCalculation.ReferenceValue.Path){T.push(a.TrendCalculation.ReferenceValue.Path)}var b=he(p);var D=b?", custom: {cardId: '"+p.getProperty("/cardId")+"', _requestFrom: 'ovp_internal'}":", custom: {_requestFrom: 'ovp_internal'}";var I=p.getProperty("/searchQuery");var O=p.getProperty("/enableOVPCardAsAPI");if(I&&O){if(D===""){D=", custom: {search: '"+I+"'}"}else{D=D.slice(0,11)+"search: '"+I+"', "+D.slice(11)}}return u+", parameters:{select:'"+T.join(",")+"'"+D+"}"+c+"}"}Pt.requiresIContext=true;function dt(e,t){if(!t||!t.Value){return""}var r=Je(e);var a=r?t.Value.$Path:t.Value.Path;if(!a){return""}var i=e.getSetting("ovpCardProperties");var n=i.getProperty("/entityType");var o=i.getProperty("/metaModel");var l=r?Ht(o,n,a):o.getODataProperty(n,a);var u=t&&t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits;var s=u&&u.Int;if(l[b.UOM]){var f=l[b.UOM];if(f.String=="%"){i.oData.percentageAvailable=true}}if(u&&r){i.oData.NumberOfFractionalDigits=u}else if(!r&&s){i.oData.NumberOfFractionalDigits=s}var c={NumberOfFractionalDigits:i.oData.NumberOfFractionalDigits||0,percentageAvailable:i.oData.percentageAvailable||false};var p="sap.ovp.cards.AnnotationHelper.KpiValueFormatter";var v=r?a+"Agg":a;var g=[v];return ee(g,p,c,r)}dt.requiresIContext=true;function Ct(){var t=arguments[arguments.length-1],r=arguments[0];var a=e.getFloatInstance({minFractionDigits:t.NumberOfFractionalDigits,maxFractionDigits:t.NumberOfFractionalDigits,style:"short",showScale:true,shortRefNumber:r});if(t.percentageAvailable){return a.format(Number(r))+" %"}else{return a.format(Number(r))}}function Tt(e,t){if(!t||!t.Value||!t.Value.Path&&!t.Value.$Path||!t.TrendCalculation){return""}var r=Je(e);var a=Ve(t.Value,r,r);var i=Ve(t.TrendCalculation.ReferenceValue,r,r);var n=Ve(t.TrendCalculation.DownDifference,r,r);var o=Ve(t.TrendCalculation.UpDifference,r,r);var l=ge(i);var u=ge(n);var s=ge(o);var f={referenceValue:i,downDifference:n,upDifference:o,bIsRefValBinding:l,bIsDownDiffBinding:u,bIsUpDiffBinding:s,bODataV4:r};var c="{value:"+JSON.stringify(f)+", model: 'ovpCardProperties'}";var p="parts: ["+a;p+=l?","+i:"";p+=u?","+n:"";p+=s?","+o:"";p+=","+c;p+="]";var v="sap.ovp.cards.AnnotationHelper.formatTrendIcon";return"{"+p+", formatter: '"+v+"'}"}Tt.requiresIContext=true;function bt(){var e=arguments[arguments.length-1];var t=1;return R(arguments[0],e.bIsRefValBinding?arguments[t++]:e.referenceValue,e.bIsDownDiffBinding?arguments[t++]:e.downDifference,e.bIsUpDiffBinding?arguments[t++]:e.upDifference,e.bODataV4)}function Dt(e,t){if(!t||!t.TrendCalculation||!t.TrendCalculation.ReferenceValue){return""}var r=Je(e);var a=e.getSetting("ovpCardProperties");var i=t&&t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits;if(r&&i){a.oData.NumberOfFractionalDigits=i}else if(!r&&i&&i.Int){a.oData.NumberOfFractionalDigits=i.Int}if(t.TrendCalculation.ReferenceValue.Path&&!r){return"{parts: [{path:'"+t.Value.Path+"'}, {path:'"+t.TrendCalculation.ReferenceValue.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.returnPercentageChange'}"}if(t.TrendCalculation.ReferenceValue.$Path&&r){return"{parts: [{path:'"+t.Value.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'}, {path:'"+t.TrendCalculation.ReferenceValue.$Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.returnPercentageChange'}"}if(r){return"{parts: [{path:'"+t.Value.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'}], formatter: 'sap.ovp.cards.AnnotationHelper.returnPercentageChange'}"}else{return"{parts: [{path:'"+t.Value.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.returnPercentageChange'}"}}Dt.requiresIContext=true;function It(t,r){var a,i,n,o,l=false;if(typeof t=="string"){t=e.getIntegerInstance().parse(t)}if(isNaN(+t)){return""}o=t==0?r:t;i=this.getModel("ovpCardProperties");if(i.getProperty("/iNumberOfFractionalDigits")){n=+i.getProperty("/iNumberOfFractionalDigits")}if(i.getProperty("/bPercentageAvailableForTarget")){l=true}if(r){a=r}else{if(i.getProperty("/sManifestTargetValue")){a=i.getProperty("/sManifestTargetValue")}}if(!n||n<0){n=0}else if(n>2){n=2}if(a){var u=e.getFloatInstance({minFractionDigits:n,maxFractionDigits:n,style:"short",showScale:true,shortRefNumber:o});if(l){return u.format(+a)+" %"}else{return u.format(+a)}}}function Ot(e,t){if(!t||!t.TrendCalculation||!t.TrendCalculation.ReferenceValue){return""}if(!t||!t.Value||!t.Value.Path&&!t.Value.$Path){return""}var r=e.getSetting("ovpCardProperties");var a=r.getProperty("/entityType");var i=r.getProperty("/metaModel");var n=Je(e);var o=t&&t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits;var l=o&&o.Int;if(l&&!n){r.setProperty("/iNumberOfFractionalDigits",l)}else if(n&&o){r.setProperty("/iNumberOfFractionalDigits",o)}if(t.TrendCalculation.ReferenceValue&&!n){if(t.TrendCalculation.ReferenceValue.String){r.setProperty("/sManifestTargetValue",t.TrendCalculation.ReferenceValue.String);return"{parts: [{path:'"+t.Value.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.TargetValueFormatter'}"}if(t.TrendCalculation.ReferenceValue.Path){var u=i.getODataProperty(a,t.TrendCalculation.ReferenceValue.Path);if(u[b.UOM]){var s=u[b.UOM];if(s.String=="%"){r.setProperty("/bPercentageAvailableForTarget",true)}}return"{parts: [{path:'"+t.Value.Path+"'},{path:'"+t.TrendCalculation.ReferenceValue.Path+"'}], formatter: 'sap.ovp.cards.AnnotationHelper.TargetValueFormatter'}"}}else if(n&&t.TrendCalculation.ReferenceValue){if(t.TrendCalculation.ReferenceValue.$Path){var u=Ht(i,a,t.TrendCalculation.ReferenceValue.$Path);if(u[b.UOM]){var s=u[b.UOM];if(s.String=="%"){r.setProperty("/bPercentageAvailableForTarget",true)}}return"{parts: [{path:'"+t.Value.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'},{path:'"+t.TrendCalculation.ReferenceValue.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'}], formatter: 'sap.ovp.cards.AnnotationHelper.TargetValueFormatter'}"}if(t.TrendCalculation.ReferenceValue){r.setProperty("/sManifestTargetValue",t.TrendCalculation.ReferenceValue);return"{parts: [{path:'"+t.Value.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'}], formatter: 'sap.ovp.cards.AnnotationHelper.TargetValueFormatter'}"}}}Ot.requiresIContext=true;function Vt(t,r){var a,i,n;if(typeof t=="string"){t=e.getIntegerInstance().parse(t)}if(isNaN(+t)){return""}t=+t;n=this.getModel("ovpCardProperties");if(n.getProperty("/iNumberOfFractionalDigits")){a=+n.getProperty("/iNumberOfFractionalDigits")}if(r){i=+r}else{if(n.getProperty("/sManifestTargetValue")){i=+n.getProperty("/sManifestTargetValue")}}if(!a||a<0){a=0}else if(a>2){a=2}if(i){var o=(t-i)/i;var l=e.getPercentInstance({style:"short",minFractionDigits:a,maxFractionDigits:a,showScale:true});return l.format(o)}}function Ft(e,t){var r=Je(e);if(t&&t.GroupBy&&!v(t.GroupBy)){return r?t.GroupBy[0].hasOwnProperty("$PropertyPath"):t.GroupBy[0].hasOwnProperty("PropertyPath")}return false}Ft.requiresIContext=true;function St(e,t){var r;for(var a=0;e&&a<e.length;a++){if(e[a].value==t){r=e[a];break}}return r?r.name:null}function Nt(e,t){return St(e,t)}function xt(e,t){var r=St(e,t);return r?r:o.getText("OVP_KEYUSER_LABEL_NO_NAVIGATION")}function At(e,t){var r="";var a=t&&t.GroupBy;if(!a){return r}var i=Je(e);var n=e.getSetting("ovpCardProperties").getProperty("/metaModel");var l=e.getSetting("ovpCardProperties").getProperty("/entityType");var u;if(t.GroupBy.constructor===Array){u=t.GroupBy}else if(!t.GroupBy.Collection){return r}else{u=t.GroupBy.Collection}var f;var c;s(u,function(){c=i?this.$PropertyPath:this.PropertyPath;f=wt(n,l,c,e);if(!f){return}r+=f;r+=", "});if(r[r.length-1]===" "&&r[r.length-2]===","){r=r.substring(0,r.length-2)}return r==""?"":o.getText("By",[r])}At.requiresIContext=true;function Et(e,t,r){var a=true;var i=Je(e);var n=r["SelectOptions"].length-1;if(t.PropertyName.PropertyPath===r["SelectOptions"][n].PropertyName.PropertyPath){a=false}t=[t];var o=e.getSetting("ovpCardProperties");var l=o.getProperty("/entityType");var u=o.getProperty("/metaModel");var s=C.getFilters(o,t,i);if(s.length==0){return""}s=C.createExcludeFilters(s,o);var f;var c;f=s[0].path;c=Lt(u,l,f,e);if(c!==f){return""}var p=u.getODataProperty(l,t[0].PropertyName.PropertyPath)["type"];var v=$t(s,p);if(a===true){return v+", "}return v}Et.requiresIContext=true;function Rt(e,t,r){var a=!(t.index===r.length-1);var i=e.getSetting("ovpCardProperties");var n=i.getProperty("/metaModel");var o=i.getProperty("/entityType");var l=n.getODataProperty(o,r[t.index].path)["type"];var u=$t([r[t.index]],l);if(a===true){return u+", "}return u}Rt.requiresIContext=true;function Mt(e){return e.id}function Ut(e){return e.id}function $t(e,t){var r=[];for(var a=0;a<e.length;a++){r.push(_t(e[a],t))}return r.join(", ")}function _t(e,r){var a=false;var i,n=t.getInstance({style:"medium"});if(r==="Edm.DateTime"){i=n.format(new Date(e.value1))}else if(r==="Edm.DateTimeOffset"){i=n.format(new Date(e.value1),true)}else{i=e.value1}if(e.operator[0]==="N"){a=true}if(e.value2){if(r==="Edm.DateTime"){i+=" - "+n.format(new Date(e.value1))}else if(r==="Edm.DateTimeOffset"){i+=" - "+n.format(new Date(e.value1),true)}else{i+=" - "+e.value1}}if(a){i=o.getText("kpiHeader_Filter_NotOperator",[i])}return i}function wt(e,t,r,a){return qt(e,t,r,"com.sap.vocabularies.Common.v1.Label",a)}function Lt(e,t,r,a){return qt(e,t,r,"sap:text",a)}function qt(e,t,r,a,i){var n=Je(i);var o;if(n){o={};o[r]=Ht(e,t,r)}else{o=e.getODataProperty(t,r)}if(!o){I.error("No Property Found for with Name '"+r+" For Entity-Type '"+t.name+"'");return}if(n){if(o[r].annotations){var l=o[r].annotations["@"+a]}if(l){return l}return Object.keys(o)[0]}else{var l=o[a];if(l){if(a==="com.sap.vocabularies.Common.v1.Label"){return l.String}return l}return o.name}}function Ht(e,t,r){var a=e.getData().$Annotations[t.$Type+"/"+r];var i=P.getEntitySetName(e,t.$Type);var n=e.getObject("/"+i+"/"+r);var o=d.merge(true,{},a,n);return o}function jt(e,t){var r=Je(e);var a=e.getSetting("ovpCardProperties");if(!t||!t.Value||!t.Value.Path&&!t.Value.$Path){return""}var i={NumberOfFractionalDigits:a.oData.NumberOfFractionalDigits||0,percentageAvailable:a.oData.percentageAvailable||false};var n="sap.ovp.cards.AnnotationHelper.KpiValueFormatter";var o=r?t.Value.$Path+"Agg":t.Value.Path;var l=[o];return ee(l,n,i)}jt.requiresIContext=true;function Bt(e,t){return t&&t.hasOwnProperty(e)}function kt(e,t){var r;if(t[e].customDateRangeImplementation){return t[e].customDateRangeImplementation}else if(t[e].filter){r={module:"sap.ui.comp.config.condition.DateRangeType",operations:{filter:t[e].filter}};return JSON.stringify(r)}else if(t[e].selectedValues){r={module:"sap.ui.comp.config.condition.DateRangeType",operations:{filter:[{path:"key",contains:t[e].selectedValues,exclude:t[e].exclude}]}};return JSON.stringify(r)}else if(t[e].defaultValue){r={module:"sap.ui.comp.config.condition.DateRangeType"};return JSON.stringify(r)}}function Yt(e){if(e){return undefined}return"_BASIC"}function Gt(e,t){if(t==="com.sap.vocabularies.Common.v1.IsFiscalYearPeriod"){var r=e.substring(0,4);var a=e.substring(4);while(a.length<3){a="0"+a}var i=g.FiscalDateFormatter["IsFiscalYearPeriod"];var n={UTC:false,style:"medium"};var o=m.getDateInstance(Object.assign({format:i,calendarType:h.CalendarType.Gregorian},n));var l=o.getPattern();if(l==="PPP/YYYY"){return a+"/"+r}else if(l==="PPP.YYYY"){return a+"."+r}else{return a+r}}else{return e}}function Xt(e,t,r,a,i,n,o){a=typeof a==="undefined"?false:a;var l=false;var u;if(!e&&a){I.error(i+T.CARD_ERROR+r+T.IS_MANDATORY);return l}if(!e){I.warning(i+T.CARD_WARNING+r+T.IS_MISSING);return true}if(o){e="@"+e}u=t[e];if(!u||typeof u!=="object"){var s=a?I.error:I.warning;s(i+T.CARD_ERROR+"in "+r+". ("+e+" "+T.NOT_WELL_FORMED);return l}var f=o?"sap.ovp.cards.v4.charts.analytical.analyticalChart":"sap.ovp.cards.charts.analytical.analyticalChart";var c=o?!u.ChartType||!u.ChartType.$EnumMember:!u.ChartType||!u.ChartType.EnumMember;if(n&&n===f&&r==="Chart Annotation"&&c){I.error(i+T.CARD_ERROR+T.MISSING_CHARTTYPE+T.CHART_ANNO);return l}return true}return{getFormattedFiscalData:Gt,getGroupID:Yt,getConditionTypeForDateProperties:kt,isDateRangeType:Bt,TextArrangementType:D,getLabelForDataItem:O,setAlignmentForDataPoint:V,colorPaletteForComparisonMicroChart:le,formatField:K,checkFilterPreference:he,formatItems:ye,getCardSelections:De,getCardSorters:Ie,getAnnotationLabel:Nt,getApplicationName:xt,removeDuplicateDataField:Se,getDataPointsCount:Ne,getFirstDataPointValue:xe,getFirstDataFieldName:Ee,getSecondDataFieldName:Re,getRequestFields:be,getThirdDataFieldName:Me,formatDataFieldValueOnIndex:Ue,formatDataPointValueOnIndex:$e,formatDataPointOrField:_e,formatsemanticObjectOfDataFieldGeneric:we,getLabelForFirstDataPoint:Le,formatImageUrl:qe,formatUnit:He,formatObjectNumber:je,formatFirstDataPointState:Be,formatFirstDataPointColor:ke,formatSecondDataPointState:Ye,formatThirdDataPointState:Ge,formatFirstDataPointStateForSmartField:Xe,formatKPIHeaderState:Ke,isFirstDataPointCriticality:We,isFirstDataPointCriticalityForTableStatus:Ze,getSortedDataFields:M,getSortedDataPoints:U,formatDataFieldValueGeneric:et,formatDataPointValue:it,formatDataPointStateGeneric:nt,checkCriticalityGeneric:ot,checkCriticalityGenericForTableStatus:lt,formatDataPointStateForSmartFieldGeneric:ut,hasActions:st,isFirstDataPointPercentageUnit:ft,resolveEntityTypePath:ct,getAssociationObject:pt,semanticObjectOfFirstDataField:gt,semanticObjectOfSecondDataField:mt,isFirstContactAnnotation:yt,getAggregateNumber:Pt,KpiValueFormatter:Ct,kpiValueCriticality:ze,formThePathForAggregateNumber:dt,formThePathForTrendIcon:Tt,formPathForPercentageChange:Dt,TargetValueFormatter:It,formPathForTargetValue:Ot,returnPercentageChange:Vt,isPresentationVarientPresent:Ft,listGroupBy:At,formTheFilterByString:Et,formTheFilterByStringNotFromSelVar:Rt,formTheIdForFilter:Mt,formTheIdForFilterNotFromSelVar:Ut,_criticality2state:N,_calculateCriticalityState:E,_calculateTrendDirection:R,_getPropertiesFromBindingString:Ce,sortCollectionByImportance:H,checkNavTargetForContactAnno:rt,checkForContactAnnotation:at,getKPIHeaderAggregateNumber:jt,formatColor:ve,formatTrendIcon:bt,formatNumberCalculation:te,formatCurrency:ae,formatDate:re,getSapTextPathForUOM:Q,getPathOrPrimitiveValue:Ve,getSorters:Te,_getItemsLength:Fe,isODataV4Context:Je,_generatePathForField:ee,_getNavigationSuffix:ie,_getNavigationPrefix:me,_getEntityTypeForODataV4Model:Ht,_formatValueFromTarget:Qe,checkExists:Xt}},true);
//# sourceMappingURL=AnnotationHelper.js.map