// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell_abap/pbServices/ui2/ODataWrapper","sap/ui/thirdparty/datajs","sap/ui/thirdparty/jquery","sap/base/Log","sap/ushell/resources","sap/ui/core/library"],function(e,r,jQuery,t,a,n){"use strict";var s;var i="default";var u=n.date.CalendarWeekNumbering;return function(){this._updateODataObjectBasedOnDatatype=function(e,r){if(jQuery.type(e)==="string"){r.value=e.toString();r.dataType="Edm.String"}if(jQuery.type(e)==="boolean"){r.value=e.toString();r.dataType="Edm.Boolean"}return r};this.getThemeList=function(){var e=new jQuery.Deferred,a="/sap/opu/odata/UI2/INTEROP/Themes";r.read({requestUri:a},function(r,t){var a,n=[];for(a=0;a<r.results.length;a=a+1){n.push(r.results[a])}e.resolve({options:n})},function(r){t.error(r.message,null,"sap.ushell_abap.adapters.abap.UserInfoAdapter");e.reject(r.message)});return e.promise()};this.getCalendarWeekNumberingList=function(){return[{value:u.Default,title:a.i18n.getText("DefaultWeekNumberingTitle"),description:a.i18n.getText("DefaultWeekNumberingText")},{value:u.ISO_8601,title:a.i18n.getText("ISO_8601WeekNumberingTitle"),description:a.i18n.getText("ISO_8601WeekNumberingText")},{value:u.MiddleEastern,title:a.i18n.getText("MiddleEasternWeekNumberingTitle"),description:a.i18n.getText("MiddleEasternWeekNumberingText")},{value:u.WesternTraditional,title:a.i18n.getText("WesternTraditionalWeekNumberingTitle"),description:a.i18n.getText("WesternTraditionalWeekNumberingText")}]};this.getLanguageList=function(){var e=new jQuery.Deferred,n=encodeURI("/sap/opu/odata/UI2/INTEROP/UserProfilePropertyValues?$filter=id eq 'PREFERRED_LOGON_LANGUAGE'");r.read({requestUri:n},function(r){var t=[{text:a.i18n.getText("userSettings.browserLanguage"),key:i}];var n=r.results.map(function(e){return{text:e.description,key:e.value}}).sort(function(e,r){return e.text.localeCompare(r.text)});t=t.concat(n);e.resolve(t)},function(r){t.error(r.message,null,"sap.ushell_abap.adapters.abap.UserInfoAdapter");e.reject(r.message)});return e.promise()};this.getUserProfilePropertyValueLists=function(){var e=new jQuery.Deferred;var r;var a={};var n=["NUMBER_FORMAT","TIME_ZONE","TIME_FORMAT","DATE_FORMAT","CALENDAR_WEEK_NUMBERING"];var s=this._createWrapper("/sap/opu/odata/UI2/INTEROP/");s.openBatchQueue();var i;for(var u=0;u<n.length;u++){i=n[u];r=encodeURI("UserProfilePropertyValues?$filter=id eq '"+i+"'&$select=description,value");s.read(r,function(e){a[this]=e.results}.bind(i),function(e){t.error(e.message,null,"sap.ushell_abap.adapters.abap.UserInfoAdapter")})}s.submitBatchQueue(function(){e.resolve(a)},function(r){t.error(r.message,null,"sap.ushell_abap.adapters.abap.UserInfoAdapter");e.reject(r.message)});return e.promise()};this._createWrapper=function(r){return e.createODataWrapper(r,false,function(e){})};this.updateUserPreferences=function(e){t.debug("[000] updateUserPreferences","UserInfoAdapter");var r=this,a,n,u,p,o,l=function(){p-=1;if(p===0){a.resolve()}},d=function(e,r){a.reject(e,r)};t.debug("[000] updateUserPreferences: _createWrapper","UserInfoAdapter");s=this._createWrapper("/sap/opu/odata/UI2/INTEROP/");a=new jQuery.Deferred;t.debug("[000] updateUserPreferences: oDataWrapper.openBatchQueue","UserInfoAdapter");s.openBatchQueue();u=e.getChangedProperties()||[];t.debug("[000] updateUserPreferences: getChangedProperties","UserInfoAdapter");p=u.length;u.forEach(function(e){var a=e.name,u=e.newValue;if(a.toUpperCase()==="LANGUAGE"){a="PREFERRED_LOGON_LANGUAGE";u=u===i?undefined:u}n="UserProfileProperties("+["id='"+a+"'","shellType='FLP')"].join(",");o={id:a,shellType:"FLP",value:u};r._updateODataObjectBasedOnDatatype(u,o);t.debug("[000] updateUserPreferences: oDataWrapper: put","UserInfoAdapter");s.put(n,o,l,d)});t.debug("[000] updateUserPreferences: submitBatchQueue","UserInfoAdapter");s.submitBatchQueue(function(){if(p===0){a.resolve()}},d);return a.promise()}}});
//# sourceMappingURL=UserInfoAdapter.js.map