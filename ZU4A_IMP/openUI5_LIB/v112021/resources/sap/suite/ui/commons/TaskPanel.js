sap.ui.define(["sap/suite/ui/commons/ToDoPanel","sap/m/GenericTile","sap/m/TileContent","sap/f/GridListItem","sap/m/FlexBox","sap/m/Link","sap/m/Text","sap/base/Log","sap/m/ObjectAttribute","sap/m/library","sap/ui/core/format/DateFormat"],function(t,e,o,i,n,r,s,a,u,c,l){"use strict";const g=c.URLHelper;const p=t.extend("sap.suite.ui.commons.TaskPanel");p.prototype.init=function(){this.setKey("tasks");this.setTitle(this.getResourceBundle().getText("tasksTabTitle"));t.prototype.init.apply(this,arguments)};p.prototype.generateCardTemplate=function(t,n){return new i(`${t}-gridListItem`,{content:[new e(`${t}-tile`,{mode:"ActionMode",frameType:"TwoByOne",pressEnabled:true,header:"{_toDos>title}",width:"{_toDos>/cardWidth}",state:"{_toDos>status}",url:"{_toDos>link}",headerImage:"{_toDos>headerImage}",press:this._onPressTask.bind(this),tileContent:[new o(`${t}-tileContent`,{priority:"{_toDos>priority}",priorityText:this.getResourceBundle().getText(this.toPriorityText(n.getProperty("priority"))),footer:"{_toDos>footerText}",content:[this._getCardContentTemplate(t,n.getProperty("attributes"))]})]})]}).addStyleClass("sapMGT")};p.prototype._onPressTask=function(t){const e=t.getSource();const o=e.getBindingContext("_toDos");const i=o.getProperty("status");if(!this._disableNavigation){if(i!=="Loading"){g.redirect(o.getProperty("link"),false)}}};p.prototype._getCardContentTemplate=function(t,e){const o=(t,o)=>{const i=e?.find(e=>e.name===t)||{};return i[o]};return new n(`${t}-contentContainer`,{direction:"Column",items:[new u(`${t}-dueDateContent`,{title:o("dueDate","label"),visible:o("dueDate","value")!=="",customContent:[new s(`${t}-dueDateText`,{text:o("dueDate","value")})]}),new u(`${t}-createdByContent`,{title:o("createdBy","label"),visible:o("createdBy","value")!=="",customContent:[new r(`${t}-createdByLink`,{text:o("createdBy","value"),press:this._onClickCreatedBy.bind(this)})]})]})};p.prototype.fetchUserInfo=async function(t,e){try{const o=await fetch(`/sap/opu/odata/IWPGW/TASKPROCESSING;mo;v=2/UserInfoCollection(SAP__Origin='${t}',UniqueName='${e}')?$format=json`);if(!o.ok){throw new Error(`Failed to Fetch User Info for: ${e}`)}const i=await o.json();this.userInfo[e]=i.d;return this.userInfo[e]}catch(t){a.error(t.message);return{}}};p.prototype.fetchUserDetailsIfRequired=function(t,e){this.userInfo=this.userInfo||{};if(Object.keys(this.userInfo).includes(e)){return Promise.resolve(this.userInfo[e])}else{return this.fetchUserInfo(t,e)}};p.prototype._onClickCreatedBy=async function(t){const e=t.getSource();const o=t.getSource().getBindingContext("_toDos");const i=o.getProperty("attributes");const n=t=>{const e=i.find(e=>e.name===t)||{};return e.value};const r=t=>{g.triggerEmail(t);setTimeout(()=>{this._disableNavigation=false},0)};const s=n("originId");const a=n("userId");this._disableNavigation=true;const u=await this.fetchUserDetailsIfRequired(s,a);if(u.Email){sap.ui.require(["sap/suite/ui/commons/collaboration/ServiceContainer"],async t=>{const o=await t.getServiceAsync();if(o.enableMinimalContactsCollaboration){try{const t=await o.enableMinimalContactsCollaboration(u.Email);t.openBy(e)}catch(t){r(u.Email)}}else{r(u.Email)}})}else{setTimeout(()=>{this._disableNavigation=false},0)}};p.prototype._getPriorityText=function(t){const e={VeryHigh:"veryHighPriority",High:"highPriority",Medium:"mediumPriority",Low:"lowPriority",None:"nonePriority"};const o=e[t]||e.None;return this.getResourceBundle().getText(o)};p.prototype.processData=function(t){this._oData.displayTiles=this._oData.tiles=(t||[]).map(t=>({title:t.TaskTitle,priority:this.toPriority(t.Priority),priorityText:this.getResourceBundle().getText(this.toPriorityText(t.Priority)),criticality:"None",attributes:this._getDefaultAttributes(t),link:this._getTaskUrl(t),formatContent:true,footerText:this.getResourceBundle().getText("createdTask",[this.toRelativeDateTime(this._getDateFromString(t.CreatedOn))])}))};p.prototype._getDateFromString=function(t){const e=/\/Date\((\d*)\)\//;const o=t.match(e);const i=o&&o[1];if(i){const t=+i;return new Date(t)}return new Date(t)};p.prototype._getTaskUrl=function(t){const e=`?showAdditionalAttributes=true`+`&/detail/${t.SAP__Origin}/${t.InstanceID}/TaskCollection(SAP__Origin='${t.SAP__Origin}',InstanceID='${t.InstanceID}')`;return this.getTargetAppUrl()+e};p.prototype._getDefaultAttributes=function(t){return[{name:"originId",label:"",value:t.SAP__Origin},{name:"userId",label:"",value:t.CreatedBy},{name:"dueDate",label:this.getResourceBundle().getText("dueDate"),value:t.CompletionDeadline?this._formatDate(t.CompletionDeadline):""},{name:"createdBy",label:this.getResourceBundle().getText("createdBy"),value:t.CreatedByName?t.CreatedByName:""}]};p.prototype._formatDate=function(t){const e=this._getDateFromString(t);const o=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();const i=l.getDateTimeInstance({pattern:"MMM dd, yyyy hh:mm a"},o);return i.format(e)};p.prototype._formatDate=function(t){const e=this._getDateFromString(t);const o=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();const i=l.getDateTimeInstance({pattern:"MMM dd, yyyy hh:mm a"},o);return i.format(e)};p.prototype.getViewAllItemsText=function(){return this.getResourceBundle().getText("viewAllTasksTitle")};p.prototype.getNoDataText=function(){return this.getResourceBundle().getText("noTaskTitle")};return p});
//# sourceMappingURL=TaskPanel.js.map