sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/m/library","sap/m/ImageHelper","sap/ui/core/Control","sap/suite/ui/commons/ProcessFlowConnection","sap/suite/ui/commons/ProcessFlowLaneHeader","sap/ui/Device","sap/ui/core/ResizeHandler","sap/base/Log","sap/ui/events/KeyCodes","./ProcessFlowRenderer","sap/ui/core/date/UI5Date","sap/ui/core/Core","sap/ui/core/Lib"],(function(jQuery,t,e,i,o,s,n,a,r,l,c,h,g,u,d){"use strict";var _=o.extend("sap.suite.ui.commons.ProcessFlow",{metadata:{library:"sap.suite.ui.commons",properties:{foldedCorners:{type:"boolean",group:"Misc",defaultValue:!1},scrollable:{type:"boolean",group:"Misc",defaultValue:!0},wheelZoomable:{type:"boolean",group:"Behavior",defaultValue:!0},showLabels:{type:"boolean",group:"Appearance",defaultValue:!1}},defaultAggregation:"lanes",aggregations:{_connections:{type:"sap.suite.ui.commons.ProcessFlowConnection",multiple:!0,singularName:"_connection",visibility:"hidden"},nodes:{type:"sap.suite.ui.commons.ProcessFlowNode",multiple:!0,singularName:"node"},lanes:{type:"sap.suite.ui.commons.ProcessFlowLaneHeader",multiple:!0,singularName:"lane"},ariaProperties:{type:"sap.suite.ui.commons.AriaProperties",multiple:!1,group:"Misc"}},events:{nodeTitlePress:{deprecated:!0,parameters:{oEvent:{type:"object"}}},nodePress:{parameters:{oEvent:{type:"object"}}},labelPress:{parameters:{oEvent:{type:"object"}}},headerPress:{parameters:{oEvent:{type:"object"}}},onError:{parameters:{oEvent:{type:"object"}}}},dnd:{draggable:!1,droppable:!0}}});return _.prototype._resBundle=null,_._cellEdgeConstants={LU:"tl",LD:"lb",DU:"tb",LR:"rl",DR:"rt",UR:"rb"},_._constants={scrollContainer:"scrollContainer",counterLeft:"counterLeft",counterRight:"counterRight",arrowScrollRight:"arrowScrollRight",arrowScrollRightMinus:"-arrowScrollRight",arrowScrollLeft:"arrowScrollLeft",arrowScrollLeftMinus:"-arrowScrollLeft",top:"top",px:"px",parents:"parents",left:"left",right:"right"},_._mouseEvents={mouseMove:"mousemove",mouseDown:"mousedown",mouseUp:"mouseup",mouseLeave:"mouseleave",mouseEnter:"mouseenter",touchStart:"touchstart",sapTouchStart:"saptouchstart",touchEnd:"touchend",sapTouchCancel:"saptouchcancel"},_._enumMoveDirection={LEFT:"left",RIGHT:"right",UP:"up",DOWN:"down"},_.prototype._zoomLevel=t.ProcessFlowZoomLevel.Two,_.prototype._wheelTimeout=null,_.prototype._isFocusChanged=!1,_.prototype._wheelTimestamp=null,_.prototype._wheelCalled=!1,_.prototype._internalCalcMatrix=!1,_.prototype._internalConnectionMap=null,_.prototype._internalLanes=!1,_.prototype._jumpOverElements=5,_.prototype._lastNavigationFocusElement=null,_.prototype._bHighlightedMode=!1,_.prototype._isLayoutOptimized=!1,_.prototype._defaultCursorClass="sapSuiteUiDefaultCursorPF",a.browser.edge?(_.prototype._grabCursorClass="sapSuiteUiGrabCursorIEPF",_.prototype._grabbingCursorClass="sapSuiteUiGrabbingCursorIEPF"):(_.prototype._grabCursorClass="sapSuiteUiGrabCursorPF",_.prototype._grabbingCursorClass="sapSuiteUiGrabbingCursorPF"),_.prototype._mousePreventEvents="contextmenu dblclick",_.prototype._mouseEvents="contextmenu mousemove mouseleave mousedown mouseup mouseenter",_.prototype._mouseWheelEvent=a.browser.mozilla?"DOMMouseScroll MozMousePixelScroll":"mousewheel wheel",_.prototype._headerHasFocus=!1,_.prototype._isInitialZoomLevelNeeded=!0,_.prototype._bDoScroll=!a.system.desktop||a.os.windows&&a.os.version>=8,_.prototype._scrollStep=192,_.prototype._bPreviousScrollForward=!1,_.prototype._bPreviousScrollBack=!1,_.prototype._iInitialArrowTop=void 0,_.prototype._iInitialCounterTop=void 0,_.prototype._bRtl=!1,_.prototype._arrowScrollable=null,_.prototype._iTouchStartScrollTop=void 0,_.prototype._iTouchStartScrollLeft=void 0,_.prototype._bSetFocusOnce=!0,_.prototype.init=function(){this._bRtl=u.getConfiguration().getRTL(),this._resBundle||(this._resBundle=d.getResourceBundleFor("sap.suite.ui.commons")),this._internalLanes=[],this._getScrollContainer()&&this._getScrollContainer().on("keydown",jQuery.proxy(this.onkeydown,this))},_.prototype.exit=function(){var t,e=this.getNodes();if(e){for(t=0;t<e.length;t++)e[t]&&e[t].destroy();e=null}if(this._internalLanes){for(t=0;t<this._internalLanes.length;t++)this._internalLanes[t].destroy();this._internalLanes=null}var i=this.getAggregation("_connections");if(i){for(t=0;t<i.length;t++)i[t].destroy();i=null}this._oArrowLeft&&this._oArrowLeft.destroy(),this._oArrowRight&&this._oArrowRight.destroy(),this._resizeRegId&&r.deregister(this._resizeRegId),this._internalCalcMatrix&&(delete this._internalCalcMatrix,this._internalCalcMatrix=null),this._getScrollContainer()&&(this._getScrollContainer().off(this._mousePreventEvents,this._handlePrevent),this._getScrollContainer().off(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this)),this._getScrollContainer().off(this._mouseWheelEvent,jQuery.proxy(this._registerMouseWheel,this)),this._getScrollContainer().off("keydown",jQuery.proxy(this.onkeydown,this)),this._getScrollContainer().off("scroll",jQuery.proxy(this._onScroll,this)))},_.prototype.onBeforeRendering=function(){this._getScrollContainer()&&(this._getScrollContainer().off(this._mousePreventEvents,this._handlePrevent),this._getScrollContainer().off(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this)),this._getScrollContainer().off(this._mouseWheelEvent,jQuery.proxy(this._registerMouseWheel,this)),this._getScrollContainer().off("keydown",jQuery.proxy(this.onkeydown,this)),this._getScrollContainer().off("scroll",jQuery.proxy(this._onScroll,this)))},_.prototype.onAfterRendering=function(){var t,e,i,o,s=!1,n=this.$("scroll-content");if(this._checkOverflow(this._getScrollContainer().get(0),this.$()),this.iCursorPositionX=0,this.iCursorPositionY=0,n&&n.length&&(this._getScrollContainer().find(".sapSuiteUiCommonsProcessFlowNode .sapUiIcon").css("cursor","inherit"),this.getScrollable()?(t=parseInt(this._getScrollContainer().css("height").slice(0,-2),10),e=parseInt(this._getScrollContainer().css("width").slice(0,-2),10),o=n[0].scrollHeight,i=n[0].scrollWidth,o<=t&&i<=e?(this._clearHandlers(this._getScrollContainer()),this._switchCursors(this._getScrollContainer(),this._grabCursorClass,this._defaultCursorClass)):(this._switchCursors(this._getScrollContainer(),this._defaultCursorClass,this._grabCursorClass),s=!0)):(this._clearHandlers(this._getScrollContainer()),this._switchCursors(this._getScrollContainer(),this._grabCursorClass,this._defaultCursorClass),n.css("position","static")),s?(this._iInitialArrowTop&&this._iInitialCounterTop||(this._iInitialArrowTop=parseInt(this.$(_._constants.arrowScrollRight).css(_._constants.top),10),this._iInitialCounterTop=parseInt(this.$(_._constants.counterRight).css(_._constants.top),10)),a.os.windows&&a.system.combi&&a.browser.chrome?(this._getScrollContainer().bind(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this)),this._getScrollContainer().css("overflow","auto")):a.os.windows&&a.browser.edge?(this._getScrollContainer().bind(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this)),this._getScrollContainer().css("overflow","auto"),this._getScrollContainer().css("-ms-overflow-style","none")):a.support.touch?(this._clearHandlers(this._getScrollContainer()),this._getScrollContainer().css("overflow","auto")):this._getScrollContainer().bind(this._mouseEvents,jQuery.proxy(this._registerMouseEvents,this))):this._bDoScroll?this._getScrollContainer().css("overflow","auto"):this._getScrollContainer().css("overflow","hidden"),a.browser.mozilla&&this._getScrollContainer().css("scrollbar-width","none"),this.getWheelZoomable()&&a.system.desktop&&!this._isHeaderMode()&&this._getScrollContainer().bind(this._mouseWheelEvent,jQuery.proxy(this._registerMouseWheel,this)),this._bDoScroll&&this._getScrollContainer().on("scroll",jQuery.proxy(this._onScroll,this)),this._resizeRegId=r.register(this,jQuery.proxy(_.prototype._onResize,this)),this._isInitialZoomLevelNeeded&&this._initZoomLevel(),this._headerHasFocus)){var l=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children();if(l[0]){var c=u.byId(l[0].id);this._changeNavigationFocus(null,c),this._headerHasFocus=!1}}},_.prototype.ontouchend=function(t){if(t.target&&-1!==t.target.id.indexOf("arrowScroll"))this._onArrowClick(t);else{if(a.support.touch?this._adjustAndShowArrow():this.onAfterRendering(),null===t||void 0===t.oSource)return;t.preventDefault(),this._isHeaderMode()&&(this._internalLanes=[],this.fireHeaderPress(this))}},_.prototype._handlePrevent=function(t){t&&!t.isDefaultPrevented()&&t.preventDefault(),t&&!t.isPropagationStopped()&&t.stopPropagation(),t&&!t.isImmediatePropagationStopped()&&t.stopImmediatePropagation()},_.prototype._onResize=function(){var t=Date.now();!this._iLastResizeEventTime||t-this._iLastResizeEventTime<50?(!this._iLastResizeHandlingTime||t-this._iLastResizeHandlingTime>500)&&(this.onAfterRendering(),this._iLastResizeHandlingTime=t):this._iLastResizeHandlingTime=null,this._iLastResizeEventTime=t},_.prototype._registerMouseEvents=function(t){switch(t&&!t.isDefaultPrevented()&&t.preventDefault(),t.type){case _._mouseEvents.mouseMove:this._getScrollContainer().hasClass(this._grabbingCursorClass)&&(u.getConfiguration().getRTL()?this._getScrollContainer().scrollLeftRTL(this.iCursorPositionX-t.pageX):this._getScrollContainer().scrollLeft(this.iCursorPositionX-t.pageX),this._getScrollContainer().scrollTop(this.iCursorPositionY-t.pageY),this._adjustAndShowArrow());break;case _._mouseEvents.mouseDown:this._switchCursors(this._getScrollContainer(),this._defaultCursorClass,this._grabbingCursorClass),u.getConfiguration().getRTL()?this.iCursorPositionX=this._getScrollContainer().scrollLeftRTL()+t.pageX:this.iCursorPositionX=this._getScrollContainer().scrollLeft()+t.pageX,this.iCursorPositionY=this._getScrollContainer().scrollTop()+t.pageY,a.system.combi&&(this._iTouchStartScrollLeft=this._getScrollContainer().scrollLeft(),this.getScrollable()&&(this._iTouchStartScrollTop=this._getScrollContainer().scrollTop()));break;case _._mouseEvents.mouseUp:this._switchCursors(this._getScrollContainer(),this._grabbingCursorClass,this._grabCursorClass);break;case _._mouseEvents.mouseLeave:this._getScrollContainer().removeClass(this._grabbingCursorClass),this._getScrollContainer().removeClass(this._grabCursorClass),this._getScrollContainer().addClass(this._defaultCursorClass);break;case _._mouseEvents.mouseEnter:this._getScrollContainer().removeClass(this._defaultCursorClass),null===t.buttons?1===t.which?this._getScrollContainer().addClass(this._grabbingCursorClass):this._getScrollContainer().addClass(this._grabCursorClass):0===t.buttons?this._getScrollContainer().addClass(this._grabCursorClass):1===t.buttons&&this._getScrollContainer().addClass(this._grabbingCursorClass)}t.target&&t.target.parentElement&&t.target.parentElement.parentElement&&t.target.parentElement.parentElement.getMetadata&&"sap.suite.ui.commons.ProcessFlowConnectionLabel"===t.target.parentElement.parentElement.getMetadata().getName()&&(t&&!t.isPropagationStopped()&&t.stopPropagation(),t&&!t.isImmediatePropagationStopped()&&t.stopImmediatePropagation())},_.prototype.onfocusin=function(t){var e;if(t&&t.target&&t.target.id&&(e=u.byId(t.target.id)),this._isHeaderMode()||this._checkNodesVisibility())this._setFocusOnHeader(!0);else if(this._bSetFocusOnce&&(!e||!t.target.id.indexOf("arrowScroll")))if(this._bSetFocusOnce=!1,e&&"sap.suite.ui.commons.ProcessFlowConnectionLabel"===e.getMetadata().getName())this._changeNavigationFocus(null,e);else if(this._lastNavigationFocusElement)this._lastNavigationFocusElement&&this._changeNavigationFocus(null,this._lastNavigationFocusElement);else{var i=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children(),o=u.byId(i[0].id);this._changeNavigationFocus(null,o)}},_.prototype._checkNodesVisibility=function(){var t=!0;return this.getNodes().forEach((function(e){e.getVisible()&&(t=!1)})),t},_.prototype.onfocusout=function(){this._bSetFocusOnce=!0,this._lastNavigationFocusElement&&this._lastNavigationFocusElement._getNavigationFocus()&&(this._lastNavigationFocusElement._setNavigationFocus(!1),"sap.suite.ui.commons.ProcessFlowNode"===this._lastNavigationFocusElement.getMetadata().getName()&&this._lastNavigationFocusElement.rerender())},_.prototype.onsapplus=function(){this._isFocusChanged=!0,this.zoomIn()},_.prototype.onsapminus=function(){this._isFocusChanged=!0,this.zoomOut()},_.prototype.onsaptabnext=function(t){var e,i=!0,o=t.target,s=u.byId(o.id);if(!s&&o&&o.childElementCount>0&&(o=o.childNodes[0],s=u.byId(o.id)),!s||"sap.suite.ui.commons.ProcessFlowNode"!==s.getMetadata().getName()&&"sap.suite.ui.commons.ProcessFlowConnectionLabel"!==s.getMetadata().getName())if(this._isHeaderMode()||this._lastNavigationFocusElement||this._checkNodesVisibility())this._lastNavigationFocusElement&&(this._changeNavigationFocus(null,this._lastNavigationFocusElement),i=!1);else{var n=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children(),a=u.byId(n[0].id);this._changeNavigationFocus(null,a),i=!1}(this._isHeaderMode()||this._checkNodesVisibility())&&i?this._headerHasFocus?this._setFocusOnHeader(!1):this._setFocusOnHeader(!0):this._lastNavigationFocusElement&&"sap.suite.ui.commons.ProcessFlowNode"===this._lastNavigationFocusElement.getMetadata().getName()&&this._lastNavigationFocusElement.rerender(),i&&(0===(e=this.$().nextAll(":focusable").first()).length&&0===(e=this.$().nextAll().find(":focusable").first()).length&&function(){var t=this.$().parent();do{0===(e=t.next(":focusable")).length&&(e=t.nextAll().find(":focusable").first()),t=t.parent()}while(0!==t.length&&0===e.length);0===e.length&&(e=jQuery(":focusable")[0])}.apply(this),e.focus(),l.debug("saptabnext: Keyboard focus has been changed to element:  id='"+e.id+"' outerHTML='"+e.outerHTML+"'"),e=null),t.preventDefault()},_.prototype.onsaptabprevious=function(t){var e=null,i=t.target;(!this._lastNavigationFocusElement||!this._lastNavigationFocusElement._getNavigationFocus())&&t.target&&t.target.childElementCount>0&&(i=t.target.childNodes[0]);var o=u.byId(i.id);if(o&&("sap.suite.ui.commons.ProcessFlowNode"===o.getMetadata().getName()||"sap.suite.ui.commons.ProcessFlowNode"===o.getMetadata().getName()))if(this._isHeaderMode()||this._lastNavigationFocusElement){if(this._lastNavigationFocusElement)return this._changeNavigationFocus(null,this._lastNavigationFocusElement),void t.preventDefault()}else{var s=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children(),n=u.byId(s[0].id);this._changeNavigationFocus(null,n)}this._isHeaderMode()?this._headerHasFocus?(this._setFocusOnHeader(!1),e=this.$().prevAll().find(":focusable").last()):this._setFocusOnHeader(!0):(0===(e=this.$().prev(":focusable")).length&&(e=this.$().prevAll().find(":focusable").last()),this._lastNavigationFocusElement&&this._lastNavigationFocusElement._setNavigationFocus(!1),this._lastNavigationFocusElement&&"sap.suite.ui.commons.ProcessFlowNode"===this._lastNavigationFocusElement.getMetadata().getName()&&this._lastNavigationFocusElement.rerender()),e&&(0===e.length?function(){var t=this.$();do{0===(e=t.prev(":focusable")).length&&(e=t.prevAll().find(":focusable").last()),t=t.parent()}while(0!==t.length&&0===e.length)}.apply(this):0!==e.first().length&&(e=jQuery(e.first())),e.focus(),l.debug("saptabnext: Keyboard focus has been set on element:  id='"+e.id+"' outerHTML='"+e.outerHTML+"'"),e=null),t.preventDefault()},_.prototype._handleKeySelect=function(t){if(this._isHeaderMode()){this._internalLanes=[],this.fireHeaderPress(this);var e=this.$("scroll-content").children().children().children(1).children("td[tabindex='0']").first().children(),i=u.byId(e[0].id);this._changeNavigationFocus(null,i)}else if(this._lastNavigationFocusElement&&"sap.suite.ui.commons.ProcessFlowNode"===this._lastNavigationFocusElement.getMetadata().getName()&&this._lastNavigationFocusElement._getNavigationFocus()){this._lastNavigationFocusElement._handleEvents(t)}},_.prototype.onkeyup=function(t){switch(t.keyCode?t.keyCode:t.which){case c.ENTER:case c.SPACE:var e=this._lastNavigationFocusElement;e&&(this.fireNodePress(this._lastNavigationFocusElement),e._handleEvents(t))}},_.prototype.onkeydown=function(t){var e=t.keyCode?t.keyCode:t.which;l.debug("ProcessFlow::keyboard input has been catched and action going to start: keycode="+e);var i=!1,o=t.ctrlKey,s=t.altKey,n=this._lastNavigationFocusElement;switch(e){case c.ARROW_RIGHT:i=this._moveToNextElement(_._enumMoveDirection.RIGHT);break;case c.ARROW_LEFT:i=this._moveToNextElement(_._enumMoveDirection.LEFT);break;case c.ARROW_DOWN:i=this._moveToNextElement(_._enumMoveDirection.DOWN);break;case c.ARROW_UP:i=this._moveToNextElement(_._enumMoveDirection.UP);break;case c.PAGE_UP:i=this._moveOnePage(_._enumMoveDirection.UP,s);break;case c.PAGE_DOWN:i=this._moveOnePage(_._enumMoveDirection.DOWN,s);break;case c.HOME:i=this._moveHomeEnd(_._enumMoveDirection.LEFT,o);break;case c.END:i=this._moveHomeEnd(_._enumMoveDirection.RIGHT,o);break;case c.NUMPAD_0:case c.DIGIT_0:this._initZoomLevel();break;case c.ENTER:case c.SPACE:return this._handleKeySelect(t),void t.preventDefault();default:return}t.preventDefault(),i&&this._changeNavigationFocus(n,this._lastNavigationFocusElement)},_.prototype._onArrowClick=function(t){var e=t.target.id;if(e){var i=this.getId();t.preventDefault(),e===i+_._constants.arrowScrollLeftMinus&&a.system.desktop?this._scroll(-this._scrollStep,500):e===i+_._constants.arrowScrollRightMinus&&a.system.desktop&&this._scroll(this._scrollStep,500)}},_.prototype._onScroll=function(){var t=this._getScrollContainer().scrollLeft();if(Math.abs(t-this._iTouchStartScrollLeft)>this._scrollStep/4&&!this._isFocusChanged)this._adjustAndShowArrow(),this._iTouchStartScrollLeft=t;else if(this.getScrollable()){var e=this._getScrollContainer().scrollTop();Math.abs(e-this._iTouchStartScrollTop)>10&&(this._moveArrowAndCounterVertical(),this._iTouchStartScrollTop=e)}},_.prototype.ontouchstart=function(){this._iTouchStartScrollLeft=this._getScrollContainer().scrollLeft(),this.getScrollable()&&(this._iTouchStartScrollTop=this._getScrollContainer().scrollTop())},_.prototype.ontouchmove=function(t){t.setMarked()},_.prototype._handleLabelClick=function(t){if(t){var e=t.getSource();if(e&&"sap.ui.core.Icon"===e.getMetadata().getName()&&(e=e.getParent()),e&&"sap.suite.ui.commons.ProcessFlowConnectionLabel"===e.getMetadata().getName()){var i=this._getConnectionMapEntries(e),o=this._createLabelPressEventArgs(e,i);this.fireLabelPress(o)}}},_.prototype._onFocusChanged=function(){var t,e,i,o,s,n,a,r,c,h,g,u,d,_,p,m=this._lastNavigationFocusElement,f=m?m.$():null;m&&this.getScrollable()?(l.debug("The actually focused element is "+m.getId()),"sap.suite.ui.commons.ProcessFlowConnectionLabel"===m.getMetadata().getName()?(r=f.parent().parent().parent().outerWidth(),c=f.parent().parent().parent().outerHeight(),h=f.parent().parent().parent().position()):(r=f.outerWidth(),c=f.outerHeight(),h=f.position()),l.debug("Element outer width x height ["+r+" x "+c+"]"),l.debug("Position of element in the content is ["+h.left+", "+h.top+"]"),s=this.$("scroll-content"),t=this._getScrollContainer().innerWidth(),e=this._getScrollContainer().innerHeight(),l.debug("Scroll container inner width x height ["+t+" x "+e+"]"),i=this._getScrollContainer().scrollLeft(),o=this._getScrollContainer().scrollTop(),l.debug("Current scroll offset is ["+i+", "+o+"]"),n=s.innerWidth(),a=s.innerHeight(),l.debug("Scroll content inner width x height ["+n+" x "+a+"]"),d=(g=-i+h.left)+r,u=-o+h.top,d>t||g<0||u+c>e||u<0?(_=Math.round((t-r)/2),_=Math.max(t-n+h.left,_),_=Math.min(h.left,_),p=Math.round((e-c)/2),p=Math.max(e-a+h.top,p),p=Math.min(h.top,p),l.debug("Element lies outside the scroll container, scrolling from ["+g+","+u+"] to ["+_+","+p+"]"),this._isFocusChanged=!0,this._getScrollContainer().animate({scrollTop:h.top-p,scrollLeft:h.left-_},500,"swing",jQuery.proxy(this._adjustAndShowArrow,this))):(l.debug("Element lies inside the scroll container, no scrolling happens."),this._setFocusToNode(m))):(this._setFocusToNode(m),this._adjustAndShowArrow())},_.prototype._setScrollWidth=function(){switch(this.getZoomLevel()){case t.ProcessFlowZoomLevel.One:this._scrollStep=240;break;case t.ProcessFlowZoomLevel.Two:this._scrollStep=192;break;case t.ProcessFlowZoomLevel.Three:this._scrollStep=168;break;case t.ProcessFlowZoomLevel.Four:this._scrollStep=128;break;default:this._scrollStep=192}},_.prototype._getLastNavigationFocusElement=function(){return this._lastNavigationFocusElement},_.prototype._getNode=function(t,e){for(var i=0;i<e.length;i++)if(e[i].getNodeId()===t.toString())return e[i]},_.prototype._getLane=function(t){for(var e=0;e<this._internalLanes.length;e++)if(this._internalLanes[e].getLaneId()===t)return this._internalLanes[e]},_.prototype.destroyLanes=function(){for(var t=0;t<this._internalLanes.length;t++)this._internalLanes[t].destroy();return this._internalLanes=[],this},_._getChildIdByElement=function(t){return"object"==typeof t?t.nodeId:t},_.prototype._isHeaderMode=function(){var t=this.getNodes();return!t||0===t.length},_.prototype._getScrollContainer=function(){return this.$(_._constants.scrollContainer)},_.prototype._handleException=function(t){var e=this._resBundle.getText("PF_ERROR_INPUT_DATA");if(this.fireOnError({text:e}),l.error("Error loading data for the process flow with id : "+this.getId()),t instanceof Array)for(var i=0;i<t.length;i++)l.error("Detailed description ("+i+") :"+t[i]);else l.error("Detailed description  :"+t)},_.prototype._getAriaText=function(){return this._resBundle.getText("PF_ARIA_PROCESS_FLOW")},_.prototype._updateLanesFromNodes=function(){_.NodeElement._createNodeElementsFromProcessFlowNodes(this.getNodes(),this.getLanes());var t=this._arrangeNodesByParentChildRelation(this.getNodes());this._internalLanes=_.NodeElement._updateLanesFromNodes(this.getLanes(),t).lanes},_.prototype._getOrCreateLaneMap=function(){return(!this._internalLanes||this._internalLanes.length<=0)&&this._updateLanesFromNodes(),_.NodeElement._createMapFromLanes(this._internalLanes,jQuery.proxy(this.ontouchend,this),this._isHeaderMode()).positionMap},_.prototype._arrangeNodesByParentChildRelation=function(t){var e,i,o=t?t.length:0,s=[];if(o>0)for(this._setParentForNodes(t),e=0;e<o;e++){if(s=t[e].getChildren()){var n=s.length;for(i=0;i<n;i++)s[i]=_._getChildIdByElement(s[i]).toString()}for(i=0;i<e;i++)if(s&&Array.prototype.indexOf.call(s,t[i].getNodeId())>-1&&t[i].getLaneId()===t[e].getLaneId()){t.splice(i,0,t[e]),t.splice(e+1,1),t=this._arrangeNodesByParentChildRelation(t);break}}return t},_.prototype._getOrCreateProcessFlow=function(){!this._internalLanes||this._internalLanes.length<=0?this._updateLanesFromNodes():this._isLanesUpdated()&&(this._resetLanesFromModel(),this._updateLanesFromNodes()),this.applyNodeDisplayState();var t=this.getNodes(),e=_.NodeElement._createNodeElementsFromProcessFlowNodes(t,this._internalLanes),i=e.elementById,o=e.elementsByLane,s=this._calculateMatrix(i);s=this._addFirstAndLastColumn(s),_.NodeElement._calculateLaneStatePieChart(o,this._internalLanes,t,this);for(var n=0;n<s.length;n++)for(var a=0;a<s[n].length;a++)s[n][a]instanceof _.NodeElement&&(s[n][a]=i[s[n][a].nodeId].oNode);return this._internalCalcMatrix=s,s},_.prototype._isLanesUpdated=function(){var t,e=this.getLanes();if(e.length!=this._internalLanes.length)return!0;for(var i=0;i<e.length;i++){var o=e[i];t=!1;for(var s=0;s<this._internalLanes.length;s++){if(this._internalLanes[s].getLaneId()===o.getLaneId()){t=!0;break}}if(!t)return!0}return!1},_.prototype._resetLanesFromModel=function(){if(this.getNodes().forEach((function(t){t._mergedLaneId=!1})),this.getLanes().forEach((function(t){t._mergedLanePosition=!1})),this._internalLanes=[],this._isHeaderMode()){var t=this.getBindingInfo("lanes");t&&t.model&&this.getModel(t.model).refresh()}else{var e=this.getBindingInfo("nodes");e&&e.model&&this.getModel(e.model).refresh()}},_.prototype._addFirstAndLastColumn=function(t){if(!t||t.length<=0)return[];for(var e=t.length,i=0;i<e;i++)t[i].unshift(null),t[i].push(null);return t},_.prototype._calculateMatrix=function(t){var e,i,o,s,n;if(!t||0===t.length)return[];(e=new _.InternalMatrixCalculation(this)).checkInputNodeConsistency(t),i=e._retrieveInfoFromInputArray(t),e._resetPositions(),o=i.highestLanePosition+1,s=Math.max(Object.keys(t).length,2),n=e._createMatrix(s,o);for(var a=0;a<i.rootElements.length;a++)e.iPositionY=i.rootElements[a].lane,n=e.processCurrentElement(i.rootElements[a],t,n);return this._isLayoutOptimized&&e._optimizeMatrix(n,t),n=e._doubleColumnsInMatrix(n),n=e._calculatePathInMatrix(n),n=e._removeEmptyLines(n)},_.NodeElement=function(t,e,i,o){this.nodeId=t,this.lane=e,this.state=i.getState(),this.displayState=i._getDisplayState(),this.isProcessed=!1,Array.isArray(o)?this.aParent=o:this.oParent=o,this.oNode=i},_.NodeElement._initNodeElement=function(t,e,i,o){return new _.NodeElement(t,e,i,o)},_.NodeElement.prototype={toString:function(){return this.nodeId},containsChildren:function(t){if(!t)return!1;if(!(t instanceof _.NodeElement))return!1;if(this.oNode.getChildren()&&t.oNode.getChildren()&&this.oNode.getChildren().length&&t.oNode.getChildren().length)for(var e=0;e<this.oNode.getChildren().length;e++)if(t.oNode.getChildren().indexOf(this.oNode.getChildren()[e])>=0)return!0;return!1}},_.NodeElement._calculateLaneStatePieChart=function(e,i,o,s){if(e&&i&&o){var n,a,r,l,c,h;for(n=0;n<o.length&&(s._bHighlightedMode=o[n].getHighlighted(),!s._bHighlightedMode);n++);for(n=0;n<i.length;n++){var g=i[n],u=e[g.getLaneId()];if(u){a=0,r=0,l=0,c=0,h=0;for(var d=0;d<u.length;d++)if(!s._bHighlightedMode||u[d].oNode._getDisplayState()===t.ProcessFlowDisplayState.Highlighted||u[d].oNode._getDisplayState()===t.ProcessFlowDisplayState.HighlightedFocused||u[d].oNode._getDisplayState()===t.ProcessFlowDisplayState.SelectedHighlighted||u[d].oNode._getDisplayState()===t.ProcessFlowDisplayState.SelectedHighlightedFocused)switch(u[d].oNode.getState()){case t.ProcessFlowNodeState.Positive:a++;break;case t.ProcessFlowNodeState.Negative:case t.ProcessFlowNodeState.PlannedNegative:r++;break;case t.ProcessFlowNodeState.Planned:c++;break;case t.ProcessFlowNodeState.Critical:h++;break;case t.ProcessFlowNodeState.Neutral:default:l++}var _=[{state:t.ProcessFlowNodeState.Positive,value:a},{state:t.ProcessFlowNodeState.Negative,value:r},{state:t.ProcessFlowNodeState.Neutral,value:l},{state:t.ProcessFlowNodeState.Planned,value:c},{state:t.ProcessFlowNodeState.Critical,value:h}];g.setState(_)}}}},_.NodeElement._updateLanesFromNodes=function(t,e){var i,o,s=_.NodeElement._createMapFromLanes(t,null,!1),n=s.positionMap,a=s.idMap,r={},l=t.slice(),c={},h=0;for(o=0;o<e.length;o++)r[e[o].getNodeId()]=e[o];for(o=0;o<e.length;o++){for(var g=e[o],u=g.getChildren()||[],d=null,p=null,m=0;m<u.length;m++){var f=r[_._getChildIdByElement(u[m])];if(f){if(g.getLaneId()===f.getLaneId()){if(!(p=a[d=f.getLaneId()+"#"])){var C=a[g.getLaneId()];a[(p=_.NodeElement._createNewProcessFlowElement(C,d,C.getPosition()+1)).getLaneId()]=p,l.splice(p.getPosition(),0,p)}f._setMergedLaneId(p.getLaneId())}_.NodeElement._changeLaneOfChildren(g.getLaneId(),f,r)}}if(p){for(var v in c={},i=!1,n){if(p.getLaneId()===n[v].getLaneId()){i=!0;break}if(parseInt(v,10)>=p.getPosition()){var N=n[v];c[N.getPosition()+1]=N}}if(!i){for(var M in c)c[h=parseInt(M,10)]._setMergedPosition(h);c[p.getPosition()]=p;for(var F=0;F<p.getPosition();F++)c[F]=n[F];n=c}}}return{lanes:l,nodes:e}},_.NodeElement._changeLaneOfChildren=function(t,e,i){var o=e.getChildren();if(o)for(var s=0;s<o.length;s++){var n=i[_._getChildIdByElement(o[s])];n&&n.getLaneId()===t&&(n._setMergedLaneId(e.getLaneId()),_.NodeElement._changeLaneOfChildren(t,n,i))}},_.NodeElement._createNewProcessFlowElement=function(t,e,i){return new n({laneId:e,iconSrc:t.getIconSrc(),text:t.getText(),state:t.getState(),position:i,zoomLevel:t.getZoomLevel()})},_.NodeElement._createMapFromLanes=function(t,e,i){var o,s={},n={},a=t?t.length:0,r=0;if(a){for(;r<a;)(o=t[r])&&"sap.suite.ui.commons.ProcessFlowLaneHeader"===o.getMetadata().getName()&&(s[o.getPosition()]=o,n[o.getLaneId()]=o,e&&o.attachPress(e),o._setHeaderMode(i)),r++;return{positionMap:s,idMap:n}}return{}},_.NodeElement._createNodeElementsFromProcessFlowNodes=function(t,e){var i,o,s,n,a,r,l,c,h,g,u={},d={},p={},m=t?t.length:0,f=e?e.length:0,C=[],v={};if(0===m)return{elementById:{},elementsByLane:{}};if(0===f)throw["No lane definition although there is a node definition."];for(h=0;h<f;){if(n=(s=e[h]).getLaneId(),a=s.getPosition(),u[n])throw["The lane with id: "+n+" is defined at least twice. (Lane error)"];if(u[n]=a,C&&Array.prototype.indexOf.call(C,a)>-1)throw["The position "+a+" is defined at least twice. (Lane error)."];C.push(a),d[n]=[],h++}for(h=0;h<m;){if((i=t[h])&&"sap.suite.ui.commons.ProcessFlowNode"===i.getMetadata().getName())for(o=i.getNodeId(),n=i.getLaneId(),c=(r=i.getChildren()||[]).length,g=0;g<c;)p[l=_._getChildIdByElement(r[g])]=p[l]||[],p[l].push(o),g++;h++}for(h=0;h<m;){if((i=t[h])&&"sap.suite.ui.commons.ProcessFlowNode"===i.getMetadata().getName()){if(!(o=i.getNodeId()))throw["There is a node which has no node id defined. (Title="+i.getTitle()+") and array position: "+h];if(a=u[n=i.getLaneId()],"number"!==jQuery.type(a))throw["For the node "+o+" position (lane) is not defined."];if(v[o])throw["The node id "+o+" is used second time."];v[o]=_.NodeElement._initNodeElement(o,a,i,p[o]),d[n].push(v[o])}h++}return{elementById:v,elementsByLane:d}},_.InternalMatrixCalculation=function(){this.iPositionX=0,this.iPositionY=0,this.nodePositions={},this.mapChildToNode={}},_.InternalMatrixCalculation.prototype._optimizeMatrix=function(t,e){var i;do{i=!1;for(var o=0;o<t[0].length;o++)for(var s=0;s<t.length-1;s++)if(!t[s][o]){for(var n=!1,a=s+1;a<t.length;a++)if(t[a][o]){n=!0;break}if(!n)break;this._optimizeLane(t,s,o,e)&&(i=!0)}}while(i)},_.InternalMatrixCalculation.prototype._optimizeLane=function(t,e,i,o){for(var s=e+1;s<t.length;s++)if(t[s][i]){var n=t[s][i];return!!this._verifyOptimizeLane(t,e,s,i,o)&&(t[e][i]=n,this.nodePositions[n.nodeId].x=e,t[s][i]=null,!0)}return!1},_.InternalMatrixCalculation.prototype._verifyOptimizeLane=function(t,e,i,o,s){var n,a,r,l,c=t[i][o].oNode;if(c&&c.getChildren())for(r=t[i][o].oNode.getChildren(),n=0;n<r.length;n++){var h=s[l=_._getChildIdByElement(r[n])].lane;for(a=o+1;a<h;a++)if(t[e][a])return!1}var g=t[i][o].nodeId,u=this.nodePositions[g],d=t[i][o].aParent;if(d)for(n=0;n<d.length;n++){if(o-1!==s[l=_._getChildIdByElement(d[n])].lane)return!1;if(this.nodePositions[l].x>=u.x)return!1}for(n=0;n<o;n++)for(a=0;a<t.length;a++)if(t[a][n]&&t[a][n].oNode){l=t[a][n].nodeId;var p=this.nodePositions[l];if(r=t[a][n].oNode.getChildren())for(var m=0;m<r.length;m++){var f=_._getChildIdByElement(r[m]),C=this.nodePositions[f];if(s[f].lane>o&&!(p.x<e&&C.x<e||p.x>e&&C.x>e))return!1}}if(c._hasChildren())for(n=0;n<e;n++)if(t[n][o]&&(r=t[n][o].oNode.getChildren()))for(a=0;a<r.length;a++){var v=s[l=_._getChildIdByElement(r[a])],N=this.nodePositions[l];if(v.lane>o&&N.x>=e&&!c._hasChildrenWithNodeId(l))return!1}return!0},_.InternalMatrixCalculation.prototype._resetPositions=function(){this.iPositionX=0,this.iPositionY=0,delete this.nodePositions,delete this.mapChildToNode,this.nodePositions={},this.mapChildToNode={}},_.InternalMatrixCalculation.prototype._createMatrix=function(t){t=parseInt(t,10);var e=new Array(t||0),i=t;if(arguments.length>1)for(var o=Array.prototype.slice.call(arguments,1);i--;)e[t-1-i]=this._createMatrix.apply(this,o);return e},_.InternalMatrixCalculation.prototype._retrieveInfoFromInputArray=function(t){var e,i=0,o=[];return Object.keys(t).forEach((function(s){(e=t[s]).oParent||e.aParent||o.push(e),i<e.lane&&(i=e.lane)})),{highestLanePosition:i,rootElements:o}},_.InternalMatrixCalculation.prototype._doubleColumnsInMatrix=function(t){var e,i=0;for(e=0;e<t.length;e++)i=i>t[e].length?i:t[e].length;var o=new Array(t.length||0);for(e=0;e<o.length;e++){o[e]=new Array(2*i-1);for(var s=0;s<i;s++)t[e][s]&&(o[e][2*s]=t[e][s])}return o},_.InternalMatrixCalculation.prototype._removeEmptyLines=function(t){var e,i,o=0;for(e=0;e<t.length;e++)for(i=0;i<t[e].length;i++)if(t[e][i]){o++;break}var s=this._createMatrix(o,t[0].length);for(e=0;e<o;e++)for(i=0;i<t[e].length;i++)s[e][i]=null,t[e][i]&&(s[e][i]=t[e][i]);return s},_.InternalMatrixCalculation.prototype._sortBasedOnChildren=function(t,e){var i,o,s,n,a,r,l={},c=null,h=[];if(!t)return[];t.forEach((function(t){var o=_._getChildIdByElement(t);(i=l[e[o].lane])||(l[e[o].lane]=i=[]),i.push(e[o])}));var g=function(t,e){return s=(t.oNode.getChildren()||[]).length,(e.oNode.getChildren()||[]).length-s};for(c in o=[],l)o.push(c),l[c].sort(g);o=o.sort((function(t,e){return e-t}));var u=function(t){r.containsChildren(t)&&a.push(t)};return o.forEach((function(t){if((n=l[t]).length>1){for(a=[],r=n.shift();r;)a.indexOf(r)<0&&a.push(r),n.forEach(u),r=n.shift();h=h.concat(a)}else h=h.concat(n)})),h},_.InternalMatrixCalculation.prototype._calculatePathInMatrix=function(t){var e=null;for(var i in this.nodePositions)if(this.nodePositions.hasOwnProperty(i))for(var o=(e=this.nodePositions[i]).c.oNode.getChildren(),s=0;o&&s<o.length;s++){var n=_._getChildIdByElement(o[s]),a=this.nodePositions[n];t=this._calculateSingleNodeConnection(e,a,e.x,e.y,a.x,a.y,t)}return t},_.InternalMatrixCalculation.prototype._calculateSingleNodeConnection=function(t,e,i,o,s,n,a){var r=s-i;if(n-o<0)throw["Problem with negative horizontal movement","Parent node is "+t.c.toString(),"Children node is "+e.c.toString(),"Coordinates : '"+i+"','"+o+"','"+s+"','"+n+"'"];if(r<=-1){var l=this._checkIfHorizontalLinePossible(a,s,o+2,n),c=n-1;l&&(c=o+1);var h=i;l&&(h=s),a[i][c]=this._createConnectionElement(a[i][c],_._cellEdgeConstants.LU,t,e,!1),(a=this._writeVerticalLine(a,i,s,c,t,e))[s][c]=this._createConnectionElement(a[s][c],_._cellEdgeConstants.UR,t,e,c===n-1);var g=o+2,u=n;l||(g=o+1,u=c+1),a=this._writeHorizontalLine(a,h,g,u,t,e)}else 0===r?a=this._writeHorizontalLine(a,i,o+1,n,t,e):1===r?(a[i][o+1]=this._createConnectionElement(a[i][o+1],_._cellEdgeConstants.LD,t,e,!1),a[s][o+1]=this._createConnectionElement(a[s][o+1],_._cellEdgeConstants.DR,t,e,o+1===n-1),a=this._writeHorizontalLine(a,s,o+2,n,t,e)):(a[i][o+1]=this._createConnectionElement(a[i][o+1],_._cellEdgeConstants.LD,t,e,!1),(a=this._writeVerticalLine(a,s,i,o+1,t,e))[s][o+1]=this._createConnectionElement(a[s][o+1],_._cellEdgeConstants.DR,t,e,o+1===n-1),a=this._writeHorizontalLine(a,s,o+2,n,t,e));return a},_.InternalMatrixCalculation.prototype._writeVerticalLine=function(t,e,i,o,s,n){for(var a=e-1;a>i;a--)t[a][o]=this._createConnectionElement(t[a][o],_._cellEdgeConstants.DU,s,n,!1);return t},_.InternalMatrixCalculation.prototype._checkIfHorizontalLinePossible=function(t,e,i,o){for(var s=!0,n=i;n<o;n++)if(t[e][n]instanceof _.NodeElement){s=!1;break}return s},_.InternalMatrixCalculation.prototype._writeHorizontalLine=function(t,e,i,o,s,n){var a=e===n.x;a||o--;for(var r=i;r<o;r++)t[e][r]=this._createConnectionElement(t[e][r],_._cellEdgeConstants.LR,s,n,r===o-1&&a);return t},_.InternalMatrixCalculation.prototype._createConnectionElement=function(t,e,i,o,n){var a=t;if(a||(a=new s),"sap.suite.ui.commons.ProcessFlowConnection"===a.getMetadata().getName()){var r=this._calculateConnectionDisplayStateBySourceAndTargetNode(i.c.oNode,o.c.oNode),l={flowLine:e,targetNodeState:o.c.state,displayState:r,hasArrow:n};a.addConnectionData(l)}return a},_.InternalMatrixCalculation.prototype._calculateConnectionDisplayStateBySourceAndTargetNode=function(e,i){var o=e.getHighlighted(),s=e.getSelected(),n=e._getDimmed(),a=i.getHighlighted(),r=i.getSelected(),l=i._getDimmed(),c=t.ProcessFlowDisplayState.Regular;return s&&r?c=t.ProcessFlowDisplayState.Selected:o&&a?c=t.ProcessFlowDisplayState.Highlighted:(n||l||o&&r||s&&a)&&(c=t.ProcessFlowDisplayState.Dimmed),c},_.prototype.addNode=function(t){return this.addAggregation("nodes",t,!1)},_.prototype._switchCursors=function(t,e,i){t.hasClass(e)&&t.removeClass(e),t.hasClass(i)||t.addClass(i)},_.prototype._clearHandlers=function(t){t.bind(this._mousePreventEvents,jQuery.proxy(this._handlePrevent,this))},_.prototype._initZoomLevel=function(){if(this.$()){var i=this.$().width();i&&(i<e.ScreenSizes.tablet?this.setZoomLevel(t.ProcessFlowZoomLevel.Four):i<e.ScreenSizes.desktop?this.setZoomLevel(t.ProcessFlowZoomLevel.Three):this.setZoomLevel(t.ProcessFlowZoomLevel.Two))}},_.prototype._registerMouseWheel=function(t){var e=t.originalEvent.wheelDelta||-t.originalEvent.detail;0===e&&(e=-t.originalEvent.deltaY),t&&!t.isDefaultPrevented()&&(t.preventDefault(),t.originalEvent.returnValue=!1);var i=function(){var t=Date.now()-this._wheelTimestamp;t<300?this._wheelTimeout=setTimeout(function(){var t=i.bind(this);("string"==typeof t||t instanceof String)&&(t=this[t]),t.apply(this,[])}.bind(this),300-t):(this._wheelTimeout=null,this._wheelCalled=!1)};this._wheelCalled||(this._wheelCalled=!0,e<0?(this._isFocusChanged=!0,this.zoomOut()):(this._isFocusChanged=!0,this.zoomIn())),this._wheelTimeout||(this._wheelTimestamp=Date.now(),this._wheelTimeout=setTimeout(function(){var t=i.bind(this);("string"==typeof t||t instanceof String)&&(t=this[t]),t.apply(this,[])}.bind(this),300)),t&&!t.isPropagationStopped()&&t.stopPropagation(),t&&!t.isImmediatePropagationStopped()&&t.stopImmediatePropagation()},_.prototype._setFocusToNode=function(t){t?"sap.suite.ui.commons.ProcessFlowNode"===t.getMetadata().getName()?(jQuery(document.getElementById(t.sId)).parent().focus(),t._setNavigationFocus(!0)):"sap.suite.ui.commons.ProcessFlowConnectionLabel"===t.getMetadata().getName()&&(t.$().focus(),t._setNavigationFocus(!0)):this._lastNavigationFocusElement&&("sap.suite.ui.commons.ProcessFlowNode"===this._lastNavigationFocusElement.getMetadata().getName()?(jQuery(document.getElementById(this._lastNavigationFocusElement.sId)).parent().focus(),this._lastNavigationFocusElement._setNavigationFocus(!0),this._lastNavigationFocusElement.rerender()):"sap.suite.ui.commons.ProcessFlowConnectionLabel"===this._lastNavigationFocusElement.getMetadata().getName()&&(this._lastNavigationFocusElement.$().focus(),this._lastNavigationFocusElement._setNavigationFocus(!0)))},_.prototype._changeNavigationFocus=function(t,e){t&&e&&t.getId()!==e.getId()&&(l.debug("Rerendering PREVIOUS node with id '"+t.getId()+"' navigation focus : "+t._getNavigationFocus()),t._setNavigationFocus(!1),t.getMetadata().getName()),e&&(l.debug("Rerendering CURRENT node with id '"+e.getId()+"' navigation focus : "+e._getNavigationFocus()),e._setNavigationFocus(!0),e.getMetadata().getName(),this._lastNavigationFocusElement=e,this._onFocusChanged())},_.prototype._moveOnePage=function(t,e){t=t||_._enumMoveDirection.UP,e=e||!1;var i,o,s,n=0,a=0,r=0,l=0,c=0,h=!1;for(i=0;i<this._internalCalcMatrix.length;i++)for(o=0;o<this._internalCalcMatrix[i].length;o++){if(this._internalCalcMatrix[i][o]&&"sap.suite.ui.commons.ProcessFlowNode"===this._internalCalcMatrix[i][o].getMetadata().getName()&&this._internalCalcMatrix[i][o]._getNavigationFocus()){n=i,a=o;break}if(this._internalCalcMatrix[i][o]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[i][o].getMetadata().getName()&&(s=this._internalCalcMatrix[i][o]._getVisibleLabel())&&s._getNavigationFocus()){n=i,a=o;break}}if(e){if(t===_._enumMoveDirection.UP)for(o=a-1;o>=0&&c<this._jumpOverElements;o--)!this._internalCalcMatrix[n][o]||"sap.suite.ui.commons.ProcessFlowNode"!==this._internalCalcMatrix[n][o].getMetadata().getName()||this._bHighlightedMode&&!this._internalCalcMatrix[n][o].getHighlighted()?this._internalCalcMatrix[n][o]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[n][o].getMetadata().getName()&&(s=this._internalCalcMatrix[n][o]._getVisibleLabel(),this._labelCanGetFocus(s)&&(c++,r=n,l=o,h=!0)):(c++,r=n,l=o,h=!0);else if(t===_._enumMoveDirection.DOWN)for(o=a+1;o<this._internalCalcMatrix[n].length&&c<this._jumpOverElements;o++)!this._internalCalcMatrix[n][o]||"sap.suite.ui.commons.ProcessFlowNode"!==this._internalCalcMatrix[n][o].getMetadata().getName()||this._bHighlightedMode&&!this._internalCalcMatrix[n][o].getHighlighted()?this._internalCalcMatrix[n][o]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[n][o].getMetadata().getName()&&(s=this._internalCalcMatrix[n][o]._getVisibleLabel(),this._labelCanGetFocus(s)&&(c++,r=n,l=o,h=!0)):(c++,r=n,l=o,h=!0)}else if(t===_._enumMoveDirection.UP)for(i=n-1;i>=0&&c<this._jumpOverElements;i--)!this._internalCalcMatrix[i][a]||"sap.suite.ui.commons.ProcessFlowNode"!==this._internalCalcMatrix[i][a].getMetadata().getName()||this._bHighlightedMode&&!this._internalCalcMatrix[i][a].getHighlighted()?this._internalCalcMatrix[i][a]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[i][a].getMetadata().getName()&&(s=this._internalCalcMatrix[i][a]._getVisibleLabel(),this._labelCanGetFocus(s)&&(c++,r=i,l=a,h=!0)):(c++,r=i,l=a,h=!0);else if(t===_._enumMoveDirection.DOWN)for(i=n+1;i<this._internalCalcMatrix.length&&c<this._jumpOverElements;i++)!this._internalCalcMatrix[i][a]||"sap.suite.ui.commons.ProcessFlowNode"!==this._internalCalcMatrix[i][a].getMetadata().getName()||this._bHighlightedMode&&!this._internalCalcMatrix[i][a].getHighlighted()?this._internalCalcMatrix[i][a]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[i][a].getMetadata().getName()&&(s=this._internalCalcMatrix[i][a]._getVisibleLabel(),this._labelCanGetFocus(s)&&(c++,r=i,l=a,h=!0)):(c++,r=i,l=a,h=!0);return h&&(this._internalCalcMatrix[n][a]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[n][a].getMetadata().getName()?this._internalCalcMatrix[n][a]._getVisibleLabel()._setNavigationFocus(!1):this._internalCalcMatrix[n][a]._setNavigationFocus(!1),this._internalCalcMatrix[r][l]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[r][l].getMetadata().getName()?((s=this._internalCalcMatrix[r][l]._getVisibleLabel())._setNavigationFocus(!0),this._lastNavigationFocusElement=s):(this._internalCalcMatrix[r][l]._setNavigationFocus(!0),this._lastNavigationFocusElement=this._internalCalcMatrix[r][l])),h},_.prototype._moveHomeEnd=function(t,e){t=t||_._enumMoveDirection.RIGHT,e=e||!1;var i,o,s,n=0,a=0,r=0,l=0,c=!1;for(i=0;i<this._internalCalcMatrix.length;i++)for(o=0;o<this._internalCalcMatrix[i].length;o++){if(this._internalCalcMatrix[i][o]&&"sap.suite.ui.commons.ProcessFlowNode"===this._internalCalcMatrix[i][o].getMetadata().getName()&&this._internalCalcMatrix[i][o]._getNavigationFocus()){n=i,a=o;break}if(this._internalCalcMatrix[i][o]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[i][o].getMetadata().getName()&&(s=this._internalCalcMatrix[i][o]._getVisibleLabel())&&s._getNavigationFocus()){n=i,a=o;break}}if(e){if(t===_._enumMoveDirection.LEFT)for(i=0;i<n;i++){if(this._internalCalcMatrix[i][a]&&"sap.suite.ui.commons.ProcessFlowNode"===this._internalCalcMatrix[i][a].getMetadata().getName()&&(!this._bHighlightedMode||this._internalCalcMatrix[i][a].getHighlighted())){r=i,l=a,c=!0;break}if(this._internalCalcMatrix[i][a]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[i][a].getMetadata().getName()&&(s=this._internalCalcMatrix[i][a]._getVisibleLabel(),this._labelCanGetFocus(s))){r=i,l=a,c=!0;break}}else if(t===_._enumMoveDirection.RIGHT)for(i=this._internalCalcMatrix.length-1;i>n;i--){if(this._internalCalcMatrix[i][a]&&"sap.suite.ui.commons.ProcessFlowNode"===this._internalCalcMatrix[i][a].getMetadata().getName()&&(!this._bHighlightedMode||this._internalCalcMatrix[i][a].getHighlighted())){r=i,l=a,c=!0;break}if(this._internalCalcMatrix[i][a]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[i][a].getMetadata().getName()&&(s=this._internalCalcMatrix[i][a]._getVisibleLabel(),this._labelCanGetFocus(s))){r=i,l=a,c=!0;break}}}else if(t===_._enumMoveDirection.LEFT)for(o=0;o<a;o++){if(this._internalCalcMatrix[n][o]&&"sap.suite.ui.commons.ProcessFlowNode"===this._internalCalcMatrix[n][o].getMetadata().getName()&&(!this._bHighlightedMode||this._internalCalcMatrix[n][o].getHighlighted())){r=n,l=o,c=!0;break}if(this._internalCalcMatrix[n][o]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[n][o].getMetadata().getName()&&(s=this._internalCalcMatrix[n][o]._getVisibleLabel(),this._labelCanGetFocus(s))){r=n,l=o,c=!0;break}}else if(t===_._enumMoveDirection.RIGHT)for(o=this._internalCalcMatrix[n].length-1;o>a;o--){if(this._internalCalcMatrix[n][o]&&"sap.suite.ui.commons.ProcessFlowNode"===this._internalCalcMatrix[n][o].getMetadata().getName()&&(!this._bHighlightedMode||this._internalCalcMatrix[n][o].getHighlighted())){r=n,l=o,c=!0;break}if(this._internalCalcMatrix[n][o]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[n][o].getMetadata().getName()&&(s=this._internalCalcMatrix[n][o]._getVisibleLabel(),this._labelCanGetFocus(s))){r=n,l=o,c=!0;break}}return c&&(this._internalCalcMatrix[n][a]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[n][a].getMetadata().getName()?this._internalCalcMatrix[n][a]._getVisibleLabel()._setNavigationFocus(!1):this._internalCalcMatrix[n][a]._setNavigationFocus(!1),this._internalCalcMatrix[r][l]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[r][l].getMetadata().getName()?((s=this._internalCalcMatrix[r][l]._getVisibleLabel())._setNavigationFocus(!0),this._lastNavigationFocusElement=s):(this._internalCalcMatrix[r][l]._setNavigationFocus(!0),this._lastNavigationFocusElement=this._internalCalcMatrix[r][l])),c},_.prototype._moveToNextElement=function(t,e){t=t||_._enumMoveDirection.RIGHT,u.getConfiguration().getRTL()&&(t===_._enumMoveDirection.RIGHT?t=_._enumMoveDirection.LEFT:t===_._enumMoveDirection.LEFT&&(t=_._enumMoveDirection.RIGHT)),e=e||1;var i,o,s,n=!1,a=!1,r=0,l=1;if(!this._internalCalcMatrix)return!1;var c,h,g,d=0,p=0;for(i=0;i<this._internalCalcMatrix.length;i++){for(o=0;o<this._internalCalcMatrix[i].length;o++)if(this._internalCalcMatrix[i][o]){if(this._internalCalcMatrix[i][o]&&"sap.suite.ui.commons.ProcessFlowNode"===this._internalCalcMatrix[i][o].getMetadata().getName()&&this._internalCalcMatrix[i][o]._getNavigationFocus()){r=d=i,l=p=o,n=!0;break}if(this._internalCalcMatrix[i][o]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[i][o].getMetadata().getName()&&(s=this._internalCalcMatrix[i][o]._getVisibleLabel())&&s._getNavigationFocus()&&s.getEnabled()){r=d=i,l=p=o,n=!0;break}}if(n)break}if(t===_._enumMoveDirection.RIGHT)for(i=d;i<this._internalCalcMatrix.length;i++){for(o=p+1;o<this._internalCalcMatrix[i].length;o++)if(this._internalCalcMatrix[i][o]&&"sap.suite.ui.commons.ProcessFlowNode"===this._internalCalcMatrix[i][o].getMetadata().getName()){if(n&&(!this._bHighlightedMode||this._internalCalcMatrix[i][o].getHighlighted())){this._internalCalcMatrix[i][o]._setNavigationFocus(!0),this._lastNavigationFocusElement=this._internalCalcMatrix[i][o],a=!0;break}}else if(this._internalCalcMatrix[i][o]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[i][o].getMetadata().getName()&&(s=this._internalCalcMatrix[i][o]._getVisibleLabel(),n&&this._labelCanGetFocus(s))){s._setNavigationFocus(!0),this._lastNavigationFocusElement=s,a=!0;break}if(p=0,a)break}if(t===_._enumMoveDirection.LEFT)for(i=d;i>=0;i--){for(o=p-1;o>=0;o--)if(this._internalCalcMatrix[i][o]&&"sap.suite.ui.commons.ProcessFlowNode"===this._internalCalcMatrix[i][o].getMetadata().getName()){if(n&&(!this._bHighlightedMode||this._internalCalcMatrix[i][o].getHighlighted())){this._lastNavigationFocusElement=this._internalCalcMatrix[i][o]._setNavigationFocus(!0),this._lastNavigationFocusElement=this._internalCalcMatrix[i][o],a=!0;break}}else if(this._internalCalcMatrix[i][o]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[i][o].getMetadata().getName()&&(s=this._internalCalcMatrix[i][o]._getVisibleLabel(),n&&this._labelCanGetFocus(s))){s._setNavigationFocus(!0),this._lastNavigationFocusElement=s,a=!0;break}if(i>0&&(p=this._internalCalcMatrix[i-1].length),a)break}if(t===_._enumMoveDirection.UP)for(i=d-1;i>=0;i--)for(c=0;!a;){if(g=p+c,(h=p-c)>=0&&this._internalCalcMatrix[i][h]&&"sap.suite.ui.commons.ProcessFlowNode"===this._internalCalcMatrix[i][h].getMetadata().getName()){if(n&&(!this._bHighlightedMode||this._internalCalcMatrix[i][h].getHighlighted())){this._internalCalcMatrix[i][h]._setNavigationFocus(!0),this._lastNavigationFocusElement=this._internalCalcMatrix[i][h],a=!0;break}}else if(h>=0&&this._internalCalcMatrix[i][h]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[i][h].getMetadata().getName()&&(s=this._internalCalcMatrix[i][h]._getVisibleLabel(),n&&this._labelCanGetFocus(s))){s._setNavigationFocus(!0),this._lastNavigationFocusElement=s,a=!0;break}if(g<this._internalCalcMatrix[i].length&&this._internalCalcMatrix[i][g]&&"sap.suite.ui.commons.ProcessFlowNode"===this._internalCalcMatrix[i][g].getMetadata().getName()){if(n&&(!this._bHighlightedMode||this._internalCalcMatrix[i][g].getHighlighted())){this._internalCalcMatrix[i][g]._setNavigationFocus(!0),this._lastNavigationFocusElement=this._internalCalcMatrix[i][g],a=!0;break}}else if(g>=0&&this._internalCalcMatrix[i][g]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[i][g].getMetadata().getName()&&(s=this._internalCalcMatrix[i][g]._getVisibleLabel(),n&&this._labelCanGetFocus(s))){s._setNavigationFocus(!0),this._lastNavigationFocusElement=s,a=!0;break}if(h<0&&g>this._internalCalcMatrix[i].length)break;c++}if(t===_._enumMoveDirection.DOWN)for(i=d+1;i<this._internalCalcMatrix.length;i++)for(c=0;!a;){if(g=p+c,(h=p-c)>=0&&this._internalCalcMatrix[i][h]&&"sap.suite.ui.commons.ProcessFlowNode"===this._internalCalcMatrix[i][h].getMetadata().getName()){if(n&&(!this._bHighlightedMode||this._internalCalcMatrix[i][h].getHighlighted())){this._lastNavigationFocusElement=this._internalCalcMatrix[i][h]._setNavigationFocus(!0),this._lastNavigationFocusElement=this._internalCalcMatrix[i][h],a=!0;break}}else if(h>=0&&this._internalCalcMatrix[i][h]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[i][h].getMetadata().getName()&&(s=this._internalCalcMatrix[i][h]._getVisibleLabel(),n&&this._labelCanGetFocus(s))){s._setNavigationFocus(!0),this._lastNavigationFocusElement=s,a=!0;break}if(g<this._internalCalcMatrix[i].length&&this._internalCalcMatrix[i][g]&&"sap.suite.ui.commons.ProcessFlowNode"===this._internalCalcMatrix[i][g].getMetadata().getName()){if(n&&(!this._bHighlightedMode||this._internalCalcMatrix[i][g].getHighlighted())){this._lastNavigationFocusElement=this._internalCalcMatrix[i][g]._setNavigationFocus(!0),this._lastNavigationFocusElement=this._internalCalcMatrix[i][g],a=!0;break}}else if(g>=0&&this._internalCalcMatrix[i][g]&&"sap.suite.ui.commons.ProcessFlowConnection"===this._internalCalcMatrix[i][g].getMetadata().getName()&&(s=this._internalCalcMatrix[i][g]._getVisibleLabel(),n&&this._labelCanGetFocus(s))){s._setNavigationFocus(!0),this._lastNavigationFocusElement=s,a=!0;break}if(h<0&&g>this._internalCalcMatrix[i].length)break;c++}return a&&(this._internalCalcMatrix[r][l]&&"sap.suite.ui.commons.ProcessFlowNode"===this._internalCalcMatrix[r][l].getMetadata().getName()?this._internalCalcMatrix[r][l]._setNavigationFocus(!1):this._internalCalcMatrix[r][l]._getVisibleLabel()._setNavigationFocus(!1)),a},_.prototype._getScrollContainerOnZoomChanged=function(t,e){return t.scrollLeft=Math.round(e.get()[0].scrollWidth/t.scrollWidth*t.scrollLeft),t.scrollTop=Math.round(e.get()[0].scrollHeight/t.scrollHeight*t.scrollTop),t.scrollWidth=e.get()[0].scrollWidth,t.scrollHeight=e.get()[0].scrollHeight,t},_.prototype._mergeLaneIdNodeStates=function(e){for(var i=0,o=0,s=0,n=0,a=0,r=0;r<5;r++)for(var l=0;l<e.length;l++)switch(e[l][r].state){case t.ProcessFlowNodeState.Positive:i+=e[l][r].value;break;case t.ProcessFlowNodeState.Negative:o+=e[l][r].value;break;case t.ProcessFlowNodeState.Neutral:s+=e[l][r].value;break;case t.ProcessFlowNodeState.Planned:n+=e[l][r].value;break;case t.ProcessFlowNodeState.PlannedNegative:o+=e[l][r].value;break;case t.ProcessFlowNodeState.Critical:a+=e[l][r].value}return[{state:t.ProcessFlowNodeState.Positive,value:i},{state:t.ProcessFlowNodeState.Negative,value:o},{state:t.ProcessFlowNodeState.Neutral,value:s},{state:t.ProcessFlowNodeState.Planned,value:n},{state:t.ProcessFlowNodeState.Critical,value:a}]},_.prototype._setFocusOnHeader=function(t){var e=this.$("thead");t?(e.focus(),e.addClass("sapSuiteUiCommonsPFHeaderFocused"),this._headerHasFocus=!0):(e.removeClass("sapSuiteUiCommonsPFHeaderFocused"),this._headerHasFocus=!1)},_.prototype._scroll=function(t,e){var i=this._getScrollContainer().get(0),o=i.scrollLeft;!a.browser.edge&&this._bRtl&&(t=-t);var s=o+t;jQuery(i).stop(!0,!0).animate({scrollLeft:s},e,jQuery.proxy(this._adjustAndShowArrow,this))},_.prototype._adjustAndShowArrow=function(){this._checkOverflow(this._getScrollContainer().get(0),this.$()),this.getScrollable()&&this._moveArrowAndCounterVertical(),this._isFocusChanged&&(this._setFocusToNode(this._lastNavigationFocusElement),this._isFocusChanged=!1)},_.prototype._getScrollingArrow=function(t){var e={src:a.system.desktop?"sap-icon://navigation-"+t+"-arrow":"sap-icon://slim-arrow-"+t},o=["sapPFHArrowScroll","sapPFHArrowScrollLeft"],s=["sapPFHArrowScroll","sapPFHArrowScrollRight"];return t===_._constants.left?(this._oArrowLeft||(this._oArrowLeft=i.getImageControl(this.getId()+_._constants.arrowScrollLeftMinus,null,this,e,o)),this._oArrowLeft):t===_._constants.right?(this._oArrowRight||(this._oArrowRight=i.getImageControl(this.getId()+_._constants.arrowScrollRightMinus,null,this,e,s)),this._oArrowRight):void 0},_.prototype._checkScrolling=function(t,e){var i=!1;return t&&t.scrollWidth>t.clientWidth&&(i=!0),this._arrowScrollable!==i&&(e.toggleClass("sapPFHScrollable",i),e.toggleClass("sapPFHNotScrollable",!i),this._arrowScrollable=i),i},_.prototype._updateLeftCounter=function(){var t;t=this._bRtl?this._getScrollContainer().scrollRightRTL():this._getScrollContainer().scrollLeft();var e=Math.round(t/this._scrollStep);return this.$(_._constants.counterLeft).text(e.toString()),e},_.prototype._updateRightCounter=function(t,e){var i,o;return this._bRtl?(i=this._getScrollContainer().scrollLeftRTL(),o=Math.round(i/this._scrollStep)):(i=this._getScrollContainer().scrollLeft(),o=Math.round((e-i-t)/this._scrollStep)),this.$(_._constants.counterRight).text(o.toString()),o},_.prototype._moveArrowAndCounterVertical=function(){var t=this._getScrollContainer().scrollTop();if(t>0){var e=this._iInitialArrowTop-t,i=this._iInitialCounterTop-t,o=this._iInitialCounterTop-this._iInitialArrowTop;e>0?(this.$(_._constants.arrowScrollRight).css(_._constants.top,e+_._constants.px),this.$(_._constants.arrowScrollLeft).css(_._constants.top,e+_._constants.px)):(this.$(_._constants.arrowScrollRight).css(_._constants.top,"0px"),this.$(_._constants.arrowScrollLeft).css(_._constants.top,"0px")),i>o?(this.$(_._constants.counterRight).css(_._constants.top,i+_._constants.px),this.$(_._constants.counterLeft).css(_._constants.top,i+_._constants.px)):(this.$(_._constants.counterRight).css(_._constants.top,o+_._constants.px),this.$(_._constants.counterLeft).css(_._constants.top,o+_._constants.px))}else this.$(_._constants.arrowScrollRight).css(_._constants.top,this._iInitialArrowTop+_._constants.px),this.$(_._constants.arrowScrollLeft).css(_._constants.top,this._iInitialArrowTop+_._constants.px),this.$(_._constants.counterRight).css(_._constants.top,this._iInitialCounterTop+_._constants.px),this.$(_._constants.counterLeft).css(_._constants.top,this._iInitialCounterTop+_._constants.px)},_.prototype._checkOverflow=function(t,e){if(this._checkScrolling(t,e)&&t){this._setScrollWidth();var i=!1,o=!1,s=this._getScrollContainer().scrollLeft(),n=t.scrollWidth,a=t.clientWidth;if(1===Math.abs(n-a)&&(n=a),this._bRtl){var r=jQuery(t);r.scrollLeftRTL()>20&&(o=!0),r.scrollRightRTL()>20&&(i=!0)}else s>20&&(i=!0),n>a&&s+a+20<n&&(o=!0);this._updateLeftCounter(),this._updateRightCounter(a,n),o===this._bPreviousScrollForward&&i===this._bPreviousScrollBack||(this._bPreviousScrollForward=o,this._bPreviousScrollBack=i,e.toggleClass("sapPFHScrollBack",i),e.toggleClass("sapPFHNoScrollBack",!i),e.toggleClass("sapPFHScrollForward",o),e.toggleClass("sapPFHNoScrollForward",!o))}else this._bPreviousScrollForward=!1,this._bPreviousScrollBack=!1},_.prototype._setParentForNodes=function(t){var e,i,o,s=t?t.length:0;for(var n in t)t[n].removeAllAssociation(_._constants.parents,!0);for(i=0;i<s;i++)if(e=t[i].getChildren())for(o=0;o<e.length;o++){var a=this._getNode(_._getChildIdByElement(e[o]),t);a&&a.addAssociation(_._constants.parents,t[i],!0)}},_.prototype._getConnectionsMap=function(){for(var t=[],e=this.getNodes(),i=0;i<e.length;i++){var o=this._getPositionOfNodeInMatrix(this._internalCalcMatrix,e[i]),s=e[i].getChildren();if(s)for(var n=0;n<s.length;n++){var a={};a.sourceNode=e[i];var r=_._getChildIdByElement(s[n]),l=this._getNode(r,e);if(l){"object"==typeof s[n]&&(a.label=s[n].connectionLabel),a.targetNode=l;var c=this._getPositionOfNodeInMatrix(this._internalCalcMatrix,a.targetNode);a.connectionParts=this._calculateConnectionParts(o,c),t.push(a)}}}return this._internalConnectionMap=t,t},_.prototype._getPositionOfNodeInMatrix=function(t,e){for(var i={},o=0;o<t.length;o++)for(var s=t[o],n=0;n<s.length;n++){var a=s[n];if(a&&"sap.suite.ui.commons.ProcessFlowNode"===a.getMetadata().getName()&&a.getNodeId()===e.getNodeId())return i.y=o,i.x=n,i}return i},_.prototype._calculateConnectionParts=function(t,e){var i=[],o=t.y,s=t.x;if(s++,i.push({x:s,y:o}),e.y>=t.y)for(;o<e.y;)o++,i.push({x:s,y:o});else for(;o>e.y;)o--,i.push({x:s,y:o});for(;s<e.x-1;)s++,i.push({x:s,y:o});return i},_.prototype._getConnectionMapEntries=function(t){var e=[],i=null,o=null;if(this._internalConnectionMap){for(var s=0;s<this._internalConnectionMap.length;s++)if((o=this._internalConnectionMap[s]).label&&o.label.getId()===t.getId()){i=o;break}o=null;for(var n=0;n<this._internalConnectionMap.length;n++)(o=this._internalConnectionMap[n]).targetNode&&o.targetNode.getNodeId()===i.targetNode.getNodeId()&&e.push(o)}return e},_.prototype._createLabelPressEventArgs=function(t,e){var i={},o=[];if(e)for(var s=0;s<e.length;s++){var n={sourceNode:e[s].sourceNode,targetNode:e[s].targetNode,label:e[s].label};o.push(n)}return i.selectedLabel=t,i.connections=o,i},_.prototype.applyNodeDisplayState=function(){var t=this.getNodes(),e=t?t.length:0,i=0;if(0!==e){for(;i<e;)t[i]._setRegularState(),i++;for(i=0;i<e&&!t[i].getHighlighted()&&!t[i].getSelected();)i++;if(i<e)for(i=0;i<e;)t[i].getHighlighted()||t[i].getSelected()||t[i]._setDimmedState(),i++}},_.InternalMatrixCalculation.prototype.checkInputNodeConsistency=function(t){var e,i,o,s,n,a=[],r=0;if(Object.keys(t).forEach((function(l){for(n=t[l],s=n.oNode.getChildren(),o=s?s.length:0,n.oNode.getFocused()&&r++,e=0;e<o;)i=_._getChildIdByElement(s[e]),t[i]||a.push("Node identificator "+i+" used in children definition is not presented as the node itself. Element : "+n.nodeId),e++})),a.length>0)throw a;return r>1},_.InternalMatrixCalculation.prototype.processCurrentElement=function(t,e,i){var o,s,n=!0,a=!0;return t.isProcessed||(this.nodePositions[t.nodeId]={c:t,x:this.iPositionX,y:2*this.iPositionY},i[this.iPositionX][this.iPositionY++]=t,o=t.oNode.getChildren(),t.isProcessed=!0,(s=this._sortBasedOnChildren(o,e))&&s.forEach(function(t){if(t.isProcessed)n&&a&&(this.iPositionX++,n=!1);else{for(a=!1;this.iPositionY<t.lane;)i[this.iPositionX][this.iPositionY++]=null;i=this.processCurrentElement(t,e,i)}}.bind(this)),o&&!a||(n&&this.iPositionX++,this.iPositionY=0)),i},_.prototype.getZoomLevel=function(){return this._zoomLevel},_.prototype.setZoomLevel=function(e){if(this._getScrollContainer()){var i,o=this._getScrollContainer(),s=null;if(o.get().length&&(i=s={scrollWidth:o.get()[0].scrollWidth,scrollHeight:o.get()[0].scrollHeight,scrollLeft:o.get()[0].scrollLeft,scrollTop:o.get()[0].scrollTop},this._zoomLevel===e))this._isInitialZoomLevelNeeded=!1;else if(e in t.ProcessFlowZoomLevel){if(this._zoomLevel=e,this._isInitialZoomLevelNeeded?(this._isInitialZoomLevelNeeded=!1,this.invalidate()):this.rerender(),s){if(a.support.touch){var n=parseInt(this._getScrollContainer().css("height").slice(0,-2),10),r=parseInt(this._getScrollContainer().css("width").slice(0,-2),10),l=this._getScrollContainer()[0].scrollHeight,c=this._getScrollContainer()[0].scrollWidth;this.getScrollable()&&(l>n||c>r)&&(this._switchCursors(this._getScrollContainer(),this._defaultCursorClass,this._grabCursorClass),this._getScrollContainer().css("overflow","auto"))}o=this._getScrollContainer(),i=this._getScrollContainerOnZoomChanged(s,o),o.scrollLeft(i.scrollLeft),o.scrollTop(i.scrollTop),this._adjustAndShowArrow(),this._isFocusChanged&&(this._setFocusToNode(),this._isFocusChanged=!1)}}else this._handleException('"'+e+'" is not a valid entry of the enumeration for property zoom level of ProcessFlow')}},_.prototype.zoomOut=function(){var e=this.getZoomLevel(),i=e;switch(e){case t.ProcessFlowZoomLevel.One:i=t.ProcessFlowZoomLevel.Two;break;case t.ProcessFlowZoomLevel.Two:i=t.ProcessFlowZoomLevel.Three;break;case t.ProcessFlowZoomLevel.Three:i=t.ProcessFlowZoomLevel.Four}return this.setZoomLevel(i),this.getZoomLevel()},_.prototype.zoomIn=function(){var e=this.getZoomLevel(),i=e;switch(e){case t.ProcessFlowZoomLevel.Four:i=t.ProcessFlowZoomLevel.Three;break;case t.ProcessFlowZoomLevel.Three:i=t.ProcessFlowZoomLevel.Two;break;case t.ProcessFlowZoomLevel.Two:i=t.ProcessFlowZoomLevel.One}return this.setZoomLevel(i),this.getZoomLevel()},_.prototype.updateModel=function(){if(this._lastNavigationFocusElement=null,this.getNodes().forEach((function(t){t._mergedLaneId=!1})),this.getLanes().forEach((function(t){t._mergedLanePosition=!1})),this._internalLanes=[],this._isHeaderMode()){var t=this.getBindingInfo("lanes");this.getModel(t.model).refresh()}else{var e=this.getBindingInfo("nodes");this.getModel(e.model).refresh()}this.rerender()},_.prototype.optimizeLayout=function(t){return void 0===t&&(t=!0),this._isLayoutOptimized!==t&&(this._isLayoutOptimized=t,this.updateModel()),this},_.prototype.getFocusedNode=function(){return this._lastNavigationFocusElement&&this._lastNavigationFocusElement.sId},_.prototype.updateNodesOnly=function(){var t=this.getBindingInfo("nodes");this.getModel(t.model).refresh(),this.rerender()},_.prototype.setSelectedPath=function(t,e){var i,o=this.getNodes();if(o)if(t&&e){var s=0;for(i=0;i<o.length;i++)o[i].getNodeId()===t||o[i].getNodeId()===e?(o[i].setSelected(!0),s++):o[i].setSelected(!1);2===s&&this.rerender()}else if(!t&&!e){for(i=0;i<o.length;i++)o[i].setSelected(!1);this.rerender()}},_.prototype.setShowLabels=function(t){return this.getShowLabels()&&!t?(this.setProperty("showLabels",t,!0),this.getShowLabels()||this.setSelectedPath(null,null)):this.setProperty("showLabels",t),this},_.prototype.setFocusToLabel=function(t){this._changeNavigationFocus(this._lastNavigationFocusElement,t)},_.prototype._labelCanGetFocus=function(t){return t&&t.getEnabled()&&(!this._bHighlightedMode||t._bHighlighted)},_.prototype.getNode=function(t){for(var e=this.getNodes(),i=0;i<e.length;i++)if(e[i].getProperty("nodeId")===t)return e[i]},_.prototype.getFocusInfo=function(){var t=document.activeElement;return t&&t.nodeName?{sFocusId:t.id,oFocusedElement:t,oFocusInfo:{}}:{}},_.prototype.applyFocusInfo=function(t){if(t.sFocusId){var e=this._lastNavigationFocusElement;this._changeNavigationFocus(null,e)}},_.prototype.getLane=function(t){for(var e=this.getLanes(),i=0;i<e.length;i++)if(e[i].getProperty("laneId")===t)return e[i]},_.prototype.removeAllLanes=function(){this.removeAllAggregation("lanes"),this._internalLanes=[]},_}));