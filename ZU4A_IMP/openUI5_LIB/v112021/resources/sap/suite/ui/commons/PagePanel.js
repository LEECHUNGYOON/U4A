sap.ui.define(["sap/suite/ui/commons/BasePanel","sap/m/FlexBox","sap/suite/ui/commons/Page","sap/m/GenericTile","sap/suite/ui/commons/util/PageIconsConstant","sap/m/IllustratedMessage","sap/m/Button","sap/ushell/Config","sap/ui/core/theming/Parameters","sap/ui/Device","sap/suite/ui/commons/MenuButton"],function(e,t,i,s,o,a,n,r,l,h,p){"use strict";var g=e.extend("sap.suite.ui.commons.PagePanel",{metadata:{properties:{title:{type:"string",group:"Misc",visibility:"hidden"},key:{type:"string",group:"Misc",visibility:"hidden"},width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"100%",visibility:"hidden"},height:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"100%",visibility:"hidden"}}}});var d=8;var u="SAP_BASIS_SP_UI_MYHOME";var c="sap-icon://document";var f=15;var P=7;var m=function(e){return{key:e,value:l.get({name:e}),assigned:false}};var v=function(){return m("sapLegendColor9")},C=function(){return["sapLegendColor6","sapLegendColor3","sapLegendColor1","sapLegendColor10","sapLegendColor12","sapLegendColor7","sapLegendColor5","sapLegendColor8","sapLegendColor18","sapLegendColor9"].map(m)};var y={phone:240,tablet:600,desktop:1024,xxsmall:240,xsmall:320,small:480,medium:560,large:768,xlarge:960,xxlarge:1120,xxxlarge:1440},_={Desktop:"Desktop",Tablet:"Tablet",Mobile:"Mobile"};var I=function(){var e;if(h.resize.width>=y.xsmall&&h.resize.width<y.tablet){e=_.Mobile}else if(h.resize.width>=y.tablet&&h.resize.width<y.desktop){e=_.Tablet}else{e=_.Desktop}return e};g.prototype.init=function(){this._oWrapperFlexBox=new t(this.getId()+"--flexContainerCardsContent",{justifyContent:"Start",height:"100%",direction:"Row",renderType:"Bare",wrap:"Wrap"}).addStyleClass("sapMNewsFlex newsSlideFlexGap");this.addContent(this._oWrapperFlexBox);this.setTitle(this.getResourceBundle().getText("pageTitle"));this.addAggregation("menuButtons",new p(`${this.getId()}-menuButton`,{icon:"sap-icon://slim-arrow-down"}));this._mngBtn=new n(`${this.getId()}-mngPageBtn`,{text:this.getResourceBundle().getText("mngPage")});this.addAggregation("actionButtons",this._mngBtn);this._oColorList=C().slice(0,d);e.prototype.init.apply(this,arguments)};g.prototype._getColorMap=function(){return this._oColorList};g.prototype.getFreeColor=function(){var e=this._oColorList.find(function(e){return!e.assigned}),t=v().key;if(e){e.assigned=true;t=e.key}return t};g.prototype.addColor=function(e){this._fetchColor(e).assigned=true;return this};g.prototype.removeColor=function(e){this._fetchColor(e).assigned=false;return this};g.prototype._fetchColor=function(e){return this._oColorList.find(function(t){return t.key===e})||{}};g.prototype.getData=function(){if(!this.oPagePromise){this.oPagePromise=this._getPages().then(function(){this._getInnerControls()}.bind(this))}return this.oPagePromise};g.prototype.attachResizeHandler=function(e,t){try{var i=I(),s=this.aFavPages.length;var o=this.getContent()[0].getDomRef();if(!o){return false}var a;if(t){if(e){a=o.clientWidth}else{a=t}}this.pageTilesStylesApplied=true;var n,r,l=a/16,h=1,p,g=t?t:o.clientWidth;if(e&&g>=1520){l=g/16-40.75}if(!e){var d=s*P+(s-1)*h;if(d<=l){n=s;r=(l-(n-1)*h)/n;r=r<=f?r:f;this.setPropertyValues({hBoxWidth:l+"rem",pagesTileWidth:r+"rem"});return true}}if(i===_.Desktop){if(e){n=Math.ceil(s>=8?4:s/2)}else{n=s<=4?s:Math.ceil(s>=8?4:s/2)}}r=(l-(n-1)*h)/n;r=r<=f?r:f;p=n*r+n*h;this.setPropertyValues({hBoxWidth:p+"rem",pagesTileWidth:r+"rem"});return true}catch(e){return false}};g.prototype._getInnerControls=function(){this.myFavPage=[];this.oInnerControls=[];if(this.aFavPages){this.aFavPages.forEach(function(e){this.myFavPage.push(new i({title:e.title,subTitle:e.title===e.spaceTitle?null:e.spaceTitle,icon:e.icon,bgColor:e.BGColor,pageId:e.pageId,spaceId:e.spaceId,spaceTitle:e.spaceTitle,url:"#Launchpad-openFLPPage?pageId="+e.pageId+"&spaceId="+e.spaceId}))}.bind(this));this.myFavPage.forEach(function(e){this.oInnerControls.push(new s({header:e.getTitle(),subheader:e.getSubTitle(),press:e.onPageTilePress.bind(this,e),sizeBehavior:"Responsive",state:"Loaded",frameType:"OneByOne",mode:"IconMode",backgroundColor:e.getBgColor(),tileIcon:e.getIcon(),visible:true,renderOnThemeChange:true,ariaRole:"listitem",dropAreaOffset:8,url:e.getProperty("url")}))}.bind(this));this._oWrapperFlexBox.setAlignItems(this.aFavPages.length==1?"Start":"Center");if(this.aFavPages.length){this.getParent()?._panelLoadedFn("Page",{loaded:true,count:this.aFavPages.length});this.setFavPagesContent()}else{this.getParent()?._panelLoadedFn("Page",{loaded:true,count:0});this.setNoPageContent()}}else{this.getParent()?._panelLoadedFn("Page",{loaded:false,count:0});this.removeAggregation("content",this._oWrapperFlexBox)}};g.prototype.setFavPagesContent=function(){this._oWrapperFlexBox.removeAllItems();this.oInnerControls.forEach(function(e){this._oWrapperFlexBox.addItem(e)}.bind(this))};g.prototype._createNoPageContent=function(){if(!this._oIllusMsg){this._oIllusMsg=new a(this.getId()+"--idNoPages",{illustrationSize:"Spot",illustrationType:"sapIllus-SimpleNoSavedItems",title:this.getResourceBundle().getText("noDataPageTitle"),description:this.getResourceBundle().getText("noPageDescription")}).addStyleClass("myHomeIllustratedMsg myHomeIllustratedMessageAlign");this.oAddPageBtn=new n(this.getId()+"--idAddPageBtn",{text:this.getResourceBundle().getText("addPage"),tooltip:this.getResourceBundle().getText("addPage"),type:"Emphasized"})}};g.prototype.setNoPageContent=function(){this._createNoPageContent();this._oIllusMsg.addAdditionalContent(this.oAddPageBtn);this._oWrapperFlexBox.removeAllItems();this._oWrapperFlexBox.addStyleClass("pagesFlexBox");this._oWrapperFlexBox.addItem(this._oIllusMsg)};g.prototype._setDefaultPages=function(e){this.aFavPages=e.slice(0,d)||[];this._setFavPages(this.aFavPages);return this.aFavPages};g.prototype.setPropertyValues=function(e){var t=Object.keys(e);t.forEach(function(t){if(t==="hBoxWidth"){this._oWrapperFlexBox.setProperty("width",e[t])}else if(t==="pagesTileWidth"&&this.oInnerControls.length){this.oInnerControls.forEach(function(i){i.setProperty("width",e[t])})}}.bind(this))};g.prototype._setFavPages=function(e,t){var i;e.forEach(function(e){e.selected=true;if(!e.BGColor){e.BGColor=this.getFreeColor()}else{this.addColor(e.BGColor)}}.bind(this));i=!e.length;if(!i){this._applyIconsForFavPages()}};g.prototype._applyIconsForFavPages=function(){this.aFavPages.map(function(e){return this._getIconForPage(e)}.bind(this))};g.prototype._getIconForPage=function(e){var t=o.PAGES.find(function(t){return e.pageId.includes(t.id)});if(!t){t=o.SPACES.find(function(t){return e.spaceId.includes(t.id)})}e.icon=t?t.icon:c;e.isIconLoaded=true};g.prototype._getPages=function(){var e=this.aFavPages?this.aFavPages:undefined;var t=false;var i=encodeURIComponent(r.last("/core/spaces/enabled"));if(i&&sap.ushell&&sap.ushell.Container){return this._fetchAllAvailablePages(true).then(function(i){if(!e){if(i.length){this._setDefaultPages(i)}else{this.removeAggregation("content",this._oWrapperFlexBox);return Promise.resolve(this.getParent()?._panelLoadedFn("Page",{loaded:false,count:0}))}}else{var s=[],o;e.forEach(function(e){o=i.find(function(t){return t.pageId===e.pageId});if(o){o.BGColor=e.BGColor;s.push(o)}});s=s.slice(0,d);if(s.length||!e.length){this._setFavPages(s,s.length!==e.length||t)}else if(!s.length&&e.length){this._setDefaultPages(i)}}this.availablePages=i}.bind(this))}else{return Promise.resolve([])}};g.prototype._fetchAllAvailableSpaces=function(){if(this._aSpaces){return Promise.resolve(this._aSpaces)}else if(sap.ushell.Container.getServiceAsync){return sap.ushell.Container.getServiceAsync("Bookmark").then(function(e){return e.getContentNodes?.()||Promise.resolve([])}).then(function(e){this._aSpaces=e.filter(function(e){return e.id!==u});this._aSpaces.forEach(function(e){e.BGColor=v();e.applyColorToAllPages=false});return this._aSpaces}.bind(this))}else{return Promise.resolve([])}};g.prototype._fetchAllAvailablePages=function(e){return this._aPages?Promise.resolve(this._aPages):this._fetchAllAvailableSpaces().then(function(t){this._aPages=[];t.forEach(function(t){if(Array.isArray(t.children)){t.children.forEach(function(i){if(!e||e&&!this._aPages.find(function(e){return e.id===i.id})){this._aPages.push({title:i.label,icon:c,isIconLoaded:false,pageId:i.id,spaceId:t.id,spaceTitle:t.label,url:"#Launchpad-openFLPPage?pageId="+i.id+"&spaceId="+t.id})}}.bind(this))}}.bind(this));return this._aPages}.bind(this))};return g});
//# sourceMappingURL=PagePanel.js.map