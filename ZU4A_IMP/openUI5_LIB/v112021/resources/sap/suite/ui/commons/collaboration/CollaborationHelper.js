/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/base/Log","sap/ui/base/Object","sap/ui/core/Lib"],function(e,t,r){"use strict";var n="sap-url-hash";var i="&sap-ui-cardTitle";var s="&sap-stageview-hash";var a="&sap-ui-xx-cardId";var o="transient";var c=e.getLogger("sap.suite.ui.commons.collaboration.CollaborationHelper");var u=t.extend("sap.suite.ui.commons.collaboration.CollaborationHelper");u.compactHash=function(e){const t=sap.ui.require("sap/ushell/Container");if(!t){return{url:e}}return t&&t.getServiceAsync("AppState").then(async function(t){var r=t.createEmptyAppState(undefined,false);var i=this._getNextKey(r);if(!this._isEligibleForBackendPersistency(t)){c.warning("Transient flag is true. URL will not be shortened");return{url:e}}var s=this._extractURLBeforeHash(e);var a=await this._extractSemanticObjectAndAction(e);var o=false;try{o=await this._isMinificationFeasible(e)}catch(e){}if(!a||!o){return{url:e}}return this._storeUrl(e,r).then(function(){return{url:s+"#"+a+"&/"+n+"="+i}}).catch(function(t){c.warning("URL is not shortened due to an error."+t.toString());return{url:e}})}.bind(this))};u._getCurrentUrl=function(){const e=sap.ui.require("sap/ushell/Container");return e&&e?new Promise(function(t){e.getFLPUrlAsync(true).then(function(e){t(e)})}):Promise.resolve(document.URL)};u.processAndExpandHash=function(){this._hideAvatarFromShellbar();return this._getCurrentUrl().then(function(e){if(e.indexOf(n)>-1){var t=e.split(n)[1].split("=")[1];if(e.indexOf(s)>0){t=t.split(s)[0]}else if(e.indexOf(a)>0){t=t.split(a)[0]}else if(e.indexOf(i)>0){t=t.split(i)[0]}return this._retrieveURL(t).then(function(t){if(t.getData()){window.location.replace(t.getData())}else{const t=e.split(n)[0];window.location.replace(t)}return Promise.resolve()})}else if(e.indexOf(a)>-1){const t=e.split(a)[0];window.location.replace(t)}else if(e.indexOf(i)>-1){const t=e.split(i)[0];window.location.replace(t)}return Promise.resolve()}.bind(this))};u._hideAvatarFromShellbar=function(){this.isTeamsModeActive().then(function(e){if(e){var t=sap.ui.require("sap/ui/core/Core");var r=t.byId("userActionsMenuHeaderButton");if(r){r.setVisible(false)}}})};u.isTeamsModeActive=function(){var e=false;const t=sap.ui.require("sap/ushell/Container");if(t){return t.getServiceAsync("URLParsing").then(function(t){return this._getCurrentUrl().then(function(r){var n=r.split("#")[0];if(n.indexOf("?")!==-1){var i=t&&t.parseParameters(n.substring(n.indexOf("?")));if(i&&i["sap-collaboration-teams"]&&i["sap-collaboration-teams"][0]&&i["sap-collaboration-teams"][0]==="true"){e=true}var s=false;if(i&&i["sap-ushell-config"]&&i["sap-ushell-config"][0]&&i["sap-ushell-config"][0]==="lean"){s=true}return Promise.resolve(e&&s)}else{return Promise.resolve(false)}})}.bind(this))}else{return Promise.resolve(false)}};u._retrieveURL=function(e){const t=sap.ui.require("sap/ushell/Container");return t&&t.getServiceAsync("AppState").then(function(t){return t.getAppState(e)})};u._isEligibleForBackendPersistency=function(e){return e&&e._oConfig&&o in e._oConfig&&!e._oConfig[o]};u._getNextKey=function(e){return e.getKey()};u._extractSemanticObjectAndAction=function(e){const t=sap.ui.require("sap/ushell/Container");return t&&t.getServiceAsync("URLParsing").then(function(t){var r=t.parseShellHash(this._extractURLHash(e));if(r){return Promise.resolve(r.contextRaw?r.semanticObject+"-"+r.action+"~"+r.contextRaw:r.semanticObject+"-"+r.action)}}.bind(this))};u._isMinificationFeasible=async function(e){const t=sap.ui.require("sap/ushell/Container");if(t){const i=await t.getServiceAsync("NavTargetResolution");const s=await t.getServiceAsync("URLParsing");var r=s.parseShellHash(this._extractURLHash(e));var n=Object.keys(r.params).length;if(n>0){return i.resolveHashFragment(`#${r.semanticObject}-${r.action}`).then(function(e){return true}).catch(function(e){return false})}else{return Promise.resolve(true)}}return Promise.resolve(false)};u._extractURLBeforeHash=function(e){var t=e.split("#")[0];return t};u._extractURLHash=function(e){var t=e.substring(e.indexOf("#"));return t};u._storeUrl=function(e,t){t.setData(e);return t.save()};return u});
//# sourceMappingURL=CollaborationHelper.js.map