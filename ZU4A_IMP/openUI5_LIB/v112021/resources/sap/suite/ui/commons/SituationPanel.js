sap.ui.define(["sap/suite/ui/commons/ToDoPanel","sap/m/GenericTile","sap/m/TileContent","sap/f/GridListItem","sap/m/library","sap/m/Text","sap/ui/model/odata/v2/ODataModel","sap/ui/core/format/DateFormat","sap/ui/core/format/NumberFormat","sap/base/Log"],function(t,e,i,o,a,r,n,s,u,p){"use strict";const l=a.URLHelper;const c=t.extend("sap.suite.ui.commons.SituationPanel");c.prototype.init=function(){this.setKey("situations");this.setTitle(this.getResourceBundle().getText("situationsTabTitle"));t.prototype.init.apply(this,arguments)};c.prototype.generateCardTemplate=function(t,a){return new o(`${t}-gridListItem`,{content:[new e(`${t}-tile`,{mode:"ActionMode",frameType:"TwoByOne",pressEnabled:true,header:"{_toDos>title}",width:"{_toDos>/cardWidth}",state:"{_toDos>status}",url:"{_toDos>link}",headerImage:"{_toDos>headerImage}",valueColor:this._convertToValueColor(a.getProperty("priority")),press:this._onPressSituation.bind(this),tileContent:[new i(`${t}-tileContent`,{priority:"{_toDos>priority}",priorityText:this.getResourceBundle().getText(this.toPriorityText(a.getProperty("priority"))),footer:"{_toDos>footerText}",content:[new r(`${t}-situationContent`,{text:"{_toDos>text}"})]})]})]}).addStyleClass("sapMGT")};c.prototype._onPressSituation=async function(t){const e=t.getSource();const i=e.getBindingContext("_toDos");const o=i.getProperty("status");const a=i.getProperty("id");const r=i.getProperty("link");if(o!=="Loading"){if(a){try{await this._mixInSituationsSupport();const t=await this._fetchNavigationTargetData(this._oSituationsModel,a);await this._executeNavigation(t,this.getOwnerComponent())}catch(t){if(t._sErrorCode==="NavigationHandler.isIntentSupported.notSupported"){l.redirect(this.getAppUrl(),false)}}}else{l.redirect(r,false)}}};c.prototype._mixInSituationsSupport=function(){return this._executeNavigation?Promise.resolve():new Promise(function(t){sap.ui.getCore().loadLibrary("s4.cfnd.sit.reuse",{async:true}).then(()=>{sap.ui.require(["sap/fe/navigation/NavigationHandler","s4/cfnd/sit/reuse/util/SituationNavigationHelperSupport"],function(e,i){i.mixInto(this);this._oSituationsModel=new n("/sap/opu/odata/sap/C_SITNMYSITUATION_CDS/");t()}.bind(this))}).catch(t=>{p.error(t)})}.bind(this))};c.prototype.processData=function(t){this._oData.displayTiles=this._oData.tiles=(t||[]).map(t=>({id:t.SitnInstanceID,title:t.SitnDefShortText,text:this._getSituationText(t.SitnDefLongText,t.to_InstanceMessageParameter.results),priority:"Medium",showPriorityText:false,link:"#SituationInstance-display?ui-type=objectbased",formatContent:false,headerImage:"sap-icon://message-warning",footerText:this.getResourceBundle().getText("createdSituation",[this.toRelativeDateTime(this._getSituationDate(t.CreationDateTime))])}))};c.prototype._getSituationText=function(t,e){if(!t||!t.split){return t}let i=t;if(!this._dateFormatter){const t=sap.ui.getCore().getConfiguration().getFormatSettings().getDatePattern("medium")||"dd/MM/yyyy";this._dateFormatter=s.getDateInstance({pattern:t})}if(!this._decimalFormatter){this._decimalFormatter=u.getInstance({decimalSeparator:sap.ui.getCore().getConfiguration().getFormatSettings().getNumberSymbol("decimal")||".",groupingSeparator:sap.ui.getCore().getConfiguration().getFormatSettings().getNumberSymbol("group")||",",groupingEnabled:true})}if(e&&e.length){e.forEach(t=>{if(t.SitnMsgParamName&&t.SitnMsgParamName.length>0){let e;let o=t.SitnMsgParamVal.trim();switch(t.SitnMsgParamType){case"Edm.DateTime":e=this._dateFormatter.format(this._dateFormatter.parse(o));break;case"Edm.Decimal":if(o.endsWith("-")){o="-"+o.substring(0,o.length-1)}e=this._decimalFormatter.format(o);break;default:e=o}i=i.split("{"+t.SitnMsgParamName+"}").join(e)}})}return i};c.prototype._getSituationDate=function(t){const e=/\/Date\((\d*)([+-])(\d*)\)\//;const i=t.match(e);const o=i[1];const a=i[2];const r=i[3];const n=o*1;const s=r*6e4;const u=a==="-"?n-s:n+s;return new Date(u)};c.prototype._convertToValueColor=function(t){const e={VeryHigh:"Error",High:"Error",Medium:"Critical",Low:"Good",Neutral:"Neutral"};return e[t]||e.Neutral};c.prototype.getViewAllItemsText=function(){return this.getResourceBundle().getText("viewAllSituationsTitle")};c.prototype.getNoDataText=function(){return this.getResourceBundle().getText("noSituationTitle")};return c});
//# sourceMappingURL=SituationPanel.js.map