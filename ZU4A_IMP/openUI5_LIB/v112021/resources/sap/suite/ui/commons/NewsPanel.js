sap.ui.define(["sap/suite/ui/commons/BasePanel","sap/ui/model/xml/XMLModel","sap/m/SlideTile","sap/m/GenericTile","sap/m/TileContent","sap/m/NewsContent","sap/m/library","sap/ui/core/format/DateFormat","sap/m/FlexItemData","sap/suite/ui/commons/MenuButton","sap/m/Button"],function(e,t,i,s,n,o,r,a,l,h,d){"use strict";var u=e.extend("sap.suite.ui.commons.NewsPanel",{metadata:{properties:{url:{type:"string",group:"Misc",defaultValue:""},title:{type:"string",group:"Misc",visibility:"hidden"},key:{type:"string",group:"Misc",visibility:"hidden"},width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"100%",visibility:"hidden"},height:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"100%",visibility:"hidden"}}}});var p=r.URLHelper;var m=7;var g=a.getDateTimeInstance({style:"medium",relative:true,relativeStyle:"short"});u.prototype.init=function(){this._oNewsTile=new i(this.getId()+"--idNewsSlide",{displayTime:2e4,width:"100%",height:"17rem"}).addStyleClass("newsTileMaxWidth");this.addContent(this._oNewsTile);this.setTitle(this.getResourceBundle().getText("newsTitle"));this.addAggregation("menuButtons",new h(`${this.getId()}-menuButton`,{icon:"sap-icon://slim-arrow-down"}));this._mngNewsBtn=new d(`${this.getId()}-mngNewsBtn`,{text:this.getResourceBundle().getText("mngNews")});this.addAggregation("actionButtons",this._mngNewsBtn);e.prototype.init.apply(this,arguments)};u.prototype.getData=function(){this.newsContainer=this.getParent();if(!this.oNewsPromise){this.oNewsPromise=new Promise(function(e,i){this._oNewsModel=new t;this._oNewsModel.setDefaultBindingMode("OneWay");this._oNewsTile.setModel(this._oNewsModel);this.newsLoad=this.newsLoad||false;this._oNewsModel.attachRequestCompleted(function(t){if(!this.newsLoad){this._onNewsModelLoaded(t);if(t.getParameters().success){this.newsContainer?._panelLoadedFn("News",{loaded:true});this.newsLoad=true}this.setNewsPanel();e()}}.bind(this));this._oNewsModel.attachRequestFailed(function(){if(!this.newsLoad){this.newsContainer?._panelLoadedFn("News",{loaded:false});this.removeAggregation("content",this.getNewsTile());this.newsLoad=true;i()}}.bind(this));this.setNewsUrl()}.bind(this))}return this.oNewsPromise};u.prototype.setNewsPanel=function(e){this.oFlexItem=this.oFlexItem||new l(this.getId()+"--idNewsItemDatanew",{growFactor:1,maxWidth:"39.75rem"});this.newsContainer?.getInnerControl().addStyleClass("newsSlideFlexGap");this._oNewsTile.getParent()?.addStyleClass("newsTileMaxWidth");this._oNewsTile.getParent()?.setLayoutData(this.oFlexItem)};u.prototype.setNewsUrl=function(){this._sUrl=this.getUrl();if(this.getNewsTile()){if(this._sUrl){this._loadFeedFromURL(this._sUrl)}else{this.handleFeedError()}}else{this.handleFeedError()}};u.prototype._onNewsModelLoaded=function(e){var t=e.getSource().getData();this.loadNewsFeed(t)};u.prototype._loadFeedFromURL=function(e){if(e){this._oNewsModel.loadData(e)}};u.prototype.loadNewsFeed=function(e,t){var i;if(e&&e.querySelector&&!!e.querySelector("rss")&&!!e.querySelector("item")){i={path:"/channel/item",length:t||m,template:{imageUrlParts:["link/@href","link"],link:"{= ${link/@href} || ${link}}",footerParts:["published","pubDate"],contentText:"{title}",subheader:"{= ${summary} || ${description}}",pressHandler:this._navigateToNewscontent,footerFormatter:this._formatDate.bind(this)}};this.bindNewsTile(this._oNewsTile,i)}else if(e&&e.querySelector&&!!e.querySelector("feed")&&!!e.querySelector("entry")){i={path:"/entry",length:t||m,template:{imageUrlParts:["link/@href","link"],link:"{= ${link/@href} || ${link}}",footerParts:["published","updated"],contentText:"{title}",subheader:"{= ${summary} || ${description}}",pressHandler:this._navigateToNewscontent,footerFormatter:this._formatDate.bind(this)}};this.bindNewsTile(this._oNewsTile,i)}else{this.handleFeedError()}};u.prototype.getNewsTile=function(){return this._oNewsTile};u.prototype.handleFeedError=function(){this.getNewsTile().removeAllTiles();this.getNewsTile().setVisible(false);this.newsContainer?._panelLoadedFn("News",{loaded:false});this.newsLoad=true};u.prototype.bindNewsTile=function(e,t){if(t){this.getNewsTile().setVisible(true);e.bindAggregation("tiles",{path:t.path,length:t.length,templateShareable:false,template:this.generateTemplate(t.template)})}};u.prototype.generateTemplate=function(e){var t=new s({backgroundImage:{parts:e.imageUrlParts,formatter:e.imageFormatter||this.extractImage.bind(this)},mode:"ArticleMode",press:[e.pressHandler,this],frameType:"Stretch",url:e.link,tileContent:[new n({footer:{parts:e.footerParts,formatter:e.footerFormatter},content:[new o({contentText:e.contentText,subheader:e.subheader})]})]});return t};u.prototype._navigateToNewscontent=function(e){var t=e.getSource().getUrl();p.redirect(t,true)};u.prototype._formatDate=function(e,t){var i=e?e:t;return this._toRelativeDateTime(new Date(i))};u.prototype.extractImage=function(e,t){var i=function(){var e=sap.ui.require.toUrl("suite/suite-ui-commons/src/sap/suite/ui/commons/util/");this.image=this.image?this.image+1:1;this.image=this.image<9?this.image:1;return e+"/imgNews/"+this.image+".jpg"}.bind(this);return fetch(e||t).then(function(e){return e.text()}).then(function(e){var t=e.match(/<meta[^>]*property=["']og:image["'][^>]*content=["']([^"']+)["'][^>]*>/i);if(Array.isArray(t)&&t[1]){return t[1]}else{return i()}}).catch(function(){return i()})};u.prototype._toRelativeDateTime=function(e){return g.format(new Date(e))};return u});
//# sourceMappingURL=NewsPanel.js.map