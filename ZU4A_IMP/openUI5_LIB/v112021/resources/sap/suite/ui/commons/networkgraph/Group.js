sap.ui.define(["sap/suite/ui/commons/library","sap/ui/thirdparty/jquery","./ElementBase","sap/ui/core/IconPool","sap/m/CheckBox","sap/ui/core/Core","sap/ui/core/Lib"],(function(e,jQuery,t,o,i,r,s){"use strict";var n=e.networkgraph.ElementStatus,a=e.networkgraph.HeaderCheckboxState,p=32,u=160,h=32,d=s.getResourceBundleFor("sap.suite.ui.commons"),l=t.extend("sap.suite.ui.commons.networkgraph.Group",{metadata:{library:"sap.suite.ui.commons",properties:{headerCheckBoxState:{type:"sap.suite.ui.commons.networkgraph.HeaderCheckboxState",group:"Misc",defaultValue:a.Hidden},key:{type:"string",group:"Misc",defaultValue:null},collapsed:{type:"boolean",group:"Misc",defaultValue:!1},icon:{type:"string",group:"Appearance",defaultValue:null},minWidth:{type:"float",defaultValue:void 0},parentGroupKey:{type:"string",group:"Misc",defaultValue:null}},events:{headerCheckBoxPress:{parameters:{checked:"boolean"}},collapseExpand:{},showDetail:{}},aggregations:{_checkBox:{type:"sap.m.CheckBox",multiple:!1,visibility:"hidden"}}},renderer:{apiVersion:2,render:function(e,t){t._render({renderManager:e})}},onAfterRendering:function(){this._afterRenderingBase()}});return l.prototype.aProcessRequiredProperties=["key","parentGroupKey"],l.BUTTONS={MENU:"menu",COLLAPSE:"collapse"},l.prototype.init=function(){this._iWidth=u,this._iHeight=p,this._oActionButtons={},this._clearChildren(),this._bIsHidden=!1},l.prototype._afterRendering=function(){this._setupEvents(),this._isVisible()||this.$().hide(),0!==this.$().find(".sapSuiteUiCommonsNetworkGraphHeaderCheckboxInner").length&&this.$().find(".sapSuiteUiCommonsNetworkGraphHeaderCheckboxInner").attr("aria-label",this.getTitle()),this._removeFromInvalidatedControls()},l.prototype._renderTopGroup=function(e){var t=this._getElementId(e.idSufix),o=0===this._iTopGroupIndex,i=e.renderManager,r=this.getIcon(),s=this.getTitle(),n=50*this._iTopGroupIndex;this.getParent()._bIsRtl&&(n=(o=!o)?0:50),o&&i.openStart("div").class("sapSuiteUiCommonsNetworkTopGroupDelimiter").openEnd().close("div"),this._renderHtmlElement("div",{top:0,left:n+"%",width:"50%",height:"32px"},{id:t,"data-sap-ui":t,class:"sapSuiteUiCommonsNetworkTopGroup "+(o?"":"sapSuiteUiCommonsNetworkTopGroupRight")},i),i.openStart("div").class("sapSuiteUiCommonsNetworkTopGroupHeader").openEnd(),r&&this._renderHtmlIcon(r,null,null,null,null,i),s&&i.openStart("div").class("sapSuiteUiCommonsNetworkGroupHeaderTitle").attr("title",s).openEnd().text(s).close("div"),i.close("div"),i.close("div")},l.prototype._render=function(e){var o,i=this.getParent(),r=!this.getCollapsed()||this._isCollapsedSwimLane()?this._iHeight:h;if(e=e||{},0===this._iNestedLevel&&i._isTwoColumnsLayout())return this._renderTopGroup(e),"";if(this._isIgnored()||!this.getVisible())return"";if(this.getParent()._isLayered()){o=this._getElementId(e.idSufix);var s=this._convertToStyle({top:this.getY()+"px",left:this.getX()+"px",width:this._iWidth+"px",height:r+"px"},this._getStatusStyle({"border-color":t.ColorType.Border,"border-width":t.ColorType.BorderWidth,"border-style":t.ColorType.BorderStyle}),!0);this._renderHtmlElement("div",{},{id:o,"data-sap-ui":o,class:this._getGroupClass(),style:s},e.renderManager),this._renderHeader(e),e.renderManager.close("div")}},l.prototype._renderHeader=function(e){var o=this.getIcon(),i=this.getTitle(),s="",a="",p="",u="";if(this.getStatus()&&this.getStatus()!==n.Standard&&(p=this._getStatusStyle({color:t.ColorType.Content},!0),u=this._getStatusStyle({color:t.ColorType.Content},!1),this._bIsSwimLane?s=this._getStatusStyle({"background-color":t.ColorType.Background},!1):a=this._getStatusStyle({"background-color":t.ColorType.Background,"border-color":t.ColorType.Background},!1)),e.renderManager.openStart("div"),this.applyStyles(e.renderManager,this.getStyleObject(a)),e.renderManager.class("sapSuiteUiCommonsNetworkGroupHeader").openEnd(),this._bIsSwimLane&&(s||this._hasDefaultStatus())&&(e.renderManager.openStart("div").class("sapSuiteUiCommonsNetworkGroupHeaderStatus"),this.applyStyles(e.renderManager,this.getStyleObject(s)),e.renderManager.openEnd(),e.renderManager.close("div")),e.renderManager.openStart("div").class("sapSuiteUiCommonsNetworkGroupHeaderInner").class("sapSuiteUiCommonsNetworkGroupHeaderInnerText").openEnd(),this._showHeaderCheckBox()&&this._renderClonedControl(e,this._getHeaderCheckbox()),o&&this._renderHtmlIcon(o,"sapSuiteUiCommonsNetworkGroupHeaderIcon",null,e.renderManager?u:p,null,e.renderManager),i){e.renderManager.openStart("div").class("sapSuiteUiCommonsNetworkGroupHeaderTitle").attr("title",i);var h=r.getConfiguration().getLanguage();this._isVerticalSwimLane()&&["ja","zh-TW","zh-CN","ko"].indexOf(h)>-1&&(u=u.length>0?u.concat(";text-orientation:sideways"):u.concat("text-orientation:sideways")),this.applyStyles(e.renderManager,this.getStyleObject(u)),e.renderManager.openEnd(),e.renderManager.text(i),e.renderManager.close("div")}e.renderManager.close("div"),e.renderManager.openStart("div").class("sapSuiteUiCommonsNetworkGroupHeaderInner").class("sapSuiteUiCommonsNetworkGroupHeaderInnerIcons").openEnd(),this._renderHtmlIcon(this.getCollapsed()?"expand-all":"collapse-all","sapSuiteUiCommonsNetworkGroupHeaderMenuIcon","collapse",e.renderManager?u:p,d.getText("NETWORK_GRAPH_EXPAND_COLLAPSE"),e.renderManager),this._renderHtmlIcon("horizontal-grip","sapSuiteUiCommonsNetworkGroupHeaderMenuIcon","menu",e.renderManager?u:p,d.getText("NETWORK_GRAPH_GROUP_DETAILS"),e.renderManager),e.renderManager.close("div"),e.renderManager.close("div")},l.prototype._getGroupClass=function(){return"sapSuiteUiCommonsNetworkGroup "+this._getStatusClass()+(this.getCollapsed()?"sapSuiteUiCommonsNetworkGroupCollapsed":"sapSuiteUiCommonsNetworkGroupExpanded")+(this._bIsSwimLane?" sapSuiteUiCommonsNetworkGroupSwimLane":" sapSuiteUiCommonsNetworkGroupClassic")+(this._isVerticalSwimLane()?" sapSuiteUiCommonsNetworkGroupVerticalSwimLane":"")+(this._isTopBottom()?" sapSuiteUiCommonsNetworkGroupTopBottom ":"")},l.prototype.getChildNodes=function(){return this._checkForProcessData(),this.aChildren},l.prototype.getChildLines=function(){return this._checkForProcessData(),this.aLines},l.prototype.getParentNodes=function(){return this._checkForProcessData(),this.aParents},l.prototype.getParentLines=function(){return this._checkForProcessData(),this.aParentLines},l.prototype.getNodes=function(){return this._checkForProcessData(),this.aNodes},l.prototype.isHidden=function(){return this._bIsHidden},l.prototype.setHidden=function(e){this.$()[e?"hide":"show"](),this._bIsHidden=e},l.prototype.getHeaderCheckbox=function(){return this._getHeaderCheckbox()},l.prototype._getHeaderCheckbox=function(){var e=this.getAggregation("_checkBox"),t=this;return e||(e=new i(this.getId()+"-checkbox",{select:function(o){var i=e.getSelected();t.fireHeaderCheckBoxPress({checked:i})}}).addStyleClass("sapSuiteUiCommonsNetworkGraphHeaderCheckboxInner"),this.setAggregation("_checkBox",e,!0)),e},l.prototype._isCollapsedSwimLane=function(){return this._bIsSwimLane&&this.getCollapsed()},l.prototype._clearChildren=function(){this.aNodes=[],this.aLines=[],this.aChildren=[],this.aParentLines=[],this.aParents=[],this.aChildGroups=[]},l.prototype._hasVisibleNodes=function(e){var t=this.aNodes.some((function(e){return!e._bIsHidden}));if(!t)for(var o=0;o<this.aChildGroups.length;o++)if(this.aChildGroups[o]._hasVisibleNodes())return!0;return t},l.prototype._hasNodes=function(){var e=this.aNodes.some((function(e){return e._useInLayout()}));return e||(e=this.aChildGroups.some((function(e){return e._hasNodes()}))),e},l.prototype._hideShow=function(e){this.$()[e?"hide":"show"](),this._bIsHidden=e;for(var t=this._oParentGroup;t;){var o=t._hasVisibleNodes();if(!(o&&!e||!o&&e))break;t._hideShow(e),t=t._oParentGroup}},l.prototype._setButtonFocus=function(e,t){e[t?"addClass":"removeClass"]("sapSuiteUiCommonsNetworkElementFocus")},l.prototype._setMenuButtonFocus=function(e){this._setButtonFocus(jQuery(this._oActionButtons.menu),e)},l.prototype._setCollapseButtonFocus=function(e){this._setButtonFocus(jQuery(this._oActionButtons.collapse),e)},l.prototype._setupEvents=function(){var e=this.$("menu"),o=this.$("header"),i=this.$("collapse"),r=this.$().find(".sapSuiteUiCommonsNetworkGroupHeaderMenuIcon");this._oActionButtons.menu=e[0],this._oActionButtons.collapse=i[0],i.off("click"),e.off("click"),o.off("click"),r.off("mouseover"),r.off("mouseout"),e.on("click",function(e){this.fireEvent("showDetail",{},!0)&&this._openDetail(),this.getParent()&&this.getParent().setFocus({item:this,button:l.BUTTONS.MENU}),this._setMenuButtonFocus(!1)}.bind(this)),i.on("click",function(e){this._collapse(),this.getParent()&&this.getParent().setFocus({item:this,button:l.BUTTONS.COLLAPSE})}.bind(this)),o.on("click",function(e){this.getParent()&&this.getParent().setFocus({item:this}),this.firePress()}.bind(this));var s=function(e,t,o){this._bIsSwimLane||e.css("background-color",this._getColor(t)),e.css("color",this._getColor(o))}.bind(this);r.on("mouseover",(function(e){s(jQuery(e.currentTarget),t.ColorType.HoverBackground,t.ColorType.HoverContent)})),r.on("mouseout",(function(e){s(jQuery(e.currentTarget),t.ColorType.Background,t.ColorType.Content)}))},l.prototype._collapse=function(){this.getParent()._selectElementAfterScroll=this,this.fireEvent("collapseExpand",{},!0),this.setCollapsed(!this.getCollapsed())},l.prototype._openDetail=function(){var e=this.$("menu");this.getParent()._tooltip.openDetail({item:this,opener:e[0]})},l.prototype._isEmpty=function(){return 0===this.aNodes.length},l.prototype._isIgnored=function(){return!this._useInLayout()||!this._hasNodes()},l.prototype._isVisible=function(){var e=this._bIsSwimLane||this.aNodes.some((function(e){return!e.isHidden()}));return e||(e=this.aChildGroups.some((function(e){return e._isVisible()}))),e},l.prototype._useInLayout=function(){return!this._oCollapsedByParent},l.prototype._resetSize=function(){this.getCollapsed()&&(this._iHeight=p,this._iWidth=u)},l.prototype._getAccessibilityLabel=function(){return d.getText("NETWORK_GRAPH_GROUP")+" "+this.getTitle()},l.prototype._isTopBottom=function(){var e=this.getParent();return e&&e._isTopBottom()},l.prototype._isVerticalSwimLane=function(){if(this._bIsSwimLane){var e=this._isTopBottom();return e&&!this.getCollapsed()||!e&&this.getCollapsed()}return!1},l.prototype._isCollapsed=function(){return this.getCollapsed()||!!this._oCollapsedByParent},t.prototype._showHeaderCheckBox=function(){return this.getHeaderCheckBoxState()!==a.Hidden},l.prototype._getBorderSize=function(){return 1},l.prototype._setFocus=function(e){this._setMenuButtonFocus(e)},l.prototype._isOnScreen=function(e,o,i,r){var s=this.getX(),n=this.getY();return t._isRectOnScreen(s,s+this._iWidth,n,n+this._iHeight,e,o,i,r)},l.prototype.getHeaderCheckBoxState=function(){return this.getProperty("headerCheckBoxState")===a.Hidden?a.Hidden:this.getHeaderCheckbox().getSelected()?a.Checked:a.Unchecked},l.prototype.setHeaderCheckBoxState=function(e){return this._setHeaderCheckBoxState(e),this},l.prototype.setX=function(e){return this.fX=e,this},l.prototype.getX=function(){return this.fX},l.prototype.setY=function(e){return this.fY=e,this},l.prototype.getY=function(){return this.fY},l.prototype._setCollapsed=function(e,t){var o=this,i=this.getParent(),r=[],s=function(t){t.aChildGroups.forEach((function(e){s(e)})),o!==t&&(t._oCollapsedByParent&&t._oCollapsedByParent!==o||(t._oCollapsedByParent=e?o:null))},n=function(t){e&&(this.getNodes().forEach((function(e){e.getSelected()&&(e.setSelected(!1),r.push(e))})),this.getChildLines().forEach((function(e){e.getSelected()&&e._isInCollapsedGroup()&&(e.setSelected(!1),r.push(e))})))}.bind(this);(e!==this.getCollapsed()||t)&&(this.setProperty("collapsed",e,!0),e&&(this.getNodes().forEach((function(e){e.getSelected()&&(e.setSelected(!1),r.push(e))})),this.getChildLines().forEach((function(e){e.getSelected()&&e._isInCollapsedGroup()&&(e.setSelected(!1),r.push(e))}))),this.aChildGroups.forEach((function(e){n(e)})),s(this),i&&r.length>0&&i.fireSelectionChange({items:r}),i&&i._bIsLayedOut&&i.invalidate())},l.prototype.setCollapsed=function(e){return this._setCollapsed(e,!1),this},l.prototype.setVisible=function(e){this.setProperty("visible",e);var t=this.getParent();return t&&t._bIsLayedOut&&!this.getCollapsed()&&this.aNodes.forEach((function(t){e?t._bIsHidden||t.$().show():t.$().hide()})),this},l}));