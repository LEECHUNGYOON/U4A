sap.ui.define(["sap/suite/ui/commons/BaseAppPanel","sap/suite/ui/commons/App","sap/suite/ui/commons/Group","sap/ushell/utils/WindowUtils","sap/base/Log"],function(t,e,i,s,n){"use strict";const o=t.extend("sap.suite.ui.commons.FavAppPanel",{metadata:{defaultAggregation:"apps",aggregations:{groups:{type:"sap.suite.ui.commons.Group",singularName:"group",multiple:true,visibility:"hidden"}}}});const a={MYHOME_PAGE_ID:"SAP_BASIS_PG_UI_MYHOME",FALLBACK_ICON:"sap-icon://document",MYINSIGHT_SECTION_ID:"AZHJGRIT78TG7Y65RF6EPFJ9U"};o.prototype._isSmartBusinessTile=function(t){return t.vizType.startsWith("X-SAP-UI2-CHIP:SSB")};o.prototype._fetchRequestFromQueue=async function(t,e){const i=await sap.ushell.Container.getServiceAsync("SpaceContent");let s;this.aRequestQueue=this.aRequestQueue||[];const n=this.aRequestQueue.find(e=>e.pageId===t);if(!n||e===true){s=i.getPage(t);if(n){n.pageLoadPromise=s}else{this.aRequestQueue.push({pageId:t,pageLoadPromise:s})}}else{s=n.pageLoadPromise}return s};o.prototype._getSections=async function(t){const e=await this._fetchRequestFromQueue(a.MYHOME_PAGE_ID,t);const i=e?.sections||[],s=i.findIndex(t=>t.default);if(s>0){if(!this._oMoveAppsPromise){this._oMoveAppsPromise=this._moveSection(a.MYHOME_PAGE_ID,s,0).then(()=>this._getSections(true))}return this._oMoveAppsPromise}else{return i}};o.prototype._fetchApps=async function(t){const e=[];try{const i=await this._getSections(t);i.forEach((t,i)=>{t.visualizations.forEach((n,o)=>{const{vizConfig:p,targetURL:r,title:u,subtitle:c,indicatorDataSource:l}=n,f=p["sap.app"]||{title:"?"},d=u||this._getAppTitleSubTitle(f,n).title,g=c||this._getAppTitleSubTitle(f,n).subTitle;let h=r;if(!h&&this._isSmartBusinessTile(n)){h=this._getTargetUrl(p["sap.flp"])}const _={oldAppId:this._getAppId(p["sap.flp"]),appId:r,url:h,leanURL:s.getLeanURL(h),title:d,subtitle:g,BGColor:this.getDefaultAppColor().key,isFav:true,isSection:false,icon:p["sap.ui"]?.icons?.icon||a.FALLBACK_ICON,isSmartBusinessTile:this._isSmartBusinessTile(n),persConfig:{pageId:a.MYHOME_PAGE_ID,sectionTitle:t.title,sectionId:t.id,sectionIndex:i,visualizationIndex:o,isDefaultSection:t.default,isPresetSection:t.preset,duplicateApps:[]},visualization:{...n,title:d,subtitle:g}};if(l){_.isCount=true;_.indicatorDataSource=l.path;_.contentProviderId=n.contentProviderId}e.push(_)})});return e}catch(t){return e}};o.prototype._getAppId=function(t){let e="";let i={};if(t){const{semanticObject:s,action:n}=t.target;if(s&&n){e=`#${s}-${n}`}else if(t?._instantiationData?.chip?.configuration){i=this._getTileProperties(t);if(i.semanticObject&&i.semanticAction){e=`#${i.semanticObject}-${i.semanticAction}`}}}return e};o.prototype._getTileProperties=function(t){let e={};const i=t?._instantiationData?.chip?.configuration;if(i){const t=this._parseSBParameters(i);const s=t?.tileConfiguration;if(s){const i=this._parseSBParameters(t.tileConfiguration);if(i){e=this._parseSBParameters(i.TILE_PROPERTIES)}}}return e};o.prototype._parseSBParameters=function(t){let e={};if(t){if(typeof t==="object"){e=t}else{try{e=JSON.parse(t)}catch(t){e=undefined}}}return e};o.prototype._getTargetUrl=function(t){const e=this._getAppId(t)||"";const i=this._getTileProperties(t);return i.evaluationId?e+"?EvaluationId="+i.evaluationId:e};o.prototype._getAppTitleSubTitle=function(t,e){const i=e?._instantiationData?.chip?.bags?.sb_tileProperties?.texts;return{title:t.title||i?.title||"",subTitle:t.subtitle||i?.description||""}};o.prototype._moveSection=async function(t,e,i){const s=await sap.ushell.Container.getServiceAsync("Pages");const n=s.getPageIndex(t);return s._moveSection(n,e,i)};o.prototype._filterDuplicateApps=function(t,e){return t.filter((t,i,s)=>{var n=s.findIndex(e=>e.appId===t.appId);return e?n!==i:n===i})};o.prototype._addGroupInformation=function(t){var e=[],i=[],s;this._linkDuplicateApps(t).forEach(function(t){if(t.persConfig.isDefaultSection){e.push(t)}else{s=i.find(e=>e.isSection&&e.id===t.persConfig.sectionId);if(!s){i.push({id:t.persConfig.sectionId,index:t.persConfig.sectionIndex,title:t.persConfig.sectionTitle,badge:"1",BGColor:this.getDefaultAppColor().key,icon:"sap-icon://folder-full",isSection:true,isPresetSection:t.persConfig.isPresetSection,apps:[t]})}else{s.apps.push(t);s.badge=s.apps.length.toString()}}});return i.concat(this._filterDuplicateApps(e,false))};o.prototype._linkDuplicateApps=function(t){t.forEach(function(e){t.filter(function(t){return t.appId===e.appId&&t.visualization.id!==e.visualization.id&&t.persConfig.sectionIndex===e.persConfig.sectionIndex}).forEach(function(t){t.persConfig.duplicateApps.push(e)})});return t};o.prototype._fetchFavApps=async function(t,e){const i=await this._fetchApps(t);var s=i.filter(function(t){return t.persConfig?.sectionId!==a.MYINSIGHT_SECTION_ID&&t.url&&t.title});if(e){return this._filterDuplicateApps(this._linkDuplicateApps(s),false)}else{return this._addGroupInformation(s)}};o.prototype.init=async function(){try{this.setKey("favApps");this.setTitle(this.getResourceBundle().getText("favoritesTab"));const t=await this._fetchFavApps(true,true);t.forEach((t,i)=>{this.addApp(new e({id:`favApps-${i}`,title:t.title,bgColor:t.BGColor,icon:t.icon,url:t.url}))});this.setInnerControls()}catch(t){n.error(t)}t.prototype.init.apply(this,arguments)};o.prototype.getNoDataText=function(){return this.getResourceBundle().getText("noFavAppsDescription")};return o});
//# sourceMappingURL=FavAppPanel.js.map