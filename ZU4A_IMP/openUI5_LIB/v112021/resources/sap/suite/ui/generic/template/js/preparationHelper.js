sap.ui.define(["sap/base/util/deepExtend","sap/suite/ui/generic/template/genericUtilities/FeError","sap/suite/ui/generic/template/genericUtilities/FeLogger"],function(e,t,i){"use strict";var n="js.preparationHelper";var a=new i(n).getLogger();function r(i,a,r,l,s,o,c){var g=e({},a);g.tableType=g.tableType||(g.gridTable?"GridTable":undefined);g.tableType=g.tableType||(g.treeTable?"TreeTable":undefined);g.tableSettings=g.tableSettings||{};g.tableSettings.type=g.tableSettings.type||g.tableType;g.tableSettings.multiSelect=g.tableSettings.multiSelect===undefined?g.multiSelect:g.tableSettings.multiSelect;g.tableSettings.inlineDelete=!!g.tableSettings.inlineDelete;g.tableSettings.multiSelect=!!g.tableSettings.multiSelect;g.tableSettings.selectionLimit=g.tableSettings.selectionLimit||200;var p=i.getODataEntitySet(l);var b=i.getODataEntityType(p.entityType);if(g.tableSettings.type!=="StandardList"&&g.tableSettings.type!=="ObjectList"){if(r.system.phone){g.tableSettings.type="ResponsiveTable"}else if(l){g.tableSettings.type=g.tableSettings.type||(b["sap:semantics"]==="aggregate"?"AnalyticalTable":"ResponsiveTable");if(g.tableSettings.type==="AnalyticalTable"&&!(b["sap:semantics"]==="aggregate")){g.tableSettings.type="GridTable"}}}if(c){var u=p["Org.OData.Capabilities.V1.SearchRestrictions"];if(!u||!u.Searchable||u.Searchable.Bool!=="false"){var f=c();g.tableSettings.searchSettings={};g.tableSettings.searchSettings.enabled=true;g.tableSettings.searchSettings.id=f}}if(b["com.sap.vocabularies.UI.v1.HeaderInfo"]){g.tableSettings.headerInfo=b["com.sap.vocabularies.UI.v1.HeaderInfo"]}if(g.tableSettings.multiSelect&&g.tableSettings.inlineDelete){throw new t(n,"Both inlineDelete and multiSelect options for table are not possible")}if(g.tableSettings.type!=="ResponsiveTable"&&g.tableSettings.inlineDelete){throw new t(n,"InlineDelete property is not supported for "+g.tableSettings.type+" type table")}if(g.tableSettings.inlineDelete){g.tableSettings.mode="Delete";g.tableSettings.onlyForDelete=true}else{var m=Array.isArray(o)&&o.some(function(e){return!(e.Inline&&e.Inline.Bool)&&(e.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||e.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&e.RequiresContext&&e.RequiresContext.Bool==="true")});if(!m){for(var y in s){if(s[y].requiresSelection!==false){m=true;break}}}if(!m&&p["Org.OData.Capabilities.V1.DeleteRestrictions"]&&p["Org.OData.Capabilities.V1.DeleteRestrictions"].Deletable&&p["Org.OData.Capabilities.V1.DeleteRestrictions"].Deletable.Bool==="false"){g.tableSettings.mode="None";g.tableSettings.onlyForDelete=false}else{if(g.tableSettings.type==="ResponsiveTable"){g.tableSettings.mode=g.tableSettings.multiSelect?"MultiSelect":"SingleSelectLeft"}else{g.tableSettings.mode=g.tableSettings.multiSelect?"MultiToggle":"Single"}g.tableSettings.onlyForDelete=!m}}delete g.gridTable;delete g.treeTable;delete g.tableType;delete g.multiSelect;return g.tableSettings}function l(e,t,i,n){var a=[i];if(n){a.push(n)}var r=a.join("#");return e.getODataEntityType(t)[r]}function s(e,t,i){function n(i){if(i[0]!=="/"){i=e.getODataEntityType(t,true)+"/"+i}return e.getObject(i.replace(/@/g,""))}function a(e){return e.PresentationVariant&&e.PresentationVariant.Path?n(e.PresentationVariant.Path):e.PresentationVariant}function r(e){var t=e.Visualizations&&e.Visualizations.find(function(e){return e.AnnotationPath.includes("com.sap.vocabularies.UI.v1.LineItem")});return t&&n(t.AnnotationPath)}var s=l(e,t,"com.sap.vocabularies.UI.v1.SelectionPresentationVariant",i);var o=s?a(s):l(e,t,"com.sap.vocabularies.UI.v1.PresentationVariant",i);return o&&r(o)||l(e,t,"com.sap.vocabularies.UI.v1.LineItem")}function o(e,t){var i={mTargetEntities:{},mProperty:{}};function n(){return{mTargetEntities:i.mTargetEntities,sForceLinkRendering:JSON.stringify(i.mProperty)}}var r=e.getODataEntityType(t.entityType);var l=[];var s={};if(!r||!r.navigationProperty){return n()}var o=r.property||[];o.forEach(function(e){if(e["com.sap.vocabularies.Common.v1.SemanticObject"]){l.push(e.name);s[e.name]={name:e.name,targetEntitiesWithSemanticObject:[],targetEntitiesWithDependent:[]}}});if(l.length==0){return n()}var c=function(e,t){return t.namespace===e};var g=function(e,t){return t.name===e};r.navigationProperty.forEach(function(t){if(t.name==="SiblingEntity"){return}var i=t.relationship;var n=i.lastIndexOf(".");var a=i.slice(0,n);var l=i.slice(n+1);var o=e.getObject("/dataServices/schema").find(c.bind(null,a));var p=o.association.find(g.bind(null,l));var b=p&&p.referentialConstraint;if(b&&b.dependent&&b.dependent.propertyRef){var u=e.getODataAssociationEnd(r,t.name);var f=e.getODataEntityType(u.type);if(f&&f["com.sap.vocabularies.UI.v1.QuickViewFacets"]){for(var m in b.dependent.propertyRef){var y=b.dependent.propertyRef[m];if(s.hasOwnProperty(y.name)){if(b.dependent.propertyRef.length==1){s[y.name].targetEntitiesWithDependent.unshift({entityType:f.namespace+"."+f.name,navName:t.name})}else{s[y.name].targetEntitiesWithDependent.push({entityType:f.namespace+"."+f.name,navName:t.name})}}}}}});var p=e.getODataEntityContainer();p.entitySet.forEach(function(t){if(r.name!==t.entityType){var i=e.getODataEntityType(t.entityType);if(i["com.sap.vocabularies.UI.v1.QuickViewFacets"]){var n=i.property||[];for(var a=0;a<n.length;a++){if(n[a]["com.sap.vocabularies.Common.v1.SemanticObject"]){for(var o=0;o<l.length;o++){if(n[a].name==l[o]){s[l[o]].targetEntitiesWithSemanticObject.push({entityType:i.namespace+"."+i.name});break}}}}}}});function b(e){return s[e].targetEntitiesWithDependent[0]}l.forEach(function(e){var t;if(s[e].targetEntitiesWithSemanticObject.length>0){if(s[e].targetEntitiesWithSemanticObject.length>1){a.warning("Quick View property "+e+"found in multiple Target Entities.")}for(var n=0;n<s[e].targetEntitiesWithSemanticObject.length;n++){for(var r=0;r<s[e].targetEntitiesWithDependent.length;r++){if(s[e].targetEntitiesWithSemanticObject[n].entityType==s[e].targetEntitiesWithDependent[r].entityType){t=s[e].targetEntitiesWithDependent[r];break}}if(t){break}}if(!t){t=b(e)}}else{t=b(e)}if(t){i.mTargetEntities[e]=t;i.mProperty[e]=true}});return n()}return{getNormalizedTableSettings:r,getAnnotation:l,getLineItemFromVariant:s,getTargetEntityForQuickView:o}});
//# sourceMappingURL=preparationHelper.js.map