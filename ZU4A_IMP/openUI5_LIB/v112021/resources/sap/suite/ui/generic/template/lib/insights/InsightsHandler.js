sap.ui.define(["sap/ui/base/Object","sap/base/util/extend","sap/m/MessageBox","sap/suite/ui/generic/template/lib/insights/InsightsCardHelper"],function(e,t,r,a){"use strict";function n(e,n,i){var o=i.oComponentUtils.getTemplatePrivateModel();var s=i.oComponentUtils.getTemplatePrivateGlobalModel();var l=s.getProperty("/generic/insights/oInsightsInstance");function p(r,i){var l,p,d,g=n.getView().getId();var C=n.getOwnerComponent();var v=C.getAppComponent();var T=o.getProperty("/generic/viewLevel");i=i||e.oPresentationControlHandler;d=v.getManifestEntry("sap.app").title;if(i){var u,c;var A=C.getModel().getMetaModel();if(i.getEntitySet){u=i.getEntitySet()}else{u=C.getEntitySet()}var y=A.getODataEntitySet(u);var E=A.getODataEntityType(y.entityType);c=E["com.sap.vocabularies.UI.v1.HeaderInfo"];p=c&&c.TypeNamePlural&&c.TypeNamePlural.String}l={id:a.getCardId(v),descriptorContent:{"sap.card":{header:{title:p||d,subTitle:d}},"sap.insights":{parentAppId:v.getManifestEntry("sap.app").id}}};var S=Object.create(null);t(S,l);S.cardType=r;S.viewId=g;s.setProperty("/generic/insights/shareCards/"+T,[S]);return[l]}function d(e){return a.isCardCreationAllowed(e)}function g(t){var r=e.oPresentationControlHandler.getModel().getMetaModel();return e.oPresentationControlHandler.getVisibleProperties().some(function(e){var a=r.getODataProperty(t,e.data("p13nData").leadingProperty);if(i.oCommonUtils.isSupportedColumn(e,a)&&(a&&(a["sap:label"]||a["com.sap.vocabularies.Common.v1.Label"])&&e.getVisible())){return true}})}function C(t,r,n){var i="";if(t===a.CardTypes.ANALYTICAL&&!d(e)){i=r.getText("ST_CARD_CREATION_FAILURE_REASON_SEMANTIC_DATE_FILTERS")}else if(t===a.CardTypes.TABLE){if(!d(e)||!g(n)){i=r.getText("ST_CARD_CREATION_FAILURE")+"\n"+r.getText("ST_CARD_CREATION_FAILURE_INFO")+"\n"+r.getText("ST_CARD_FAILURE_REASON_SEMANTIC_DATE_FILTERS")+"\n"+r.getText("ST_CARD_FAILURE_TABLE_REASON_UNSUPPORTED_COLUMNS")}}return i.length===0?false:i}function v(t,s,p,d){var g=n.getOwnerComponent();if(!p&&s.cardType===a.CardTypes.ANALYTICAL){p=i.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(e.oSmartChart)}else{p=p||e.oPresentationControlHandler}var v=p.getModel();var T=p.getEntitySet();var u=v.getMetaModel();var c=u.getODataEntitySet(T);var A=u.getODataEntityType(c.entityType);var y=g.getModel("i18n").getResourceBundle();function E(){var t=n.getView();var r={};r.currentControlHandler=p;r.component=g;r.view=t;r.entitySet=c;r.entityType=A;r.oSmartFilterbar=e.oSmartFilterbar;r.oTemplateUtils=i;var a=i.oComponentUtils.getTemplatePrivateModel();var o=a.getProperty("/listReport/vDraftState");if(o&&Number(o)){r.oFECustomFilterData={name:"IsActiveEntity",value:o}}return r}var S=function(e){s.descriptorContent=e.getParameter("manifest");var t=i.oServices.oInsightsFECardProvider.getCardProviderInsightsInstance();t.channel.publishCard(t.id,s,d.consumerId)};var m=C(s.cardType,y,A);if(!m){var I={};var _=a.createCardForPreview(E());if(o.getProperty("/listReport/bSupressCardRowNavigation")){I.text=y.getText("ST_CARD_NAVIGATION_FAILURE_INFO")}if(d&&d.sendManifestToCardConsumer){var f=y.getText("ST_SEND_CARD_TO_CHAT");_["sap.app"].id=s.id;l.showCardPreview(_,true,I,f,S)}else{l&&l.showCardPreview(_,true,I)}}else{r.error(m)}}return{prepareAndShowCard:v,getCardsToShare:p}}return e.extend("sap.suite.ui.generic.template.lib.InsightsCardHandler",{constructor:function(e,r,a){t(this,n(e,r,a))}})});
//# sourceMappingURL=InsightsHandler.js.map