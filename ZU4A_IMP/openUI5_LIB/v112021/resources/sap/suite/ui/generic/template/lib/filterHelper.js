sap.ui.define(["sap/fe/navigation/SelectionVariant"],function(e){"use strict";var t={};function a(e){if(e){if(e.hasOwnProperty("SelectionVariantID")){delete e.SelectionVariantID}else if(e.hasOwnProperty("PresentationVariantID")){delete e.PresentationVariantID}delete e.Text;delete e.ODataFilterExpression;delete e.Version;delete e.FilterContextUrl;delete e.ParameterContextUrl;return e}return e}function r(e,t,a){var r;e.forEach(function(e){r=e&&e.Ranges;t.massAddSelectOption(a,r)})}function n(t){var n,i,o;var l=0;for(var u in t){var s=new e;if(t.hasOwnProperty(u)&&t[u]){n=t[u].value;if(n&&typeof n==="string"&&V(n)){n=JSON.parse(n);if(typeof n!=="object"){t[u].value=n.toString();continue}i=n.SelectOptions&&n.SelectOptions[0];if(i&&i.Ranges&&i.Ranges.length===1){o=i.Ranges[0]||{};if(o.Option==="EQ"&&!o.Low){i.Ranges=[];t[u].value=JSON.stringify(n)}}}else if(n&&Array.isArray(n)){var f,c;for(l=0;l<n.length;l++){f=JSON.parse(n[l]);c=f&&f.SelectOptions||[];r(c,s,u)}s=a(s&&s.toJSONObject());t[u].value=JSON.stringify(s)}}}}function i(e,t){var a=e.getMetaModel();var r=a.getODataEntitySet(t);var n=a.getODataEntityType(r.entityType);var i=n.navigationProperty||[];var o=i.find(function(e){return e.name==="Parameters"});if(o){var l=a.getODataAssociationEnd(n,o.name);var u=l&&l.type&&a.getODataEntityType(l.type);if(u&&u["sap:semantics"]==="parameters"&&u.key){return u}}return null}function o(e,t,a){var r=i(e,t);if(r){var n=r.property.find(function(e){return e.name===a});var o=n&&n["com.sap.vocabularies.Common.v1.FilterDefaultValue"]||{};var l=Object.keys(o);if(l.length){return o[l[0]]}return n.defaultValue===undefined?null:n.defaultValue}return null}function l(e,t){var a=t&&t.getFilterData();var r=a._CUSTOM&&a._CUSTOM["sap.suite.ui.generic.template.customData"];if(a&&(a["$Parameter."+e]||a[e])){return a["$Parameter."+e]||a[e]||""}else if(r&&(r["$Parameter."+e]||r[e])){return r["$Parameter."+e]||r[e]||""}}function u(e,t){var a=[];if(e){a=t&&t.property&&t.property.filter(function(t){return t&&t.name===e})||[]}var r=a&&a.length?a[0]:{};var n=r&&r["com.sap.vocabularies.Common.v1.FilterDefaultValue"]||{};var i=Object.keys(n);return r&&(i&&i.length&&n[i[0]]||r.defaultValue)}function s(e){var t;var r=[];if(e&&Array.isArray(e)){e.forEach(function(e){if(e){t=a(JSON.parse(e));r.push(JSON.stringify(t))}});return r}else if(e&&V(e)){t=a(JSON.parse(e));return JSON.stringify(t)}}function f(e){var t="";if(!e){return null}if(e.type){t=e.type.startsWith("Edm.")?e.type.split("Edm.")[1]:e.type}var a={Boolean:"boolean",Byte:"integer",SByte:"integer",Int16:"integer",Int32:"integer",Int64:"number",Single:"number",Double:"number",Float:"number",Decimal:"number",Guid:"string",String:"string",Date:"date",DateTime:"datetime",DateTimeOffset:"datetime",Time:"datetime",Binary:"",Stream:"",TimeOfDay:"",Duration:""};if(t&&t==="string"){return t}else if(t&&a[t]){return a[t]}else{return"string"}}function c(e,t,a,r){var n="";if(Array.isArray(t)){t.filter(function(t){if(t&&t.includes(e.Low)){n=t}})}else if(typeof t==="string"){n=t}if(!n&&e.Low&&e.High){var i=a&&a.getFilterData()||{},o=i[r]||{};if(o.ranges){var l=o.ranges||[];var u=l.filter(function(t){return t.value1===e.Low});var s=u[0]||{};n=s.tokenText||""}}return n}function g(e,t,a,r){var n=e&&e.getUiState(),i=n&&n.getSelectionVariant(),o=i&&i.SelectOptions||[],l=false;o.filter(function(e){return e&&e["PropertyName"]===t}).map(function(n){l=true;var i=n&&n.Ranges||[];i.forEach(function(n){var i=c(n,r,e,t);a.addSelectOption(t,n.Sign,n.Option,n.Low,n.High,i)})});if(!l){a.addSelectOption(t,"I","EQ","")}}function v(e){var t=e["component"].getModel("_templPriv"),a=t.getProperty("/listReport/datePropertiesSettings");if(a){return a}}function p(e,t){var a=v(e);var r=t&&t.name;var n=a&&Object.keys(a);if(n&&n.length&&r){return n&&n.indexOf(r)>-1}else if(E(t)){var i=e["component"].getFilterSettings();return i&&i.dateSettings&&i.dateSettings.useDateRange}}function m(e,a){if(a){t[e.name]={"sap:filter-restriction":"single-value"}}else{t[e.name]={"sap:filter-restriction":e["sap:filter-restriction"]}}}function d(e,t){var a=v(e);if(a&&a[t]&&a[t]["defaultValue"]){return a[t]["defaultValue"]["operation"]}else{var r=e["component"].getFilterSettings();var n=r&&r.dateSettings&&r.dateSettings.fields;return n&&n[t]&&n[t]["defaultValue"]&&n[t]["defaultValue"]["operation"]}}function S(e,t){var a=e&&e.getUiState(),r=a&&a.getSelectionVariant(),n=r&&r.SelectOptions||[];var i=n.filter(function(e){return e&&e["PropertyName"]===t});i=i&&i[0]||[];var o=i.Ranges||[];return o&&o[0]}function y(e,t,a,r,n){if(e&&a){var i=e.conditionTypeInfo;return i&&i.data&&i.data["operation"]}if(!a){var o=l(t.name,r);var i=o&&o.conditionTypeInfo;var u=i&&i.data&&i.data["operation"];var s=o&&o["ranges"];var f=s&&s[0];if(u){switch(u){case"DATE":case"DATERANGE":case"SPECIFICMONTH":case"FROM":case"TO":var g=c({Low:f.Low},n,r,t.name);var v=S(r,t.name);if(v){v.Text=g;return v}break;case"LASTDAYS":case"LASTWEEKS":case"LASTMONTHS":case"LASTQUARTERS":case"LASTYEARS":case"NEXTDAYS":case"NEXTWEEKS":case"NEXTMONTHS":case"NEXTQUARTERS":case"NEXTYEARS":var p=i&&i.data&&i.data.value1;var g=c({Low:p},n,r,t.name);return{Low:u,High:p.toString(),Option:"BT",Text:g};case"TODAYFROMTO":var m=i&&i.data&&i.data.value1;var d=i&&i.data&&i.data.value2;var g=c({Low:m},n,r,t.name);return{Low:u,High:m.toString()+","+d.toString(),Option:"BT",Text:g};default:var g=c({Low:u},n,r,t.name)||"";g=g.substring(0,g.indexOf("(")-1);return{Low:u,High:null,Option:"EQ",Text:g}}}}}function O(e,t,a,r,n){var i=e.oSmartFilterbar,o=d(e,t.name)||a,l=y(null,t,false,i,n);if(l){r.addSelectOption(t.name,"I",l.Option,l.Low,l.High,l.Text)}else if(o){r.addSelectOption(t.name,"I","EQ",o,null,o)}}function T(e,t){if(t&&e){var a=t.getFiltersWithValues()||[],r="",n=a.filter(function(t){r=t&&t.getName();return r===e||"$Parameter."+e===r});var i=n&&n[0]&&n[0].getControl();if(i&&i.getMetadata()&&i.getMetadata().getName()==="sap.m.DynamicDateRange"){var o=i.getIdForLabel()||"";o=o.substring(0,o.lastIndexOf("-"));if(o){var l=sap.ui.getCore().byId(o);return l&&l.getValue()}}else if(i&&i.hasOwnProperty("value")){return i.getProperty("value")}else if(i&&typeof i.getTokens==="function"){var u=i.getTokens()||[],s=u.map(function(e){return e.getText()});return{type:"filters",value:s}}}}function D(e,t,a,r,n,i){var o=T(e,t);if(o&&typeof o==="string"){if(!a[e]){a[e]={}}a[e]["label"]=o;if(n){o=i?n:o}return o}else if(o&&o.value&&o.type==="filters"){return o.value}}function E(e){if((e["type"]==="Edm.DateTime"&&e["sap:display-format"]==="Date"||e["type"]==="Edm.String"&&e["com.sap.vocabularies.Common.v1.IsCalendarDate"]&&e["com.sap.vocabularies.Common.v1.IsCalendarDate"].Bool==="true")&&(e["sap:filter-restriction"]==="interval"||e["sap:filter-restriction"]==="single-value"||e["_filterRestriction"]==="single-value")){return true}return false}function V(e){try{if(JSON.parse(e)){return true}}catch(e){return false}}return{enhanceVariant:s,updateRangeValue:n,getPropertyType:f,getFilterDefaultValue:u,getParameterDefaultValue:o,addFiltervalues:g,getParameterActualValue:l,removeExtraInfoVariant:a,IsSemanticDateRangeValid:p,getDateRangeValue:y,getLabelForConfigParams:D,getRelatedTextToRange:c,setFilterRestrictionToSemanticDateRange:m,addDateRangeValueToSV:O,getDateRangeDefaultValue:d}});
//# sourceMappingURL=filterHelper.js.map