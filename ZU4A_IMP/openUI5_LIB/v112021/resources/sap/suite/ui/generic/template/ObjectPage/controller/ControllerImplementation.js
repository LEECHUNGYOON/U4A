sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/model/base/ManagedObjectModel","sap/fe/navigation/SelectionVariant","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/detailTemplates/detailUtils","sap/suite/ui/generic/template/ObjectPage/controller/MessageSortingHandler","sap/suite/ui/generic/template/ObjectPage/controller/MessageStripHelper","sap/suite/ui/generic/template/ObjectPage/controller/SideContentHandler","sap/suite/ui/generic/template/ObjectPage/extensionAPI/ExtensionAPI","sap/m/Table","sap/suite/ui/generic/template/lib/ShareUtils","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/ObjectPage/controller/MultipleViewsHandler","sap/suite/ui/generic/template/lib/MessageUtils","sap/ui/events/KeyCodes","sap/base/util/merge","sap/ui/model/FilterProcessor","sap/suite/ui/generic/template/js/StableIdHelper","sap/base/util/extend","sap/base/util/UriParameters","sap/base/util/isEmptyObject","sap/ui/dom/jquery/Focusable","sap/suite/ui/generic/template/genericUtilities/FeError","sap/suite/ui/generic/template/lib/CreateWithDialogHandler","sap/ui/Device","sap/base/strings/whitespaceReplacer","sap/base/util/deepExtend","sap/suite/ui/generic/template/ObjectPage/controller/CtxMenuHandler","sap/suite/ui/generic/template/ObjectPage/controller/inlineCreationRows/InlineCreationRowsHelper","sap/suite/ui/generic/template/ObjectPage/controller/RelatedAppsHandler","sap/ui/core/Lib"],function(e,t,n,o,a,i,r,l,s,c,u,d,g,f,v,p,m,C,b,S,h,E,P,y,T,I,A,D,O,U,x,F,j,w,H){"use strict";var M="ObjectPage.controller.ControllerImplementation";var R=new p(M).getLogger();var B=20;function L(e){e.setSelectedSection(null)}function N(e){return e.data("creationMode")}function _(e,t){if(e.getBindings){var n=e.getBindings();for(var o=0;o<n.length;o++){_(n[o],t)}}else{var a=e.getType();e.setType(a,t)}}var V={getMethods:function(p,I,V){var k={};var W=s.getControllerBase(p,I,V);p.oController=V;var G;var q;var z=new d(V,I,I.oComponentUtils.stateChanged);var K=new w(V,I);var $=new F(V,I,{deleteEntries:function(e,t){var n=e.getTable();var o=n.getId();Me(e,t,o)}});I.oSideContentHandler=z;var J;var Q;var X=Object.create(null);var Y=Object.create(null);var Z=null;var ee=null;I.initialStateAppliedPromise=null;var te=null;var ne=Object.create(null);var oe;var ae;var ie=Object.create(null);function re(e){var t=e.getParameter("bindingParams");t.parameters=t.parameters||{};t.parameters.usePreliminaryContext=true;t.parameters.bCanonicalRequest=I.oServices.oApplication.mustRequireRequestsCanonical();t.parameters.batchGroupId="facets";return t}function le(e){R.info("Activate object");var t=I.oServices.oCRUDManager.activateDraftEntity();var n=G.getModel("ui");var o=n.getProperty("/createMode");t.then(function(t){Te();C.showSuccessMessageIfRequired(I.oCommonUtils.getText(o?"OBJECT_CREATED":"OBJECT_SAVED"),I.oServices);var n=V.getOwnerComponent();I.oServices.oViewDependencyHelper.setAllPagesDirty([n.getId()]);I.oServices.oViewDependencyHelper.unbindChildren(n);var a=n.getNavToListOnSave();var i=I.oServices.oApplication.getEditFlowOfRoot();if(i==="direct"&&e){W.utils.switchToNextObject()}else if(i==="direct"&&a!==false){I.oServices.oApplication.invalidatePaginatorInfo();I.oServices.oApplication.navigateAfterActivation(false)}else{I.oServices.oApplication.invalidatePaginatorInfo();var r=!a&&t.context;if(r){I.oServices.oApplication.setNextFocus(Je)}I.oServices.oApplication.navigateAfterActivation(r)}},Function.prototype);t.catch(function(){I.oInfoObjectHandler.executeForAllInformationObjects("smartTable",function(e){e.onSaveWithError()})});var a={activationPromise:t};I.oComponentUtils.fire(V,"AfterActivate",a)}function se(){if(ne){for(var e in ne){I.oCommonUtils.setEnabledToolbarButtons(V.byId(e))}ne=Object.create(null)}}function ce(e){var t=e.getSource();I.oServices.oApplication.addSideEffectPromise(new Promise(function(n,o){var a=I.oServices.oApplicationController.executeSideEffects(e.getSource().getBindingContext(),null,null,V.getOwnerComponent().getAppComponent().getForceGlobalRefresh(),{draftRootContext:I.oComponentUtils.getMainComponentDetails().bindingContext,callPreparationOnDraftRoot:true});a.then(function(){n();setTimeout(function(){if(t){t.focus()}})},o)}))}function ue(e,t){var n=V.getView();var o=n.getModel();var a=I.oComponentUtils.isComponentDirty();var i=o.getPendingChanges();var r=Object.create(null);if(i){for(var l in i){if(i.hasOwnProperty(l)){var s=o.getContext("/"+l);r[l]={context:s,change:i[l]}}}}var c=I.oServices.oCRUDManager.saveEntity();var u=false;var d=new Promise(function(o,i){c.then(function(l){if(!e){var s=I.oComponentUtils.getTemplatePrivateModel();s.setProperty("/objectPage/displayMode",1);se();p.setEditable(false)}de(l,n,a,r,e,t,o,i);u=true},function(){I.oInfoObjectHandler.executeForAllInformationObjects("smartTable",function(e){e.onSaveWithError()});i()})});var g=e?Function.prototype:function(){if(u){Je()}};I.oServices.oApplication.setNextFocus(g);var f={saveEntityPromise:c,sideEffectsExecutedPromise:d};I.oComponentUtils.fire(V,"AfterSave",f)}function de(e,t,n,o,a,i,r,l){var s=G.getModel("ui");var c=s.getProperty("/createMode");var u=V.getOwnerComponent();I.oServices.oViewDependencyHelper.setParentToDirty(u,u.getEntitySet(),1);I.oServices.oViewDependencyHelper.unbindChildren(u);var d=u.getNavToListOnSave();var g=I.oServices.oApplication.getEditFlowOfRoot();var f;if(g==="direct"){f=d===false||a}else{f=!d||a}if(f){if(i){W.utils.switchToNextObject()}else if(c){I.oComponentUtils.adaptUrlAfterNonDraftCreateSaved(t.getBindingContext(),a)}}else{p.navigateUp()}var v;if(c){v="OBJECT_CREATED"}else{v=n?"OBJECT_SAVED":"OBJECT_NOT_MODIFIED"}C.showSuccessMessageIfRequired(I.oCommonUtils.getText(v),I.oServices);var m=[];for(var b in o){var S=o[b];var h=S.context;var E=S.change;var P=Object.keys(E)||[];var y=P.indexOf("__metadata");if(y>-1){P.splice(y,1)}var T=I.oServices.oApplicationController.executeSideEffects(h,P);m.push(T)}Promise.allSettled(m).then(function(){r()})}function ge(e){var t=e.getSource().getId();ve("SaveAndContEdit",t)}function fe(e){var t=e.getSource().getId();ve("SaveAndEditNext",t)}function ve(e,t){var n;var o;var a;if(I.oComponentUtils.isDraftEnabled()){n=1;if(e==="SaveAndEditNext"){o=le.bind(null,true);a=t}else{o=le.bind(null,false);var i=e.getSource();a=r.isMenuButton(i)?E.getStableId({type:"ObjectPageAction",subType:"ActivateMenu"}):E.getStableId({type:"ObjectPageAction",subType:"CommonAction",sAction:"activate"})}}else{n=3;if(e==="SaveAndContEdit"){o=ue.bind(null,true,false);a=t}else if(e==="SaveAndEditNext"){o=ue.bind(null,true,true);a=t}else{o=ue.bind(null,false,false);a="save"}}I.oCommonUtils.executeIfControlReady(function(){var e=Promise.resolve(V.beforeSaveExtension());e.then(function(){var e=I.oComponentUtils.getCRUDActionHandler();e.handleCRUDScenario(n,o)})},a)}function pe(e){var t=e.getSource();if(N(t)==="inline"){var a=e.getParameter("bindingParams");if(a.filters&&a.filters.length){var i=h.groupFilters(a.filters);var r=I.oComponentUtils.getTemplatePrivateModel();var l=r.getProperty("/objectPage/displayMode");if(!e.getParameter("messageFilterActive")&&!(l===4)){a.filters=new n({filters:[new n({filters:[new n({path:"IsActiveEntity",operator:"EQ",value1:true}),i],and:true}),new n({filters:[new n({path:"IsActiveEntity",operator:"EQ",value1:false}),new n({filters:[i,new n({path:"HasActiveEntity",operator:"EQ",value1:false})],and:false})],and:true})],and:false})}else{a.filters=i}}var s=a.sorter[0]&&a.sorter[0].getGroupFunction();var c=s&&function(e){var t=e.getObject();if(t.IsActiveEntity||t.HasActiveEntity){var n=P({},s(e));n.key=n.key.charAt(0)==="ยง"?"ยง"+n.key:n.key;return n}return{key:"ยง",text:I.oCommonUtils.getText("NEW_ENTRY_GROUP")}};if(t.data("disableInlineCreateSort")==="false"){var u=I.oCommonUtils.getMetaModelEntityType(t.getEntitySet());var d="DraftEntityCreationDateTime";var g=u.property.some(function(e){return e.name===d});if(!g){d="HasActiveEntity"}a.sorter.unshift(new o(d,g,c))}}}function me(){return G.getHeaderTitle()}function Ce(e){var t=I.oComponentUtils.getTemplatePrivateModel();var n={sharePageToPressed:function(e){var n=t.getProperty("/objectPage/headerInfo/objectTitle");var o=t.getProperty("/objectPage/headerInfo/objectSubtitle");if(o){n=n+" - "+o}var a=I.oServices.oApplication.getBusyHelper();if(a.isBusy()){return}var i=V.getView().getBindingContext();var r=i.getObject().IsActiveEntity;var l=v.getCurrentUrl().then(function(t){if(r||r===undefined){switch(e){case"Email":sap.m.URLHelper.triggerEmail(null,n,t);break;default:break}}else{var o=I.oServices.oApplication.getDraftSiblingPromise(i);var l=sap.ushell.services&&new sap.ushell.services.URLParsing;a.setBusy(o.then(function(o){var a=l?t.split(l.getHash(t))[0]+l.getShellHash(t)+"&"+o.sDeepPath:t;switch(e){case"Email":sap.m.URLHelper.triggerEmail(null,n,a);break;default:break}}))}});a.setBusy(l)},shareJamPressed:function(){v.openJamShareDialog(t.getProperty("/objectPage/headerInfo/objectTitle")+" "+t.getProperty("/objectPage/headerInfo/objectSubtitle"))},shareTilePressed:function(){v.fireBookMarkPress()},getModelData:function(){var e=V.getView().getBindingContext();var n=e.getObject().IsActiveEntity;var o=V.getOwnerComponent();var a=o.getAppComponent().getMetadata();var i=a.getManifestEntry("sap.app");var r=I.oComponentUtils.getViewLevel();var l=r>1;if(n===false){var s=I.oServices.oApplication.getDraftSiblingPromise(e);var c=new sap.ushell.services.URLParsing;return s.then(function(e){return v.getCurrentUrl().then(function(n){var o=c?n.split(c.getHash(n))[0]+c.getShellHash(n)+"&"+e.sDeepPath:n;var a=c?"#"+c.getShellHash(document.URL)+"&"+e.sDeepPath:e.sDeepPath;return{serviceUrl:"",appTitle:i?i.title:"",title:t.getProperty("/objectPage/headerInfo/objectTitle"),subtitle:t.getProperty("/objectPage/headerInfo/objectSubtitle"),customUrl:a,currentUrl:o,appId:i.id,bEnableCollaborationShareAsCard:false}})})}else{return Promise.resolve().then(function(){return v.getCurrentUrl().then(function(e){return{serviceUrl:"",appTitle:i?i.title:"",objectShellTitle:t.getProperty("/objectPage/headerInfo/objectShellTitle"),title:t.getProperty("/objectPage/headerInfo/objectTitle"),subtitle:t.getProperty("/objectPage/headerInfo/objectSubtitle"),customUrl:v.getCustomUrl(),currentUrl:e,appId:i.id,bEnableCollaborationShareAsCard:o.getAppComponent().getObjectPageHeaderType()==="Dynamic"&&t.getProperty("/objectPage/displayMode")<2&&o.getAppComponent().getCollaborationSettings().isShareAsCardEnabled!==false&&!l}})})}}};v.openSharePopup(I.oCommonUtils,e,n,V)}var be;function Se(){be=function(e){var t=I.oServices.oApplication.getBusyHelper();if(t.isBusy()){return}var n=V.getOwnerComponent();var o=n.getModel("_templPrivGlobal");var a={objectPage:{currentEntitySet:n.getProperty("entitySet")}};o.setProperty("/generic/multipleViews",a);var i=I.oServices.oCRUDManager.deleteEntity();var r=n.getBindingContext().getPath();var l=Object.create(null);l[r]=i;var s={deleteEntityPromise:i};I.oComponentUtils.fire(V,"AfterDelete",s);e.close()};return I.oCommonUtils.getDialogFragmentAsync("sap.suite.ui.generic.template.ObjectPage.view.fragments.TableDeleteConfirmation",{onCancel:function(e){var t=e.getSource().getParent();t.close()},onDelete:function(e){var t=e.getSource().getParent();(I.oComponentUtils.isDraftEnabled()?I.oServices.oApplicationController.synchronizeDraftAsync():Promise.resolve()).then(be.bind(null,t))}},"delete",Function.prototype,true)}function he(){var e=I.oServices.oApplication.getBusyHelper();if(e.isBusy()){return}var t=I.oComponentUtils.getTemplatePrivateModel();var n=(t.getProperty("/objectPage/headerInfo/objectTitle")||"").trim();var o=t.getProperty("/objectPage/headerInfo/objectSubtitle");var a=I.oComponentUtils.getViewLevel();var i=a>1;var r={};r.title=I.oCommonUtils.getText("ST_GENERIC_DELETE_TITLE");r.text=I.oCommonEventHandlers.getDeleteText(n,o,!i,i);var l=Promise.resolve(V.beforeDeleteExtension());l.then(function(e){P(r,e);Se().then(function(e){var t=e.getModel("delete");t.setData(r);e.open()})},Function.prototype)}function Ee(e){var n=e.getParameter("columnInfos");var o=n&&n.length-1;while(o>=0){if(n[o].ignore){n.splice(o,1)}o-=1}var a=n.reduce(function(e,t){if(!t.type&&!t.customParseFunction){e.push(t)}return e},[]);if(a.length>0){var i=I.oCommonUtils.getText("DATA_PASTE_UNSUPPORTED_FORMAT_MESSAGE");t.show(i,{icon:t.Icon.ERROR,title:I.oCommonUtils.getText("ST_ERROR"),actions:[sap.m.MessageBox.Action.CLOSE]})}}function Pe(e){var t=e.getId();var n=t.split("::Table")[0]+"::addEntry";var o=V.byId(n);return o}function ye(e){var n;var o=e.getSource();var a=Pe(o);var i=N(o);var r=["creationRows","creationRowsHiddenInEditMode"].includes(i);var l=a||r;var s=a||o;if(!l){return}var c=e.getParameter("result");if(c){if(c.errors){var u=c.errors.map(function(e){return e.message});var d=I.oCommonUtils.getText("DATA_PASTE_ERROR_MESSAGE",[u.length]);var g=I.oCommonUtils.getText("DATA_PASTE_ERROR_CORRECTION_MESSAGE");var f=I.oCommonUtils.getText("DATA_PASTE_ERROR_CORRECTION_NOTE");u.unshift("");u.unshift(f);u.unshift(g);t.show(d,{icon:t.Icon.ERROR,title:I.oCommonUtils.getText("ST_ERROR"),actions:[sap.m.MessageBox.Action.CLOSE],details:u.join("<br>")})}else if(c.parsedData){n=c.parsedData;if(n&&n.length){var v=n.length;var p;var m,C=[];var b=sap.m.DraftIndicatorState.Saved;for(var S=0;S<v;S++){p=S<v-1;m=I.oCommonEventHandlers.addEntry(s,true,undefined,n[S],p);C.push(m)}Promise.all(C).then(function(){var e=I.oComponentUtils.getTemplatePrivateGlobalModel();e.setProperty("/generic/draftIndicatorState",b)})}}}}function Te(){var e=I.oComponentUtils.getTemplatePrivateModel();var t=e.getProperty("/objectPage/aPasteAttachedTables");var n=t.length;var o;var a;while(n>=0){o=t[n];a=V.byId(o+"::Table");if(a&&a.isA("sap.ui.comp.smarttable.SmartTable")&&a.hasListeners("paste")){a.detachBeforePaste(Ee);a.detachPaste(ye);t.splice(n,1)}n-=1}}function Ie(){I.oCommonUtils.executeIfControlReady(he,"delete")}function Ae(){var e=G.getSections()||[];var t=e.find(function(e){return e.getVisible()&&e._bInternalVisible!==false});return!!t&&t.getId()===G.getSelectedSection()}function De(e){var t,n;if(e){n=e.context||(e.targetSiblingKey?e.draftAdministrativeData:e);if(I.oServices.oDraftController.getDraftContext().hasDraft(n)){I.oServices.oViewDependencyHelper.setRootPageToDirty();t=n.context||n}}var o=!G.getUseIconTabBar()&&Ae();var a;if(t){I.oServices.oApplication.switchToDraft(t,e.targetSiblingKey)}else{var i=I.oComponentUtils.getTemplatePrivateModel();i.setProperty("/objectPage/displayMode",2);var l=V.getView().getModel("ui");a=l.getProperty("/editable")}p.setEditable(true);if(!t){var s=[];if(!a){r.searchInTree(G,function(e){if(r.isSmartField(e)){if(e.getMode()==="edit"&&e.getBindingContext()){var t=e._getNextModeRenderedPromise();s.push(t)}return false}})}var c=I.oServices.oApplication.getBusyHelper();c.setBusy(Promise.allSettled(s))}I.oServices.oApplication.setNextFocus(Xe.bind(null,o))}var Oe;function Ue(e){e=!!e&&typeof e==="boolean";var t=I.oServices.oCRUDManager.editEntity(e);t.then(function(e){if(e.draftAdministrativeData){Oe(e.draftAdministrativeData.CreatedByUserDescription||e.draftAdministrativeData.CreatedByUser)}else{De(e)}})}Oe=function(e){var t;I.oCommonUtils.getDialogFragmentAsync("sap.suite.ui.generic.template.ObjectPage.view.fragments.UnsavedChangesDialog",{onEdit:function(){t.close();Ue(true)},onCancel:function(){t.close()}},"Dialog").then(function(n){t=n;var o=I.oComponentUtils.getMainComponentUtils();var a=I.oServices.oApplication.getBusyHelper();a.setBusy(o);o.then(function(n){var o=n.getText("DRAFT_LOCK_EXPIRED",[e]);var a=t.getModel("Dialog");a.setProperty("/unsavedChangesQuestion",o);t.open()})})};function xe(){var e='{"SelectionVariantID":""}';var t=V.getOwnerComponent();var n=t.getEntitySet();var o=t.getModel();var a=o.getMetaModel();var r=a.getODataEntitySet(n);var l=a.getODataEntityType(r.entityType);var s=l.property;var c=[];for(var u in s){var d=s[u];var g=d["com.sap.vocabularies.Common.v1.FieldControl"]&&d["com.sap.vocabularies.Common.v1.FieldControl"].Path;if(g&&c.indexOf(g)<0){c.push(g)}}var f=V.getView().getBindingContext();var v=f.getObject();var p=new i;for(var m in s){var C=s[m].type;var b=s[m].name;var S=v[s[m].name];if(c.indexOf(b)>-1){continue}if(b&&(S||C==="Edm.Boolean")){if(C==="Edm.Time"&&S.ms!==undefined){S=S.ms}if(S instanceof Date){S=S.toJSON()}if(typeof S!=="string"){try{S=S.toString()}catch(e){S=S+""}}p.addParameter(b,S)}}e=p.toJSONString();return e}function Fe(e,t){var n=true;var o=t.getModel();t=t instanceof f?t.getParent():t;var a=I.oCommonUtils.getDeleteRestrictions(t);var i=a&&a.Deletable&&a.Deletable.Path;if(i){n=o.getProperty(i,e)}return n}var je;function we(e,n,o,a){je=function(i){var l=I.oServices.oApplication.getBusyHelper();var s=0;var c;var u=V.getView().getModel().getObject(n[0].getPath());var d=I.oServices.oCRUDManager.deleteEntities({pathes:o,suppressRefreshAllComponents:true,smartTable:e});l.setBusy(d);I.oServices.oApplicationController.executeSideEffects(e.getBindingContext(),[],[e.getTableBindingPath()]);d.then(function(n){if(u.IsActiveEntity===false){c=0}else{c=n.length}s=o.length-c;var a="";if(s>0){var i=e.getTable();if(r.isUiTable(i)){var l=i.getPlugin("sap.ui.table.plugins.SelectionPlugin");if(l){l.clearSelection()}}if(s>1){a=I.oCommonUtils.getContextText("DELETE_SUCCESS_PLURAL_WITH_COUNT",e.getId(),null,[s])}else if(c>0){a=I.oCommonUtils.getContextText("DELETE_SUCCESS_WITH_COUNT",e.getId(),null,[s])}else{a=I.oCommonUtils.getContextText("ITEM_DELETED",e.getId())}}if(c>0){if(c>1){a+=a&&a+"\n";a+=I.oCommonUtils.getContextText("DELETE_ERROR_PLURAL_WITH_COUNT",e.getId(),null,[c])}else if(s>0){a+="\n";a+=I.oCommonUtils.getContextText("DELETE_ERROR_WITH_COUNT",e.getId(),null,[c])}else{a+=I.oCommonUtils.getContextText("DELETE_ERROR",e.getId())}}if(a){if(c>0){var d=!I.oComponentUtils.isDraftEnabled()&&o.length!==1;if(d){I.oServices.oApplication.removeTransientMessages();t.error(a)}}else{C.showSuccessMessageIfRequired(a,I.oServices)}}});var g={deleteEntitiesPromise:d,sUiElementId:a,aContexts:n};I.oComponentUtils.fire(V,"AfterLineItemDelete",g);i.close()};return I.oCommonUtils.getDialogFragmentAsync("sap.suite.ui.generic.template.ObjectPage.view.fragments.TableDeleteConfirmation",{onCancel:function(e){e.getSource().getParent().close()},onDelete:function(e){je(e.getSource().getParent())}},"delete",Function.prototype,true)}function He(e){var t=I.oCommonUtils.getOwnerControl(e,true);var n=I.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(t).getSelectedContexts();var o=e.getParent().getParent().getId();Me(t,n,o)}function Me(e,n,o){if(n.length===0){t.error(I.oCommonUtils.getText("ST_GENERIC_NO_ITEM_SELECTED"),{styleClass:I.oCommonUtils.getContentDensityClass()});return}(I.oComponentUtils.isDraftEnabled()?I.oServices.oApplicationController.synchronizeDraftAsync():Promise.resolve()).then(function(){var t,a=[],i=[];if("getMode"in e.getTable()){t=e.getTable().getMode()}n.forEach(function(t){if(Fe(t,e)){i.push(t.getPath())}else{a.push(t)}});var r={};r.undeletableCount=0;r.tableMode=t;if(n.length>1){r.title=I.oCommonUtils.getText("ST_GENERIC_DELETE_TITLE_WITH_COUNT",[n.length]);r.text=I.oCommonUtils.getContextText("DELETE_SELECTED_ITEMS",e.getId())}else{r.title=I.oCommonUtils.getText("ST_GENERIC_DELETE_TITLE");r.text=I.oCommonEventHandlers.getSelectedItemContextForDeleteMessage(e,n[0],true)}if(a.length>0){r.undeletableText=I.oCommonUtils.getContextText("DELETE_UNDELETABLE_ITEMS",e.getId(),null,[a.length,n.length]);if(t==="Delete"){r.undeletableCount=a.length;r.undeletableText=undefined;r.text=I.oCommonUtils.getText("DELETE_UNDELETABLE_ITEM")}}var l={sUiElementId:o,aContexts:n};var s=Promise.resolve(V.beforeLineItemDeleteExtension(l));s.then(function(t){P(r,t);we(e,n,i,o).then(function(e){if(!a.length){r.undeletableText=undefined}var t=e.getModel("delete");t.setData(r);e.open()})},Function.prototype)})}function Re(){var e=I.oComponentUtils.getTemplatePrivateModel();e.setProperty("/objectPage/isHeaderExpanded",true);var t=V.byId("template::ObjectPage::ObjectPageHeader");t.attachStateChange(function(t){var n=t.getParameter("isExpanded");e.setProperty("/objectPage/isHeaderExpanded",n)})}function Be(){var e;var t=I.oComponentUtils.getTemplatePrivateModel();var n=function(n){return function(o){var a=o.getSource();var i=a.getExternalValue();i=U(i);t.setProperty("/objectPage/headerInfo/"+n,i);if(n==="objectTitle"){I.oComponentUtils.setText(i);if(!i){var r=I.oComponentUtils.getHeaderDataAvailablePromise();r.then(function(n){i=a.getExternalValue();if(i){return}var o=V.getView();var r=n.getObject();var l=o.getModel("ui");var s=l.getProperty("/createMode");if(s&&r&&(r.IsActiveEntity===undefined||r.IsActiveEntity===false||r.HasActiveEntity===false)){e=e||I.oCommonUtils.getText("NEW_OBJECT");t.setProperty("/objectPage/headerInfo/objectTitle",e);I.oComponentUtils.setText(e)}})}}}};G.getCustomData().forEach(function(e){var o=e.getKey();if(o==="objectTitle"||o==="objectSubtitle"){var a=e.getBinding("value");var i=!a&&e.getBindingInfo("value");if(!a&&!i){t.setProperty("/objectPage/headerInfo/"+o,e.getValue());return}var r=n(o);if(a){a.attachChange(r);_(a,"string")}else{i.events={change:r};for(var l=0;l<i.parts.length;l++){i.parts[l].targetType="string"}}}})}function Le(e){e.preventDefault();var t=e.getSource().getId();var n=I.oInfoObjectHandler.getControlInformation(t);if(n){if(I.oComponentUtils.isDraftEnabled()){n.navigate()}else{I.oCommonUtils.fnProcessDataLossOrDraftDiscardConfirmation(n.navigate,Function.prototype)}}}function Ne(e){var t=[];for(var n=0;n<e.length;n++){if(e[n].getVisible()){t.push(e[n])}}return t}function _e(e){var t=e?e.getSubSections():G.getSections();var n=Ne(t);return n.length===1&&!!(e||_e(n[0]))}function Ve(e,t){var n=e.getParent();var o="sapSmartTemplatesObjectPageSubSectionGridExpand",a="sapUxAPObjectPageSubSectionFitContainer",i=t?"addStyleClass":"removeStyleClass";while(n){if(r.isGrid(n)){n[i](o)}else if(r.isObjectPageSubSection(n)){n[i](a);e.setFitContainer(t);return null}else{R.warning("Unexpected parent "+n.toString()+" in fnHandleUiTableExpand method")}n=n.getParent()}}function ke(e,t){var n="sapUiSizeCompact",o="sapUiSizeCondensed",a;a=document.body;if(!e.bCondensedTableLayout||!(e.bSetFitContainer||t.hasStyleClass("sapUiSizeCondensed"))){return null}else if(e.bSetFitContainer&&a.classList.contains(n)){t.addStyleClass(o)}else{t.removeStyleClass(o)}}function We(e,t,n){if(t.isA("sap.m.Table")){t.setGrowingThreshold(n.growingThreshold);t.setGrowingScrollToLoad(n.bGrowingScrollOnLoad)}else if(t.isA("sap.ui.table.Table")){Ve(e,n.bSetFitContainer);ke(n,t)}}function Ge(e,t,n){var o={growingThreshold:Y[t.getId()],bSetFitContainer:false,bGrowingScrollOnLoad:false};var a=V.getOwnerComponent().mProperties;o.bCondensedTableLayout=a.condensedTableLayout;if(a&&a.sections){var i=a.sections[n];if(i&&i.hasOwnProperty("condensedTableLayout")){o.bCondensedTableLayout=i.condensedTableLayout}}var r;if(G.getUseIconTabBar()){r=t.getParent();while(r&&r.sParentAggregationName!=="sections"){r=r.getParent()}}if(_e(r)){o.growingThreshold=B;o.bGrowingScrollOnLoad=true;o.bSetFitContainer=true}We(e,t,o)}function qe(e){var t=G.getSelectedSection();var n=G.getSections();var o=-1;var a=e?1:-1;n.some(function(e,n){if(e.getId()===t){o=n;return true}});for(var i=o+a;i!==o;i=i+a){if(i<0){i=n.length}else if(i>=n.length){i=-1}else{var l=n[i];if(l.getVisible()){var s=l.getSubSections();var c=s.find(function(e){return e.getVisible()});if(c){I.oServices.oApplication.setNextFocus(r.focusUI5Control.bind(null,c));G.setSelectedSection(l);l.setSelectedSubSection(c);Ke(l.getId(),c.getId());return}}}}}function ze(e){var t=e&&e.getParameter("section");var n=t?t.getId():G.getSelectedSection();var o=e&&e.getParameter("subSection");var a=o&&o.getId();if(n!==Z||a!==ee){R.info("Selected Section: "+n+" and SubSection: "+n)}return{sNewSectionId:n,sNewSubSectionId:a}}function Ke(e,t){Z=e;ee=t;I.oComponentUtils.stateChanged()}function $e(e){var t=ze(e);Ke(t.sNewSectionId,t.sNewSubSectionId)}function Je(){setTimeout(function(){var e=G.getHeaderTitle();var t=e.getActions();var n=t.find(function(e){return e.getVisible()&&e.getEnabled&&e.getEnabled()});if(n){r.focusControl(n.getId())}},0)}function Qe(e){var t=!e&&G.getSelectedSection();var n=t&&sap.ui.getCore().byId(t);var o=n&&n.getVisible()&&n;var a,i;if(o){a=n.getSelectedSubSection();i=a&&sap.ui.getCore().byId(a);i=i&&i.getVisible()&&i;a=i&&a}else{t=null}var l=r.searchInTree(G,function(e){if(r.isObjectPageSection(e)){if(t===e.getId()){t=null}if(t){return false}n=e;return null}if(r.isObjectPageSubSection(e)){if(a===e.getId()){a=null}if(a){return false}bt(e);G.setSelectedSection(n);n.setSelectedSubSection(e);return null}if(r.isSmartField(e)){return r.getSmartFieldIsFocussableForInputPromise(e).then(function(t){return t&&e})}if(r.isSmartTable(e)){var o=I.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(e);var i=o.getFirstFocussableEditableCellPromise();return i.then(function(t){if(t){return t}if(I.oComponentUtils.isDraftEnabled()){var n=Pe(e);if(n&&n.isFocusable()){return n}var o=e.getToolbar();var a=o?o.getContent():[];var i=a.find(function(e){return r.isButton(e)&&e.isFocusable()});return i||false}return false})}return null});return Promise.resolve(l).then(function(e){if(!e){if(o){G.setSelectedSection(o);if(i){o.setSelectedSubSection(i)}}else{L(G)}}return e})}function Xe(e){setTimeout(function(){var t=Qe(e);t.then(function(e){r.focusUI5Control(e)})},0)}function Ye(e){var t=e.getSource().getId();I.oInfoObjectHandler.pushCategory(t,"searchField");var n=I.oInfoObjectHandler.getControlInformation(t);n.rebindTable()}function Ze(e){e.getControlAsync().then(function(){var t=V.byId(e.getSearchFieldId());if(t){t.setValue("");e.rebindTable()}})}function et(){I.oInfoObjectHandler.executeForAllInformationObjects("searchField",Ze,true)}function tt(e,t){I.oCommonEventHandlers.addEntry(e,true)}function nt(e,t){var n=I.oServices.oCRUDManager.getDefaultValues(t,e);if(n instanceof Promise){var o=function(e){ot(e[0],t)};n.then(o,o)}else{ot(e,t)}}function ot(e,t){var n=I.oCommonUtils.getOwnerControl(t,true);if(!t.data("CrossNavigation")){var o=N(n)==="inline";if(o){tt(t,n);return}else if(I.oComponentUtils.isDraftEnabled()){I.oCommonEventHandlers.addEntry(t,false);return}}I.oCommonUtils.fnProcessDataLossOrDraftDiscardConfirmation(function(){I.oCommonEventHandlers.addEntry(t,false,undefined,e)},Function.prototype,"LeaveApp")}function at(e){var t=E.getStableId({type:"ObjectPageAction",subType:"Create",sFacet:e});I.oCommonUtils.executeIfControlReady(function(t){I.oServices.oApplicationController.synchronizeDraftAsync().then(function(){var n=E.getStableId({type:"ObjectPageAction",subType:"CreateWithDialog",sFacet:e});var o=n&&V.byId(n);var a=I.oCommonUtils.getOwnerControl(t,true);var i=N(a);var r=["creationRows","creationRowsHiddenInEditMode"].includes(i);if(o){Q.createWithDialog(o,t)}else if(r){k.oInlineCreationRowsHelper.handleAddEntry(a)}else{nt(null,t)}})},t)}function it(e,t){var n=k.oMessageStripHelper.dataStateFilter(e,t);R.info("Filtering message "+e.getMessage()+" (id: "+e.getId()+") for table "+t.getId()+" returns "+n);return n}function rt(e){k.oMessageStripHelper.onClose(e)}function lt(){var e=V.getOwnerComponent().getModel("ui");e.bindProperty("/editable").attachChange(function(){var e=X;X=Object.create(null);for(var t in e){var n=e[t];n.refresh()}})}function st(e){ut(e)}function ct(e){var t;return I.oCommonUtils.getDialogFragmentAsync("sap.suite.ui.generic.template.ObjectPage.view.fragments.SwitchDraftAndActiveObjectPopOver",{onEditAndActiveToggle:function(n,o){var a=n.getParameter("item").getProperty("key");if(a===(o?"SwitchToActive":"SwitchToDraft")){return}I.oServices.oApplicationController.synchronizeDraftAsync().then(function(){I.oServices.oApplication.performAfterSideEffectExecution(function(){I.oServices.oApplication.setNextFocus(function(){r.focusUI5Control(e);t.close()});var n=I.oServices.oApplication.getBusyHelper();n.setBusy(I.oServices.oApplication.getSwitchToSiblingFunctionPromise(o).then(function(e){e()}))},true)})}},"SwitchDraftAndActiveObjectPopOver",Function.prototype,true).then(function(e){t=e;return e})}function ut(e){var t,n=e.getId();var o=J.isSmartControlMulti(e);if(o){t="NOITEMS_SMARTTABLE_WITH_FILTER_FOR_SEGMENTEDBUTTON"}else{var a=e.fetchVariant();var i=a&&a.filter&&a.filter.filterItems.length>0;if(!i){var r=I.oInfoObjectHandler.getControlInformation(n);var l=r.getSearchFieldId();var s=l&&V.byId(l);i=s&&s.getValue().trim()}t=i?"NOITEMS_SMARTTABLE_WITH_FILTER":"NOITEMS_SMARTTABLE"}var c=I.oCommonUtils.getContextText(t,n);e.setNoData(c)}p.refreshFacets=function(e){var t=function(t){var n=I.oInfoObjectHandler.getControlInformation(t.getId());if(n){n.refresh(e,false)}};G.getSections().forEach(function(e){e.getSubSections().forEach(t)})};p.onComponentActivate=function(e,t){W.onComponentActivate(e,t);ne=Object.create(null)};p.getCurrentState=function(){var t=Object.create(null);var n=I.oServices.oApplication.getStatePreservationMode()==="persistence";function o(e){return{data:e,lifecycle:{permanent:true,pagination:n,page:false,session:true}}}if(Z){t.section=o(Z)}if(ee){t.subSection=o(ee)}var a={};I.oInfoObjectHandler.executeForAllInformationObjects("smartControl",function(e){a[e.getId()]=e.getControlStateWrapper().getState()});if(!T(a)){t.smartControls=o(a)}var i=z.getCurrentState();if(i){t.sideContent=o(i)}var r=J.getCurrentState();if(r){t.multipleViews=o(r)}t.objectPageLayout=o(q.getState());var l=Object.create(null);V.provideCustomStateExtension(l);for(var s in l){t["$custom$"+s]=l[s]}var c=true;var u=function(n,o){if(!(n instanceof e)){throw new A(M,"State must always be set with respect to a ControllerExtension")}if(!c){throw new A(M,"State must always be provided synchronously")}var a=n.getMetadata().getNamespace();if(o){for(var i in o){t["$extension$"+a+"$"+i]=o[i]}}};V.templateBaseExtension.provideExtensionStateData(u);c=false;return t};function dt(){oe={bLayoutFinished:false,bStateApplied:false,bRebindCompleted:false};ae=true}function gt(e){oe[e]=true;vt()}function ft(e){var t=true;for(var n in e.waitFor){if(e.waitFor[n]&&!oe[n]){t=false;break}}return t}function vt(){var e=ae?"subSectionNotWaitingForViewPort":"subSection";var t=V.getView();I.oInfoObjectHandler.executeForAllInformationObjects(e,function(e){var n=e.getId();var o=e.getLoadingStrategy();var a=(ae||r.isElementVisibleOnView(n,t))&&ft(o);if(a){if(ae){e.getControlAsync().then(function(t){o.activeHandler(t,e)})}else{var i=V.byId(n);var l=i.getParent();l.connectToModels();I.oInfoObjectHandler.setInformationWithControl(i);o.activeHandler(i,e)}}});if(ae){G._triggerVisibleSubSectionsEvents()}}function pt(){if(te){te();te=null;gt("bStateApplied")}}function mt(){gt("bLayoutFinished")}function Ct(){L(G);mt()}function bt(e){if(oe&&oe.bRebindCompleted){var t=I.oInfoObjectHandler.setInformationWithControl(e);var n=e.getId();if(!ie[n]){V.onSubSectionEnteredExtension(e);ie[n]=true}if(t){J.subSectionEntered(t);var o=t.getLoadingStrategy();var a=ft(o);if(a){o.activeHandler(e,t)}}}}function St(e){I.oCommonEventHandlers.handleSideEffectForField(e,true)}function ht(e){I.oCommonEventHandlers.handleSideEffectForField(e,false)}function Et(e){var t=e.getSource();e.getSource()._getComputedMetadata().then(function(n){if(n.property.property&&n.property.property["com.sap.vocabularies.Communication.v1.IsEmailAddress"]&&n.property.property["com.sap.vocabularies.Communication.v1.IsEmailAddress"].Bool){e.preventDefault();I.oCommonEventHandlers.onRenderTeamsContactCollabOptions.call(this,t,t.getValue())}})}p.applyState=function(t,n){var o=I.oComponentUtils.getHeaderDataAvailablePromise()||Promise.resolve();o.then(function(){var o=Object.create(null);var a=Object.create(null);for(var i in t){if(i.indexOf("$custom$")===0){o[i.substring(8)]=t[i]}else if(i.indexOf("$extension$")===0){var r=i.substring(11,i.indexOf("$",11));var l=a[r];if(!l){l=Object.create(null);a[r]=l}var s=i.substring(i.indexOf("$",11)+1,i.length);l[s]=t[i]}}V.applyCustomStateExtension(o,n);var c=true;var u=function(t){if(!(t instanceof e)){throw new A(M,"State must always be retrieved with respect to a ControllerExtension")}if(!c){throw new A(M,"State must always be restored synchronously")}var n=t.getMetadata().getNamespace();return a[n]};V.templateBaseExtension.restoreExtensionStateData(u,n);c=false});z.applyState(t.sideContent,n);J.applyState(t.multipleViews,n);q.setState(t.objectPageLayout);I.oInfoObjectHandler.executeForAllInformationObjects("smartControl",function(e){e.getControlStateWrapper().setState(t.smartControls&&t.smartControls[e.getId()])});if(n){if(Z!==(t.section||"")){I.oComponentUtils.stateChanged()}pt();mt();return}et();if(t.section){Z=t.section;R.info("Restoring Selected Section: "+Z);G.setSelectedSection(Z);if(t.subSection){var a;G.getSections().some(function(e){if(e.getId()===t.section){a=e;return true}return false});if(a){a.setSelectedSubSection(t.subSection)}ee=t.subSection;R.info("Restoring Selected Subsection: "+ee)}mt()}else{Promise.all([o,I.oComponentUtils.getNavigationFinishedPromise()]).then(Ct);Z=""}pt()};p.prepareForControlNavigation=function(e){var t=G.getUseIconTabBar();if(!t){return}var n;var o=r.isElementVisibleOnView(e,false,function(e){var t=r.isObjectPageSection(e);if(t){return e.getId()}n=e.getId()});var a=o&&G.getSelectedSection();if(o!==a){G.setSelectedSection(o);Ke(o,n)}};function Pt(e,t,n,o){var a=e.some(function(e){var t=I.oCommonUtils.getPositionableControlId(e.controlIds,true);return!t||r.isTable(r.byId(t))});if(a){ae=false;vt()}if(t){var i=new c(V,I,G);return i.getPrepareMessageDisplayPromise(t,e,n,o)}return Promise.resolve()}p.prepareForMessageHandling=function(e,t,n){return Pt(e,t,n,G.getBindingContext().getDeepPath())};p.applyHeaderContextToSmartTablesDynamicColumnHide=function(e){var t=e.getModel();var n=function(o,a){var i=a.getHiddenColumnInfo();if(T(i.columnKeyToHiddenPath)){return}var r=i.staticHiddenColumns.slice();var l=o&&n.bind(null,false,a);for(var s in i.columnKeyToHiddenPath){var c=i.columnKeyToHiddenPath[s];if(e.getProperty(c)){r.push(s)}if(l){var u=t.bindProperty(c,e);u.attachChange(l)}}a.getControlAsync().then(function(e){e.deactivateColumns(r)})};I.oInfoObjectHandler.executeForAllInformationObjects("smartTableWithColumnHide",n.bind(null,true))};var Ue=l.testable(Ue,"editEntity");var Fe=l.testable(Fe,"isEntryDeletable");var le=l.testable(le,"onActivateImpl");var ue=l.testable(ue,"onSaveImpl");l.testable(function(){return I.initialStateAppliedPromise},"getStateAppliedPromise");function yt(){var e=I.oComponentUtils.getParameterModelForTemplating().getObject("/templateSpecific/sections");e.forEach(function(e){if(e.sExtensionPointNamePrefix!=="ReplaceFacet"){e.subSections.forEach(I.oInfoObjectHandler.initializeSubSectionInfoObject)}});var t=I.oComponentUtils.getParameterModelForTemplating().getObject("/treeNode");if(t&&t.leadingComponents){for(var n in t.leadingComponents){var o=t.leadingComponents[n];o.followingComponents.forEach(c)}}if(t&&t.facetsWithEmbeddedComponents){for(var a in t.facetsWithEmbeddedComponents){var i=t.facetsWithEmbeddedComponents[a];for(var r=0;r<i.length;r++){var l=i[r];var s=t.embeddedComponents[l];c(s)}}}function c(e){var t={};t.additionalData={};t.additionalData.facetId=e.sectionId;t.id=e.subSectionId;t.loadingStrategy="reuseComponent";I.oInfoObjectHandler.initializeSubSectionInfoObject(t)}}function Tt(e){var t=e.getSource();I.oCommonUtils.setEnabledToolbarButtons(t);if(ne){ne[t.getId()]=true}}function It(e,t){$.beforeOpenContextMenu(e,t)}function At(e,t){$.onContextMenu(e,t)}var Dt={onInit:function(){G=V.byId("objectPage");var e=G.getShowHeaderContent();var t=I.oComponentUtils.getTemplatePrivateModel();t.setProperty("/objectPage/headerContentVisible",e);q=I.oCommonUtils.getControlStateWrapper(G);q.attachStateChanged(I.oComponentUtils.stateChanged);lt();var n=V.getOwnerComponent();I.initialStateAppliedPromise=new Promise(function(e){te=e});dt();yt();var o=me();var a=n.getAppComponent();var i=a.getObjectPageHeaderType()==="Dynamic";p.aBreadCrumbs=o&&o.getBreadcrumbs()===null?[]:o.getBreadcrumbs().getLinks();(p.aBreadCrumbs||[]).forEach(function(e,t){I.oComponentUtils.registerAncestorTitleUpdater(e,"text",t+1)});if(i){Re()}var l={controller:V,getPrepareMessageDisplayPromise:Pt};W.onInit(null,l);Be();I.oCommonUtils.executeGlobalSideEffect();p.beforeRebind=function(e){ie=Object.create(null);dt();e.then(function(){gt("bRebindCompleted");k.oInlineCreationRowsHelper.onBeforeRebindObjectPage()});if(!te){I.initialStateAppliedPromise=new Promise(function(e){te=e})}I.oInfoObjectHandler.executeForAllInformationObjects("subSection",function(e){var t=V.byId(e.getId());if(t){e.getLoadingStrategy().inActiveHandler(t,e);return}})};p.afterRebind=function(){R.info("Call of _triggerVisibleSubSectionsEvents (afterRebind)");G._triggerVisibleSubSectionsEvents()};p.setFocus=function(e,t){var n=e.activeComponents;if(n.length>0&&!(t&&(t.isCreate||t.ignorePersistence))){var o=n[n.length-1];if(o===V.getOwnerComponent().getId()||I.oComponentUtils.getHierarchicalDistance(o)>0){var a=I.oServices.oApplication.getStatePreservationMode()==="persistence"||I.oComponentUtils.getCurrentKeys().every(function(t,n){return t===e.currentKeys[n]});if(a){var i=I.oComponentUtils.getLastFocus();if(i){r.focusControl(i.getId())}return}}}var l=G.getModel("ui");var s=l.getProperty("/editable");if(s){Xe(true)}else{Je()}};G.attachEvent("subSectionEnteredViewPort",function(e){var t=e.getParameter("subSection");R.info("Viewport entered ","Subsection: "+t.getId());bt(t)});Q=new D(k,V,I);k.oCreateWithDialogHandler=Q;J=new m(V,I,I.oComponentUtils.stateChanged);k.oMultipleViewsHandler=J;k.oMessageStripHelper=new u(J,V,I,W.state.messageButtonHelper);k.oInlineCreationRowsHelper=new j(G,I,N,V,k.oMessageStripHelper);var t=I.oComponentUtils.getTemplatePrivateModel();t.setProperty("/objectPage/aPasteAttachedTables",[]);I.oComponentUtils.attach(V,"PageDataLoaded",function(e){var t=I.oComponentUtils.getParameterModelForTemplating().getObject("/templateSpecific/streamEnabledAssociatedEntites");if(t&&t.length>0){for(var n=0;n<t.length;n++){var o=I.oCommonUtils.getStreamData(t[n],e.context);I.oCommonUtils.setStreamData(o,t[n])}}var a=I.oCommonUtils.getStreamData(null,e.context);I.oCommonUtils.setStreamData(a);I.oComponentUtils.hidePlaceholder()});var s=V.byId(E.getStableId({type:"ObjectPageAction",subType:"Share"})+"-internalBtn");if(s){s.attachPress(function(){Ce(s)})}},handlers:{onEditAndActiveToggle:function(){var e=G.getModel("ui");var t=e.getProperty("/editable");I.oServices.oApplicationController.synchronizeDraftAsync().then(function(){I.oServices.oApplication.performAfterSideEffectExecution(function(){var e=I.oServices.oApplication.getBusyHelper();e.setBusy(I.oServices.oApplication.getSwitchToSiblingFunctionPromise(!t).then(function(e){e();I.oServices.oApplication.setNextFocus(function(){var e=V.createId(E.getStableId({type:"ObjectPageAction",subType:t?"ContinueEditing":"DisplayActiveVersion"}));setTimeout(r.focusControl.bind(null,e),0)})}))},true)})},addEntry:at,onCancelCreateWithPopUpDialog:function(){Q.onCancelPopUpDialog()},onSaveCreateWithPopUpDialog:function(e){Q.onSavePopUpDialog(e)},submitChangesForSmartMultiInput:function(e){if(I.oComponentUtils.isDraftEnabled()){I.oCommonEventHandlers.submitChangesForSmartMultiInput(e)}},onSmartFieldModeToggled:function(e,t){var n=e.getSource();I.oCommonEventHandlers.onSmartFieldModeToggled(n,t)},deleteEntry:function(e){var t=I.oCommonUtils.getOwnerControl(e.getSource(),true);var n=[e.getParameter("listItem").getBindingContext()];var o=e.getSource().getId();Me(t,n,o)},deleteEntries:function(e){var t=E.getStableId({type:"ObjectPageAction",subType:"Delete",sFacet:e});I.oCommonUtils.executeIfControlReady(He,t)},onSelectionChange:Tt,checkUpdateFinished:function(e){I.oCommonUtils.setEnabledToolbarButtons(e.getSource())},onMultiSelectionChange:function(e){I.oCommonEventHandlers.onMultiSelectionChange(e)},onCancel:function(){var e=I.oComponentUtils.isDraftEnabled();var t=E.getStableId({type:"ObjectPageAction",subType:"CommonAction",sAction:e?"discard":"cancel"});var n=sap.ui.getCore().byId(V.createId(t));var o=I.oServices.oApplication.getEditFlowOfRoot()==="direct";var a=!o&&!G.getModel("ui").getProperty("/createMode");var i=W.state.onCancel(n,a&&Je);i.then(function(){Te();if(!e){se()}if(o){p.navigateUp()}},Function.prototype)},onContactDetails:function(e,t){I.oCommonEventHandlers.onContactDetails(e,t)},onSmartFieldInitialise:function(e){var t=this.getView().getId();I.oCommonEventHandlers.onSmartFieldInitialise(e,t)},onPressDraftInfo:function(e){var t=V.getView().getBindingContext();var n=sap.ui.getCore().byId(e.getSource().getId()+(e.getId()==="markChangesPress"?"-changes":"-lock"));I.oCommonUtils.showDraftPopover(t,n)},onPressDraftInfoObjectPageDynamicHeaderTitle:function(e){var t=V.getView().getBindingContext();var n=V.byId("template::ObjectPage::ObjectMarkerObjectPageDynamicHeaderTitle");I.oCommonUtils.showDraftPopover(t,n)},onSwitchDraftAndActiveObjectPopOver:function(e){var t=e.getSource();ct(t).then(function(e){e.openBy(t)})},onShareObjectPageActionButtonPress:function(e){I.oCommonUtils.executeIfControlReady(Ce,E.getStableId({type:"ObjectPageAction",subType:"Share"})+"-internalBtn")},onRelatedApps:function(e){K.getRelatedApps(e)},onSummarize:function(){var e=I.oServices.oApplication.getSummarizationLibraryUrl();H.load({name:"ux.eng.fioriai.reuse",url:e}).then(function(){sap.ui.require(["ux/eng/fioriai/reuse/library"],function(e){e.summarize({view:V.getView()})})})},onEdit:function(e){var t=V.byId("edit");if(t.data("CrossNavigation")){I.oCommonEventHandlers.onEditNavigateIntent(t);return}I.oCommonUtils.executeIfControlReady(Ue,"edit")},onValidateDraft:ce,onSave:ve,onSaveAndContinueEdit:ge,onSaveAndEditNext:fe,onBreadCrumbUrlPressed:Le,onDelete:Ie,onCallActionFromToolBar:function(e){I.oCommonEventHandlers.onCallActionFromToolBar(e,W.state)},onCallAction:function(e,t,n,o){I.oServices.oApplication.performAfterSideEffectExecution(function(){var a=V.getView().getBindingContext();if(a){I.oServices.oDataLossHandler.performIfNoDataLoss(function(){var i=V.getOwnerComponent();var r=i.getEntitySet();var l=o?{ResultIsActiveEntity:true}:{};var s={functionImportPath:e,contexts:[a],sourceControlHandler:"",label:V.byId(t).getText(),operationGrouping:n,skipProperties:l};I.oServices.oCRUDManager.callAction(s).then(function(e){var t=e&&e[0];if(t&&t.context&&(!t.actionContext||t.actionContext&&t.context.getPath()!==t.actionContext.getPath())){I.oServices.oViewDependencyHelper.setParentToDirty(i,r,1)}})},Function.prototype,"Proceed",true)}},true)},onDataFieldForIntentBasedNavigation:function(e){e=S({},e);I.oServices.oApplication.performAfterSideEffectExecution(function(){I.oCommonUtils.fnProcessDataLossOrDraftDiscardConfirmation(function(){I.oCommonEventHandlers.onDataFieldForIntentBasedNavigation(e,W.state)},Function.prototype,"LeaveApp")},true)},onDataFieldWithIntentBasedNavigation:function(e){I.oCommonEventHandlers.onDataFieldWithIntentBasedNavigation(e,W.state)},onDataFieldWithEmail:function(e){I.oCommonEventHandlers.onDataFieldWithEmail(e)},onDataFieldWithNavigationPath:function(e){I.oCommonEventHandlers.onDataFieldWithNavigationPath(e)},onChartInit:function(e){var t=e.getSource();I.oInfoObjectHandler.setInformationWithControl(t);t.getChartAsync().then(function(e){if(O.browser.safari){t.setHeight("50vH")}e.attachSelectData(Tt).attachDeselectData(Tt);I.oCommonUtils.checkToolbarIntentsSupported(t)})},onBeforeRebindDetailTable:function(e){var t=e.getSource();if(!t.getModel()){return}e.mParameters.bindingParams.events["dataReceived"]=st.bind(null,t);k.oInlineCreationRowsHelper.onBeforeRebindControl(e);t.setNoData(I.oCommonUtils.getText("WAITING_SMARTTABLE"));var n=re(e);var o=I.oInfoObjectHandler.getControlInformation(t.getId());var a=o.getSearchFieldId();if(a){var i=V.byId(a);var l=i&&i.getValue()||"";if(l){n.parameters.custom={search:l}}}I.oCommonEventHandlers.onBeforeRebindTable(e,{ensureExtensionFields:V.templateBaseExtension.ensureFieldsForSelect,addExtensionFilters:V.templateBaseExtension.addFilters,isFieldControlRequired:true,isPopinWithoutHeader:true,isDataFieldForActionRequired:true,isFieldControlsPathRequired:true,isMandatoryFiltersRequired:true});V.onBeforeRebindTableExtension(e);var s=n.events.refresh||Function.prototype;n.events.refresh=function(e){var n=t.getId();R.info("Data requested (SmartTable: "+n+")");J.onDataRequested(n);s.call(this,e)};var c=n.events.dataReceived||Function.prototype;n.events.dataReceived=function(e){I.oCommonEventHandlers.onDataReceived(t);c.call(this,e)};J.onRebindContentControl(t.getId(),n);pe(e);k.oMessageStripHelper.onBeforeRebindControl(e);if(r.isAnalyticalTable(t.getTable())){n.parameters.entitySet=t.getEntitySet()}},onListNavigate:function(e){var t=I.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(I.oCommonUtils.getOwnerControl(e.getSource(),true)).getPressedItemParameter();var n=!!e.getParameters()[t].getBindingContext().isTransient();var o=x({},e);(n?I.oServices.oApplicationController.synchronizeDraftAsync():Promise.resolve()).then(function(){I.oCommonEventHandlers.onListNavigate(o,W.state)})},onBeforeSemanticObjectLinkPopoverOpens:function(e){var t=xe();I.oCommonUtils.semanticObjectLinkNavigation(e,t,V,k)},onBeforeSemanticObjectLinkNavigationCallback:function(e){return I.oCommonEventHandlers.onBeforeSemanticObjectLinkNavigationCallback(e)},onSemanticObjectLinkNavigationPressed:function(e){var t=e.getParameters();var n=e.getSource();I.oCommonEventHandlers.onSemanticObjectLinkNavigationPressed(n,t)},onSemanticObjectLinkNavigationTargetObtained:function(e){var t=e.getParameters();var n=e.getSource();I.oCommonEventHandlers.onSemanticObjectLinkNavigationTargetObtained(n.getEntitySet(),n.getFieldSemanticObjectMap(),t,W.state)},onSemanticObjectLinkNavigationTargetObtainedSmartLink:function(e){var t,n;t=e.getParameters();n=e.getSource();while(n.getMetadata().getName()!=="sap.ui.comp.smarttable.SmartTable"&&n.getParent()){n=n.getParent()}I.oCommonEventHandlers.onSemanticObjectLinkNavigationTargetObtained(n.getEntitySet(),{},t,W.state)},sectionChange:$e,onSwitchTabs:qe,uploadStream:function(e){I.oCommonEventHandlers.uploadStream(e)},handleUploadComplete:function(e){I.oCommonEventHandlers.handleUploadComplete(e)},handleTypeMismatch:function(e){I.oCommonEventHandlers.handleTypeMismatch(e)},removeStream:function(e){I.oCommonEventHandlers.removeStream(e)},onInlineDataFieldForAction:function(e){I.oCommonEventHandlers.onInlineDataFieldForAction(e)},onInlineDataFieldForIntentBasedNavigation:function(e){I.oCommonEventHandlers.onInlineDataFieldForIntentBasedNavigation(e.getSource(),W.state)},onDeterminingDataFieldForAction:function(e){I.oCommonEventHandlers.onDeterminingDataFieldForAction(e)},onBeforeRebindChart:function(e){var t=e.getSource();if(!t.getModel()){return}re(e);t.getChartAsync().then(function(e){t.oModels=e.oPropagatedProperties.oModels});var n={ensureExtensionFields:Function.prototype,addExtensionFilters:V.templateBaseExtension.addFilters,isFieldControlRequired:true,isMandatoryFiltersRequired:true};I.oCommonUtils.onBeforeRebindTableOrChart(e,n)},onToggleDynamicSideContent:z.onToggleDynamicSideContent,sideContentBreakpointChanged:z.sideContentBreakpointChanged,onTableInit:function(e,t){var n=e.getSource();var o=n.getTable();var i=I.oInfoObjectHandler.setInformationWithControl(n);var l=new a(n);n.setModel(l,"tableobserver");k.oMessageStripHelper.initSmartTable(n,t);var s=i.getHiddenColumnInfo();if(s&&s.staticHiddenColumns&&s.staticHiddenColumns.length>0){n.deactivateColumns(s.staticHiddenColumns)}I.oCommonUtils.checkToolbarIntentsSupported(n);var c=r.isMTable(o);if(c||r.isUiTable(o)){var u=o.getId();var d=function(){if(c&&!Y[u]){Y[u]=o.getGrowingThreshold&&o.getGrowingThreshold()}Ge(n,o,t)};G.attachEvent("subSectionVisibilityChange",d);d()}if(N(n)==="inline"&&!n.data("CrossNavigation")){o.addEventDelegate({onkeyup:function(e){if(e.ctrlKey&&e.keyCode===b.ENTER&&n.getEditable()){tt(n,n);e.preventDefault();e.setMarked()}}})}var g=I.oComponentUtils.getTemplatePrivateModel();var f=["inline","creationRows","creationRowsHiddenInEditMode"];var v=N(n);if(f.indexOf(v)>-1){o.addEventDelegate({onAfterRendering:function(e){var o;if(n.getEditable()&&!n.hasListeners("paste")){n.attachBeforePaste(Ee);n.attachPaste(ye);o=g.getProperty("/objectPage/aPasteAttachedTables");if(o){o.push(t)}}}})}I.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(n).addCellSelector()},onBeforeExport:function(e){I.oCommonEventHandlers.onBeforeExport(e)},onSearchObjectPage:Ye,onSmartTablePaste:ye,onUITableExpand:Ve,onSingleSectionOrSubsectionVisible:_e,dataStateFilter:it,dataStateClose:rt,onSmartFieldModelValueChanged:St,onTableSmartFieldModelValueChanged:ht,beforeOpenContextMenu:It,onContextMenu:At,onSmartFieldPress:Et},formatters:{sideContentActionButtonText:z.formatSideContentActionButtonText,setNoDataTextForSmartTable:function(e){if(I.oCommonUtils&&e){var t=I.oCommonUtils.getContextText("WAITING_SMARTTABLE",e);if(t!=="WAITING_SMARTTABLE"){return t}return""}},setVMVisibilityForVendor:function(){var e=new y(window.location.href);if(e.mParams["sap-ui-layer"]){var t=e.mParams["sap-ui-layer"];for(var n=0;n<t.length;n++){if(t[n].toUpperCase()==="VENDOR"){return true}}}return false},formatItemTextForMultipleView:function(e){return e&&J?J.formatItemTextForMultipleView(e):""}},extensionAPI:new g(I,V,W,k)};Dt.handlers=P(W.handlers,Dt.handlers);return Dt}};return V});
//# sourceMappingURL=ControllerImplementation.js.map