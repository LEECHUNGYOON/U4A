sap.ui.define(["sap/suite/ui/generic/template/AnalyticalListPage/controller/KpiCardController","sap/ui/model/json/JSONModel","sap/ui/core/library","sap/ui/Device","sap/m/ResponsivePopover","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/ui/core/mvc/View"],function(e,t,a,i,r,n,o){"use strict";var s=new n("AnalyticalListPage.controller.KpiTagController").getLogger();var l,p;p=a.mvc.ViewType;var d={_kpiCards:[],init:function(e){var a=this;a.oState=e;a.oGenericModel=new t;var i={header:"Some Header",title:"Some Title",titleUrl:"",icon:"sap-icon://camera"};a.oGenericModel.setData(i);if(l===undefined){l=sap.ui.getCore().loadLibrary("sap.ovp",{async:true})}},openKpiCard:function(e){var t=this;var a;if(typeof e.currentTarget!="undefined"){a=sap.ui.getCore().byId(e.currentTarget.id)}else{a=e.getSource()}l.then(function(){t.createPopover(function(){t._openCard(a)}.bind(t,a),a)})},_openCard:function(e){var t=this;setTimeout(function(){t._kpiCards[e.getQualifier()].openBy(e)},0)},handleKpiPress:function(e){this.openKpiCard(e)},createPopover:function(a,n){var l=this;var d=n.getQualifier();var g=l.oState.oController.getOwnerComponent();var c=g.getKeyPerformanceIndicators();var u;for(var v in c){if(c[v].hasOwnProperty("qualifier")&&c[v].qualifier===d){u=c[v];break}}if(!u){s.error("KPI settings not found with qualifier.");return}var f=g.getAppComponent().getManifestEntry("/sap.app/crossNavigation/outbounds/"+u.detailNavigation);var C=g.getModel(u.model);C.getMetaModel().loaded().then(function(){var s=this;var l=new t;var g=arguments[0];s._oCardController=new e;var c=s.oState.oController.getOwnerComponent();var u=c.getModel(g.model);var v=u.getMetaModel();var C=v.getODataEntitySet(g.entitySet);g.metaModel=v;l.setData(g);var m=n.getFilterableKPISelectionVariant();o.create({preprocessors:{xml:{bindingContexts:{entityType:v.createBindingContext(v.getODataEntityType(C.entityType,true)),entitySet:v.createBindingContext(v.getODataEntitySet(g.entitySet,true))},models:{entitySet:v,entityType:v,parameter:l},dataModel:u,settings:l,preprocessorsData:c.getComponentData().preprocessorsData}},type:p.XML,viewName:"sap.suite.ui.generic.template.AnalyticalListPage.view.KpiCardSizeM",height:"100%"}).then(function(e){var o=n.kpiSettings.kpiPropertyPath;e.data({kpiTitle:n.getSmartKpiConfig().properties.title,qualifierSettings:g});if(o.selectionPresentationVariantPath){e.data({dataPointPath:o.dataPointPath,selectionPresentationVariantPath:o.selectionPresentationVariantPath})}else{e.data({kpiAnnotationPath:o.kpiAnnotationPath})}if(g.filterable){e.data({mergedSelectionVariant:m});e.data({searchQuery:n.getSmartFilterBarBasicSearchValue()})}else{e.data({selectionVariant:n.kpiSettings.selectionVariant})}e.setModel(c.getModel(g.model));var l=new t;var p={visible:g.detailNavigation?true:false};if(n.kpiSettings.navigation){p.target=n.kpiSettings.navigation.semanticObject;p.action=n.kpiSettings.navigation.action;p.parameters=JSON.stringify({EvaluationId:n.kpiSettings.navigation.kpiId})}else if(g.detailNavigation&&f){p.target=f.semanticObject;p.action=f.action;p.parameters=JSON.stringify(f.parameters?f.parameters:{})}else{p.visible=false}l.setData(p);e.setModel(l,"detailNavigation");if(typeof s._kpiCards[d]!="undefined"){s._kpiCards[d].destroy()}s._kpiCards[d]=new r;var u=i.system.phone?true:false;s._kpiCards[d].setShowHeader(u);if(!u){s._kpiCards[d].addStyleClass("sapSmartTemplatesAnalyticalListPageKpiCardStyle")}s._kpiCards[d].addAriaLabelledBy(n.getSmartKpiConfig().properties.title);s._kpiCards[d].setPlacement("Auto");s._kpiCards[d].addContent(e);s._oKpiCardController=e.getController();s._oKpiCardController._assignSmartTemplateDependencies(s.oState.oTemplateUtils,s.oState.oController);s.oState.oController.getView().addDependent(s._kpiCards[d]);a()})}.bind(this,u))},onExit:function(){if(this._oKpiCard){this._oKpiCard.destroy()}},_setModel:function(e){this._oKpiCard.setModel(e)}};return d});
//# sourceMappingURL=KpiTagController.js.map