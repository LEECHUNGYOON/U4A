sap.ui.define(["sap/base/Log","sap/base/util/deepClone","sap/base/i18n/ResourceBundle"],function(e,t,a){"use strict";var r;var i={};var n=[];var o;var l=3;var s,v,c,p;var u=function(e){if(e){var t=e.indexOf("/")>-1?e.replaceAll("/","."):e;return"${if(int("+t+") == 0, 'Default', if(int("+t+") == 1 , 'Attention', if(int("+t+") == 2 , 'Warning', 'Good')))}"}return"Default"};var d=function(e,t){return t&&t.name===e||undefined};var f=function(e,t){var a=r.component;var i=a.getEntitySet();var n=a.getModel();var o=n.getMetaModel();var l=o.getODataEntitySet(i);var s=o.getODataEntityType(l.entityType);var v=e.split("/");var c=v.length;var p=0;while(c>0){var u=s.property.find(d.bind(null,v[p]));if(u&&u["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"]&&u["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"].Bool==="true"){return true}else if(c>1){var f=o.getODataAssociationEnd(s,v[p]);s=o.getODataEntityType(f.type);p++}c--}return false};var g=function(e,t){var a=r.component;var i=a.getEntitySet();var n=a.getModel();var o=n.getMetaModel();var l=o.getODataEntitySet(i);var s=o.getODataEntityType(l.entityType);var v=e.split("/");var c=v.length;var p=0;while(c>0){var u=s.property.find(d.bind(null,v[p]));if(u&&u["com.sap.vocabularies.PersonalData.v1.IsPotentiallyPersonal"]&&u["com.sap.vocabularies.PersonalData.v1.IsPotentiallyPersonal"].Bool==="true"){return true}else if(c>1){var f=o.getODataAssociationEnd(s,v[p]);s=o.getODataEntityType(f.type);p++}c--}return false};var h=function(e,t){var a=r.component;var i=a.getEntitySet();var n=a.getModel();var o=n.getMetaModel();var l=o.getODataEntitySet(i);var s=o.getODataEntityType(l.entityType);var v=e.split("/");var c=v.length;var p=0;while(c>0){var u=s.property.find(d.bind(null,v[p]));if(u&&u["type"]){return u["type"]}else if(c>1){var f=o.getODataAssociationEnd(s,v[p]);s=o.getODataEntityType(f.type);p++}c--}return undefined};var m=function(e,t){if(e.getItems().length>1){var a={type:"DataPoint",label:"",value:"",path:"",displayBehaviour:"",paths:{},objectStatus:"",color:"",edmType:""};var r=e.getItems();a.path=r[1].getBindingPath("value");if(f(a.path,t)){return null}if(g(a.path,t)){return null}a.edmType=h(a.path,t);a.label=r[0].getText&&r[0].getText();a.value=r[1].getValue&&r[1].getValue();var i=r[1].getConfiguration&&r[1].getConfiguration();a.displayBehaviour=i&&i.getDisplayBehaviour&&i.getDisplayBehaviour();if(r[1].getInnerControls){var n=r[1].getInnerControls();if(n&&n.length>0){n.forEach(function(e){var t=e.getBinding("text");var r=t&&e.getBindingInfo("text");if(t&&r){var i=r.parts;if(i&&i.length>0){i.forEach(function(e){if(e.path!==a.path&&e.path!=="__$$SmartFieldNotExistingBindingPath"){a.paths[e.path]=e.path}})}}var n=e.getBinding("state");var o=n&&e.getBindingInfo("state");if(n&&o){a.objectStatus=e.getBindingPath("state");a.color=u(a.criticality);if(a.path===a.criticality){a.path=Object.keys(a.paths)[0];a.paths=[]}}})}}return a}return undefined};var y=function(e,t){if(e.getItems().length>1){var a={type:"PlainTextVBox",label:"",value:"",path:""};var r=e.getItems();a.label=r[0].getText&&r[0].getText();a.path=r[1].getBindingPath("text");a.value=r[1].getText&&r[1].getText();return a}return undefined};var b=function(e,t){if(e.getItems().length>0){var a={type:"Form",header:"",fields:[]};var r=e.getItems();var i=0;if(r[0].getContent&&r[0].getContent()===null&&r[0].getText){a.header=r[0].getText();i=1}for(i;i<r.length;i++){var n=r[i];var o={type:"FormField",label:"",value:"",path:"",paths:{},displayBehaviour:"",expand:"",objectStatus:"",color:"",edmType:""};var l=n.getItems();o.label=l[0].getText&&l[0].getText();if(l[1].getText){o.path=l[1].getBindingPath("text");o.value=l[1].getText()}else{o.path=l[1].getBindingPath("value");o.value=l[1].getValue()}if(f(o.path,t)){continue}if(g(o.path,t)){continue}o.edmType=h(o.path,t);var s=l[1].getObjectBinding&&l[1].getObjectBinding();if(s&&s.getPath){o.expand=l[1].getObjectBinding().getPath()}var v=l[1].getConfiguration&&l[1].getConfiguration();o.displayBehaviour=v&&v.getDisplayBehaviour&&v.getDisplayBehaviour();if(l[1].getInnerControls){var c=l[1].getInnerControls();if(c&&c.length>0){for(var p=0;p<c.length;p++){var d=c[p];var m=d.getBinding("text");var y=m&&d.getBindingInfo("text");if(m&&y){var b=y.parts;if(b&&b.length>0){for(var x=0;x<b.length;x++){var I=b[x];if(I.path!==o.path&&I.path!=="__$$SmartFieldNotExistingBindingPath"){o.paths[I.path]=I.path}}}}var P=d.getBinding("state");var C=P&&d.getBindingInfo("state");if(P&&C){o.objectStatus=d.getBindingPath("state");o.color=u(o.objectStatus)}}}}a.fields.push(o)}return a}};var x=function(e){var t=[];if(e.paths){t=Object.keys(e.paths).filter(function(t){return t!==e.path&&t.indexOf("##@@")===-1})}var a=e.edmType==="Edm.Decimal"?"${formatNumber(float("+e.path+"), 2)}":"${"+e.path+"}";var r="";var i="";var n;if(t.length>1){var o=t.filter(function(e){return e.endsWith("_Text")});var l=t.filter(function(e){return!e.endsWith("_Text")});if(o&&o.length>0){i="${"+o[0]+"}"}if(l&&l.length>0){r="${"+l[0]+"}"}if(o&&o.length>0){i="${"+o[0]+"}"}}else if(t.length>0){i="${"+t[0]+"}"}if(e.displayBehaviour){switch(e.displayBehaviour){case"descriptionAndId":if(r){n=a+(i?" "+i:"")+(r?" ("+r+")":"")}else if(i){n=i+(a?" ("+a+")":"")}else{n=a}break;case"descriptionOnly":n=i;break;case"idAndDescription":n=a+(r?" "+r:"")+(i?" ("+i+")":"");break;case"idOnly":n=a||r;break;default:n=a;break}}else{n=a}n=n&&n.indexOf("/")>-1?n.replaceAll("/","."):n;return n};var I=function(){var e=r.component;var t=e.getAppComponent().getMetadata();var a=t.getManifestEntry("sap.app");var i=e.getComponentContainer();var n=i.getElementBinding();var o=new URL(c);var l=o.origin+a.dataSources.mainService.uri;var s=n.sPath;if(a.dataSources.mainService.uri.endsWith("/")&&s.startsWith("/")){s=s.substring(1,s.length)}var v=o.origin+a.dataSources.mainService.uri+s+(n.mParameters.expand?"?$expand="+encodeURIComponent(n.mParameters.expand):"");return{serviceUrl:l,contextUrl:v}};var P=function(){var e={type:"TextBlock",size:"Small",weight:"Bolder",text:"${form1}",maxLines:2,wrap:true,spacing:"Medium"};var a={type:"TextBlock",size:"Small",text:"${field1}",maxLines:1,color:"Default",weight:"Default",wrap:false,isSubtle:true};var r={type:"TextBlock",size:"Small",text:"${field1desc}",maxLines:2,wrap:true,color:"Default"};var i={type:"ColumnSet",columns:[]};var u={type:"Column",items:[],verticalContentAlignment:"Top",width:1};var d={type:"ActionSet",actions:[]};var f={type:"Action.ShowCard",title:"",style:"default",card:{type:"AdaptiveCard",body:[],actions:[{type:"Action.Execute",verb:"",style:"positive",title:"OK",data:{serviceURI:"",contextURL:"",actionParams:{keys:[]},isConfirmationRequired:false}}],$schema:"http://adaptivecards.io/schemas/adaptive-card.json"}};var g={type:"Input.Text",id:"",isMultiline:false,isRequired:true,label:""};var h={type:"Input.Date",id:"",isRequired:true,label:""};var m={type:"AdaptiveCard",metadata:{webUrl:I().contextUrl},msTeams:{width:"full"},body:[{type:"ColumnSet",columns:[{type:"Column",items:[{type:"TextBlock",size:"Medium",weight:"Bolder",text:p,maxLines:3},{type:"TextBlock",size:"Default",weight:"Bolder",text:"["+s+"]("+c+")",maxLines:1,spacing:"None"},{type:"TextBlock",size:"Default",text:v,maxLines:1,spacing:"None"}],verticalContentAlignment:"Top",width:"auto"}]}],$schema:"http://adaptivecards.io/schemas/adaptive-card.json",version:"1.4"};if(o&&o.length>0){var y;o.forEach(function(n){var o;var s;var v;var c;if(n.type!=="DataPoint"){if(y){m.body.push(y)}y=undefined}switch(n.type){case"Form":if(n.header&&n.header.length>0){o=t(e);o.text=n.header;m.body.push(o)}var p=n.fields;var d=Math.ceil(p.length/l);for(var f=1;f<=d;f++){var g=f*l;var h=g-l;var b=t(i);for(var I=h;I<g;I++){var P=p[I];c=t(u);if(!P){b.columns.push(c);continue}v=t(a);v.text=P.label;c.items.push(v);s=t(r);s.text=x(P);s.color=P.color?P.color:"Default";c.items.push(s);b.columns.push(c)}m.body.push(b)}break;case"PlainTextVBox":o=t(e);o.text=n.label;m.body.push(o);s=t(r);s.text=x(n);m.body.push(s);break;case"DataPoint":if(!y){y=t(i)}c=t(u);o=t(e);o.text=n.label;c.items.push(o);s=t(r);s.text=x(n);s.color=n.color?n.color:"Default";c.items.push(s);y.columns.push(c);break;default:break}if(y&&y.columns.length===3){m.body.push(y);y=undefined}});if(y){m.body.push(y);y=undefined}}if(n.length>0){n.sort(function(e,t){var a={"com.sap.vocabularies.UI.v1.ImportanceType/High":1,"com.sap.vocabularies.UI.v1.ImportanceType/Medium":2};var r=a[e.importance]||3;var i=a[t.importance]||3;return r-i});var b=t(d);var P=0;for(var C=0;C<n.length;C++){if(P===2){break}var T=n[C];var B=t(f);if(T.parameter&&T.parameter.additionalParameters&&T.parameter.additionalParameters.length>0){var D=T.parameter.additionalParameters;for(var O=0;O<D.length;O++){var E=D[O];if(E.type==="Edm.String"){var S=t(g);S.label=E.name;S.id=E.name;S.isRequired=E.nullable==="true";B.card.body.push(S)}else if(E.type==="Edm.DateTime"){var w=t(h);w.label=E.name;w.id=E.name;w.isRequired=E.nullable==="true";B.card.body.push(w)}}}B.title=T.label;B.card.actions[0].verb=T.action;B.card.actions[0].data.serviceURI=I().serviceUrl;B.card.actions[0].data.contextURL=I().contextUrl;B.card.actions[0].data.isConfirmationRequired=T.critical;if(T.parameter.parameterData){var U=Object.keys(T.parameter.parameterData);for(var k=0;k<U.length;k++){var A=U[k];if(B.card.actions[0].data.actionParams.keys.indexOf(A)===-1){B.card.actions[0].data.actionParams.keys.push(A)}}}var M=B;if(B.card.body.length===0){B.card.actions[0].title=B.title;M=B.card.actions[0]}var $=(T.hiddenPath?T.hiddenPath:true)+" && "+(T.applicablePath?T.applicablePath:true);M["$when"]="${"+$+"}";if(T.stylePath.length>0){M["$when"]="${"+$+" && ("+T.stylePath+" == '3' || "+T.stylePath+" == 'UI.CriticalityType/Positive')}";M.style="positive";b.actions.push(M);var j=t(M);j["$when"]="${"+$+" && ("+T.stylePath+" == '1' || "+T.stylePath+" == 'UI.CriticalityType/Negative')}";j.style="destructive";b.actions.push(j);P++}else if(T.styleValue.length>0){M.style=T.styleValue;b.actions.push(M);P++}else{b.actions.push(M);P++}}m.body.push(b)}return m};var C=function(){var e=r.component;var t=r.controller;var a=t.byId("objectPage-OPHeaderContent");var i=e.getAppComponent().getObjectPageHeaderType()==="Dynamic";if(i){if(a&&a.getContent()){var n=a.getContent();var l=[];n.forEach(function(e){if(e.getId().endsWith("DynamicHeaderContentFlexBox")){var t=e.getItems();t.forEach(function(e){l.push(e)})}else{l.push(e)}});l.forEach(function(e){var a;if(e.getId().endsWith("DataPoint")){a=m(e,t)}else if(e.getId().endsWith("PlainTextVBox")){a=y(e,t)}else if(e.getId().endsWith("Form")){a=b(e,t)}if(a){o.push(a)}})}}};var T=function(e){var t={};if(e&&e.key&&e.key.propertyRef){for(var a=0;a<e.key.propertyRef.length;a++){var r=e.key.propertyRef[a].name;t[r]=true}}return t};var B=function(e,t,a){if(t&&e&&!e["com.sap.vocabularies.Common.v1.Label"]){var r=a.getODataProperty(t,e.name,false);if(r&&r["com.sap.vocabularies.Common.v1.Label"]){e["com.sap.vocabularies.Common.v1.Label"]=r["com.sap.vocabularies.Common.v1.Label"]}}};var D=function(e){var t=e["com.sap.vocabularies.Common.v1.IsActionCritical"];if(!t){return false}if(t.Bool===undefined){return true}var a=t.Bool;if(typeof a==="string"){var r=a.toLowerCase();return!(r=="false"||r==""||r==" ")}return!!a};var O=function(){var t=r.controller;var a;n=[];var i=r.component;var o=i.getEntitySet();var l=i.getModel();var s=t.getView().getModel("@i18n").getResourceBundle();var v=t.getView().getModel("i18n").getResourceBundle();var c=v.getText("COPY");var p=l.getMetaModel();var u=p.getODataEntitySet(o);var d=p.getODataEntityType(u.entityType);var f=Object.keys(d);var g=f.filter(function(e){return e==="com.sap.vocabularies.UI.v1.Identification"});if(g.length>0){var h=d["com.sap.vocabularies.UI.v1.Identification"];for(var m=0;m<h.length;m++){var y=h[m].Label&&h[m].Label.String;if(y){a=y.indexOf("i18n>")>1?y.split("i18n>")[1].replace("}",""):"";if(a!==""){y=s.getText(a)}}if(y&&y.toUpperCase().indexOf(c.toUpperCase())>-1){continue}if(h[m].RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"){var b;if(h[m]["com.sap.vocabularies.UI.v1.Hidden"]){if(h[m]["com.sap.vocabularies.UI.v1.Hidden"]["Bool"]){var x=h[m]["com.sap.vocabularies.UI.v1.Hidden"]["Bool"];if(typeof x==="string"){var I=x.toLowerCase();var P=!(I=="false"||I==""||I==" ");if(P){continue}}}else if(h[m]["com.sap.vocabularies.UI.v1.Hidden"]["Path"]){b=h[m]["com.sap.vocabularies.UI.v1.Hidden"]["Path"]}else{continue}}if(h[m]["Determining"]){if(h[m]["Determining"]["Bool"]){var C=h[m]["Determining"]["Bool"];if(typeof C==="string"){var O=C.toLowerCase();var E=!(O=="false"||O==""||O==" ");if(E){continue}}}else{continue}}var S="";var w="";if(h[m]["Criticality"]){if(h[m]["Criticality"]["EnumMember"]){var U=h[m]["Criticality"]["EnumMember"];if(U==="com.sap.vocabularies.UI.v1.CriticalityType/Negative"||U==="1"){w="destructive"}else{w="positive"}}else if(h[m]["Criticality"]["Path"]){var k=h[m]["Criticality"]["Path"];if(k&&k.length>0){k=k.replaceAll("/",".");S=k}}}if(h[m]["com.sap.vocabularies.UI.v1.IsCopyAction"]){if(h[m]["com.sap.vocabularies.UI.v1.IsCopyAction"]["Bool"]){var A=h[m]["com.sap.vocabularies.UI.v1.IsCopyAction"]["Bool"];if(typeof A==="string"){var M=A.toLowerCase();var $=!(M=="false"||M==""||M==" ");if($){continue}}}else{continue}}var j=h[m].Action.String.split("/")[1];var L=p.getODataFunctionImport(j);var R=t.getView().getBindingContext().getObject();var F=T(d);var V;var H={};var W={parameterData:{},additionalParameters:[]};if(L.parameter){for(var N=0;N<L.parameter.length;N++){var q=L.parameter[N];B(q,d,p);var z=q.name;var _=!!F[z];V=undefined;if(R&&R.hasOwnProperty(z)){V=R[z]}else if(_&&R&&L["sap:action-for"]){e.error("Key parameter of action not found in current context: "+z);throw new Error("Key parameter of action not found in current context: "+z)}W.parameterData[z]=V;var K=!!H[z];if(!K&&(!_||!L["sap:action-for"])&&q.mode.toUpperCase()=="IN"){W.additionalParameters.push(q)}}}var G={type:"Action",label:y,action:j,parameter:W,critical:D(L),rawFunctionImport:L,stylePath:S,styleValue:w,hiddenPath:b,applicablePath:L["sap:applicable-path"],importance:h[m]["com.sap.vocabularies.UI.v1.Importance"]?h[m]["com.sap.vocabularies.UI.v1.Importance"]["EnumMember"]:"com.sap.vocabularies.UI.v1.ImportanceType/Low"};n.push(G)}}}};var E=function(){if(r.objectTitle){s=r.objectTitle}if(r.objectSubtitle){v=r.objectSubtitle}if(r.appTitle){p=r.appTitle}if(r.url){c=r.url}C();O();return P()};i.createAdaptiveCard=function(e,t){o=[];var a;r=t;switch(e){case"HeaderInfo":a=E();break;default:break}return a};return i});
//# sourceMappingURL=AdaptiveCardHelper.js.map