sap.ui.define(["sap/ui/base/Object","sap/base/util/extend","sap/ui/model/base/ManagedObjectModel","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/expressionHelper","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/m/plugins/CellSelector"],function(e,t,n,r,i,o,a){"use strict";function u(e,t,u,s){var l=s.getTable();var c=r.isMTable(l);var f=r.isUiTable(l);var g=r.isTreeTable(l);var d=f?"rows":"items";function v(){return l.getBinding(d)}function b(){return s.getTableBindingPath()}function m(e){return l.getColumns(e)}function p(){var e=l.getPlugins().find(function(e){return e.isA("sap.ui.table.plugins.SelectionPlugin")});var t=e?e.getSelectedIndices():l.getSelectedIndices();return t||[]}function C(e){var t=[];e.forEach(function(e){var n=l.getContextByIndex(e);if(n){t.push(n)}});return t}function h(){if(c){return l.getSelectedContexts()}var e=p();return C(e)}function I(){var e=v();if(!e){return null}if(g){var t=e.getLength()>0?e.getLength():0;var n=[];for(var r=0;r<t;r++){var i=e.getContextByIndex(r);n.push(i)}return n}return e.getAllCurrentContexts()}function P(){return s.getModel()}function x(){var e=[];var t=s.getCustomData().find(function(e){return e.getKey()==="TemplateSortOrder"});var n=t&&t.getValue();if(n){n.split(", ").forEach(function(t){var n=t.split(" ");e.push({Property:n[0],Descending:n.length>1})})}return e}function T(){return l.getAggregation(d)}function F(){return t.setEnabledToolbarButtons(s)}function S(){return t.setEnabledFooterButtons(s)}function y(e){s.attachAfterVariantInitialise(function(){s.setCurrentVariantId(e)});s.setCurrentVariantId(e)}function B(){return l.getBindingInfo(d)}function w(e,t,n){e(n)}function R(t,n,r){var i=B();if(i&&i.binding){return new Promise(function(o,a){var s=function(e){i.binding.detachDataReceived(s);w(o,a,e);if(typeof r==="function"){(r||Function.prototype)()}};i.binding.attachDataReceived(s);if(t){i.binding.refresh(t)}else{i.binding.refresh()}if(!n&&e.getView().getModel("ui").getProperty("/editable")){u.messagesRefresh(t)}})}else{return V()}}function V(){return new Promise(function(e,t){var n=function(r){s.detachBeforeRebindTable(n);var i=r.getParameters().bindingParams;var o=i.events.dataReceived||Function.prototype;var a=function(n){o.call(this,n);w(e,t,n)};i.events.dataReceived=a};s.attachBeforeRebindTable(n);s.rebindTable()})}function O(t){var n=e.getOwnerComponent();var r=n.getModel().getMetaModel();var i=[];var o=r.getODataEntitySet(n.getEntitySet())["Org.OData.Capabilities.V1.SortRestrictions"];if(o&&o.NonSortableProperties){i=o.NonSortableProperties.map(function(e){return e.PropertyPath})}var a=t.filter(function(e){return!i.includes(e.Property)});var u=s.getUiState();var l=u.getPresentationVariant();if(!l.SortOrder){l.SortOrder=x()}l.SortOrder=l.SortOrder.concat(a);u.setPresentationVariant(l);s.setUiState(u)}function E(e){if(c){var t=l.getItems().findIndex(function(t){return t.getBindingContextPath()===e});if(t>-1){l.scrollToIndex(t)}}}function M(e){var t=e.getPath();var n=-2;for(var r=0;n===-2;r++){var i=l.getContextByIndex(r);var o=i&&i.getPath();if(o===t){n=r}else if(!i){n=-1}}return n}function D(e){var t=l.getFirstVisibleRow();var n=l.getVisibleRowCount();var r=e.getPath();for(var i=0;i<n;i++){if(l.getContextByIndex(t+i).getPath()===r){return l.getRows()[i]}}}function U(e){var t=e;var n,i;for(var o;t&&!n;t=n?t:o){var o=t.getParent();var i=r.isRow(o);n=(i||r.isColumnListItem(o))&&o}if(n){var a=n.indexOfCell(t);var u=l.getColumns();if(i){u=u.filter(function(e){return e.getVisible()})}return u[a]}}function A(e){return s._getColumnLabel(e)}o.testable(D,"getGridTableRow");o.testable(M,"getGridTableRowIndexFromContext");function L(e){var t=r.searchInTree(e,function(e){return r.isSmartField(e)?r.getSmartFieldIsFocussableForInputPromise(e).then(function(t){return t&&e}):null});return Promise.resolve(t)}function H(e){L(e).then(function(t){r.focusUI5Control(t||e)})}function G(e){var t=l.getItems();var n=t.find(function(t){return e.getPath()===t.getBindingContext().getPath()});return n}function N(e){if(c){var t=G(e);if(t){setTimeout(function(){H(t)},0)}}else{var n=M(e);if(n!==-1){l.setFirstVisibleRow(n);setTimeout(function(){var t=D(e);H(t)},0)}}}function j(){return new Promise(function(e,t){J(function(){Promise.resolve(r.searchInTree(l,function(e){if(r.isSmartField(e)){return r.getSmartFieldIsFocussableForInputPromise(e).then(function(t){return t&&e})}})).then(e)})})}function _(){return c?l.getGrowingThreshold():l.getThreshold()}function q(){return s.getDataStateIndicator()}function K(){return c}function k(){return s.getToolbar()}function z(e){if(!e){return}var t=e.getModel();var n=s.getEntitySet();var r=s.getModel("@i18n");var o=r&&r.getResourceBundle();var a=i.getAnnotationFormatter(t,n,"/com.sap.vocabularies.UI.v1.HeaderInfo/Title/Value",o);var u=a.format(e);a.done();a=i.getAnnotationFormatter(t,n,"/com.sap.vocabularies.UI.v1.HeaderInfo/Description/Value",o);var l=a.format(e);a.done();return{title:u,subTitle:l}}function J(e){if(!l.getBusy()){e();return}var t=new n(l);var r=t.bindProperty("/busy");var i=function(){t.destroy();J(e)};r.attachChange(i)}function Q(){return new Promise(function(e){J(e)})}function W(){return c||v().isLengthFinal()}function X(){var e=T(),t=c?e.length:v().getLength();for(var n=0;n<t;n++){var r=c?e.at(n).getBindingContext():l.getContextByIndex(n);if(r.isInactive()){return r}}}function Y(){var e=X();if(e){N(e)}}function Z(){return c?"listItem":"item"}function $(e){return c?G(e):D(e)}function ee(e){var t;if(c){var n=e.getParameter("listItem");t=n&&n.getBindingContext()}else{var r=e.getParameter("rowIndex");var i=r<0?[]:C([r]);t=i[0]}var o=h();var a=!!t&&o.indexOf(t)>=0;var u=a||!t;var s=u?o:[t];return{focussedBindingContext:t,applicableContexts:s,doesApplicableEqualSelected:u}}function te(){var e=c?l.getRenderedColumns():l._getVisibleColumns();return e.map(function(e){return e.data("p13nData").leadingProperty})}function ne(e){var t=te();return e.filter(function(e){return!t.includes(e)})}function re(){if(f){s.addDependent(new a)}}return{getBinding:v,getBindingPath:b,getSelectedContexts:h,getCurrentContexts:I,getVisibleProperties:m,getItems:T,getBindingInfo:B,getModel:P,setEnabledToolbarButtons:F,setEnabledFooterButtons:S,setCurrentVariantId:y,setCurrentTableVariantId:y,setCurrentChartVariantId:Function.prototype,refresh:R,rebind:V,getUnbusyPromise:Q,applyNavigationSortOrder:O,scrollToSelectedItemAsPerChildContext:E,getColumnForCell:U,getColumnLabel:A,getFirstFocussableEditableCellPromise:j,setFocusOnFirstEditableFieldInTableRow:N,getThreshold:_,getDataStateIndicator:q,getToolbar:k,getTitleInfoForItem:z,isLengthFinal:W,focusOnFirstTransientRow:Y,isMTable:K,getPressedItemParameter:Z,findVisibleColumnProperties:te,findHiddenColumnProperties:ne,getRowForContext:$,getFocusInfoForContextMenuEvent:ee,addCellSelector:re}}return e.extend("sap.suite.ui.generic.template.lib.presentationControl.SmartTableHandler",{constructor:function(e,n,r,i){t(this,u(e,n,r,i))}})});
//# sourceMappingURL=SmartTableHandler.js.map