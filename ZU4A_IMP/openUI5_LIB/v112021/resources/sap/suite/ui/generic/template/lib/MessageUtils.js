sap.ui.define(["sap/ui/base/Event","sap/ui/core/library","sap/ui/core/IconPool","sap/m/MessageToast","sap/ui/generic/app/util/MessageUtil","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/lib/TemplateComponent"],function(e,t,r,a,s,o,n,i){"use strict";var c=t.ValueState;var l=t.IconColor;var g=new n("lib.MessageUtils").getLogger();var u=sap.ui.getCore().getMessageManager();function E(e,t,r,a,o,n){o=o||{};var i=s.parseErrorResponse(a);var c=i.messageText;var l;var u=false;var E=false;var p=t&&t.getOwnerComponent();var T=o.resourceBundle||p.getModel("i18n").getResourceBundle();var f=o.navigationController||r.oNavigationController;var v=o.model||p.getModel();g.debug("handleError has been called with operation "+e+" and HTTP response status code "+i.httpStatusCode);var _=n&&n[i.httpStatusCode];if(_){_(i.httpStatusCode)}var I=i.httpStatusCode;switch(I){case 400:switch(e){case s.operations.modifyEntity:break;case s.operations.callAction:c=T.getText("ST_GENERIC_BAD_REQUEST_ACTION");break;case s.operations.deleteEntity:c=T.getText("ST_GENERIC_BAD_REQUEST_DELETE");break;case s.operations.editEntity:c=T.getText("ST_GENERIC_BAD_REQUEST_EDIT");break;case s.operations.saveEntity:case s.operations.activateDraftEntity:if(r&&r.oTemplateCapabilities&&r.oTemplateCapabilities.oMessageButtonHelper&&r.oTemplateCapabilities.oMessageButtonHelper.showMessagePopover){r.oTemplateCapabilities.oMessageButtonHelper.showMessagePopover();E=true}else{g.info("A MessageButtonHelper class instance could not be found as one of the services' template capabilities.")}break;default:c=T.getText("ST_GENERIC_BAD_REQUEST");break}break;case 401:u=true;c=T.getText("ST_GENERIC_ERROR_AUTHENTICATED_FAILED");l=T.getText("ST_GENERIC_ERROR_AUTHENTICATED_FAILED_DESC");break;case 403:switch(e){case s.operations.callAction:c=T.getText("ST_GENERIC_ERROR_NOT_AUTORIZED_ACTION");break;case s.operations.addEntry:c=T.getText("ST_GENERIC_ERROR_NOT_AUTORIZED_CREATE");break;case s.operations.deleteEntity:c=T.getText("ST_GENERIC_ERROR_NOT_AUTORIZED_DELETE");break;case s.operations.editEntity:c=T.getText("ST_GENERIC_ERROR_NOT_AUTORIZED_EDIT");break;default:c=T.getText("ST_GENERIC_ERROR_NOT_AUTORIZED");l=T.getText("ST_GENERIC_ERROR_NOT_AUTORIZED_DESC");u=true;break}break;case 404:switch(e){case s.operations.callAction:c=T.getText("ST_GENERIC_BAD_REQUEST_ACTION");break;default:c=T.getText("ST_GENERIC_BAD_REQUEST");break}break;case 409:case 412:if((e===s.operations.activateDraftEntity||e===s.operations.deleteEntity)&&a.response&&a.response.headers&&a.response.headers["preference-applied"]==="handling=strict"){return}break;case 422:break;case 423:if(e===s.operations.activateDraftEntity||e===s.operations.saveEntity||e===s.operations.deleteEntity){return}break;case 500:case 501:case 502:case 503:case 504:case 505:u=!Object.keys(s.operations).some(function(t){return t===e});switch(e){case s.operations.callAction:c=T.getText("ST_GENERIC_ERROR_SYSTEM_UNAVAILABLE_FOR_ACTION");break;default:c=T.getText("ST_GENERIC_ERROR_SYSTEM_UNAVAILABLE");break}l=T.getText("ST_GENERIC_ERROR_SYSTEM_UNAVAILABLE_DESC");break;case 0:u=false;E=true;break;default:u=true;c=T.getText("ST_GENERIC_ERROR_SYSTEM_UNAVAILABLE");l=T.getText("ST_GENERIC_ERROR_SYSTEM_UNAVAILABLE_DESC");break}if(u){var R;if(p){var S=p.getModel("_templPriv");R=S.getProperty("/generic/viewLevel")}f.navigateToMessagePage({title:T.getText("ST_GENERIC_ERROR_TITLE"),text:c,description:l,icon:"sap-icon://message-error",viewLevel:R})}else if(!i.containsTransientMessage&&!E){s.addTransientErrorMessage(c,l,v)}}function p(t,r,a,s,n){var c;if(r instanceof e){var l=r.getParameter("item");c=l.getBindingContext("msg").getObject()}else{c=r}var g=t.oCommonUtils.getPositionableControlId(c.controlIds,true);if(!g){t.oServices.oApplication.registerForMessageNavigation(t,c,a);return}var u=Promise.resolve(false);if(s){var E=o.byId(g);if(o.isTable(E)){var p=c.controlIds.filter(function(e){var t=o.byId(e);return!o.isTable(t)});var T;p.forEach(function(e){var r=o.isElementVisibleOnView(e,null,function(t){var r=o.isView(t)&&t.getVisible()&&t.getController().getOwnerComponent();return r instanceof i&&{component:r,controlId:e}});if(r&&t.oServices.oApplication.isComponentActive(r.component)){var a=r.component.getModel("_templPriv");r.level=a.getProperty("/generic/viewLevel");if(!T||T.level<r.level){T=r}}});if(T){g=T.controlId;a=T.component}else{var f=c.aFullTargets.find(function(e){return e.startsWith(n)&&e.lastIndexOf("/")>n.length});if(f){u=t.oServices.oApplication.navigateToMessageTarget(c,f)}}}}u.then(function(e){if(e){return}var r={targetInfo:c};t.oServices.oApplication.prepareForControlNavigation(a,g).then(function(){var e=o.byId(g);var t=o.isSmartField(e)?o.getSmartFieldIsFocussableForInputPromise(e):Promise.resolve(true);t.then(function(t){o.focusUI5Control(t?e:e.getParent(),r)})})})}function T(e,t){var r=u.getMessageModel().getData();var a=r.some(function(e){return e.persistent&&t.oApplication.isTransientMessageNoCustomMessage(e)});if(!a){t.oApplication.showMessageToast(e)}}function f(e,t){var r=e.some(function(e){var r=t.oCommonUtils.getPositionableControlId(e.controlIds,true);return!r||o.isTable(o.byId(r))});return r?t.oComponentUtils.prepareForMessageHandling(e):Promise.resolve()}function v(e){var t=e.getTechnicalDetails();return!!t&&t.statusCode==="412"&&!t.headers["preference-applied"]}function _(e){var t=u.getMessageModel().getData();return t.find(function(t){return t.id===e})}function I(e,t){var r=u.getMessageModel().getProperty("/");var a=r.filter(function(r){return r.persistent&&(e||!r.technicalDetails||r.technicalDetails.statusCode!=="404"||r.type!=="Error")&&t(r)});return a}function R(e){var t=I(true,e);if(t.length>0){u.removeMessages(t)}}function S(e){var t=c.None,r=0;for(var a=0;a<e.length;a++){var s=C(e[a]);if(s>r){t=e[a].type;r=s}}return t}function d(e,t){var r,a="";r=S(e);var s="";if(r===c.Error){s=e.length>1?"ST_MESSAGES_DIALOG_TITLE_ERROR_PLURAL":"ST_MESSAGES_DIALOG_TITLE_ERROR"}else if(r===c.Warning){s=e.length>1?"ST_MESSAGES_DIALOG_TITLE_WARNING_PLURAL":"ST_MESSAGES_DIALOG_TITLE_WARNING"}else if(r===c.Information){s="ST_MESSAGES_DIALOG_TITLE_INFORMATION"}else if(r===c.Success){s="ST_MESSAGES_DIALOG_TITLE_SUCCESS_PLURAL"}a=t.getText(s);return{sTitle:a,sSeverity:r}}function A(e,t,r){var s=e.oApplicationProxy.isTransientMessageNoCustomMessage;var n=I(false,s);if(n.length===0){return Promise.resolve()}R(s);var i;if(n.length===1){i=n[0].type;if(i===c.Success||i===c.Information||i===c.None){a.show(n[0].message);return Promise.resolve()}}var l=d(n,e);i=l.sSeverity;return new Promise(function(a){var s,g,u;var E=function(){u.setProperty("/backButtonVisible",false);u.setProperty("/messages",[]);u.setProperty("/messageToGroupName",Object.create(null));g.navigateBack();u.getProperty("/resolve")()};var p={onMessageDialogClose:function(){s.close()},onActionButtonPressed:function(){u.getProperty("/actionButtonCallback")();s.close()},afterClose:E,onBackButtonPress:function(){u.setProperty("/backButtonVisible",false);g.navigateBack()},onMessageSelect:function(){var e=s.getButtons().find(function(e){return e.isFocusable()});o.focusUI5Control(e);u.setProperty("/backButtonVisible",true)},getSeverityIconFromIconPool:b,getIconColor:m};var T=function(t,r){r.setProperty("/genericGroupName",e.getText("ST_MESSAGE_GENERAL_TITLE"));r.setProperty("/backButtonVisible",false);r.setProperty("/cancelButtonText",e.getText("CANCEL"));r.setProperty("/closeButtonText",e.getText("ST_GENERIC_DIALOG_CLOSE_BUT"))};e.oApplicationProxy.getDialogFragmentAsync("sap.suite.ui.generic.template.fragments.MessageDialog",p,"settings",T,false,true).then(function(e){s=e;g=s.getContent()[0];var o=s.getModel();var E=o&&o.getMetaModel();var p=false;var T=!!(r&&r.action);var f=Object.create(null);if(E){n.forEach(function(e){var t=e.getTargets()[0];if(!t){return}if(t.lastIndexOf("/")>0){t=t.substring(0,t.lastIndexOf("/"))}var r=t.substring(1,t.indexOf("("));var a=r&&E.getODataEntitySet(r);var s=a&&E.getODataEntityType(a.entityType);var n=s&&s["com.sap.vocabularies.UI.v1.HeaderInfo"];var i=n&&n.Title&&n.Title.Value&&n.Title.Value.Path;var c=o.getProperty(t);var l=c&&c[i];if(l){f[e.getId()]=l;p=true}})}u=s.getModel("settings");u.setProperty("/showActionButton",T);if(T){u.setProperty("/actionButtonText",r.actionLabel);u.setProperty("/actionButtonCallback",r.action)}u.setSizeLimit(9999);u.setProperty("/title",i!==c.Error&&i!==c.Warning&&t||l.sTitle);u.setProperty("/messages",n);u.setProperty("/grouping",p);u.setProperty("/state",i);u.setProperty("/resolve",a);u.setProperty("/messageToGroupName",f);s.open()})})}function C(e){var t;switch(e.type){case"Error":t=4;break;case"Warning":t=3;break;case"Information":t=2;break;case"Success":t=1;break;default:t=0}return t}function b(e){switch(e){case c.Error:return r.getIconURI("error");case c.Warning:return r.getIconURI("alert");case c.Information:return r.getIconURI("information");case c.Success:return r.getIconURI("sys-enter-2");default:return""}}function m(e){switch(e){case c.Error:return l.Negative;case c.Warning:return l.Critical;case c.Success:return l.Positive;default:return""}}function M(e){var t=[];e.forEach(function(e){var r=_(e);if(r){t.push(r)}});u.removeMessages(t)}return{operations:s.operations,handleTransientMessages:A,prepareForMessageHandling:f,handleError:E,navigateFromMessageTitleEvent:p,removeTransientMessages:R,getTransientMessages:I,showSuccessMessageIfRequired:T,parseError:s.parseErrorResponse,isMessageETagMessage:v,getMessageById:_,getSeverityAsNumber:C,getSeverityIconFromIconPool:b,getIconColor:m,getMessageDialogTitleAndSeverity:d,deleteMessages:M}});
//# sourceMappingURL=MessageUtils.js.map