/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/base/util/extend","sap/base/util/isPlainObject","sap/m/NavContainer","sap/f/FlexibleColumnLayout","sap/ui/core/UIComponent","sap/ui/model/base/ManagedObjectModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/ui/model/odata/MessageScope","sap/ui/model/resource/ResourceModel","sap/ui/rta/RuntimeAuthoring","sap/ui/generic/app/ApplicationController","sap/suite/ui/generic/template/genericUtilities/ProcessObserver","sap/suite/ui/generic/template/designtime/utils/DesigntimeHandler","sap/suite/ui/generic/template/lib/Application","sap/suite/ui/generic/template/lib/BusyHelper","sap/suite/ui/generic/template/lib/DataLossHandler","sap/suite/ui/generic/template/lib/navigation/NavigationController","sap/suite/ui/generic/template/lib/TemplateAssembler","sap/suite/ui/generic/template/lib/CRUDHelper","sap/suite/ui/generic/template/lib/ViewDependencyHelper","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/support/lib/CommonMethods","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/lib/navigation/startupParameterHelper","sap/suite/ui/generic/template/lib/PageLeaveHandler","sap/suite/ui/generic/template/lib/ShareUtils","sap/suite/ui/commons/collaboration/CollaborationHelper","sap/insights/CardHelper","sap/suite/ui/generic/template/lib/insights/InsightsFECardProvider","sap/suite/ui/generic/template/js/RuntimeFormatters"],function(e,t,a,n,i,o,r,s,l,p,u,c,g,d,f,v,m,y,b,h,S,C,P,A,M,N,E,R,H,w,T){"use strict";var B="lib.AppComponent";var O=new M(B).getLogger();g=P.observableConstructor(g);var I=sap.m.DraftIndicatorState;var V=Object.create(null);var L=h.getRegisterAppComponent();var D=true;if(window["sap-ushell-config"]&&window["sap-ushell-config"].apps&&window["sap-ushell-config"].apps.placeholder){D=window["sap-ushell-config"].apps.placeholder.enabled}var F;function x(){F=F||new u({bundleName:"sap/suite/ui/generic/template/lib/i18n/i18n"}).getResourceBundle();return F.getText.apply(F,arguments)}function j(){return new d({processObservers:[]})}var U=sap.ui.getCore().getMessageManager().getMessageModel();var G=new r({path:"validation",operator:s.EQ,value1:true});function _(r,s){var u;var h={oAppComponent:r,leaveAppPromise:Promise.resolve(),ghostapp:function(){var e=r.getManifestEntry("sap.ui.generic.app");return!!(e&&e.settings&&e.settings.ghostapp)}(),componentRegistry:Object.create(null),aRunningSideEffectExecutions:[],getText:x,oTemplatePrivateGlobalModel:(new l).setDefaultBindingMode("TwoWay"),aStateChangers:[],oPaginatorInfo:Object.create(null),oStatePreserversAvailablePromise:Promise.resolve(),oValidationMessageBinding:U.bindList("/",null,null,G),mBusyTopics:Object.create(null),bEnablePlaceholder:D,bStateHandlingSuspended:false,nDelayedDraftTimerInSeconds:20,sSummarizationLibraryUrl:""};h.oDataLossHandler=new y(h);h.oPageLeaveHandler=new E(h);h.oValidationMessageBinding.attachChange(Function.prototype);var M;var B;var F;function _(){var e=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService("URLParsing");h.oTemplatePrivateGlobalModel.setProperty("/generic",{draftIndicatorState:I.Clear,shellServiceUnavailable:false,forceFullscreenCreate:false,isSummarizationEnabled:false});r.setModel(h.oTemplatePrivateGlobalModel,"_templPrivGlobal");h.oShellServicePromise.catch(function(){h.oTemplatePrivateGlobalModel.setProperty("/generic/shellServiceUnavailable",true)});var t=sap.ushell&&sap.ushell.Container;if(t){t.getServiceAsync("Navigation").then(function(e){e.resolveIntent("#IntelligentPrompt-summarize").then(function(e){h.oTemplatePrivateGlobalModel.setProperty("/generic/isSummarizationEnabled",!!e);h.sSummarizationLibraryUrl=e}).catch(function(){O.warning("No intelligent summarization capability enabled on the tenant")})})}var a=R.getCurrentUrl();a.then(function(t){var a=e&&e.isIntentUrlAsync(t);if(a){a.then(function(e){h.oTemplatePrivateGlobalModel.setProperty("/generic/crossAppNavSupport",e)})}else{h.oTemplatePrivateGlobalModel.setProperty("/generic/crossAppNavSupport",false)}});H.isTeamsModeActive().then(function(e){h.oTemplatePrivateGlobalModel.setProperty("/generic/isTeamsModeActive",e)}).finally(function(e){if(!e&&!h.ghostapp){w.getServiceAsync("UIService").then(function(e){h.oTemplatePrivateGlobalModel.setProperty("/generic/insights",{oInsightsInstance:e,shareCards:Object.create(null)});h.oInsightsFECardProvider=new T(h);h.oInsightsFECardProvider.fnRegisterApplicationAsCardProvider()}).catch(Function.prototype)}});h.oTemplatePrivateGlobalModel.setProperty("/generic/shareControlVisibility",z());var n=sap.ui.getCore().getMessageManager().getMessageModel();r.setModel(n,"_templPrivMessage")}function z(){var e=r.getComponentData();return!(e&&e.feEnvironment&&e.feEnvironment.getShareControlVisibility)||e.feEnvironment.getShareControlVisibility()}function k(){h.fnAddSideEffectPromise=function(e){var t=0;for(;h.aRunningSideEffectExecutions[t];){t++}h.aRunningSideEffectExecutions[t]=e;var a=function(){h.aRunningSideEffectExecutions[t]=null};e.then(a,a)};M.attachEvent("beforeSideEffectExecution",function(e){h.fnAddSideEffectPromise(e.getParameter("promise"))});var e=r.getModel("_templPrivGlobal");var t="/generic/draftIndicatorState";M.attachBeforeQueueItemProcess(function(a){if(a.draftSave){e.setProperty(t,I.Saving)}});M.attachOnQueueCompleted(function(){if(e.getProperty(t)===I.Saving){e.setProperty(t,I.Saved)}});M.attachOnQueueFailed(function(){if(e.getProperty(t)===I.Saving){e.setProperty(t,I.Clear)}});e.setProperty("/generic/appComponentName",r.getMetadata().getComponentName())}function q(){var t=H.processAndExpandHash();var a=r.getId();O.info("Init called for AppComponent "+a);var n=new f(h);V[a]=n;if(c.willRTAStartAfterReload()){O.info("AppComponent "+a+" has been restarted for RTA");n.start(true)}var s={appComponent:r,oTemplateContract:h,application:new v(h),oViewDependencyHelper:new C(h)};h.oViewDependencyHelper=s.oViewDependencyHelper;h.oShellServicePromise=r.getService("ShellUIService").catch(function(){var e=sap.ui.core.service.ServiceFactoryRegistry.get("sap.ushell.ui5service.ShellUIService");return e&&e.createInstance()||Promise.reject()});h.oShellServicePromise.catch(function(){O.warning("No ShellService available")});var l=re().settings;if(l&&l.hasOwnProperty("ghostapp")){l=e({},l);delete l.ghostapp}else{l=l||Object.create(null)}if(l.draftSettings&&l.draftSettings.dataSaveFrequency==="immediate"){h.nDelayedDraftTimerInSeconds=0}r.applySettings(l);(i.prototype.init||Function.prototype).apply(r,arguments);h.appSettings=new o(r);h.oBusyHelper.setBusy(h.oShellServicePromise,undefined,undefined,true);F=L(s);var u=r.getModel();h.bCreateRequestsCanonical=true;var d=u.messageScopeSupported();h.oBusyHelper.setBusy(d,undefined,undefined,true);h.oBusyHelper.setBusy(t,undefined,undefined,true);Promise.all([t,d]).then(function(e){var t=e[1];if(t){u.setPersistTechnicalMessages(true);u.setMessageScope(p.BusinessObject);h.bCreateRequestsCanonical=false}M=new g(u);_();B=new b(h);k();S.enableAutomaticDraftSaving(h);if(!u.oMetadata||!u.oMetadata.isLoaded()||u.oMetadata.isFailed()){u.attachMetadataFailed(function(){B.navigateToMessagePage({title:x("ST_GENERIC_ERROR_TITLE"),text:x("ST_GENERIC_ERROR_SYSTEM_UNAVAILABLE"),icon:"sap-icon://message-error",description:x("ST_GENERIC_ERROR_SYSTEM_UNAVAILABLE_DESC")});for(var e in h.componentRegistry){h.componentRegistry[e].fnViewRegisteredResolve(true)}})}if(r&&r.getMetadata()&&r.getMetadata().getManifest()){A.setAppComponent(r)}A.setApplicationStatus(A.mApplicationStatus.LOADING);A.publishEvent("elements","ViewRenderingStarted",{});var a=r.getComponentData();var n=a&&a.feEnvironment&&a.feEnvironment.isReadOnly&&a.feEnvironment.isReadOnly();var i=sap.ushell&&sap.ushell.Container;if(!n&&i){i.registerDirtyStateProvider(ue)}});K();O.info("Init done for AppComponent "+a)}function Q(){if(h.oNavigationHost){return""}if(r.getFlexibleColumnLayout()){var e=new n;h.oNavigationHost=e;h.aNavigationObservers=[new d({processName:"BeginColumnNavigation",eventHandlers:{attachProcessStart:e.attachBeginColumnNavigate.bind(e),attachProcessStop:e.attachAfterBeginColumnNavigate.bind(e)}}),new d({processName:"MidColumnNavigation",eventHandlers:{attachProcessStart:e.attachMidColumnNavigate.bind(e),attachProcessStop:e.attachAfterMidColumnNavigate.bind(e)}}),new d({processName:"EndColumnNavigation",eventHandlers:{attachProcessStart:e.attachEndColumnNavigate.bind(e),attachProcessStop:e.attachAfterEndColumnNavigate.bind(e)}})];h.oNavigationObserver=new d({processObservers:h.aNavigationObservers});h.aHeaderLoadingObservers=[j(),j(),j()]}else{var t=new a({id:r.getId()+"-appContent"});h.oNavigationHost=t;h.oNavigationObserver=new d({processName:"Navigation",eventHandlers:{attachProcessStart:t.attachNavigate.bind(t),attachProcessStop:t.attachNavigationFinished.bind(t)}})}h.oHeaderLoadingObserver=new d({processObservers:h.aHeaderLoadingObservers||[]});h.oPagesDataLoadedObserver=new d({processObservers:[h.oHeaderLoadingObserver,h.oNavigationObserver]});h.oNavigationHost.addStyleClass(h.oApplicationProxy.getContentDensityClass());h.oBusyHelper=new m(h);h.oBusyHelper.setBusyReason("HashChange",true,true,undefined,true);h.oBusyHelper.getUnbusy().then(function(){h.oShellServicePromise.then(function(e){e.setBackNavigation(h.oApplicationProxy.onBackButtonPressed)})});return h.oNavigationHost}function W(){for(var e in h.componentRegistry){var t=h.componentRegistry[e];t.utils.leaveApp(false)}}function X(){(h.oNavigationControllerProxy?h.oNavigationControllerProxy.leave:Function.prototype)();var e=r.getId();O.info("Exit called for AppComponent "+e);delete V[e];var t=sap.ushell&&sap.ushell.Container;if(t){t.deregisterDirtyStateProvider(ue)}h.ghostapp=true;if(h.oNavigationHost){h.oNavigationHost.destroy()}if(M){M.destroy()}if(B){B.destroy()}if(h.oValidationMessageBinding){h.oValidationMessageBinding.destroy()}if(h.oInsightsFECardProvider){h.oInsightsFECardProvider.unRegisterApplicationAsCardProvider()}A.setAppComponent(null);(i.prototype.exit||Function.prototype).apply(r,arguments);F();P.endApp(s);if(u){u()}O.info("Exit done for AppComponent "+e)}function Y(){for(var e in h.componentRegistry){var t=h.componentRegistry[e];if(t.methods.onSuspend){t.methods.onSuspend()}}W();var a=sap.ushell&&sap.ushell.Container;if(a){a.deregisterDirtyStateProvider(ue)}h.ghostapp=true;h.aStateChangers.forEach(function(e){e.leaveApp()});(h.oNavigationControllerProxy?h.oNavigationControllerProxy.suspend:Function.prototype)();u();u=null}function J(){h.oBusyHelper.setBusyReason("exiting",false);for(var e in h.componentRegistry){var t=h.componentRegistry[e];if(t.methods.onRestore){t.methods.onRestore()}}K();var a=sap.ushell&&sap.ushell.Container;if(a){a.registerDirtyStateProvider(ue)}h.ghostapp=false;h.oNavigationControllerProxy.restore()}function K(){h.leaveAppPromise=new Promise(function(e){u=e})}function Z(e){var t=Object.keys(e).map(function(t){var a=e[t];if(a.pages){a.pages=Z(a.pages)}return e[t]});return t}function $(e){if(e.pages&&t(e.pages)){e.pages=e.pages&&t(e.pages)?Z(e.pages):e.pages}}function ee(e,t){if(!e){return}for(var a=0;a<e.length;a++){var n=e[a];if(n.routingSpec&&n.routingSpec.noOData){n.entitySet=n.routingSpec.routeName;if(t>1){n.navigationProperty=n.routingSpec.routeName}}ee(n.pages,t+1);if(n.embeddedComponents){for(var i in n.embeddedComponents){var o=n.embeddedComponents[i];if(o.pages){o.pages=Z(o.pages);ee(o.pages,t+1)}}}if(n.implementingComponent&&n.implementingComponent.pages){n.implementingComponent.pages=Z(n.implementingComponent.pages);ee(n.implementingComponent.pages,t+1)}}}function te(e){ee(e.pages,0)}function ae(e){if(e){var t=e.entitySet;var a=e.component&&e.component.settings&&e.component.settings.quickVariantSelectionX&&e.component.settings.quickVariantSelectionX.variants||{};var n=function(e){for(var t in e){var a=e[t];if(a.entitySet){return true}}return false};if(n(a)){for(var i in a){var o=a[i];if(o.entitySet===undefined){o.entitySet=t}}}}}function ne(e){ae(e.pages[0])}function ie(e){if(e&&e.objectPageDynamicHeaderTitleWithVM){e.objectPageHeaderType=e.objectPageHeaderType||"Dynamic";e.objectPageVariantManagement=e.objectPageVariantManagement||"VendorLayer"}}var oe;function re(){if(!oe){oe=r.getManifestEntry("sap.ui.generic.app");if(Object.keys(oe).length===0){return oe}$(oe);te(oe);ne(oe);ie(oe.settings)}return oe}var se;function le(){if(!se){se=e({},r.getMetadata().getManifest());se["sap.ui.generic.app"]=re()}return se}function pe(){var e=r.getFlexibleColumnLayout()?"f":"m";return"sap."+e+".routing.Router"}function ue(e){return!h.ghostapp&&h.oDataLossHandler.getShellDataLossPopup(e)}var ce;var ge=false;function de(){ge=false;var e=r.getModel();e.invalidate();for(var t in h.componentRegistry){var a=h.componentRegistry[t];a.utils.refreshBindingUnconditional()}return Promise.resolve()}var fe={init:q,createContent:Q,exit:X,suspend:Y,restore:J,_getRouterClassName:pe,getConfig:re,getInternalManifest:le,getTransactionController:function(){return M.getTransactionController()},getApplicationController:function(){return M},getNavigationController:function(){return B},navigateBasedOnStartupParameter:function(e){if(ge){var t=de();h.oBusyHelper.setBusy(t)}ce=e;h.oBusyHelper.getUnbusy().then(function(){if(!ce||h.oBusyHelper.isBusy()){ce=null;return}var e=h.oNavigationControllerProxy.clearHistory().then(N.parametersToNavigation.bind(null,h,ce));h.oBusyHelper.setBusy(e);ce=null})},refreshForStartupParameter:function(e,t){ge=true;if(t){var a=de();h.oBusyHelper.setBusy(a)}}};var $=P.testable($,"fnNormalizePagesMapToArray");re=P.testable(re,"getConfig");P.testable(K,"AppComponent_setLeaveAppPromise");return fe}return i.extend("sap.suite.ui.generic.template.lib.AppComponent",{metadata:{config:{title:"SAP UI Application Component",fullWidth:true},properties:{forceGlobalRefresh:{type:"boolean",defaultValue:false},considerAnalyticalParameters:{type:"boolean",defaultValue:false},showDraftToggle:{type:"boolean",defaultValue:true},objectPageHeaderType:{type:"string",defaultValue:"Static"},objectPageVariantManagement:{type:"string",defaultValue:"None"},flexibleColumnLayout:{type:"object",defaultValue:null},inboundParameters:{type:"object",defaultValue:null},tableColumnVerticalAlignment:{type:"string",defaultValue:"Middle"},useColumnLayoutForSmartForm:{type:"boolean",defaultValue:true},objectPageColumns:{type:"object",properties:{screenSizeXL:{type:"int",defaultValue:6}}},statePreservationMode:{type:"string",defaultValue:"auto"},enableAutoColumnWidthForSmartTable:{type:"boolean",defaultValue:true},draftDiscardConfirmationSettings:{type:"object",defaultValue:{enabled:"always"}},collaborationSettings:{type:"object",defaultValue:{isShareAsCardEnabled:true}}},events:{pageDataLoaded:{}},routing:{config:{async:true,viewType:"XML",viewPath:"",clearTarget:false},routes:[],targets:[]},library:"sap.suite.ui.generic.template",designtime:{tool:{start:function(e){var t=e.getId();O.info("Ui Adaptation started for AppComponent "+t);var a=V[t];a.start()},stop:function(e){var t=e.getId();O.info("Ui Adaptation stopped for AppComponent "+t);var a=V[t];a.stop()}}}},suppressDataLossPopup:function(){return false},constructor:function(){var t=P.startApp();e(this,_(this,t));(i.prototype.constructor||Function.prototype).apply(this,arguments)}})});
//# sourceMappingURL=AppComponent.js.map