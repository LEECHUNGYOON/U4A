sap.ui.define(["sap/fe/navigation/SelectionVariant","sap/suite/ui/generic/template/AnalyticalListPage/extensionAPI/ExtensionAPI","sap/suite/ui/generic/template/AnalyticalListPage/controller/FilterBarController","sap/suite/ui/generic/template/listTemplates/controller/ToolbarController","sap/suite/ui/generic/template/AnalyticalListPage/controller/VisualFilterBarController","sap/suite/ui/generic/template/AnalyticalListPage/controller/VisualFilterDialogController","sap/suite/ui/generic/template/AnalyticalListPage/controller/AnalyticGridController","sap/ui/table/AnalyticalTable","sap/ui/model/odata/AnnotationHelper","sap/ui/model/analytics/odata4analytics","sap/suite/ui/generic/template/AnalyticalListPage/controller/ContentAreaController","sap/suite/ui/generic/template/listTemplates/controller/IappStateHandler","sap/ui/Device","sap/m/SegmentedButtonItem","sap/suite/ui/generic/template/AnalyticalListPage/util/AnnotationHelper","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/base/util/ObjectPath","sap/suite/ui/generic/template/lib/ShareUtils","sap/base/util/merge","sap/base/util/deepExtend","sap/suite/ui/generic/template/listTemplates/listUtils","sap/suite/ui/generic/template/listTemplates/controller/MultipleViewsHandler","sap/suite/ui/generic/template/js/StableIdHelper","sap/suite/ui/generic/template/listTemplates/controller/MessageStripHelper","sap/ui/model/json/JSONModel","sap/ui/comp/personalization/Util","sap/suite/ui/generic/template/lib/insights/InsightsHandler","sap/suite/ui/generic/template/genericUtilities/metadataAnalyser","sap/suite/ui/generic/template/genericUtilities/filterHelper"],function(e,t,a,r,n,i,o,l,s,d,c,g,u,p,f,m,v,C,S,h,F,b,y,P,I,T,A,H,B,D){"use strict";var E=new v("AnalyticalListPage.controller.ControllerImplementation");var M=E.getLogger();var V=E.Level;var w="chart",_="visual",U="compact",R=900;return{getMethods:function(v,E,O){var L={};L.oRefreshTimer=null;L.nRefreshInterval=0;L.bVisualFilterInitialised=false;L._bIsStartingUp=true;var x=false;function N(e){L.oRefreshTimer=setTimeout(function(){var e=O.getOwnerComponent();var t=e.getModel("_templPriv");if(!t.getProperty("/alp/filterChanged")){v.refreshBinding()}},e)}function K(e){if(L.nRefreshInterval!==0){if(L.oRefreshTimer!==null){clearTimeout(L.oRefreshTimer)}if(!e){N(L.nRefreshInterval)}}}function k(){var e=O.getOwnerComponent();var t=e.getModel("_templPriv");t.setProperty("/listReport/isLeaf",e.getIsLeaf())}function j(e,t){var a=e&&e.property;return a.filter(function(e){return typeof e[t]!=="undefined"})}function z(t){var a=t.getModel(),r=a&&a.getMetaModel(),n=r&&r.getODataEntityType(B.getEntityTypeNameFromEntitySetName(t.getEntitySet(),r)),i,o=r&&r.getODataEntityType(B.getEntityTypeNameFromEntitySetName(t.getEntitySet(),r),true),l=f.createSVAnnotation(n,r,L.oController.getOwnerComponent().getQualifier());if(L.oController.getOwnerComponent().getFilterDefaultsFromSelectionVariant()&&l){i=b.createSVObject(h({},l),t)}else{if(L.oController.getOwnerComponent().getFilterDefaultsFromSelectionVariant()&&!l){M.warning("No SelectionVariant found in the annotation : No default values filled in FilterBar")}var c=n&&j(n,"com.sap.vocabularies.Common.v1.FilterDefaultValue"),g,u,p,m,v,C=[];try{g=new d.Model(new d.Model.ReferenceByModel(a));v=g&&g.findQueryResultByName(t.getEntitySet());u=v&&v.getParameterization();p=u&&r.getODataEntitySet(u.getEntitySet().getQName());m=p&&r.getODataEntityType(p.entityType);C=m?j(m,"defaultValue"):[]}catch(e){M.error(e)}if(c.length>0||C.length>0){i=new e;c.forEach(function(e){var t=r.createBindingContext(o+"/property/[${path:'name'}==='"+e.name+"']/com.sap.vocabularies.Common.v1.FilterDefaultValue");i.addSelectOption(e.name,"I","EQ",s.format(t))});C.forEach(function(e){i.addParameter(e.name,e.defaultValue)})}}return i}function G(e){var t=e.getSource();t.suspendSetFilterData();var a=z(t);if(a){L.oIappStateHandler.fnSetFiltersUsingUIState(a.toJSONObject(),{},true,false)}L.oIappStateHandler.onSmartFilterBarInitialise();O.onInitSmartFilterBarExtension(e);O.templateBaseExtension.onInitSmartFilterBar(e)}function q(){var e=L.oController.getOwnerComponent();if(L.hideVisualFilter||e.getDefaultFilterMode()=="visual"&&e.getModel().mMetadataUrlParams&&e.getModel().mMetadataUrlParams["sap-value-list"]==="none"){if(L.alr_visualFilterBar&&!L.alr_visualFilterBar.getAssociateValueListsCalled()){L.alr_visualFilterBar.setAssociateValueListsCalled(true)}L.oSmartFilterbar.associateValueLists()}var t=L.oIappStateHandler.onSmartFilterBarInitialized();t.then(function(){L._bIsStartingUp=false;if(L.bVisualFilterInitialised){L.oIappStateHandler.fnUpdateVisualFilterBar()}if(L.sNavType!==sap.fe.navigation.NavType.iAppState){L.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()}},function(e){if(e instanceof Error){e.showMessageBox()}L.oIappStateHandler.fnOnError();L._bIsStartingUp=false}).finally(function(){if(L.oSmartFilterableKPI){var e=L.oSmartFilterableKPI.getContent();e.forEach(function(e){if(e.getSmartFilterId){e._bStopDataLoad=false;e._updateKpiList(true)}})}})}function W(e){var t=e.getSource(),a=e.getParameters().limitReached,r=t.getSelectedIndices(),n,i;if(r.length>0){if(a){n="Your last selection was limited to the maximum of "+t.getLimit()+" items.";E.oServices.oApplication.showMessageToast(n)}}i=t.getParent();E.oCommonUtils.setEnabledToolbarButtons(i)}function J(e){var t=e.getParameters();var a=e.getSource();E.oCommonEventHandlers.onSemanticObjectLinkNavigationPressed(a,t)}function Q(e){var t,a;t=e.getParameters();a=e.getSource();E.oCommonEventHandlers.onSemanticObjectLinkNavigationTargetObtained(a.getEntitySet(),a.getFieldSemanticObjectMap(),t,L)}function X(e){var t=L.oSmartFilterbar;var a=[];if(e.fetchVariant()&&e.fetchVariant().filter&&e.fetchVariant().filter.filterItems){a=e.fetchVariant().filter.filterItems}var r={search:!!t.getBasicSearchValue(),filter:!!(a.length||t.retrieveFiltersWithValues().length)};return r}function $(e){var t=e.getId();var a=X(e);var r="";if(a.search||a.filter){r=E.oCommonUtils.getContextText("NOITEMS_SMARTCHART_WITH_FILTER",t)}else{r=E.oCommonUtils.getContextText("NOITEMS_SMARTCHART",t)}e.getChartAsync().then(function(e){e.setCustomMessages({NO_DATA:r})})}function Y(e){var t=function(){var e=E.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(L.oSmartChart);var t=e.getModel().getMetaModel();var a=t.getODataEntitySet(e.getEntitySet()).entityType;var r=L.oSmartTable.getTable();var n=r.getBinding("rows")||r.getBinding("items");var i=n&&n.getDownloadUrl();var o=n.aApplicationFilter||n.aApplicationFilters;if(!o.length){return Promise.resolve({sServiceUrl:i})}var l=L.oSmartFilterbar.getFilterData();var s=D.getFilterParams(t,a,o,l);if(s){i=E.oCommonUtils.fnReplaceFiltersWithGetDownloadUrl(i,s);return Promise.resolve({sServiceUrl:i})}else{return Promise.resolve({sServiceUrl:""})}};var a={sharePageToPressed:function(e){var t=E.oServices.oApplication.getBusyHelper();if(t.isBusy()){return}var a=E.oServices.oApplication.getAppTitle();var r=S.getCurrentUrl().then(function(t){switch(e){case"Email":a=E.oCommonUtils.getText("EMAIL_HEADER",[a]);sap.m.URLHelper.triggerEmail(null,a,t);break;default:break}});t.setBusy(r)},shareJamPressed:function(){S.openJamShareDialog(E.oServices.oApplication.getAppTitle())},shareTilePressed:function(){S.fireBookMarkPress()},getServiceUrl:function(){return t().then(function(e){if(e.sServiceUrl){e.sServiceUrl=e.sServiceUrl?e.sServiceUrl+"&$top=0&$inlinecount=allpages":""}var t={serviceUrl:e.sServiceUrl};O.onSaveAsTileExtension(t);return t.serviceUrl})},getModelData:function(){var e=C.get("sap.ushell.Container.getUser");var t=O.getOwnerComponent().getAppComponent();var r=t.getManifestEntry("sap.ui");var n=t.getManifestEntry("sap.app");return a.getServiceUrl().then(function(t){return S.getCurrentUrl().then(function(a){return{serviceUrl:t,icon:r&&r.icons?r.icons.icon:"",title:n?n.title:"",isShareInJamActive:!!e&&e().isJamActive(),customUrl:S.getCustomUrl(),currentUrl:a}})})}};S.openSharePopup(E.oCommonUtils,e,a)}return{onInit:function(){var e=O.getOwnerComponent();M.setLevel(V.WARNING,"ALPSmartFilterBar");var t=e.getModel("_templPriv");t.setProperty("/alp",{filterMode:e.getHideVisualFilter()?U:e.getDefaultFilterMode(),contentView:e.getDefaultContentView(),autoHide:e.getAutoHide(),visibility:{hybridView:u.system.phone||u.system.tablet&&!u.system.desktop?false:true},filterChanged:false});L.hideVisualFilter=e.getHideVisualFilter();L.hideVisualFilter=L.hideVisualFilter===undefined||L.hideVisualFilter!==true?false:true;L.quickVariantSelectionX=e.getQuickVariantSelectionX();L.oSmartFilterbar=O.byId("template::SmartFilterBar");L.oSmartTable=O.byId("table");L.oSmartFilterableKPI=O.byId("template::KPITagContainer::filterableKPIs");L.oPage=O.byId("template::Page");L.oSmartChart=O.byId("chart");var i=new y(L,O,E);L.oMultipleViewsHandler=i;L.oMessageStripHelper=new I(E.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(L.oSmartTable),i,O,E,"alp");if(O.getOwnerComponent().getProperty("dshQueryName")){L.oAnalyticGridContainer=O.byId("template::AnalyticGridContainer");L.oAnalyticGridController=new o;L.oAnalyticGridController.setState(L)}L.alr_compactFilterContainer=O.byId("template::CompactFilterContainer");L.alr_visualFilterContainer=O.byId("template::VisualFilterContainer");L.alr_filterContainer=O.byId("template::FilterContainer");L.alr_visualFilterBar=O.byId("template::VisualFilterBar");var s="";if(L.quickVariantSelectionX){s=i.getSelectedKey()}var d=P.getStableId({type:"ALPTable",subType:"ColumnListItem",sQuickVariantKey:s});L.alp_ColumnListItem=O.byId(d);if(L.alr_visualFilterBar){var p=e.getFilterSettings();if(p&&Object.keys(p).length>0){L.alr_visualFilterBar.setFilterSettings(p)}L.alr_visualFilterBar.setSmartFilterId(L.oSmartFilterbar.getId());L.alr_visualFilterBar.attachOnFilterItemAdded(function(e){var t=e.getParameters();t.attachBeforeRebindVisualFilter(function(e){var t=e.getParameters();var a=t.sEntityType;var r=t.sDimension;var n=t.sMeasure;var i=t.oContext;var o=L.oController;o.onBeforeRebindVisualFilterExtension(a,r,n,i)})})}L.oKpiTagContainer=O.byId("template::KPITagContainer::globalKPIs");L.oFilterableKpiTagContainer=O.byId("template::KPITagContainer::filterableKPIs");if(L.oKpiTagContainer||L.oFilterableKpiTagContainer){sap.ui.require(["sap/suite/ui/generic/template/AnalyticalListPage/controller/KpiTagController"],function(e){e.init(L)})}L.oContentArea=new c;L.oTemplateUtils=E;L.toolbarController=new r;L.oController=O;L.filterBarController=new a;L.filterBarController.init(L);L.oContentArea.createAndSetCustomModel(L);L.oInsightsHandler=new H(L,O,E);L.oMultipleViewsHandler.getInitializationPromise().then(function(){L.oContentArea.setState(L)});var f=E.oServices.oInsightsFECardProvider&&E.oServices.oInsightsFECardProvider.getCardProviderInsightsInstance();if(f&&!E.oCommonUtils.isMultiViewMultiEntity()){E.oServices.oInsightsFECardProvider.fnRegisterComponentForProvider(L.oInsightsHandler,O.getView().getId());t.bindProperty("/alp/filterChanged").attachChange(function(e){if(!e.getSource().getValue()){var t=E.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(L.oSmartChart);var a=L.oInsightsHandler.getCardsToShare("Analytical",t);f.onViewUpdate(true,a)}else{f.onViewUpdate(true,[])}})}if(!L.hideVisualFilter){L.visualFilterBarContainer=new n;L.visualFilterBarContainer.init(L)}if(L.alr_visualFilterBar){L.alr_visualFilterBar.addEventDelegate({onAfterRendering:function(){if(L.oSmartFilterbar.isInitialised()){L.oSmartFilterbar.setFilterData({_CUSTOM:L.oIappStateHandler.getFilterState()})}}})}L.oIappStateHandler=new g(L,O,E);k();O.byId("template::FilterText").attachBrowserEvent("click",function(){O.byId("template::Page").setHeaderExpanded(true)});t.setProperty("/listReport/isHeaderExpanded",true);t.setProperty("/generic/bDataAreShownInChart",false);if(L.oSmartTable){var C=L.oSmartTable.getTable()}var S="sapUiSizeCozy",h="sapUiSizeCompact",b="sapUiSizeCondensed";if(m.isUiTable(C)||C instanceof l){var T=O.getView();var A=document.body;if(A.classList.contains(S)||T.hasStyleClass(S)){L.oSmartTable.addStyleClass(S)}else if(A.classList.contains(h)||T.hasStyleClass(h)){var B=e.getCondensedTableLayout();if(B===false){L.oSmartTable.addStyleClass(h)}else{L.oSmartTable.addStyleClass(b)}}}if(L.oSmartFilterableKPI){L.oSmartFilterableKPI.setModel(e.getModel("_templPriv"),"_templPriv");var D=L.oSmartFilterableKPI.getContent(),w=L.oController;D.forEach(function(e){if(e.getSmartFilterId){e.attachBeforeRebindFilterableKPI(function(e){var t=e.getParameters(),a=t.selectionVariant,r=t.entityType,n=e.getSource().getId();w.onBeforeRebindFilterableKPIExtension(a,r,n)},w)}})}v.getUrlParameterInfo=function(){return L.oIappStateHandler.getUrlParameterInfo()};v.onComponentActivate=function(){};v.refreshBinding=function(){if(L.alr_visualFilterBar&&L.alr_visualFilterBar.updateVisualFilterBindings){L.alr_visualFilterBar.updateVisualFilterBindings()}if(L.oSmartChart&&L.oSmartChart.rebindChart){L.oSmartChart.rebindChart()}if(L.oSmartTable){E.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(L.oSmartTable).refresh()}if(L.oKpiTagContainer){var e=L.oKpiTagContainer.mAggregations.content;for(var t in e){if(e[t]._createGlobalKpi){e[t]._createGlobalKpi()}}}if(L.oFilterableKpiTagContainer){var e=L.oFilterableKpiTagContainer.mAggregations.content;for(var t in e){if(e[t]._createFilterableKpi){e[t]._createFilterableKpi()}}}K()};v.onSuspend=function(){K(true)};v.onRestore=function(){if(L.nRefreshInterval){N(L.nRefreshInterval)}};if(L.alr_visualFilterBar){L.alr_visualFilterBar.attachInitialized(function(e){L.bVisualFilterInitialised=true;if(!L._bIsStartingUp){L.oIappStateHandler.fnUpdateVisualFilterBar(true)}})}L.oSmartFilterbar.attachFilterChange(function(t){var a=e.getModel("_templPriv");L.oIappStateHandler.fnCheckMandatory();var r=L.oSmartFilterbar.isDialogOpen();var n=t.getSource(),i;i=F({},n.getFilterData(true));if(r&&L.visualFilterDialogContainer){var o=L.visualFilterDialogContainer.oVerticalBox.getModel("_dialogFilter");o.setData(i)}else{var l=L.oController.getOwnerComponent().getModel("_filter");l.setData(i)}if(t.getParameters().filterItem){if(!L.hideVisualFilter){L.filterBarController.changeVisibility(t)}a.setProperty("/alp/_ignoreChartSelections",false)}L.filterBarController._updateFilterLink();if(!L.oSmartFilterbar.isLiveMode()&&!L.oSmartFilterbar.isDialogOpen()){a.setProperty("/alp/filterChanged",true)}});var T=O.getView();var A=document.body;var _,x;if(A.classList.contains(S)||T.hasStyleClass(S)){_=true}if(_&&e.getTableType()!=="ResponsiveTable"){var j=e.getModel("_templPriv");if(u.resize.height<=R){x=j.getProperty("/alp/contentView");j.setProperty("/alp/enableHybridMode",false);j.setProperty("/alp/contentView",x==="charttable"?"chart":x)}L.resizeHandler=function(e){var t=e.height;if(t<=R){x=j.getProperty("/alp/contentView");j.setProperty("/alp/enableHybridMode",false);j.setProperty("/alp/contentView",x==="charttable"?"chart":x)}else{j.setProperty("/alp/enableHybridMode",true)}};u.resize.attachHandler(L.resizeHandler)}if(e.getRefreshIntervalInMinutes()){L.nRefreshInterval=e.getRefreshIntervalInMinutes();L.nRefreshInterval=(L.nRefreshInterval<1?1:L.nRefreshInterval)*6e4}var z=O.byId(P.getStableId({type:"ALPAction",subType:"Share"})+"-internalBtn");if(z){z.attachPress(function(){Y(z)})}},attachRefreshInterval:N,clearingRefreshTimerInterval:K,onExit:function(){if(L.resizeHandler){u.resize.detachHandler(L.resizeHandler)}if(L.oRefreshTimer!==null){clearTimeout(L.oRefreshTimer)}},handlers:{onBack:function(){E.oServices.oNavigationController.navigateBack()},onSmartTableInit:function(e){var t=e.getSource(),a=t.getToolbar(),r=a.getContent(),n;t.setHeight("100%");E.oCommonUtils.checkToolbarIntentsSupported(t);if(L._pendingTableToolbarInit){if(!L.oSmartFilterableKPI&&!L.oMultipleViewsHandler.getMode()){a.insertContent(L.alr_viewSwitchButtonOnTable,r.length)}}if(L._pendingTableToolbarInit){for(var i=0;i<r.length;i++){if(r[i].mProperties.text==="Settings"){n=i}}a.insertContent(L._autoHideToggleBtn,n)}delete L._pendingTableToolbarInit;t.attachShowOverlay(function(e){t.getToolbar().setEnabled(!e.getParameter("overlay").show)});var o=new T({highlightMode:"rebindTable"});t.setModel(o,"_tableHighlight");E.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(t).addCellSelector()},onBeforeRebindTable:function(e){var t=e.getSource();var a=e.getParameter("bindingParams");L.oMessageStripHelper.onBeforeRebindControl(e);if(L.chartController&&L.chartController.oChart){var r=L.chartController.oChart,n=L.chartController._chartInfo;n.drillStack=L.chartController.oChart.getDrillStack();var i=n.drillStack&&n.drillStack.length>0?n.drillStack[n.drillStack.length-1]:undefined}var o=O.getOwnerComponent().getModel("_templPriv");var l=o.getProperty("/alp/contentView");if(l===w){a.preventTableBind=true;x=true}var s=o.getProperty("/alp/_ignoreChartSelections");if(L.detailController.isFilter()&&L.oSmartChart&&!s){L.detailController._applyChartSelectionOnTableAsFilter(e,r)}if(L.detailController.isFilter()&&i&&i.filter){a.filters.push(i.filter)}var d=[];var c=t.getTable().getColumns();for(var g=0;g<c.length;g++){var u=c[g];if(u.getGrouped&&u.getGrouped()){d.push(u.getLeadingProperty?u.getLeadingProperty():A.getColumnKey(u))}}L.detailController._updateExpandLevelInfo(d);if(O.getOwnerComponent().getModel().getDefaultCountMode()==="None"&&t._isAnalyticalTable){a.parameters.provideTotalResultSize=false;t.setShowRowCount(false)}O.onBeforeRebindTableExtension(e);L.oMultipleViewsHandler.aTableFilters=F({},a.filters);var p=a.events.refresh||Function.prototype;a.events.refresh=function(e){L.oMultipleViewsHandler.onDataRequested();p.call(this,e)};var f=a.events.dataRequested||Function.prototype;a.events.dataRequested=function(e){L.detailController.onSmartTableDataRequested(t);f.call(this,e)};var m=a.events.dataReceived||Function.prototype;a.events.dataReceived=function(e){L.oContentArea.enableToolbar();E.oCommonEventHandlers.onDataReceived(t);E.oComponentUtils.hidePlaceholder();m.call(this,e)};E.oCommonEventHandlers.onBeforeRebindTable(e,{setBindingPath:t.setTableBindingPath.bind(t),ensureExtensionFields:O.templateBaseExtension.ensureFieldsForSelect,addExtensionFilters:O.templateBaseExtension.addFilters,resolveParamaterizedEntitySet:L.oMultipleViewsHandler.resolveParameterizedEntitySet,isMandatoryFiltersRequired:false,isFieldControlRequired:false,isPopinWithoutHeader:false,isDataFieldForActionRequired:false,isFieldControlsPathRequired:false});var v=a.filters.slice(0);L.oMultipleViewsHandler.onRebindContentControl(a,v);t.getModel("_tableHighlight")&&t.getModel("_tableHighlight").setProperty("/highlightMode","rebindTable");L.detailController._applyCriticalityInfo(e,t);b.handleErrorsOnTableOrChart(E,e,L)},onSelectionDetailsActionPress:function(e){L.oMultipleViewsHandler.onDetailsActionPress(e)},addEntry:function(e){var t=e.getSource();E.oCommonEventHandlers.addEntry(t,false,L.oSmartFilterbar)},deleteEntries:function(e){E.oCommonEventHandlers.deleteEntries(e)},onSelectionChange:function(e){var t=e.getSource(),a=t.getModel(),r=t.getModel("_templPriv");var n=a.getMetaModel(),i=n.getODataEntitySet(this.getOwnerComponent().getEntitySet()),o=i["Org.OData.Capabilities.V1.DeleteRestrictions"];var l=o&&o.Deletable&&o.Deletable.Path?o.Deletable.Path:"";var s=false;var d=true;var c=l&&l!=="";var g=E.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(E.oCommonUtils.getOwnerPresentationControl(t)).getSelectedContexts();if(g.length>0){for(var u=0;u<g.length;u++){var p=a.getObject(g[u].getPath());if(!(p.IsActiveEntity&&p.HasDraftEntity&&p.DraftAdministrativeData&&p.DraftAdministrativeData.InProcessByUser)){d=false}if(c){if(a.getProperty(l,g[u])){c=false}}if(!d&&!c){s=true;break}}}r.setProperty("/listReport/deleteEnabled",s)},onMultiSelectionChange:W,onChange:function(e){E.oCommonEventHandlers.onChange(e)},onContactDetails:function(e){E.oCommonEventHandlers.onContactDetails(e)},onSmartFilterBarInitialise:G,onSmartFilterBarInitialized:q,onEditStateFilterChanged:function(e){e.getSource().fireChange()},onFilterPress:function(e){L.filterBarController.showDialog.call(L.filterBarController)},onClearPress:function(e){L.filterBarController.clearFilters();O.onClearFilterExtension(e)},onGoPress:function(e){L.filterBarController.fnCheckMandatory();var t=L.oSmartFilterbar.isDialogOpen();if(!t){L.filterBarController.onGoFilter()}},onBeforeSFBVariantSave:function(){if(L.oSmartFilterbar.isDialogOpen()&&!L.hideVisualFilter){L.visualFilterDialogContainer._updateFilterBarFromDialog.call(L.visualFilterDialogContainer)}var e=L.oIappStateHandler.getCurrentAppState();if(!this.getOwnerComponent().getProperty("smartVariantManagement")){delete e.customData["sap.suite.ui.generic.template.genericData"].contentView}var t=L.oSmartFilterbar.getFilterData(true);var a,r=L.oSmartFilterbar.getBasicSearchControl();if(r&&r.getValue){a=r.getValue()}t._CUSTOM=e.customData;t._CUSTOM["sap.suite.ui.generic.template.genericData"].variantDirty=false;L.oSmartFilterbar.setFilterData(t,true);if(a){L.oSmartFilterbar.getBasicSearchControl().setValue(a)}L.oSmartFilterbar.fireFilterChange()},onAfterSFBVariantLoad:function(e){if(!L.oSmartFilterbar.isDialogOpen()){L.filterBarController._afterSFBVariantLoad();if(L.oSmartFilterableKPI&&!L.oSmartFilterbar.isLiveMode()){var t=L.oSmartFilterableKPI.getContent();t.forEach(function(t){if(t.getSmartFilterId){if(e.getParameter("executeOnSelect")){t.bSearchTriggred=true}}})}}},onBeforeRebindChart:function(e){var t=e.getSource();$(t);var a=e.getParameters().bindingParams;L.oMultipleViewsHandler.aTableFilters=F({},a.filters);var r=a.filters.slice(0);var n={setBindingPath:t.setChartBindingPath.bind(t),ensureExtensionFields:Function.prototype,addExtensionFilters:O.templateBaseExtension.addFilters,resolveParamaterizedEntitySet:L.oMultipleViewsHandler.resolveParameterizedEntitySet,isFieldControlRequired:false,isMandatoryFiltersRequired:true};O.onBeforeRebindChartExtension(e);var i=a.events.dataReceived||Function.prototype;a.events.dataReceived=function(e){if(!t.getToolbar().getEnabled()){L.oContentArea.enableToolbar()}E.oComponentUtils.hidePlaceholder();i.call(this,e)};E.oCommonUtils.onBeforeRebindTableOrChart(e,n,L.oSmartFilterbar);L.oMultipleViewsHandler.onRebindContentControl(a,r);b.handleErrorsOnTableOrChart(E,e,L)},onListNavigate:function(e){E.oCommonEventHandlers.onListNavigate(e,L)},onCallActionFromToolBar:function(e){var t=E.oCommonUtils.getParentTable;E.oCommonUtils.getParentTable=function(){return L.oSmartTable};E.oCommonEventHandlers.onCallActionFromToolBar(e,L);E.oCommonUtils.getParentTable=t;t=null},onCallActionFromList:function(e){},onDataFieldForIntentBasedNavigation:function(e){E.oCommonEventHandlers.onDataFieldForIntentBasedNavigation(e,L)},onDataFieldWithEmail:function(e){E.oCommonEventHandlers.onDataFieldWithEmail(e)},onDataFieldWithIntentBasedNavigation:function(e){E.oCommonEventHandlers.onDataFieldWithIntentBasedNavigation(e,L)},onBeforeSemanticObjectLinkPopoverOpens:function(e){var t=e.getSource();var a=L.oSmartFilterbar.getUiState({allFilters:false}).getSelectionVariant();if(L.oSmartFilterbar.getEntitySet()!==t.getEntitySet()){a.FilterContextUrl=E.oServices.oApplication.getNavigationHandler().constructContextUrl(t.getEntitySet(),t.getModel())}var r=JSON.stringify(a);E.oCommonUtils.semanticObjectLinkNavigation(e,r,O)},onAssignedFiltersChanged:function(e){if(e&&e.getSource()){if(L&&L.oSmartFilterbar&&L.filterBarController){O.byId("template::FilterText").setText(L.oSmartFilterbar.retrieveFiltersWithValuesAsText())}}},onToggleFiltersPressed:function(){var e=O.getOwnerComponent();var t=e.getModel("_templPriv");t.setProperty("/listReport/isHeaderExpanded",t.getProperty("/listReport/isHeaderExpanded")===true?false:true)},onSearchButtonPressed:function(){if(u.system.phone&&L.oPage.getHeaderExpanded()){L.oPage.setHeaderExpanded(false)}var e=O.getOwnerComponent().getModel();L.oController.getOwnerComponent().getModel("_templPriv").setProperty("/alp/filterChanged",false);L.oController.getOwnerComponent().getModel("_templPriv").setProperty("/generic/bDataAreShownInChart",true);e.attachEventOnce("requestSent",function(){if(!L._bIsStartingUp){L.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()}else{L.oIappStateHandler.fnResolveStartUpPromise()}});L.oController.getOwnerComponent().getModel("_templPriv").setProperty("/alp/_ignoreChartSelections",true);if(L.oSmartTable){E.oCommonUtils.refreshModel(L.oSmartTable.getEntitySet())}else{E.oCommonUtils.refreshModel(L.oSmartChart.getEntitySet())}K()},onSemanticObjectLinkNavigationPressed:J,onSemanticObjectLinkNavigationTargetObtained:Q,onAfterTableVariantSave:function(){L.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()},onAfterApplyTableVariant:function(){L.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()},onAfterChartVariantSave:function(e){L.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL();E.oCommonUtils.setEnabledToolbarButtons(e.getSource())},onAfterApplyChartVariant:function(){L.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()},onFilterModeSegmentedButtonChange:function(e){L.filterBarController.handleFilterSwitch(e.getParameter("key"),e.oSource._bApplyingVariant);L.oController._templateEventHandlers.onSegmentButtonPressed();L.filterBarController.fnCheckMandatory()},onContentViewSegmentButtonPressed:function(e){if(e.getParameter("key")==="crosstable"&&!L.oAnalyticGrid){L.oAnalyticGridController.initAnalyticGrid()}var t=e.getSource().getSelectedKey();if((t==="table"||t==="charttable")&&x){L.oSmartTable.rebindTable();x=false}if(!L.oSmartFilterableKPI&&!L.oController.getOwnerComponent().getContentTitle()){var a=L.oController.getView(),r;if(t==="customview1"){r="template::contentViewExtensionToolbar"}else if(t==="customview2"){r="template::contentViewExtension2Toolbar"}else if(t==="chart"||t==="charttable"){r=a.byId("template::masterViewExtensionToolbar")?"template::masterViewExtensionToolbar":"template::ChartToolbar"}else if(t==="table"){r="template::TableToolbar"}L.oController._templateEventHandlers.setFocusOnContentViewSegmentedButtonItem(a,r)}L.oController._templateEventHandlers.onSegmentButtonPressed(!L.oController.getOwnerComponent().getProperty("smartVariantManagement"))},setFocusOnContentViewSegmentedButtonItem:function(e,t){var a=e.byId(t);if(a){var r=a.getContent().length,n=a.getContent()[r-1];if(n){n.addEventDelegate({onAfterRendering:function(e){e.srcControl.focus()}})}}},onSegmentButtonPressed:function(e){if(!e){L.oController.byId("template::PageVariant").currentVariantSetModified(true);L.oSmartFilterbar.setFilterData({_CUSTOM:L.oIappStateHandler.getFilterState()})}L.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()},onShareListReportActionButtonPress:function(e){E.oCommonUtils.executeIfControlReady(Y,P.getStableId({type:"ALPAction",subType:"Share"})+"-internalBtn")},onDeterminingDataFieldForAction:function(e){var t=L.oController.getOwnerComponent().getModel("_templPriv");var a=t.getProperty("/alp/contentView");var r=E.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(a===w?L.oSmartChart:L.oSmartTable);E.oCommonEventHandlers.onDeterminingDataFieldForAction(e,r)},onDeterminingDataFieldForIntentBasedNavigation:function(e){var t=e.getSource();var a=L.oController.getOwnerComponent().getModel("_templPriv");var r=a.getProperty("/alp/contentView");var n=E.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(r===w?L.oSmartChart:L.oSmartTable).getSelectedContexts();E.oCommonEventHandlers.onDeterminingDataFieldForIntentBasedNavigation(t,n,L.oSmartFilterbar)},onInlineDataFieldForAction:function(e){E.oCommonEventHandlers.onInlineDataFieldForAction(e)},onInlineDataFieldForIntentBasedNavigation:function(e){E.oCommonEventHandlers.onInlineDataFieldForIntentBasedNavigation(e.getSource(),L)},onAutoHideToggle:function(){L.oSmartTable.getModel("_tableHighlight").setProperty("/highlightMode","eyeModeSwitch");L.chartController&&L.chartController._updateTable();L.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL()},onFullScreenToggled:function(e){var t=e.getParameter("fullScreen");var a=e.getSource().getModel("_templPriv");a.setProperty("/alp/fullScreen",t)},onDialogClosed:function(e){L.visualFilterDialogContainer._closeDialog.call(L.visualFilterDialogContainer,e)},onDialogOpened:function(e){if(!L.visualFilterDialogContainer){L.visualFilterDialogContainer=new i;L.visualFilterDialogContainer.init(L)}var t=L.oController.getView().getModel("_templPriv"),a=_,r={},n;n=t.getProperty("/alp/searchable");if(!n){if(L.alr_visualFilterBar&&!L.alr_visualFilterBar.getAssociateValueListsCalled()){L.alr_visualFilterBar.setAssociateValueListsCalled(true);L.oSmartFilterbar.associateValueLists()}}r.item=new p({icon:"sap-icon://filter-analytics",tooltip:"{i18n>FILTER_VISUAL}",key:a,enabled:"{_templPriv>/alp/searchable}"});r.selectionChange=function(e){L.visualFilterDialogContainer._toggle.call(L.visualFilterDialogContainer,e)};r.content=L.visualFilterDialogContainer._createForm();r.search=function(e){L.visualFilterDialogContainer._triggerSearchInFilterDialog.call(L.visualFilterDialogContainer,e)};r.filterSelect=function(e){L.visualFilterDialogContainer._triggerDropdownSearch.call(L.visualFilterDialogContainer,e)};L.oSmartFilterbar.addAdaptFilterDialogCustomContent(r)},onSearchForFilters:function(e){L.visualFilterDialogContainer._triggerSearchInFilterDialog.call(L.visualFilterDialogContainer,e)},onDialogSearch:function(e){L.visualFilterDialogContainer._searchDialog.call(L.visualFilterDialogContainer)},onDialogClear:function(e){O.onClearFilterExtension(e)},onRestore:function(e){L.visualFilterDialogContainer._restoreDialog.call(L.visualFilterDialogContainer)},onDialogCancel:function(e){L.visualFilterDialogContainer._cancelDialog.call(L.visualFilterDialogContainer)},onRowSelectionChange:function(e){var t=e.getSource();E.oCommonUtils.setEnabledToolbarButtons(t)},dataStateFilter:function(e,t){return L.oMessageStripHelper.dataStateFilter(e,t)},dataStateClose:function(){L.oMessageStripHelper.onClose()},onAddCardsToRepository:function(e){var t=E.oServices.oPresentationControlHandlerFactory.getPresentationControlHandler(L.oSmartChart);L.oInsightsHandler.prepareAndShowCard(e,{cardType:"Analytical"},t)},onBeforeExport:function(e){E.oCommonEventHandlers.onBeforeExport(e)},beforeOpenContextMenu:function(e,t){e.preventDefault()}},formatters:{formatItemTextForMultipleView:function(e){return L.oMultipleViewsHandler?L.oMultipleViewsHandler.formatItemTextForMultipleView(e):""},formatMessageStrip:function(e,t){return L.oMultipleViewsHandler?L.oMultipleViewsHandler.formatMessageStrip(e,t):""}},extensionAPI:new t(E,O,L)}}}});
//# sourceMappingURL=ControllerImplementation.js.map