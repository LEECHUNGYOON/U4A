sap.ui.define(["sap/ui/base/Object","sap/ui/core/mvc/ControllerExtension","sap/m/MessageBox","sap/fe/navigation/SelectionVariant","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/metadataAnalyser","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/ui/model/analytics/odata4analytics","sap/base/util/extend","sap/base/util/deepExtend","sap/suite/ui/generic/template/genericUtilities/FeError","sap/suite/ui/generic/template/genericUtilities/ControlStateWrapperFactory","sap/suite/ui/generic/template/genericUtilities/oDataModelHelper","sap/ui/core/IconPool","sap/ui/export/util/Filter","sap/ui/model/odata/ODataUtils"],function(e,t,r,a,n,i,o,s,l,c,u,f,p,g,v,d,m){"use strict";var y="lib.CommonUtils";var b=new s(y).getLogger();var h={0:[{property:"IsActiveEntity",operator:"==",value:false},{property:"SiblingEntity/IsActiveEntity",operator:"==",value:null}],1:[{property:"IsActiveEntity",operator:"==",value:true},{property:"HasDraftEntity",operator:"==",value:false}],2:[{property:"IsActiveEntity",operator:"==",value:false}],3:[{property:"IsActiveEntity",operator:"==",value:true},{property:"SiblingEntity/IsActiveEntity",operator:"==",value:null},{property:"DraftAdministrativeData/InProcessByUser",operator:"!=",value:""}],4:[{property:"IsActiveEntity",operator:"==",value:true},{property:"SiblingEntity/IsActiveEntity",operator:"==",value:null},{property:"DraftAdministrativeData/InProcessByUser",operator:"==",value:""}],5:[{property:"IsActiveEntity",operator:"==",value:true}]};function E(e,s,E){var P=new p(e);var C=Object.create(null);function D(e){var t=e.getToolbar&&e.getToolbar();if(t){var r=L(t);if(r&&r.annotatedActionIds){C[e.getId()]=JSON.parse(atob(r.annotatedActionIds))}if(r&&r.deleteButtonId){C[e.getId()].push({ID:r.deleteButtonId,RecordType:"CRUDActionDelete"})}if(r&&r.multiEditButtonId){C[e.getId()].push({ID:r.multiEditButtonId,RecordType:"CRUDActionMultiEdit"})}}}function S(e){var t=e.getId();if(!C[t]){D(e)}return C[t]||[]}function A(t){var r,a,n;r=e.getOwnerComponent().getModel().getMetaModel();a=r.getODataEntitySet(t);n=r.getODataEntityType(a.entityType);return n}function I(e,t){var r=e.split("?");r[1]=r[1].split("&").map(function(e){if(e.startsWith("$filter")){return t}return e}).join("&");e=r.join("?");return e}function O(t){s.oApplication.attachControlToParent(t,e.getView())}function T(t,r,a){var i=function(e,t){if(e===t){return 0}var a=n.byId(e);var i=n.byId(t);if(!a){if(i){return 1}return e>t?1:-1}if(!i){return-1}if(r){var o=n.isTable(a);var s=n.isTable(i);if(o!==s){return o?1:-1}}var l=a.isFocusable();var c=i.isFocusable();if(l!==c){return l?-1:1}return e>t?1:-1};t=t.concat().sort(i);var o=e.getView();var s=t.find(function(e){var t;var r=a&&function(r){a(e,r,t);t=r};return n.isElementVisibleOnView(e,o,r)});return s}function x(t,r,a,n){return s.oApplication.getDialogFragmentForView(e.getView(),t,r,a,n)}function M(t,r,a,n,i){return s.oApplication.getDialogFragmentForViewAsync(e.getView(),t,r,a,n,i)}var B;function F(t,r,a){var n=e.getOwnerComponent();B=B||n.getModel("i18n").getResourceBundle();return B.getText(t,r,a)}function R(e,t,r,a){var n=r||e,i=t&&t!="|"?e+"|"+t:n;var o=F(i,a,true);if(!o&&i!=n){o=F(n,a)}return o}function w(t){var r=e.getOwnerComponent();var a=t.indexOf("::"+r.getEntitySet()+"--")+2;var n=t.substring(a,t.lastIndexOf("::")),n=n.replace(/--/g,"|").replace(/::/g,"|");return n}function V(e,t,r,a){var n=w(t);return R(e,n,r,a)}function N(e,t){var t=t||e.getSelectionBehavior();if(t==="DATAPOINT"){return{dataPoints:e.getSelectedDataPoints().dataPoints,count:e.getSelectedDataPoints().count}}else if(t==="CATEGORY"){return{dataPoints:e.getSelectedCategories().categories,count:e.getSelectedCategories().count}}else if(t==="SERIES"){return{dataPoints:e.getSelectedSeries().series,count:e.getSelectedSeries().count}}}function L(e){var t={};if(e instanceof sap.ui.core.Element){e.getCustomData().forEach(function(e){t[e.getKey()]=e.getValue()})}return t}function k(e){var t,r;var a=X(e,true);var n=s.oPresentationControlHandlerFactory.getPresentationControlHandler(a).getSelectedContexts();var i=a.getModel();z(n,i,a);t=S(a);for(var o=0;o<t.length;o++){r=t[o];j(r,n,a)}}function U(t,r,a){var n=e.byId(t.ID);if(!n){return{}}var i;var o;var s;if(t.RecordType==="CRUDActionDelete"){s=G(a.getModel(),r,a);if(E.getViewLevel()===0){o="/listReport/deleteEnabled"}else{i=Promise.resolve(s)}}else if(t.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||t.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){var l=a.getModel();var c=l.getMetaModel();i=K(l,c,r,t.RecordType,t.Action,n)}else if(t.RecordType==="CRUDActionMultiEdit"){s=r.filter(J).length>0;o="/listReport/multiEditEnabled";E.getTemplatePrivateModel().setProperty("/listReport/multiEditEnabled",r.filter(J).length>0)}if(i){if(i&&!/generic\/controlProperties/.test(n.getBindingPath("enabled"))){i=null;s=n.getEnabled()}}return{enabledPromise:i,path:o,enabled:s}}function j(e,t,r){var a=U(e,t,r);if(a.path){E.getTemplatePrivateModel().setProperty(a.path,a.enabled)}if(a.enabledPromise){a.enabledPromise.then(_.bind(null,e.ID,"enabled"))}}function H(e){var t=Z(e);z(s.oPresentationControlHandlerFactory.getPresentationControlHandler(t).getSelectedContexts(),e.getModel(),t)}function _(e,t,r){var a=E.getTemplatePrivateModel();var n=a.getProperty("/generic/controlProperties/"+e);if(!n){n={};n[t]=r;a.setProperty("/generic/controlProperties/"+e,n)}else{a.setProperty("/generic/controlProperties/"+e+"/"+t,r)}}function K(e,t,r,a,i,o){var s,l,c,u;var f=false;if(a==="com.sap.vocabularies.UI.v1.DataFieldForAction"){s=t.getODataFunctionImport(i);c=s&&s["sap:action-for"];if(c&&c!==""&&c!==" "){if(r.length>0){u=s["sap:applicable-path"];if(u&&u!==""&&u!==" "){for(var p=0;p<r.length;p++){if(!r[p]||r[p].isTransient()){continue}l=e.getObject(r[p].getPath());if(l&&l[u]){f=true;break}}}else{f=true}}}else{f=true}}else if(a==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){if(xe(r).length>0){f=true}else if(n.isSmartChart(o)){return o.getChartAsync().then(function(){return o.getDrillStackFilters().length>0})}}return Promise.resolve(f)}function G(e,t,r){if(t.length===0){return false}var a=W(r);var n=a&&a.Deletable&&a.Deletable.Path;return t.some(function(t){if(t.isInactive()){return false}else if(t.isTransient()){return true}var r=e.getObject(t.getPath()+"/DraftAdministrativeData");var a=!(r&&r.InProcessByUser&&!r.DraftIsProcessedByMe);return a&&!(n&&!e.getProperty(n,t))})}function W(e){var t=e.getModel()&&e.getModel().getMetaModel();var r=t&&t.getODataEntitySet(e.getEntitySet());var a=r&&r["Org.OData.Capabilities.V1.DeleteRestrictions"];return a}function J(e){var t=e.getModel();var r=t.getObject(e.getPath()+"/DraftAdministrativeData");var a=g.analyseContext(e);var n=s.oApplication.isObjectInEditMode(a.entitySet,a.key);if(!r&&!n){var i=t.getMetaModel().getODataEntitySet(g.analyseContext(e).entitySet);var o=i["Org.OData.Capabilities.V1.UpdateRestrictions"]&&i["Org.OData.Capabilities.V1.UpdateRestrictions"].Updatable;if(o){if(o.Path){return!!t.getProperty(o.Path,e)}else if(o.Bool!=="false"){return true}}else{return true}}}function z(t,r,a){var n=Q(a);var i=E.getTemplatePrivateModel();var o=i.getProperty("/generic/listCommons/breakoutActionsEnabled");if(n){var s=e.byId("template::IconTabBar");var l="";if(s){l=s.getSelectedKey()}Y(o,n,t,r,l,a)}i.setProperty("/generic/listCommons/breakoutActionsEnabled",o)}function q(e,t,r,a,i,o){var s=o.id+(a&&!o.determining?"-"+a:"");var l=i&&i.getId().indexOf("AnalyticalListPage")>-1;var c=!l||!!e[s].enabled;var u=o.filter==="chart";if(o.requiresSelection){if(t.length>0){if(o.applicablePath){var f=g.splitAccessPath(o.applicablePath);c=t.some(function(e){var t=r.getObject(e.getPath()+f.navigationPath);return t[f.property]===true})}else{c=c||(u?n.isSmartChart(i):n.isSmartTable(i))}}else if(n.isSmartChart(i)){if(!l||u){c=i.getDrillStackFilters().length>0}}else{c=c&&u}}e[s]={enabled:c}}function Y(e,t,r,a,n,i){for(var o in t){var s=t[o];q(e,r,a,n,i,s)}}function Q(e){var t=E.getControllerExtensions();var r=L(e).sectionId;if(!r){return t&&t["Actions"]}else{return t&&t.Sections&&t.Sections[r]&&t.Sections[r].Actions}}function X(e,t){var r=[n.isSmartTable,n.isSmartChart,n.isSmartList];if(!t){r.push(n.isMTable);r.push(n.isUiTable)}var a=function(e,t){return t(e)};for(var i=e;i;i=i.getParent&&i.getParent()){var o=r.some(a.bind(null,i));if(o){return i}}return null}function Z(e){var t=e;while(t){if(n.isSmartTable(t)||n.isSmartChart(t)||n.isSmartList(t)){return t}t=t.getParent&&t.getParent()}return null}function $(t){if(!s.oApplication.checkEtags(t)){var r=e.getOwnerComponent();var a=r.getModel();var n=a.getMetaModel().getODataEntitySet(t);if(e.getMetadata().getName()==="sap.suite.ui.generic.template.AnalyticalListPage.view.AnalyticalListPage"&&ee(a,n)){a.invalidateEntityType(n.entityType)}else{var i=function(e){return g.analyseContextPath(e,a).entitySet===t};a.invalidate(i)}var o=r.getId();var l=Object.create(null);l[o]=true;s.oApplication.refreshAllComponents(l);return true}return false}function ee(e,t){var r=new l.Model(l.Model.ReferenceByModel(e));var a=r.findQueryResultByName(t.name);var n=a&&a.getParameterization();return!!n}function te(t,r,a){var n;if(E.isDraftEnabled()){n=s.oDraftController.isActiveEntity(t)?1:6}else{var i=e.getOwnerComponent();n=i.getModel("ui").getProperty("/editable")?6:1}if(a){s.oApplication.setObjectInEditMode(true)}E.navigateAccordingToContext(t,n,r)}function re(e){if(e instanceof sap.fe.navigation.NavError){if(e.getErrorCode()==="NavigationHandler.isIntentSupported.notSupported"){r.show(F("ST_NAV_ERROR_NOT_AUTHORIZED_DESC"),{title:F("ST_GENERIC_ERROR_TITLE"),icon:r.Icon.ERROR})}else{r.show(e.getErrorCode(),{title:F("ST_GENERIC_ERROR_TITLE"),icon:r.Icon.ERROR})}}}function ae(t,r){be(function(){var r=s.oApplication.getNavigationHandler();var a={semanticObject:t.semanticObject,action:t.action};var n=r.mixAttributesAndSelectionVariant(t.parameters);if(typeof e.adaptNavigationParameterExtension==="function"){e.adaptNavigationParameterExtension(n,a)}Ie(t);s.oApplication.navigateExternal(t.semanticObject,t.action,n.toJSONString(),null,re)},Function.prototype,"LeaveApp")}function ne(t){var r=[],a,n,i;var o=e.getOwnerComponent();var s=o.getModel().getMetaModel();if(!t){return{}}var l=o.getAppComponent().getConfig().pages[0];if(!l){return{}}var c=function(e){i=s.getODataEntitySet(e.entitySet).entityType;n=s.getODataEntityType(i);a={};a={entitySet:e.entitySet,aKeys:s.getODataEntityType(i).key.propertyRef,navigationProperty:e.navigationProperty};for(var t=0,r=a.aKeys.length;t<r;t++){var o=0,l=n.property.length;for(o;o<l;o++){if(a.aKeys[t].name===n.property[o].name){a.aKeys[t].type=n.property[o].type;break}}}};var u=function(e,t){if(!t.pages){return r}for(var n=0,i=t.pages.length;n<i;n++){if(!t.pages[n]){break}if(e===t.pages[n].entitySet){c(t.pages[n]);r.splice(0,0,a);break}r=u(e,t.pages[n]);if(r.length>0){c(t.pages[n]);r.splice(0,0,a)}}return r};return u(t,l)}function ie(e,t){var r,a;for(var n=0,i=e.length;n<i;n++){if(e[n].navigationProperty){a+="/"+e[n].navigationProperty}else{a="/"+e[n].entitySet}for(var o=0,s=e[n].aKeys.length;o<s;o++){if(o===0){a+="(";r=""}else{r=","}var l=e[n].aKeys[o];var c=encodeURIComponent(t[l.name]);switch(l.type){case"Edm.Guid":if(t.DraftAdministrativeData&&t.DraftAdministrativeData.DraftIsCreatedByMe){a+=r+l.name+"="+"guid'"+t.DraftAdministrativeData.DraftUUID+"'"}else{a+=r+l.name+"="+"guid'"+c+"'"}break;case"Edm.Boolean":if(t.DraftAdministrativeData&&t.DraftAdministrativeData.DraftIsCreatedByMe){a+=r+l.name+"="+false}else{a+=r+l.name+"="+c}break;case"Edm.Decimal":case"Edm.Int16":case"Edm.Int32":case"Edm.Int64":case"Edm.Byte":case"Edm.DateTimeOffset":case"Edm.SByte":var u=m.formatValue(c,l.type);a+=r+l.name+"="+u;break;default:if(typeof c==="string"){a+=r+l.name+"="+"'"+c+"'"}else{a+=r+l.name+"="+c}break}if(o===s-1){a+=")"}}}return a}function oe(e){var t=e.getParameter("originalId"),r=sap.ui.getCore().byId(t),a=X(r,true),i=Object.create(null);i.smartLink=r;if(n.isSmartTable(a)){var o=s.oPresentationControlHandlerFactory.getPresentationControlHandler(a);i.smartTable=a;i.column=o.getColumnForCell(r)}return i}function se(e,t,r){var a={getSourceInfo:oe.bind(null,e),oSelectionVariant:t};return!!r.beforeSmartLinkPopoverOpensExtension(a)}function le(e,t,r,a){var n,i,o,l,c,u,f;var p=e.getParameters();var g=s.oApplication.getNavigationHandler();n=g.mixAttributesAndSelectionVariant({},t);if(se(e,n,r)){return}var v=false;for(l in p.semanticAttributesOfSemanticObjects){v=v||l===p.semanticObject;var d=p.semanticAttributesOfSemanticObjects[l];for(o in d){if(!n.getSelectOption(o)){n.addParameter(o,"")}}c=n.getPropertyNames();u=n.getSelectOptionsPropertyNames();f=n.getParameterNames();for(var m=0,y=c.length;m<y;m++){var b=c[m];if(u.indexOf(b)<0&&f.indexOf(b)<0){delete d[b];n.removeSelectOption(b)}}}if(v){var h=p.semanticAttributesOfSemanticObjects[""];var E=p.semanticAttributesOfSemanticObjects[p.semanticObject];f=n.getParameterNames();f.forEach(function(e){n.removeParameter(e);if(!(e in h)){var t=E[e];t=typeof t==="undefined"||t===null?"":String(t);n.addParameter(e,t)}});n=g.mixAttributesAndSelectionVariant(E,n.toJSONString());n=ce(n,e.getSource(),a);var P={semanticObject:p.semanticObject,action:""};r.adaptNavigationParameterExtension(n,P);i=n.toJSONString()}delete p.semanticAttributes;g.processBeforeSmartLinkPopoverOpens(p,i)}function ce(t,r,a){var i;var o=[];var s=e.getOwnerComponent().getEntitySet();if(n.isSemanticObjectController(r)||n.isSmartTable(r)){i=r.getEntitySet()}else{var l=X(r);var c=l&&l.getParent();if(n.isSmartTable(c)){r=c;i=r.getEntitySet()}else{i=s}}o.push(i);var u=a&&a.oMultipleViewsHandler&&a.oMultipleViewsHandler.getMode&&a.oMultipleViewsHandler.getMode()==="multi";if(i!==s&&!u){o.push(s)}o.forEach(function(e){if(r){var a=r.getModel().getMetaModel();var n=a.getODataEntityType(a.getODataEntitySet(e).entityType);t.getPropertyNames().forEach(function(e){var r=a.getODataProperty(n,e);if(r&&(r["com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext"]&&r["com.sap.vocabularies.UI.v1.ExcludeFromNavigationContext"].Bool!=="false"||r["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"]&&r["com.sap.vocabularies.PersonalData.v1.IsPotentiallySensitive"].Bool!=="false")){t.removeSelectOption(e)}})}});return t}function ue(t,r){var a=function(e){for(var t=0;t<e.length;t++){r(e[t].name)}};var n=e.getView().getModel().getMetaModel();var i=n.getODataEntitySet(t,false);var o=n.getODataEntityType(i.entityType,false);a(o.key.propertyRef);var l=s.oDraftController.getDraftContext();if(l.isDraftEnabled(t)){a(l.getSemanticKey(t));r("IsActiveEntity");r("HasDraftEntity");r("HasActiveEntity")}}function fe(){return!!(E&&E.getSettings()&&E.getSettings().quickVariantSelectionX)}function pe(t,r,a,n){if(n&&a&&a.getAnalyticBindingPath&&a.getConsiderAnalyticalParameters()){try{var o=a.getAnalyticBindingPath();var s=t.getEntitySet();var l=t.getModel();var c=l.getMetaModel();var u=c.getODataEntitySet(s);var f=e.getOwnerComponent();var p=f.getAppComponent();var g=i.getParametersByEntitySet(p.getModel(),s);if(c.getODataEntityType(u.entityType)["sap:semantics"]!=="aggregate"||fe()){if(r){var v=r(u,g);o=v||o}}if(o){n(o)}}catch(e){b.warning("Mandatory parameters have no values")}}}function ge(e,t,r){for(var a=0;a<t.length;a++){var n=t[a];var i=n.lastIndexOf("/");var o;if(i<0){if(s.oApplication.getNavigationProperty(e,n)){o=n}else{continue}}else{o=n.substring(0,i)}if(r.indexOf(o)===-1){r.push(o)}}}function ve(r,a,n){var i=r.getParameter("bindingParams"),o=r.getSource(),s=o.getId();i.parameters=i.parameters||{};i.parameters.transitionMessagesOnly=E.getNoStateMessagesForTables();var l=function(e,r,n){if(a&&a[e]){var i=true;var o=function(){var a=arguments[0];if(!(a instanceof t)){throw new f(y,"Please provide a valid ControllerExtension in order to execute extension "+e)}if(!i){throw new f(y,"Extension "+e+" must be executed synchronously")}var n=Array.prototype.slice.call(arguments,1);r.apply(null,n)};a[e](o,n);i=false}};var c=function(t){if(!s||e.byId(s)===o){i.filters.push(t)}};if(a.addTemplateSpecificFilters){a.addTemplateSpecificFilters(i.filters)}l("addExtensionFilters",c,s);if(E.getViewLevel()===0){pe(o,a.resolveParamaterizedEntitySet,n,a.setBindingPath)}var u=o.getEntitySet();var p=i.parameters.select&&i.parameters.select.split(",")||[];var g=i.parameters.expand&&i.parameters.expand.split(",")||[];var v=function(t,r){if(t&&(!r||e.byId(r)===o)){var a=t.split(",");a.forEach(function(e){if(e&&p.indexOf(e)===-1){p.push(e)}})}};if(a.isMandatoryFiltersRequired){ue(u,v)}l("ensureExtensionFields",v,s);(a.addNecessaryFields||Function.prototype)(p,v,u);ge(u,p,g);if(g.length>0){i.parameters.expand=g.join(",")}if(p.length>0){i.parameters.select=p.join(",")}}function de(e,t,r){if(!e){return F("DRAFT_OBJECT")}else if(t){return F(r?"LOCKED_OBJECT":"UNSAVED_CHANGES")}else{return""}}function me(){return new Promise(function(e){var t;M("sap.suite.ui.generic.template.fragments.DraftAdminDataPopover",{formatText:function(){var e=Array.prototype.slice.call(arguments,1);var t=arguments[0];if(!t){return""}if(e.length>0&&(e[0]===null||e[0]===undefined||e[0]==="")){if(e.length>3&&(e[3]===null||e[3]===undefined||e[3]==="")){return e.length>2&&(e[1]===null||e[1]===undefined||e[1]==="")?"":e[2]}else{return F(t,e[3])}}else{return F(t,e[0])}},closeDraftAdminPopover:function(){t.close()},formatDraftLockText:de},"admin").then(function(r){t=r;e(t)})})}function ye(e,t,r,a){return s.oDataLossHandler.performIfNoDataLoss(e,t,a,true,true)}function be(e,t,r,a){r=r||"LeavePage";if(E.isDraftEnabled()){return s.oPageLeaveHandler.performAfterDiscardOrKeepDraft(e,t,r,a,false)}else{return s.oDataLossHandler.performIfNoDataLoss(e,t,r,a,false)}}function he(e,t){t=u({busy:{set:true,check:true},dataloss:{popup:true,navigation:false}},t);var r,a;var n=new Promise(function(e,t){r=e;a=t});var i=t.busy.set?function(){if(!E.isDraftEnabled()){s.oApplication.getBusyHelper().setBusy(n,false,{actionLabel:t.sActionLabel})}return e()}:e;var o=t.mConsiderObjectsAsDeleted?function(){s.oApplication.prepareDeletion(t.mConsiderObjectsAsDeleted);return i()}:i;var l=function(){var e;if(E.isDraftEnabled()){s.oApplication.getBusyHelper().setBusy(n,false,{actionLabel:t.sActionLabel});e=s.oApplicationController.synchronizeDraftAsync().then(function(){return o()})}else{e=t.dataloss.popup?be(o,a,null,t.dataloss.navigation?"LeavePage":"Proceed",true):o()}if(e instanceof Promise){e.then(r,a)}else{r(e)}};s.oApplication.performAfterSideEffectExecution(l,t.busy.check&&a);return n}function Ee(e){var t=e.getId()+"-variant";var r=sap.ui.getCore().byId(t);var a=r.getDefaultVariantKey();return a===r.STANDARDVARIANTKEY?"":a}function Pe(e){var t=e.getId()+"-variant";var r=sap.ui.getCore().byId(t);var a=r.getDefaultVariantKey();return a===r.STANDARDVARIANTKEY?"":a}function Ce(t){var r=t.getToolbar();var a=E.getTemplatePrivateModel();var n=e.getOwnerComponent();var i=[],o=[];var s=n.getAppComponent();var l=sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService&&sap.ushell.Container.getService("CrossApplicationNavigation");var u=a.getProperty("/generic/supportedIntents/");var f=r.getContent();var p=f.length;for(var g=0;g<p;g++){var v=L(f[g]);if(v.hasOwnProperty("SemanticObject")&&v.hasOwnProperty("Action")){var d=v.SemanticObject;var m=v.Action;var y={semanticObject:d,action:m,ui5Component:s};i.push([y]);var b=c({},y);b.bLinkIsSupported=false;o.push(b)}}if(i.length>0&&l){var h=l.getLinks(i);h.done(function(e){u=a.getProperty("/generic/supportedIntents/");var t=e.length;for(var r=0;r<t;r++){if(e[r][0].length>0){o[r].bLinkIsSupported=true}var n=o[r].semanticObject;var i=o[r].action;var s=a.getProperty("/generic/supportedIntents/"+n);if(!s){u[n]={};u[n][i]={visible:o[r].bLinkIsSupported}}else if(!s[i]){s[i]={visible:o[r].bLinkIsSupported}}else{s[i]["visible"]=o[r].bLinkIsSupported}}a.updateBindings()})}}function De(t,r){var a=r&&e.byId(r);var n=r&&!a?Promise.reject():new Promise(function(e,r){s.oApplication.performAfterSideEffectExecution(function(){var n=s.oApplication.getBusyHelper();if(n.isBusy()){r();return}if(a&&(!a.getVisible()||a.getEnabled&&!a.getEnabled())){r();return}var i=a?t(a):t();if(i instanceof Promise){i.then(e,r);n.setBusy(i)}else{e(i)}})});n.catch(Function.prototype);return n}function Se(e,t,r,a,n){var i,o={};if(!t){i=[]}else if(Array.isArray(t)){i=t}else{i=[t]}if(r){o.urlParameters=r}if(a&&a.bInvocationGroupingChangeSet){o.operationGrouping="com.sap.vocabularies.UI.v1.OperationGroupingType/ChangeSet"}o.triggerChanges=E.isDraftEnabled();E.executeBeforeInvokeActionFromExtensionAPI(n);var l=s.oApplicationController.invokeActions(e,i,o);if(a&&a.bSetBusy){E.getBusyHelper().setBusy(l)}l.then(E.executeAfterInvokeActionFromExtensionAPI.bind(null,n));return l}function Ae(e){var t=s.oApplication.getChevronNavigationRefreshBehaviour(e);if(t!==Object.create(null)){s.oViewDependencyHelper.setRefreshBehaviour(t)}}function Ie(e){var t=s.oApplication.getComponentRefreshBehaviour(e);s.oViewDependencyHelper.setRefreshBehaviour(t)}function Oe(e,t){var r=t.getModel();var a=t.getPath().split("/")[1];var n=r.oData[a];if(e){var i=n&&n[e]&&n[e].__ref;var o=r.oData[i];return o}else{return n}}function Te(t,r){if(t&&t.__metadata){var a=t.__metadata.edit_media;var n=t.__metadata.content_type;var i="";if(a){if(a.startsWith("http:")||a.startsWith("https:")){var o=a&&new URL(a);i=o&&o.pathname}else{i=a}}var s=v.getIconForMimeType(n);var l={url:i,fileType:n,icon:s};var c=E.getTemplatePrivateModel();var u=e.getOwnerComponent().getEntitySet();if(!c.getProperty("/generic/controlProperties/fileUploader")){c.setProperty("/generic/controlProperties/"+"fileUploader",{})}if(r){c.setProperty("/generic/controlProperties/"+"fileUploader/"+r,l)}else{c.setProperty("/generic/controlProperties/"+"fileUploader/"+u,l)}}}function xe(e){return e.filter(function(e){return!e||!e.isTransient()})}function Me(t,r,a,n){var o=e.getOwnerComponent().getModel().getMetaModel();var s=i.getNavigationPropertyRelationship(o,t,r);var l=i.getNavigationPropertyRelationship(o,a,n);return s.relationship===l.relationship&&s.fromRole===l.toRole&&s.toRole===l.fromRole}function Be(t){var r=t.getSource();return n.isButton(r)?r.data():sap.ui.getCore().byId(e.createId(L(r)["ActionId"])).data()}function Fe(t){if(!E.isDraftEnabled()){return}var r=e.byId("editStateFilter");if(!r){return}var a=r.getSelectedKey(),n=h[a];n.forEach(function(e){var r=t.findIndex(function(t){return e.property===t.property&&e.operator===t.rawValues[0].operator&&e.value===t.rawValues[0].value&&t.rawValues.length===1});if(r!==-1){t.splice(r,1)}});var i=r.getLabels().at(0).getText(),o=r.getSelectedItem().getText(),s={operator:"==",value:o};var l=new d("editStateFilter",s,i);t.push(l)}function Re(t,r){var n=t.getSmartFilterId();if(!n){return}var i=e.byId(n);var o=i.getAnalyticalParameters();if(!o.length){return}var s=i&&i.getUiState({allFilters:false});var l=s?JSON.stringify(s.getSelectionVariant()):"{}";var c=new a(l);o.forEach(function(e){var t=c.getParameter(e.name);if(!t){return}if(e.type==="Edm.DateTime"||e.type==="Edm.DateTimeOffset"){t=new Date(t)}var a=new d(e.name,{operator:"==",value:t},e.fieldLabel);a.setType(e.ui5Type);r.push(a)})}var z=o.testable(z,"fillEnabledMapForBreakoutActions");var X=o.testable(X,"getOwnerControl");var S=o.testable(S,"fnGetToolbarCustomData");var ce=o.testable(ce,"removePropertiesFromNavigationContext");return{getPositionableControlId:T,getMetaModelEntityType:A,fnReplaceFiltersWithGetDownloadUrl:I,getText:F,getSpecializedText:R,getSpecificI18nKeyForSmartControl:w,getContextText:V,getNavigationKeyProperties:ne,mergeNavigationKeyPropertiesWithValues:ie,isMultiViewMultiEntity:fe,executeGlobalSideEffect:function(){if(E.isDraftEnabled()){var t=e.getView();var r=e.getOwnerComponent();var a=r.getAppComponent();var i=a.getForceGlobalRefresh();var o=r.getModel("ui");t.attachBrowserEvent("keydown",function(e){var r=e.target.type==="search";var a=e.target.type==="textarea";var l=e.target.id.indexOf("rowAction")>-1;var c=e.target.id.indexOf("ColumnListItem")>-1;if(e.keyCode===13&&e.ctrlKey!==true&&o.getProperty("/editable")&&!r&&!a&&!l&&!c){s.oApplication.addSideEffectPromise(new Promise(function(e,r){var a,o,l,c=false,u={draftRootContext:E.getMainComponentDetails().bindingContext,callPreparationOnDraftRoot:true,callPreparationOnly:false};var f=function(){setTimeout(function(){var t=s.oApplicationController.executeSideEffects(l,null,null,i,u);t.then(function(){e()},r)})};var p=function(e){var t=e.getFirstInnerControl&&e.getFirstInnerControl();if(t.getValue()!==t.getLastValue()){return true}return false};o=n.getControlWithFocus();while(o){if(n.isSmartField(o)){l=o.getBindingContext&&o.getBindingContext();if(l.isTransient()){if(!p(o)){u.callPreparationOnly=true}f();return e()}}else if(n.isOverflowToolbar(o)||n.isButton(o)||n.isLink(o)||n.isMultiInputField(o)&&(o._sTypedInValue&&o._sTypedInValue.length>0)){c=true}else if(n.isSmartForm(o)){a=o;break}else if(n.isSmartTable(o)){break}o=o.getParent()}if(c){u={}}l=l||o&&o.getBindingContext&&o.getBindingContext()||t.getBindingContext();var g=a?a.check():Promise.resolve();g.then(f)}))}})}},setEnabledToolbarButtons:k,setEnabledFooterButtons:H,getToolbarActionEnablementInfo:U,fillEnabledMapForBreakoutActions:z,getBreakoutActions:Q,getSelectionPoints:N,getDeleteRestrictions:W,getSmartTableDefaultVariant:Ee,getSmartChartDefaultVariant:Pe,setPrivateModelControlProperty:_,removePropertiesFromNavigationContext:ce,navigateFromListItem:te,navigateExternal:ae,semanticObjectLinkNavigation:le,getCustomData:function(e){var t=e.getSource().getCustomData();var r={};for(var a=0;a<t.length;a++){r[t[a].getKey()]=t[a].getValue()}return r},getToolbarCustomData:S,isSupportedColumn:function(e,t){var r=e.data("p13nData")&&e.data("p13nData").columnKey;if(r.indexOf("DataFieldForAnnotation")>-1||r.indexOf("DataFieldForAction")>-1||r.indexOf("DataFieldForIntentBasedNavigation")>-1||t&&t["com.sap.vocabularies.UI.v1.IsImageURL"]&&t["com.sap.vocabularies.UI.v1.IsImageURL"].Bool==="true"||e.data("addCardtoInsightsConfig")&&e.data("addCardtoInsightsConfig").isMultiValueColumn){return false}return true},getCustomDataText:function(e){return new Promise(function(t,r){e.getCustomData().forEach(function(e){var r=e.getKey();if(r==="text"){var a=e.getBinding("value");var n=!a&&e.getBindingInfo("value");if(!a&&!n){t(e.getValue());return}var i=function(e){var r=e.getSource();r.detachChange(i);t(r.getExternalValue());return};if(a){if(!a.isInitial()){t(a.getExternalValue());return}a.attachChange(i)}else{n.events={change:i};for(var o=0;o<n.parts.length;o++){n.parts[o].targetType="string"}}}})})},onBeforeRebindTableOrChart:ve,formatDraftLockText:de,showDraftPopover:function(e,t){me().then(function(r){var a=r.getModel("admin");a.setProperty("/IsActiveEntity",e.getProperty("IsActiveEntity"));a.setProperty("/HasDraftEntity",e.getProperty("HasDraftEntity"));r.bindElement({path:e.getPath()+"/DraftAdministrativeData"});if(r.getBindingContext()){r.openBy(t)}else{r.getObjectBinding().attachDataReceived(function(){r.openBy(t)})}})},getContentDensityClass:function(){return s.oApplication.getContentDensityClass()},attachControlToView:O,getDialogFragment:x,getDialogFragmentAsync:M,fnProcessDataLossOrDraftDiscardConfirmation:be,processDataLossTechnicalErrorConfirmation:ye,securedExecution:he,getOwnerControl:X,getOwnerPresentationControl:Z,refreshModel:$,getElementCustomData:L,triggerAction:function(t,r,a,n){s.oDataLossHandler.performIfNoDataLoss(function(){s.oCRUDManager.callAction({functionImportPath:a.Action,contexts:t,sourceControlHandler:n,label:a.Label,operationGrouping:""}).then(function(a){if(a&&a.length>0){var n=a[0];var i=n.response&&n.response.context||n.context;var o=i&&i.getPath();var l=i&&(!n.actionContext||o!==n.actionContext.getPath());if(l){s.oViewDependencyHelper.setMeToDirty(e.getOwnerComponent(),r,false,o==="/undefined"||t.length>1)}}})},Function.prototype,"Proceed",undefined,false)},checkToolbarIntentsSupported:Ce,executeIfControlReady:De,invokeActionsForExtensionAPI:Se,isContextEditable:J,setExternalChevronRefreshBehaviour:Ae,setComponentRefreshBehaviour:Ie,getStreamData:Oe,setStreamData:Te,getControlStateWrapper:P.getControlStateWrapper,filterActiveContexts:xe,checkInverseNavigation:Me,getCustomDataFromEvent:Be,getControlStateWrapperById:P.getControlStateWrapperById,handleError:re,transformTechnicalPropsOnExportedFile:Fe,includeEntitySetParametersToExportedFile:Re}}return e.extend("sap.suite.ui.generic.template.lib.CommonUtils",{constructor:function(e,t,r){c(this,E(e,t,r))}})});
//# sourceMappingURL=CommonUtils.js.map