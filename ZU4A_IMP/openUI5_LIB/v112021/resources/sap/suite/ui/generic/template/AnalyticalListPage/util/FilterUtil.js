sap.ui.define(["sap/ui/comp/odata/MetadataAnalyser","sap/ui/base/Object","sap/ui/model/Context","sap/suite/ui/generic/template/AnalyticalListPage/util/OperationCode","sap/suite/ui/generic/template/AnalyticalListPage/util/V4Terms","sap/ui/core/format/DateFormat","sap/ui/model/odata/AnnotationHelper","sap/ui/events/KeyCodes","sap/ui/comp/odata/FiscalFormat","sap/suite/ui/generic/template/genericUtilities/metadataAnalyser","sap/ui/core/date/UI5Date"],function(e,t,r,a,i,n,o,u,l,s,f){"use strict";var c=t.extend("sap.suite.ui.generic.template.AnalyticalListPage.util.FilterUtil");c.createTitle=function(e,t){var r;if(!e){return t}if(t instanceof Date){return e}if(e.indexOf(":")!==-1){e=e.substring(0,e.indexOf(":"))}if(e.indexOf(t)===-1){r=e+" ("+t+")"}else{r=e}return r};c._updateVisualFilterAria=function(e){var t=e.getItems()[1].getItems()[0];var r=t.getParentProperty();var a=t.getModel("i18n").getResourceBundle();var i=a.getText("VIS_FILTER_ITEM_ARIA");if(t.getIsMandatory()){i+=" "+a.getText("VIS_FILTER_MANDATORY_PROPERTY_ARIA",r)}i+=" "+a.getText("VIS_FILTER_DIALOG_NAVIGATE_ARIA")+" "+a.getText("VIS_FILTER_ACCESS_FIELDS_ARIA");e.getItems()[2].setText(i)};c.getAllMandatoryFilters=function(t,r){var a=new e(t);var i=s.getEntityTypeNameFromEntitySetName(r,t.getMetaModel());var n=a.getFieldsByEntityTypeName(i);var o=[];for(var u in n){var l=n[u];if(l.requiredFilterField){o.push(l.name)}}return o};c.isNullable=function(t,r,a){var i=new e(t);var n=s.getEntityTypeNameFromEntitySetName(r,t.getMetaModel());var o=i.getFieldsByEntityTypeName(n);for(var u in o){var l=o[u];if(l&&l.name===a&&l.type==="Edm.String"){if(l.nullable==="false"){return false}else{return true}}}return false};c.getAllMandatoryFiltersMapping=function(e,t){var r=[],a=[],i=false;for(var n=0;n<e.length;n++){i=true;for(var o=0;o<t.length;o++){if(e[n]===t[o].valueListProperty){r.push(t[o]);i=false;break}}if(i){a.push(e[n])}}var u={aMappedFilterList:r,aMappingMissingFilterList:a};return u};c.checkFilterHasValueFromSelectionVariant=function(e,t){return e.some(function(e){if(e.PropertyName.PropertyPath===t){return true}})};c.checkFilterHasValueFromSmartFilterBar=function(e,t){return e.some(function(e){if(e.getName()===t){return true}})};c.checkFilterHasValueFromSelectionVariantOrSmartFilterBar=function(e,t,r,a){var i=r&&c.checkFilterHasValueFromSelectionVariant(r,e);if(!i){i=c.checkFilterHasValueFromSmartFilterBar(a.getFiltersWithValues(),t)}return i};c.readProperty=function(e,t){var r=0,a=typeof t==="string"?t.split("."):[];while(r<a.length){if(!e){return undefined}e=e[a[r++]]}return e};c.executeFunction=function(e,t,r){var a=0,i,n=typeof t==="string"?t.split("."):[];while(a<n.length){if(!e){return undefined}i=e;e=e[n[a++]]}return typeof e==="function"?e.apply(i,r):undefined};c.createTitleFromCode=function(e){var t=c.readProperty(e,"value1"),r=c.readProperty(e,"value2"),i=c.readProperty(e,"operation"),n;if(!t||!i||!a[i]){return undefined}if(r&&i!=="EQ"){n=t+a[i].code+r}else if(a[i].position==="last"){n=t+a[i].code}else if(a[i].position==="mid"){n=a[i].code+t+a[i].code}else{n=a[i].code+t}if(e.exclude){n="!("+n+")"}return n};c.formatFiltersLink=function(e){var t=this.getModel("i18n"),r=t.getResourceBundle();return e?r.getText("VISUAL_FILTER_FILTERS_WITH_COUNT",[e]):r.getText("VISUAL_FILTER_FILTERS")};c.getBooleanValue=function(e,t){if(e&&e.Bool){if(e.Bool.toLowerCase()==="true"){return true}else if(e.Bool.toLowerCase()==="false"){return false}}return t};c.getPrimitiveValue=function(e){var t;if(e){if(e.String){t=e.String}else if(e.Bool){t=c.getBooleanValue(e)}else if(e.EnumMember){t=e.EnumMember.split("/")[1]}else{t=c.getNumberValue(e)}}return t};c.getNumberValue=function(e){if(e){var t=Object.keys(e)[0];return e&&t&&["String","Int","Decimal","Double","Single"].indexOf(t)!==-1?Number(e[t]):undefined}};c.getPathOrPrimitiveValue=function(e){if(e){return e.Path?"{path:'"+e.Path+"'}":c.getPrimitiveValue(e)}else{return""}};c.isFilterDiff=function(e,t){if(Array.isArray(e)!=Array.isArray(t)){return true}if(Array.isArray(e)){return this.isFilterListDiff(e,t)}else{return this.isFilterObjDiff(e,t)}};c.isFilterObjDiff=function(e,t){if(!e||!t){return true}for(var r in e){if(r=="aFilters"){if(this.isFilterListDiff(e.aFilters,t.aFilters)){return true}}else if(e[r]!=t[r]){return true}}return false};c.convertLocalDatetoUTCDate=function(e){var t=new Date(e.valueOf()+e.getTimezoneOffset()*60*1e3);return new Date(t.setHours(0,0,0))};c.getDateInMedium=function(e){return e instanceof Date?n.getDateInstance({style:"medium"}).format(e):undefined};c.getDateTimeInMedium=function(e){return e instanceof Date?n.getDateTimeInstance({style:"medium"}).format(e):undefined};c.isDefaultVariantSelected=function(e){var t=e.oSmartFilterbar.getSmartVariant();return t&&t.getCurrentVariantId()===t.getDefaultVariantKey()};c.isFilterListDiff=function(e,t){if(!e||!t){return true}if(e.length!=t.length){return true}for(var r=0;r<e.length;r++){var a=e[r];var i=t[r];if(this.isFilterObjDiff(a,i)){return true}}return false};c.getTextArrangement=function(e,t,r){var a,i=e?e:t,n=e&&t?e+" ("+t+")":i;if(t!=="__IS_OTHER__"&&t!=="Other"){switch(r){case sap.ui.comp.smartfilterbar.DisplayBehaviour.descriptionAndId:a=n;break;case sap.ui.comp.smartfilterbar.DisplayBehaviour.descriptionOnly:a=e?e:"";break;case sap.ui.comp.smartfilterbar.DisplayBehaviour.idAndDescription:a=e&&t?t+" ("+e+")":i;break;case sap.ui.comp.smartfilterbar.DisplayBehaviour.idOnly:a=t?t:"";break;default:a=n;break}}else{a=e}return a};c.getTooltipForValueHelp=function(e,t,r,a,i){var n="";if(i){if(!a){n=r.getText("DP_WITHOUT_SELECTIONS",t)}else{n=r.getText("DP_SINGLE_SELECTED",[t,a])}return n}if(!a){n=e?r.getText("VALUE_HELP",t):r.getText("DROPDOWN_WITHOUT_SELECTIONS",t)}else{if(!e){n=r.getText("DROPDOWN_WITH_SELECTIONS",[t,a])}else{n=a===1?r.getText("VH_SINGLE_SELECTED",[t,a]):r.getText("VH_MULTI_SELECTED",[t,a])}}return n};c.getPropertyNameDisplay=function(e,t,r,a,i){var n=a?a.getResourceBundle():undefined,o=e.getMetaModel(),u=o.getODataEntityType(o.getODataEntitySet(t).entityType),l=o.getODataProperty(u,r);if(!l){return r}var s=l["com.sap.vocabularies.Common.v1.Label"]&&l["com.sap.vocabularies.Common.v1.Label"].String?l["com.sap.vocabularies.Common.v1.Label"].String:l["sap:label"];var f=l["com.sap.vocabularies.Common.v1.QuickInfo"]&&l["com.sap.vocabularies.Common.v1.QuickInfo"].String?l["com.sap.vocabularies.Common.v1.QuickInfo"].String:l["sap:quickinfo"];if(i&&f){if(f.match(/{@i18n>.+}/gi)&&n){f=n.getText(f.substring(f.indexOf(">")+1,f.length-1))}return f}if(s){if(s.match(/{@i18n>.+}/gi)&&n){s=n.getText(s.substring(s.indexOf(">")+1,s.length-1))}return s}else{return r}};c.getUnitFieldText=function(e,t,r){var a=e.getMetaModel(),i=a.getODataEntityType(a.getODataEntitySet(t).entityType),n=a.getODataProperty(i,r),o=n["com.sap.vocabularies.Common.v1.Text"]&&n["com.sap.vocabularies.Common.v1.Text"].Path?n["com.sap.vocabularies.Common.v1.Text"].Path:n["sap:text"];return o};c.IsNavigationProperty=function(e,t,r){var a=e.getMetaModel(),i=a.getODataEntityType(a.getODataEntitySet(t).entityType);var n=i["navigationProperty"];var o=false;if(r.indexOf("/")!==-1){for(var u=0;u<n.length;u++){if(n[u].name===r.split("/")[0]){o=true;break}}}return o};c.getKeysForNavigationEntitySet=function(e,t,r){if(r){var a=e.getODataEntitySet(t),i=e.getODataEntityType(a.entityType),n=e.getODataAssociationEnd(i,r),o=e.getODataEntityType(n.type),u=this.readProperty(o,"key.propertyRef");if(u&&u.length>1){return u||null}else{return null}}else{return null}};c.isPropertyNonFilterable=function(e,t){if(!e||!t){return false}var r=e[i.FilterRestrictions];var a=r&&r.NonFilterableProperties;if(a){for(var n=0;n<a.length;n++){if(a[n].PropertyPath===t){return true}}}return false};c.getVisualFilterSelectFields=function(e,t,r,a,i,n,o){var u=[e,t];if(t!=r){if(u.indexOf(r)===-1){u.push(r)}}if(a){if(u.indexOf(a)===-1){u.push(a);if(o&&u.indexOf(o)===-1){u.push(o)}}}if(i&&Array.isArray(i)){i.forEach(function(e){if(u.indexOf(e)===-1){u.push(e)}})}if(n){n.forEach(function(e){if(u.indexOf(e.name)===-1){u.push(e.name)}})}return u};c.getFilterDialogMode=function(e){return e.getProperty("/alp/filterDialogMode")};c.getFilterMode=function(e){return e.getProperty("/alp/filterMode")};c.isVisualFilterLazyLoaded=function(e){if(!e.getLazyLoadVisualFilter()){return false}var t=this.getFilterDialogMode(e.getModel("_templPriv"));if(t==="compact"){return true}else if(t==="visual"){return false}var r=this.getFilterMode(e.getModel("_templPriv"));if(r==="compact"){return true}return false};c.formatStringDate=function(e,t,r){if(e!==""){if(t==="Line"){var a=n.getDateInstance({format:"MMMdd"});var i=n.getDateInstance({format:"YYYY"});var o=e&&a.parse(e);var u=e&&i.parse(e);if(r){return i.format(u)}else{return a.format(o)}}else{var l=n.getDateInstance({pattern:"yyyyMMdd"});var s=e&&l.parse(e);return c.getDateInMedium(s)}}return e};c.formatStringDateYearMonth=function(e,t,r){if(!e){return e}var a=e;var i="-";var o=4;var u=[a.slice(0,o),i,a.slice(o)].join("");var l=f.getInstance(u);if(t==="Line"){var s=n.getDateTimeInstance({format:"Y",UTC:true});var c=n.getDateTimeInstance({format:"MMM",UTC:true});if(r){return s.format(l)}else{return c.format(l)}}else{var g=n.getDateTimeInstance({format:"YYYYMMM",UTC:true});return g.format(l)}};c.formatStringDateYearQuarter=function(e,t,r){if(!e){return e}var a=parseInt(e.substr(0,4),10),i=e.substr(4),o=parseInt(i,10)*3-2,u=o-1,l=f.getInstance(Date.UTC(a,u));if(t==="Line"){var s=n.getDateTimeInstance({format:"QQQ",UTC:true});if(r){return a}else{return s.format(l)}}else{var s=n.getDateTimeInstance({format:"YYYYQ",UTC:true});return s.format(l)}};c.formatStringDateYearWeek=function(e,t,r){if(!e){return e}var a=parseInt(e.substr(0,4),10),i=e.substr(4),o=1+(parseInt(i,10)-1)*7,u=f.getInstance(Date.UTC(a,0,o));var l=n.getDateTimeInstance({format:"Y",UTC:true}),s=n.getDateTimeInstance({format:"www",UTC:true});if(t==="Line"){if(r){return l.format(u)}else{return s.format(u)}}else{var c=s.format(u).concat(" ",l.format(u));return c}};c.formatStringFiscalYearPeriod=function(e,t,r){if(e!==""){var a,i,n=1,o=1e3,u=1e4,l=parseInt(e,10);if(l<u){a=l;i=n}else{a=Math.floor(l/o);i=l%o}if(t==="Line"){if(r){return a.toString()}else{return i.toString()}}else{var s=i.toString().concat(" ",a.toString());return s}}return e};c.getResolvedDimensionValue=function(e){return e===null||e===""?null:e.toString()};c.isPropertyHidden=function(e){var t=false;if(e){var r=e["com.sap.vocabularies.UI.v1.Hidden"];t=r?r.Bool==="true":false}return t};c.isInteger=function(e){return e.toUpperCase().indexOf("EDM.INT")!=-1?true:false};c.onKeyUpVisualFilter=function(e){if(e.keyCode===u.F4){var t=sap.ui.getCore().byId(e.target.id),r,a;if(t){var i=t.getMetadata().getElementName();switch(i){case"sap.m.Button":if(this.isF4Enabled){r=t}break;case"sap.m.HeaderContainerItemContainer":var n=t.getItem();if(n){a=n.getId().replace("FilterItemContainer","ValueHelpButton");r=this.getF4ButtonId(a)}break;case"sap.m.CustomListItem":a=t.getId().replace("FilterItemContainer","ValueHelpButton");r=this.getF4ButtonId(a);break;default:break}}else{if(e.target.id.length>0){a=e.target.id.replace("FilterItemMicroChart","ValueHelpButton")}else{a=e.target.parentElement.id.replace("FilterItemMicroChart","ValueHelpButton")}a=a.slice(0,a.indexOf("-innerChart"));r=this.getF4ButtonId(a)}if(r&&this.isF4Enabled(r)){r.firePress()}}};c.onKeyDownVisualFilter=function(e,t){if(t.keyCode===u.ENTER){if(t.ctrlKey||t.metaKey){e.search();t.stopPropagation()}}};c.getF4ButtonId=function(e){var t=sap.ui.getCore().byId(e);return t};c.isF4Enabled=function(e){if(e.data("isF4Enabled")){if(e.getVisible()&&e.getEnabled()){return true}}return false};c.isAlreadyInParameter=function(e,t){return e&&e.some(function(e){return e.localDataProperty===t})};c.checkManditoryFieldsFilled=function(e){if(e){var t=e.determineMandatoryFilterItems(),r=e.getFiltersWithValues(),a=0;var i={aMandatoryFilter:[],bIsMandatoryFilter:true};if(t.length){if(!r.length||r.length<t.length){i.bIsMandatoryFilter=false}if(!e.validateMandatoryFields()){for(var n=0;n<t.length;n++){for(var o=0;o<r.length;o++){if(r[o].getName()===t[n].getName()){a++}else if(r[o].getMandatory()){i.aMandatoryFilter.push(t[n].getLabel())}}}i.bIsMandatoryFilter=a===t.length;if(t.length===1){i.aMandatoryFilter.push(t[0].getLabel())}}}if(i.bIsMandatoryFilter){var u=e.verifySearchAllowed.apply(e,arguments);if(u.hasOwnProperty("error")||u.hasOwnProperty("mandatory")){i.bIsMandatoryFilter=false}}}return i};c.getParameter=function(e){var t="$Parameter.";if(e.indexOf(t)>-1){e=e.substring(t.length)}return e};return c},true);
//# sourceMappingURL=FilterUtil.js.map