/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Core","./BaseShape","./GanttUtils","sap/ui/Device","sap/ui/core/theming/Parameters","../library","./RenderUtils"],function(t,e,i,r,a,s,n){"use strict";var o=s.simple.shapes.ShapeAlignment;var l=e.extend("sap.gantt.simple.BaseText",{metadata:{library:"sap.gantt",properties:{text:{type:"string"},x:{type:"float"},y:{type:"float"},fontSize:{type:"int",defaultValue:13},textAnchor:{type:"string",defaultValue:"start"},fontFamily:{type:"string",defaultValue:"Arial"},truncateWidth:{type:"float"},showEllipsis:{type:"boolean",defaultValue:true},isLabel:{type:"boolean",defaultValue:false},_shapeCropped:{type:"boolean",defaultValue:false,visibility:"hidden"},_xBiassed:{type:"float",visibility:"hidden"}}},renderer:{apiVersion:2},constructor:function(){var t,i;if(arguments[0]&&arguments[0]._shapeCropped!=null){t=arguments[0]._shapeCropped;delete arguments[0]._shapeCropped}if(arguments[0]&&arguments[0]._xBiassed!=null){i=arguments[0]._xBiassed;delete arguments[0]._xBiassed}e.apply(this,arguments);if(t){this.setProperty("_shapeCropped",t,true)}if(i){this.setProperty("_xBiassed",i,true)}}});var h=["x","y","text-anchor","style","filter","transform","opacity"];l.prototype.getX=function(){var t=i.getValueX(this);var e=this.getParent();if(isNaN(t)&&e&&e.getTime){t=i.getValueX(e)}var r=this.getGanttChartBase();var a=r&&r.getEnablePseudoShapes()&&e&&e.isPseudoShape;if(a){var s=e&&e.getButton&&e.getButton()[0].getHeight();var o=e&&e.getAggregation("task");var l=o&&o.truncatedTextWidth;var h=2+2;var p={showEllipsis:true,textAnchor:this.getHorizontalTextAlignment().toLowerCase()};var u=o.getWidth(),g=p.textAnchor;t=n._calculateX(this,g,t,u,h,l,p,s)}return t};l.prototype.getY=function(){var t=this.getProperty("y"),e=1;if(t!==null&&t!==undefined){return t}var i=this.getFontSize();var r=this.getRowYCenter()+i/2;if(this._iBaseRowHeight!=undefined){if(this.getAlignShape()==o.Top){r=this.getRowYCenter()-this._iBaseRowHeight/2+i}else if(this.getAlignShape()==o.Bottom){r=this.getRowYCenter()+this._iBaseRowHeight/2-e}r=parseInt(r,10)}return r};l.prototype.getStyle=function(){var t=e.prototype.getStyle.apply(this,arguments);var i=this.getTitleColor()?this.getTitleColor():this.getFill()||a.get("sapUiBaseText");var r={"font-size":this.getFontSize()+"px",fill:this.determineValueColor(i),"font-family":this.getFontFamily(),"font-weight":this.getFontWeight()};return t+this.getInlineStyle(r)};l.prototype.renderElement=function(t,e){this.writeElementData(t,"text",true);if(this.aCustomStyleClasses){this.aCustomStyleClasses.forEach(function(e){t.class(e)})}n.renderAttributes(t,e,h);var i=e.getGanttChartBase();if(i&&i.getSelectOnlyGraphicalShape()&&e.getIsLabel()){t.class("sapGanttTextNoPointerEvents")}t.openEnd();n.renderTooltip(t,e);if(this.getShowAnimation()){n.renderElementAnimation(t,e)}this.writeTruncatedText(t,e);t.close("text")};l.prototype.writeTruncatedText=function(t,e){var i=e.getText(),r=this.getTruncateWidth()!=null;if(r){var a=this._truncateText(i,e.bPseudoShape,e.iIconHeight);this.renderEllipsisIfNecessary(t,a,e.oTextElement)}else{t.text(i)}};l.prototype.getTruncateWidth=function(){var e=this.getProperty("truncateWidth");var i=this.getParent();if(i&&i.isA("sap.gantt.simple.BaseShape")){var r=0;if(i.getWidth){r=i.getWidth()}else if(i.getEndTime()&&i.getTime()){r=Math.abs(this.getXByTime(i.getEndTime())-this.getXByTime(i.getTime()))}else{r=e}if(r<e){return r}}if(this.getTextAnchor().toLowerCase()===s.simple.horizontalTextAlignment.Dynamic.toLowerCase()&&this.getProperty("_shapeCropped")){e=t.getConfiguration().getRTL()?e+this.getProperty("_xBiassed"):e-this.getProperty("_xBiassed")}return e};l.prototype.renderEllipsisIfNecessary=function(t,e,i){var r;if(e.ellipsis){t.text(e.truncatedText+"...");r=e.truncatedText+"..."}else{t.text(e.truncatedText);r=e.truncatedText}if(i){i.truncatedTextWidth=this.measureTextWidth(r);i.iTruncateWidth=this.getTruncateWidth()}};l.prototype._truncateText=function(t,e,i){var r=this._processTextForTruncation(t,e,i);r=r||{ellipsis:false,truncatedText:t};return r};l.prototype._processTextForTruncation=function(e,r,a){var s=this.getTruncateWidth(),n=this.measureTextWidth("..."),o=this.measureTextWidth(e);var l;if(r){l=2+a+8}else{l=8}o=o+l;if(o>s){var h,p;if(this.getShowEllipsis()&&n<s){p=true;h=s-n}else{p=false;h=s}if(h>l){h=h-l}var u;var g=i.geNumberOfTruncatedCharacters(o,h,e,this,this.measureTextWidth);var d=r&&!(h>l)?0:g;if(t.getConfiguration().getRTL()){var f=e.length-d;u=e.slice(f,e.length).trim()}else{u=e.slice(0,d).trim()}return{ellipsis:p,truncatedText:u}}return null};l.prototype.getTextAnchor=function(){var t=this.getProperty("textAnchor");return t};l.prototype.measureTextWidth=function(t){return i.getShapeTextWidth(t,this.getFontSize(),this.getFontFamily(),this.getFontWeight())};return l},true);
//# sourceMappingURL=BaseText.js.map