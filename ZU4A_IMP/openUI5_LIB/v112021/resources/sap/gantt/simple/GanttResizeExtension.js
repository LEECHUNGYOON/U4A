/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/base/Log","sap/ui/events/KeyCodes","sap/ui/core/Core","./GanttExtension","./CoordinateUtils","./GanttUtils","sap/ui/core/theming/Parameters","sap/ui/Device","sap/gantt/misc/Utility","sap/gantt/misc/Format"],function(jQuery,e,t,i,r,n,a,s,o,h,g){"use strict";var l=r.extend("sap.gantt.simple.GanttResizeExtension",{_init:function(e,t){this._initResizeStatus();return"ResizeExtension"}});var p=".sapGanttResizing";var d={strokeWidth:1,strokeDasharray:"5, 1",fillOpacity:0,shapeColor:null};var m={color:"grey",strokeWidth:2,strokeDasharray:"5, 1",fillOpacity:0,shapeColor:null};var c={None:0,LeftResize:1,RightResize:2};var u=function(e,t){return parseFloat(e.attr(t),10)};l.prototype.getSelectionSettings=function(){if(!this.mSelectionSettings){return this.updatemSelectionSettings()||this.mSelectionSettings}return this.mSelectionSettings};l.prototype.updatemSelectionSettings=function(){d.color=s.get("sapUiBaseText");var e=this.getGantt().getShapeSelectionSettings();if(jQuery.isEmptyObject(e)){return d}var t=jQuery.extend(true,{},d);for(var i in t){if(e[i]){t[i]=e[i]}}if(!t.shapeColor){t.fillOpacity=0}else if(t.fillOpacity===0){t.fillOpacity=.4}this.mSelectionSettings=t};l.prototype.getSelectionInlineStyle=function(e){var t=this.getSelectionSettings();var i=t.shapeColor;var r=t.color;if(i){i=i.substr(0,1)==="@"?i.substring(1):i}if(r){r=r.substr(0,1)==="@"?r.substring(1):r}this._bShapeSelectedFill=false;this._getShapeSelectedFill(e);var n={fill:s.get(i)?s.get(i):i,stroke:s.get(r)?s.get(r):r,"fill-opacity":this._bShapeSelectedFill?0:t.fillOpacity,"stroke-width":this._bShapeSelectedFill?0:t.strokeWidth,"stroke-dasharray":t.strokeDasharray};return Object.keys(n).reduce(function(e,t){e+=t+":"+n[t]+";";return e},"")};l.prototype.getHighlightSettings=function(){if(!this.mHighlightSettings){return this.updatemHighlightSettings()||this.mHighlightSettings}return this.mHighlightSettings};l.prototype.updatemHighlightSettings=function(){var e=this.getGantt().getShapeHighlightSettings();if(e===null){return m}var t=Object.assign({},m);for(var i in t){if(e[i]){t[i]=e[i]}}if(!t.shapeColor){t.fillOpacity=0}else if(t.fillOpacity===0){t.fillOpacity=.4}this.mHighlightSettings=t};l.prototype.initDomSelector=function(){this.mDoms={}};l.prototype.updateDomSelector=function(e){if(e){this.origin.shapeUid=jQuery(e.target).parents("g").attr(a.SELECT_FOR_DATASET_KEY)}var t="g["+a.SELECT_FOR_DATASET_KEY+'="'+this.origin.shapeUid+'"]';var i={leftLine:t+" .leftLine",rightLine:t+" .rightLine",topLine:t+" .topLine",bottomLine:t+" .bottomLine",leftLineTrigger:t+" line.leftTrigger",rightLineTrigger:t+" line.rightTrigger",leftRectTrigger:t+" rect.leftTrigger",rightRectTrigger:t+" rect.rightTrigger",resizeRectCover:t+" rect.resizeCover"};for(var r in i){if(i.hasOwnProperty(r)){this.mDoms[r]=jQuery(i[r])}}};l.prototype.getSvgElement=function(){var t=jQuery(document.getElementById(this.getGantt().getId()));if(t.length===0){e.warning("can not find gantt chart, use gantt chart instance sId as the key is required")}return t.find("svg.sapGanttChartSvg").get(0)};l.prototype.getHeaderSvgElement=function(){var t=jQuery(document.getElementById(this.getGantt().getId()));if(t.length===0){e.warning("can not find gantt chart, use gantt chart instance sId as the key is required")}return t.find("svg.sapGanttChartHeaderSvg").get(0)};l.prototype._getShapeSelectionRootNode=function(){var e=this.getSvgElement(),t=jQuery(e).find("g.sapGanttChartSelection");return d3.select(t.get(0))};l.prototype._getDeltaMarkerSelectionRootNode=function(){var e=this.getHeaderSvgElement(),t=jQuery(e).find("g.sapGanttChartHeaderSelection");return d3.select(t.get(0))};l.prototype._getShapeHighlightRootNode=function(){var e=this.getSvgElement();if(e){var t=e.querySelectorAll(".sapGanttChartHighlight");return d3.select(t[0])}};l.prototype.toggleOutline=function(e){if(!e.getSelected()){this.removeOutline(e);return}this.setFrame(this._getDomRef(e).getBBox());var t=e.getConnectable(),i=e.getResizable(),r=e.getSelectable();if(r){if(t||i){this.renderResizerOutline(e)}else{this.renderPlainOutline(e)}}};l.prototype.toggleHighlight=function(e){if(!e.getHighlighted()){this.removeHighlight(e);return}this.setFrame(e.getDomRef().getBBox());var t=this.getHighlightOutLines(e);var i=this.createHighlightContainer(e);this.renderHighlightBorders(t,i);this.renderResizeTriggerAndCover(t,i,false,e)};l.prototype.addDeltaLineResizer=function(e){this.setFrame(e.getDomRef().getBBox());this.clearAllDeltaOutline();var t=this.getOutlineLines(e);var i=this.createResizeContainer(e,true);this.renderSelectionBorders(t,i);this.renderResizeTriggerAndCover(t,i,false,e);this.attachHeaderMouseEvent()};l.prototype.addResizerOnMouseOver=function(e){this.setFrame(this._getDomRef(e).getBBox());var t=e.getResizable();if(t){this.renderResizerOutlineOnMouseOver(e)}};l.prototype.clearAllOutline=function(e){this._getShapeSelectionRootNode().selectAll("*").remove()};l.prototype.clearAllDeltaOutline=function(){this._getDeltaMarkerSelectionRootNode().selectAll("*").remove()};l.prototype.clearAllHighlight=function(){if(this._getShapeHighlightRootNode()){this._getShapeHighlightRootNode().selectAll("*").remove()}};l.prototype.renderPlainOutline=function(e){var t=this._getDomRef(e);if(t){var i=!!e.getRlsAnchors;var r=h.getShapeBias(e);var n=i?e.getD():this.determineOutlineByFrame(e,r);var s=null;if(i&&e.getEnableCurvedEdge()){s=a.getPathCorners(e.getD(),5)}var o=this._getShapeSelectionRootNode();var g=i?this.createOutlineRlsNode(e,n,s):this.createOutlinePathNode(e,n);o.node().appendChild(g)}};l.prototype.createOutlineRlsNode=function(e,t,i){var r=document.createElementNS(d3.ns.prefix.svg,"g");var n=document.createElementNS(d3.ns.prefix.svg,"path");var a=document.createElementNS(d3.ns.prefix.svg,"path");var s=document.createElementNS(d3.ns.prefix.svg,"path");r.setAttribute("id",e.getShapeUid()+"-selected");r.setAttribute("aria-hidden","false");r.setAttribute("class","resizeContainer sapGanttSelectedPath");r.style=e.getSelectedStyle();if(!i){a.setAttribute("d",t)}else{a.setAttribute("fill","none");a.setAttribute("d",i)}r.appendChild(a);n.setAttribute("stroke-width",1);n.setAttribute("fill",e.getSelectedStartShapeColor());n.setAttribute("stroke-dasharray","none");n.setAttribute("d",e.getConnectorStartPath(t,e.getGanttChartBase().getId(),e.getProcessedType()));s.setAttribute("stroke-width",1);s.setAttribute("fill",e.getSelectedEndShapeColor());s.setAttribute("stroke-dasharray","none");s.setAttribute("d",e.getConnectorEndPath(t,e.getGanttChartBase().getId(),e.getProcessedType()));r.appendChild(n);r.appendChild(s);return r};l.prototype.createOutlinePathNode=function(e,t){var i=document.createElementNS(d3.ns.prefix.svg,"path");i.setAttribute("id",e.getShapeUid()+"-selected");i.setAttribute("aria-hidden","false");i.setAttribute("class","resizeContainer sapGanttSelectedPath");var r=e.getSelectedStyle?e.getSelectedStyle():this.getSelectionInlineStyle(e);i.style=r;i.setAttribute("d",t);return i};l.prototype.determineOutlineByFrame=function(e,t){var i=this._getDomRef(e).getBBox(),r=false;if(e instanceof sap.gantt.simple.BaseGroup){var n=0,a;a=window.getComputedStyle(e.getDomRef()).transform.match(/matrix.*\((.+)\)/);if(a){n=a[1].split(",")[5];r=true}}var s=i.x,o=r?i.y+parseFloat(n):i.y,h=i.width,g=i.height,l=s+h,p=o+g;var d=this.getSelectionSettings().strokeWidth,m=d/2;s=s-m+t.x;o=r?o-m:o-m+t.y;l=l+m+t.x;p=r?p+m:p+m+t.y;var c=["M",s,o,"L",l,o,"L",l,p,"L",s,p,"z"].join(" ").trim();return c};l.prototype.removeOutline=function(e){var t=document.getElementById(e.getShapeUid()+"-selected");if(t){jQuery(t).remove()}};l.prototype.removeHighlight=function(e){var t=document.getElementById(e.getShapeUid()+"-highlighted");if(t){t.childNodes.forEach(function(e){e.remove()})}};l.prototype.removeDeltaOutline=function(e){var t=document.getElementById(e.getId()+"-selected");if(t){jQuery(t).remove()}};l.prototype.renderResizerOutline=function(e){this.removeOutline(e);var t=e.getConnectable(),i=e.getResizable();var r=this.getOutlineLines(e,true);var n=this.createResizeContainer(e);this.renderSelectionBorders(r,n);if(i){this.renderResizeTriggerAndCover(r,n,false,e,true);this.attachMousedownEvent()}if(t){this.renderShapeConnectTrigger(e,n);this.getGantt()._getConnectExtension().attachShapeConnectEvents()}if(this.isResizing()){this.updateDomSelector();this.updateOriginShapeFrame();this.attachResizeEvents()}};l.prototype.renderResizerOutlineOnMouseOver=function(e){this.removeOutline(e);var t=this.getOutlineLines(e,true);var i=this.createResizeContainer(e);this.renderSelectionBorders(t,i,true);this.renderResizeTriggerAndCover(t,i,true,false,true);this.attachMousedownEvent();if(this.isResizing()){this.updateDomSelector();this.updateOriginShapeFrame();this.attachResizeEvents()}};l.prototype.showShapeConnectTrigger=function(e){var t=this.getGantt()._getConnectExtension();var i=t.getRlsStartShape().shapeUid;return t.isShapeConnecting()?i===e.getShapeUid():true};l.prototype.renderSelectionBorders=function(e,t,i){t.selectAll(".border").data(e.border).enter().append("line").each(function(e){if(i){e.stroke="transparent"}d3.select(this).attr(e)}).attr("class",function(e){return"border "+e.class+"Line"})};l.prototype.renderResizeTriggerAndCover=function(e,t,i,r,n){t.selectAll(".lineTrigger").data(e.indicator).enter().append("line").each(function(e){d3.select(this).attr(e)}).attr("class",function(e){return"resizeTrigger lineTrigger "+e.class+"Trigger"}).attr({opacity:0,"stroke-width":3}).style({cursor:"ew-resize"});if(!i){var a=this.getResizeRectCoverAttrs(r,n);t.append("rect").attr(a).style({"pointer-events":"none"})}};l.prototype.renderHighlightBorders=function(e,t){t.selectAll(".border").data(e.border).enter().append("line").each(function(e){d3.select(this).attr(e)}).attr("class",function(e){return"border "+e.class+"Line"})};l.prototype.createResizeContainer=function(e,t){var i=t?this._getDeltaMarkerSelectionRootNode():this._getShapeSelectionRootNode();var r=t?e.getId():e.getShapeUid();var n=i.append("g").classed("resizeContainer",true).attr("id",r+"-selected").attr(a.SELECT_FOR_DATASET_KEY,r);return n};l.prototype.createHighlightContainer=function(e){var t=this._getShapeHighlightRootNode();var i=e.getShapeUid();var r=t.append("g").classed("highlightContainer",true).attr("id",i+"-highlighted").attr(a.SELECT_FOR_DATASET_KEY,i);return r};l.prototype.renderShapeConnectTrigger=function(e,t){var i=this.showShapeConnectTrigger(e);var r=this.getConnectSquaresData(i,e);t.selectAll(".rectTrigger").data(r.slice()).enter().append("rect").each(function(e){d3.select(this).attr(e)}).attr("class",function(e){return"shapeConnectTrigger rectTrigger "+e.class+"Trigger"}).attr({stroke:"#000","stroke-width":1})};l.prototype.attachMousedownEvent=function(){var e=jQuery(document.getElementById(this.getGantt().getId()+"-svg"));var t=e.find(".resizeTrigger");t.off(p);t.bind("mousedown"+p,jQuery.proxy(this.beforeResizing,this))};l.prototype.attachHeaderMouseEvent=function(){var e=jQuery(document.getElementById(this.getGantt().getId()+"-header-svg"));var t=e.find(".resizeTrigger");t.off(p);t.bind("mousedown"+p,jQuery.proxy(this.beforeDeltaResizing,this))};l.prototype.attachResizeEvents=function(){this._removeDragEvents();var e=jQuery(document);e.bind("mousemove"+p,jQuery.proxy(this.onResizing,this));e.bind("mouseup"+p,jQuery.proxy(this.endResizing,this));e.bind("keydown"+p,jQuery.proxy(this.onKeydown,this))};l.prototype.attachDeltaResizeEvents=function(){this._removeDragEvents();var e=jQuery(document);e.bind("mousemove"+p,jQuery.proxy(this.onDeltaResizing,this));e.bind("mouseup"+p,jQuery.proxy(this.onDeltaResize,this));e.bind("keydown"+p,jQuery.proxy(this.onKeydown,this))};l.prototype._removeDragEvents=function(){var e=jQuery(document);e.off(p)};l.prototype.beforeResizing=function(e){var t=jQuery(e.target),i=t.parents("g").attr(a.SELECT_FOR_DATASET_KEY);var r=this._getShapeByUid(i);if(!r||e.button!==0){return}this.setFrame(this._getDomRef(r).getBBox());this.updateDomSelector(e);this.origin.eventTarget=e.target;this.updateOriginShapeFrame();this.origin.resizeFor=i;if(t.hasClass("leftTrigger")){this.currentAction=c.LeftResize}else{this.currentAction=c.RightResize}this._updateResizingEffect(true);this.attachResizeEvents()};l.prototype.beforeDeltaResizing=function(e){var t=jQuery(e.target),r=t.parents("g").attr(a.SELECT_FOR_DATASET_KEY);var s=i.byId(r);if(!s||e.button!==0){return}var o=n.getEventSVGPoint(this.getDomRefs().headerSvg,e),h=e.target.getBBox();this.mResizePoint={cursorX:o.x,cursorY:o.y,shapeX:h.x,shapeY:h.y,shapeWidth:h.width};this.setFrame(s.getDomRef().getBBox());this.updateDomSelector(e);this.origin.eventTarget=e.target;this.updateOriginShapeFrame();this.origin.resizeFor=r;if(t.hasClass("leftTrigger")){this.currentAction=c.LeftResize}else{this.currentAction=c.RightResize}this._updateResizingEffect(true);this.attachDeltaResizeEvents();this.deltaResize=true};l.prototype.updateOriginShapeFrame=function(){var e=this.getFrame();this.origin.minX=e.x;this.origin.maxX=e.x+e.width};l.prototype.onResizing=function(e){if(this._shallSkip(e)){return}this._updateResizingEffect(true);var t=this.getSvgElement();var i=n.getEventSVGPoint(t,e).x;var r=this.getGantt()._getPointerExtension();i=i+r._getAutoScrollStep();if(this.currentAction===c.RightResize){this._updateRightPartDoms(i)}else if(this.currentAction===c.LeftResize){this._updateLeftPartDoms(i)}};l.prototype.onDeltaResizing=function(e){if(this._shallSkip(e)){return}this._updateResizingEffect(true);var t=this.getHeaderSvgElement();var i=n.getEventSVGPoint(t,e).x;var r=this.getGantt()._getPointerExtension();i=i+r._getAutoScrollStep();if(this.currentAction===c.RightResize){this._updateRightPartDoms(i,e)}else if(this.currentAction===c.LeftResize){this._updateLeftPartDoms(i,e)}if(e){if(!this.deltaResizeStart){this.$ghost=this.createResizeGhost(i,this.currentAction);this.deltaResizeStart=true}else{if(this._isValidResize(i)){this.showGhost(e)}}}};l.prototype._isValidResize=function(e){if(this.currentAction===c.LeftResize){return!(e>this.mElementFrame.x+this.mElementFrame.width)}else if(this.currentAction===c.RightResize){return!(e<this.mElementFrame.x)}};l.prototype._updateResizingEffect=function(e){var t=e?.4:0;this.mDoms.resizeRectCover.attr("opacity",t)};l.prototype.isResizing=function(){return this.currentAction===c.LeftResize||this.currentAction===c.RightResize};l.prototype.removeGhost=function(){this.$ghost=null;jQuery(document.getElementById("sapGanttDragGhostWrapper")).remove()};l.prototype._updateRightPartDoms=function(e,t){var i=function(e){if(e-this.origin.minX<=2*this.getMargin()){return this.origin.minX+2*this.getMargin()}return e}.bind(this);var r=i(e);this.mDoms.rightLine.attr({x1:r,x2:r});this.mDoms.rightLineTrigger.attr({x1:r,x2:r});this.mDoms.topLine.attr({x2:r});this.mDoms.bottomLine.attr({x2:r});this.mDoms.rightRectTrigger.attr({x:r+a.SHAPE_CONNECT_INDICATOR_WIDTH/2-2});var n=r-this.origin.minX;this.mDoms.resizeRectCover.attr({width:n})};l.prototype.showGhost=function(e){var t=this.calcGhostAligmentForLines(e);var i=a.getTimeLabel(e,this.getGantt().getAxisTime(),this.getGantt().getLocale(),this.getDomRefs().headerSvg);document.getElementById("sapGanttDragText").innerText=i;jQuery(document.getElementById("sapGanttDragGhostWrapper")).css(t).css({visibility:"visible"})};l.prototype.calcGhostAligmentForLines=function(e){var t=n.xPosOfEvent(e);var i=n.getSvgScreenPoint(this.getDomRefs().headerSvg,{pageX:this.mResizePoint.cursorX,clientX:this.mResizePoint.cursorX,pageY:this.mResizePoint.cursorY,clientY:this.mResizePoint.cursorY});return{left:t+"px",top:i.y+"px"}};l.prototype.createResizeGhost=function(e,t){var r=jQuery("<div id='sapGanttDragGhostWrapper'></div>");jQuery(document.body).append(r);var n=document.createElement("canvas");var s=this.origin.eventTarget.getBBox();n.width=1;n.height=s.height;var o=jQuery(this.origin.eventTarget),h=o.parents("g").attr(a.SELECT_FOR_DATASET_KEY);var g=i.byId(h);var l=g.getParent(),p={};if(l.getVisibleDeltaStartEndLines()){var d=l._getStartLine();var m=l._getEndLine();var c=l._getHeaderStartLine();var u=l._getHeaderEndLine();var f=document.getElementById(d.sId);var v=document.getElementById(m.sId);var S=document.getElementById(c.sId);var y=document.getElementById(u.sId);p={headerStartLine:S,startLine:f,headerEndLine:y,endLine:v};var T=S.getBBox();var R=f.getBBox();n.height+=R.height+T.height}this.createGhostImage(this.origin.eventTarget,n,p);return r};l.prototype.createGhostImage=function(e,t,i){var r=this.serializeClonedSvg(t,e,i);var n=this._b64EncodeUnicode(r);var a="data:image/svg+xml;base64,"+n;this.appendGhostImageToWrapper(e,a)};l.prototype._b64EncodeUnicode=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function e(t,i){return String.fromCharCode("0x"+i)}))};l.prototype.serializeClonedSvg=function(e,t,r){var n=d3.ns.prefix.svg;var a=document.createElementNS(n,"svg");a.setAttribute("width",e.width);a.setAttribute("height",e.height);var s=document.createElementNS(n,"g");var o=i.byId(this.origin.shapeUid).getParent();if(o.getVisibleDeltaStartEndLines()){var h=r.headerEndLine.getBBox();s.setAttribute("transform","translate("+-h.x+", "+-h.y+")");var g=r.headerEndLine.cloneNode(true);s.appendChild(g);var l=r.endLine.cloneNode(true);s.appendChild(l)}var p=this.getGantt().getSvgDefs();if(p){var d=jQuery(document.getElementById(p.getId())).get(0).cloneNode(true);a.appendChild(d)}a.appendChild(s);return(new XMLSerializer).serializeToString(a)};l.prototype.appendGhostImageToWrapper=function(e,t){var i=jQuery(document.getElementById("sapGanttDragGhostWrapper"));jQuery("<div class='sapGanttDragGhost'>"+"<img class='sapGanttDragGhostImg' src='"+t+"'>"+"<div id='sapGanttDragText' class='sapGanttDragTextOverlay'></div>"+"</div>").appendTo(i)};l.prototype._updateLeftPartDoms=function(e){var t=function(e){var t=this.origin.maxX;var i=2*this.getMargin();if(t-e<=i){return t-i}return e}.bind(this);var i=t(e);this.mDoms.leftLine.attr({x1:i,x2:i});this.mDoms.leftLineTrigger.attr({x1:i,x2:i});this.mDoms.topLine.attr({x1:i});this.mDoms.bottomLine.attr({x1:i});this.mDoms.leftRectTrigger.attr({x:i-this.getMargin()-a.SHAPE_CONNECT_INDICATOR_WIDTH-2});var r=Math.abs(i-u(this.mDoms.rightLineTrigger,"x1"))-2;this.mDoms.resizeRectCover.attr({x:i+this.getMargin(),width:r<0?0:r})};l.prototype.onKeydown=function(e){if(e.keyCode===t.ESCAPE){if(this.isResizing()){this._updateLeftPartDoms(this.origin.minX-this.getMargin());this._updateRightPartDoms(this.origin.maxX+this.getMargin());this._updateResizingEffect(false);this._initResizeStatus()}this._removeDragEvents()}};l.prototype.endResizing=function(e){this._removeDragEvents();if(this._shallSkip(e)){return}var t=u(this.mDoms.leftLine,"x1")+this.getMargin(),i=u(this.mDoms.rightLine,"x1")-this.getMargin();var r=this._getShapeByUid(this.origin.resizeFor),n=this.getGantt();if(r){this.renderResizerOutline(r);this._fireShapeResizeEvent(n,r,t,i);if(n.getEnablePseudoShapes()){var s=h.parseUid(this.origin.resizeFor).rowIndex;n.pseudoShapeSpecificData=n.pseudoShapeSpecificData?n.pseudoShapeSpecificData:{};n.pseudoShapeSpecificData.resizedShape=r;n.pseudoShapeSpecificData.resizedShapeRowIndex=s;n.pseudoShapeSpecificData.needUpdateForTasksInAggr=true}a.rerenderAssociatedRelationships(n,r)}this._initResizeStatus()};l.prototype.onDeltaResize=function(e){var t=jQuery(this.origin.eventTarget),r=t.parents("g").attr(a.SELECT_FOR_DATASET_KEY);var n=i.byId(r);var s=n.getParent();var o=this._getDeltaResizeEventData(e);if(o){s.fireDeltalineResize(o)}this.removeGhost();this._initResizeStatus();this._removeDragEvents()};l.prototype._getDeltaResizeEventData=function(e){var t=i.getConfiguration().getRTL();var r=jQuery(this.origin.eventTarget),s=r.parents("g").attr(a.SELECT_FOR_DATASET_KEY);var o=i.byId(s);var h=o.getParent();var l=n.getEventSVGPoint(this.getDomRefs().headerSvg,e);var p=this.getGantt();var d=p.getAxisTime();var m=g.dateToAbapTimestamp(d.viewToTime(l.x));if(t){if(this.currentAction===c.LeftResize){if(l.x>this.mElementFrame.x+this.mElementFrame.width){m=g.dateToAbapTimestamp(d.viewToTime(this.mElementFrame.x+this.mElementFrame.width))}return{newTimeStamp:h.getTimeStamp(),newEndTimeStamp:m,oldTimeStamp:h.getTimeStamp(),oldEndTimeStamp:h.getEndTimeStamp()}}else{if(l.x<this.mElementFrame.x){m=g.dateToAbapTimestamp(d.viewToTime(this.mElementFrame.x))}return{newTimeStamp:m,newEndTimeStamp:h.getEndTimeStamp(),oldTimeStamp:h.getTimeStamp(),oldEndTimeStamp:h.getEndTimeStamp()}}}else{if(this.currentAction===c.LeftResize){if(l.x>this.mElementFrame.x+this.mElementFrame.width){m=g.dateToAbapTimestamp(d.viewToTime(this.mElementFrame.x+this.mElementFrame.width))}return{newTimeStamp:m,newEndTimeStamp:h.getEndTimeStamp(),oldTimeStamp:h.getTimeStamp(),oldEndTimeStamp:h.getEndTimeStamp()}}else if(this.currentAction===c.RightResize){if(l.x<this.mElementFrame.x){m=g.dateToAbapTimestamp(d.viewToTime(this.mElementFrame.x))}return{newTimeStamp:h.getTimeStamp(),newEndTimeStamp:m,oldTimeStamp:h.getTimeStamp(),oldEndTimeStamp:h.getEndTimeStamp()}}}};l.prototype._getShapeByUid=function(e){var t=a.getShapesWithUid(this.getGantt().getId(),[e]);if(t.length>0){return t[0]}};l.prototype._fireShapeResizeEvent=function(e,t,r,n){var a,s;if(i.getConfiguration().getRTL()){a=n===this.origin.maxX?t.getTime():e.getAxisTime().viewToTime(n);s=r===this.origin.minX?t.getEndTime():e.getAxisTime().viewToTime(r)}else{a=r===this.origin.minX?t.getTime():e.getAxisTime().viewToTime(r);s=n===this.origin.maxX?t.getEndTime():e.getAxisTime().viewToTime(n)}e.fireShapeResize({shape:t,shapeUid:t.getShapeUid(),rowObject:t.getParent(),oldTime:[t.getTime(),t.getEndTime()],newTime:[a,s]})};l.prototype._initResizeStatus=function(){this.currentAction=c.None;this.origin={minX:-1,maxX:-1,eventTarget:null,resizeFor:null};this.mElementFrame=null;this.iOutlineMargin=0;this.initDomSelector();this.deltaResize=false;this.deltaResizeStart=false;this.$ghost=null;this.mResizePoint={}};l.prototype.setFrame=function(e){this.mElementFrame=e};l.prototype.getFrame=function(){return this.mElementFrame};l.prototype.setMargin=function(e){this.iOutlineMargin=e};l.prototype.getMargin=function(){return this.iOutlineMargin};l.prototype._shallSkip=function(e){if(!this.isResizing()){return true}if(this.origin.eventTarget&&!jQuery(this.origin.eventTarget).hasClass("resizeTrigger")){return true}return false};l.prototype.getConnectSquaresData=function(e,t){var i=this.getFrame(),r=i.x,n=i.y,s=i.width,o=i.height,g=this.getMargin(),l=false;if(t instanceof sap.gantt.simple.BaseGroup){var p=0,d;d=window.getComputedStyle(t.getDomRef()).transform.match(/matrix.*\((.+)\)/);if(d){p=d[1].split(",")[5];l=true}n=i.y+parseFloat(p)}var m=e?a.SHAPE_CONNECT_INDICATOR_WIDTH:0;var c={width:m,height:m,stroke:"#000","stroke-width":1};var u=h.getShapeBias(t);var f;if(t.getDomRef("nonLabelGroup")){f=3/4}else{f=1/2}var v=r-g-m-2+u.x,S=l?n+o*f-m/2:n+o*f-m/2+u.y;var y=r+s+g+2+u.x,T=S;return[jQuery.extend({x:v,y:S,class:"left"},c),jQuery.extend({x:y,y:T,class:"right"},c)]};l.prototype._getShapeSelectedFill=function(e){if(e.isA("sap.gantt.simple.BaseConditionalShape")){e=e._getActiveShapeElement()}if(e&&(e.getSelectedFill()||e.getSelectedTitleColor())){this._bShapeSelectedFill=true}else if(e instanceof sap.gantt.simple.BaseGroup){if(this.getGantt().getSelectOnlyGraphicalShape()){e._eachChildOfGroup(e,function(e,t){t.forEach(function(e){if(!this._bShapeSelectedFill){this._getShapeSelectedFill(e)}}.bind(this))}.bind(this))}else{e._eachChildOfGroup(e,function(e){if(!this._bShapeSelectedFill){this._getShapeSelectedFill(e)}}.bind(this))}}};l.prototype.getResizeRectCoverAttrs=function(e,t){var i=this.getFrame(),r=this.getMargin(),n=e.getHighlightable()?this.getHighlightSettings():this.getSelectionSettings(),a=n.strokeWidth,o=false;var h=n.shapeColor;if(h){h=h.substr(0,1)==="@"?h.substring(1):h}this._bShapeSelectedFill=false;var g=t&&(this._getShapeSelectedFill(e)||this._bShapeSelectedFill);var l=s.get(h)?s.get(h):h;var p={stroke:"none","stroke-width":0,fill:g?null:l,class:"resizeCover",opacity:g?0:n.fillOpacity};if(e instanceof sap.gantt.simple.BaseGroup){var d,m=0;d=window.getComputedStyle(e.getDomRef()).transform.match(/matrix.*\((.+)\)/);if(d){m=d[1].split(",")[5];o=true}}var c=2*r-2*a;return jQuery.extend({x:i.x-r+a,y:o?i.y-r+a+parseFloat(m):i.y-r+a,width:i.width+c,height:i.height+c},p)};l.prototype.getOutlineLines=function(e,t){var i=this.getFrame(),r=i.x,n=i.y,a=i.width,o=i.height,g=this.getMargin(),l=false;if(e instanceof sap.gantt.simple.BaseGroup){var p,d=0;p=window.getComputedStyle(e.getDomRef()).transform.match(/matrix.*\((.+)\)/);if(p){d=p[1].split(",")[5];l=true}n=i.y+parseFloat(d)}var m=this.getSelectionSettings();var c=m.shapeColor;var u=m.color;if(c){c=c.substr(0,1)==="@"?c.substring(1):c}if(u){u=u.substr(0,1)==="@"?u.substring(1):u}this._bShapeSelectedFill=false;var f=t&&(this._getShapeSelectedFill(e)||this._bShapeSelectedFill);var v={"stroke-dasharray":m.strokeDasharray,fill:s.get(u)?s.get(c):c,"fill-opacity":m.fillOpacity,stroke:s.get(u)?s.get(u):u,"stroke-width":f?0:m.strokeWidth};var S=h.getShapeBias(e);var y={minX:r-g+S.x,minY:l?n-g:n-g+S.y,maxX:r+a+g+S.x,maxY:l?n+o+g:n+o+g+S.y};var T={top:{x1:y.minX,y1:y.minY,x2:y.maxX,y2:y.minY},right:{x1:y.maxX,y1:y.minY,x2:y.maxX,y2:y.maxY},bottom:{x1:y.minX,y1:y.maxY,x2:y.maxX,y2:y.maxY},left:{x1:y.minX,y1:y.minY,x2:y.minX,y2:y.maxY}};var R=["top","right","bottom","left"];var E=R.map(function(e){return jQuery.extend(T[e],{class:e},v)});var x=jQuery.extend(true,T);var D=["left","right"].map(function(e){return jQuery.extend(x[e],{class:e},v)});return{border:E,indicator:D}};l.prototype.getHighlightOutLines=function(e){var t=this.getFrame(),i=t.x,r=t.y,n=t.width,a=t.height;var o=this.getMargin();var g=this.getHighlightSettings();var l=g.shapeColor;var p=g.color;if(l){l=l.substr(0,1)==="@"?l.substring(1):l}if(p){p=p.substr(0,1)==="@"?p.substring(1):p}var d={"stroke-dasharray":g.strokeDasharray,fill:s.get(p)?s.get(l):l,"fill-opacity":g.fillOpacity,stroke:s.get(p)?s.get(p):p,"stroke-width":g.strokeWidth};var m=h.getShapeBias(e);var c={minX:i-o+m.x,minY:r-o+m.y,maxX:i+n+o+m.x,maxY:r+a+o+m.y};var u={top:{x1:c.minX,y1:c.minY,x2:c.maxX,y2:c.minY},right:{x1:c.maxX,y1:c.minY,x2:c.maxX,y2:c.maxY},bottom:{x1:c.minX,y1:c.maxY,x2:c.maxX,y2:c.maxY},left:{x1:c.minX,y1:c.minY,x2:c.minX,y2:c.maxY}};var f=["top","right","bottom","left"];var v=f.map(function(e){return Object.assign(u[e],{class:e},d)});var S=Object.assign({},u);var y=["left","right"].map(function(e){return Object.assign(S[e],{class:e},d)});return{border:v,indicator:y}};l.prototype._getResizeTime=function(e){var t=u(this.mDoms.leftLine,"x1")+this.getMargin(),r=u(this.mDoms.rightLine,"x1")-this.getMargin();if(isNaN(t)||isNaN(r)){return null}var n=this.getGantt();var a=n.getAxisTime().viewToTime(t),s=n.getAxisTime().viewToTime(r),o;var h=i.getConfiguration().getRTL();if(h){o=s;s=a;a=o}return{time:a,endTime:s}};l.prototype._getDomRef=function(e){return e.getDomRef("nonLabelGroup")?e.getDomRef("nonLabelGroup"):e.getDomRef()};return l});
//# sourceMappingURL=GanttResizeExtension.js.map