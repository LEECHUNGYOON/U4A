/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["./AggregationUtils","./GanttUtils","sap/ui/core/Core","../library","sap/ui/Device","../misc/Utility","sap/ui/core/theming/Parameters","../misc/Format"],function(e,t,i,a,n,r,l,o){"use strict";var s=13;var g=a.simple.horizontalTextAlignment;var p={apiVersion:2,RENDER_EXTEND_FACTOR:.382,getGanttRenderWidth:function(e){var t=jQuery(document.getElementById(e.getId()+"-gantt")).width();return e.getHorizontalLazyLoadingEnabled()&&!e._isAllDataLoadedPromiseResolved?t:t*(1+2*p.RENDER_EXTEND_FACTOR)},renderAttributes:function(e,t,i){var a=i.map(function(e){var i=e.split("-").reduce(function(e,t){return e+t.charAt(0).toUpperCase()+t.slice(1)},"get");return{name:e,value:t[i]()}});a.forEach(function(t){if(t.value||t.value===0){if(t.name==="style"){var i=t.value.split(";");i.forEach(function(t){t=t.trim();if(t!=""){var i=t.split(/:(.*)/);if(i[0]==="fill"&&i[1].indexOf(" ")!=-1){i[1]=encodeURI(i[1])}e.style(i[0],i[1])}})}else{e.attr(t.name,t.value)}}})},renderTooltip:function(e,t){if(t.getTooltip()){e.openStart("title").openEnd();e.text(t.getTooltip());e.close("title")}},updateShapeSelections:function(e,i,a){if(e._getResizeExtension==null){return}var n=e._getResizeExtension();var r=e.getId();t.getShapesWithUid(r,a).forEach(function(t){if(t){this._bShapeSelectionProperties=false;this._hasShapeSelectionProperties(t,e);if(this._bShapeSelectionProperties){this._updateShapeStyle(t,false,e,0)}if(t.isA("sap.gantt.simple.shapes.Shape")){t.setSelected(false)}else if(t.getParent().isA("sap.gantt.simple.BaseConditionalShape")){t.getParent().setProperty("selected",false,true)}else{t.setProperty("selected",false,true)}}}.bind(this));n.clearAllOutline(r);t.getShapesWithUid(r,i).forEach(function(t){if(t){if(t.getProperty("selectable")){this._bShapeSelectionProperties=false;this._hasShapeSelectionProperties(t,e);if(this._bShapeSelectionProperties){this._updateShapeStyle(t,true,e,0)}if(t.isA("sap.gantt.simple.shapes.Shape")){t.setSelected(true)}else if(t.getParent().isA("sap.gantt.simple.BaseConditionalShape")){t.getParent().setProperty("selected",true,true);n.toggleOutline(t)}else{t.setProperty("selected",true,true);n.toggleOutline(t)}}e.getSelection().updateProperties(t.getShapeUid(),{draggable:t.getDraggable(),time:t.getTime(),endTime:t.getEndTime()})}}.bind(this))},_hasShapeSelectionProperties:function(e,t){if(!e||e.isA("sap.gantt.simple.Relationship")){return}if(e.isA("sap.gantt.simple.BaseConditionalShape")){e=e._getActiveShapeElement()}if(e&&(e.getSelectedFill()||e.getSelectedTitleColor())){this._bShapeSelectionProperties=true}else if(e instanceof sap.gantt.simple.BaseGroup){if(t.getSelectOnlyGraphicalShape()){e._eachChildOfGroup(e,function(e,i){i.forEach(function(e){if(!this._bShapeSelectionProperties){this._hasShapeSelectionProperties(e,t)}}.bind(this))}.bind(this))}else{e._eachChildOfGroup(e,function(e){if(!this._bShapeSelectionProperties){this._hasShapeSelectionProperties(e,t)}}.bind(this))}}},_updateShapeStyle:function(e,t,i,a,n,r){if(!e||e.isA("sap.gantt.simple.Relationship")||!e.getVisible()){return}if(e.isA("sap.gantt.simple.BaseConditionalShape")&&e._getActiveShapeElement()){this._updateShapeStyle(e._getActiveShapeElement(),t,i,a,n,r)}else if(e.isA("sap.gantt.simple.BaseGroup")){if(i.getSelectOnlyGraphicalShape()){e._eachChildOfGroup(e,function(e,l){l.forEach(function(e){var l=this._updateGroupShapeStyle(e,t,i,a,n,r);a=l}.bind(this))}.bind(this))}else{e._eachChildOfGroup(e,function(e){var l=this._updateGroupShapeStyle(e,t,i,a,n,r);a=l}.bind(this))}}else{this._updateShapeSelectionStyle(e,t,n,r)}},_updateGroupShapeStyle:function(e,t,i,a,n,r){if(!e||e.isA("sap.gantt.simple.Relationship")||!e.getVisible()){return a}r=r||{};var l=e.getParent();var o=l.getFill()||r.fill;var s=l.getTitleColor()||r.titleColor;var g=l.getSelectedFill()||r.selectedFill;var p=l.getSelectedTitleColor()||r.selectedTitleColor;var h=l.getDomRef("nonLabelGroup")?l.getDomRef("nonLabelGroup"):l.getDomRef()||n;if(h){var d=h.children||h.childNodes;while(a<d.length&&d[a].tagName==="title"){a+=1}this._bUpdatedTitle=false;var c=e.isA("sap.gantt.simple.BaseGroup")||e.isA("sap.gantt.simple.BaseConditionalShape")&&e._getActiveShapeElement()&&e._getActiveShapeElement().isA("sap.gantt.simple.BaseGroup");var f=c?0:a;var S={fill:o,titleColor:s,selectedFill:g,selectedTitleColor:p};this._updateShapeStyle(e,t,i,f,h.children[a],S);var u=this._bUpdatedTitle&&!c?2:1;a+=u}return a},_updateShapeSelectionStyle:function(e,t,i,a){a=a||{};var n=e.getFill()||a.fill;var r=e.getTitleColor()||a.titleColor;var o=t?e.getSelectedFill()||a.selectedFill||n:n;var s=l.get("sapUiBaseText");var g=e.isA("sap.gantt.simple.BaseText")?r||n||s:r||s;var p=e.isA("sap.gantt.simple.BaseText")?e.getSelectedFill()||a.selectedFill:null;var h=t?e.getSelectedTitleColor()||a.selectedTitleColor||p||g:g;var d=i?i:document.getElementById(e.getId());if(d){d.style.fill=e.isA("sap.gantt.simple.BaseText")?h:o;var c=d.nextSibling;if(c&&c.tagName==="text"&&e.getShowTitle()&&e.getTitle()){c.style.fill=h;this._bUpdatedTitle=true}}},updateShapeHighlights:function(e,i,a){if(e._getResizeExtension==null){return}var n=e._getResizeExtension();var r=e.getId();t.getShapesWithUid(r,a).forEach(function(e){if(e){if(e.isA("sap.gantt.simple.shapes.Shape")){e.setHighlighted(false)}else if(e.getParent().isA("sap.gantt.simple.BaseConditionalShape")){e.getParent().setProperty("highlighted",false,true)}else{e.setProperty("highlighted",false,true)}}});n.clearAllHighlight(r);t.getShapesWithUid(r,i).forEach(function(t){if(t){if(t.getProperty("highlightable")){if(t.isA("sap.gantt.simple.shapes.Shape")){t.setHighlighted(true)}else if(t.getParent().isA("sap.gantt.simple.BaseConditionalShape")){t.getParent().setProperty("highlighted",true,true);n.toggleHighlight(t)}else{t.setProperty("highlighted",true,true);n.toggleHighlight(t)}}e.getHighlight().updateProperties(t.getShapeUid(),{time:t.getTime(),endTime:t.getEndTime()})}})},updateShapeSelectionByShapeID:function(e,t){if(e._getResizeExtension==null){return}var i=e.getSelection().getSelectedShapeIDS();var a=e.getSelection().getDeSelectedShapeIDS();var n=e.getSelection().getSelectedRowIDS();var r=e.getSelection().getDeSelectedRowIDS();if(i&&i.length>0){this._updateShapeSelection(e,i,true)}if(n&&n.length>0){this._updateRowSelection(e,n,true)}if(a&&a.length>0){this._updateShapeSelection(e,a,false)}if(r&&r.length>0){this._updateRowSelection(e,r,false,t)}},_updateShapeSelection:function(e,i,a){var n=e.getId();if(!a){i.forEach(function(t){e.oSelection.mSelected.deSelectShapeId[t]={selected:a}})}t.getShapeByShapeId(n,i).forEach(function(t){this._updateShapes(t,a,e)}.bind(this))},_updateRowSelection:function(e,i,a,n){var r=e.getId();var l=e.searchTxt;if(!a){l=e.deSelectTxt}if(n){t.getShapesInRowsById(r,i).forEach(function(t){if(t&&(!a||t.getProperty("selectable"))){if(t.mProperties.shapeId){e.getSelection().updateShapeId(t.getShapeId(),a)}this._updateShapes(t,a,e)}}.bind(this))}else if(l!==null&&l!==undefined){t.getShapesInRowsById(r,i).forEach(function(t){if(t){var i=this._selectShapeBySearchText(e,t,a);if(i&&(!a||t.getProperty("selectable"))){if(t.mProperties.shapeId){e.getSelection().updateShapeId(t.getShapeId(),a)}this._updateShapes(t,a,e);if(!a){e.getSelection().clearSelectionByUid(t.getShapeUid(),true)}}}}.bind(this))}},_updateShapes:function(e,t,i){e.setProperty("selected",t,true);if(t){i.getSelection().updateProperties(e.getShapeUid(),{draggable:e.getDraggable(),time:e.getTime(),endTime:e.getEndTime()},true)}else{i.getSelection().clearSelectionByUid(e.getShapeUid(),false)}},updateShapeHighlightByShapeID:function(e,t){if(e._getResizeExtension==null){return}var i=e.getHighlight().getHighlightedShapeID();var a=e.getHighlight().getDeEmphasizedShapeID();if(i&&i.length>0){this._updateShapeHighlight(e,i,true)}if(a&&a.length>0){this._updateShapeHighlight(e,a,false)}},_updateShapeHighlight:function(e,i,a){var n=e.getId();t.getShapeByShapeId(n,i).forEach(function(t){this._updateShapeAttributes(t,a,e)}.bind(this))},_updateShapeAttributes:function(e,t,i){e.setProperty("highlighted",t,true);if(t){i.getHighlight().updateProperties(e.getShapeUid(),{time:e.getTime(),endTime:e.getEndTime()},true)}else{i.getHighlight().clearHighlightByUid(e.getShapeUid())}},_selectShapeBySearchText:function(e,t,i){var a=false;var n=e.getTable().getBindingInfo("rows").model;var r=e.searchProperty;if(!i){r=e.deSelectProperty}function l(t){if(i){e.searchTxt.forEach(function(e){if(t!==undefined&&t!==null&&t.toString().toLowerCase().indexOf(e.toString().toLowerCase())!==-1){a=true}})}else{if(t!==undefined&&t!==null&&t.toString().toLowerCase().indexOf(e.deSelectTxt.toString().toLowerCase())!==-1){a=true}}}if(Array.isArray(r)&&r.length>0){r.forEach(function(e){if(a){return}var i=t.getBindingContext(n).getProperty(e);l(i)})}else if(typeof r==="string"){var o=t.getBindingContext(n).getProperty(r);l(o)}else{var s=t.getBindingContext(n).getObject();if(s){Object.keys(s).forEach(function(e){if(a){return}l(s[e])})}}return a},getShapeElementByTarget:function(e){return jQuery(this.getDraggableDOMElement(e)).control(0,true)},getDraggableDOMElement:function(e){return jQuery(e).closest("["+t.SHAPE_ID_DATASET_KEY+"]").get(0)},addTitleSpacing:function(e,t){if(e.titleSpacing){e.x=t?e.x-e.titleSpacing:e.x+e.titleSpacing}},renderElementTitle:function(e,t,a){if(t.getShowTitle==null||!t.getShowTitle()){return}var n=t.getTitle();if(n){var o=0,p=0,h=0;if(t.getWidth){p=t.getWidth();h=t.getWidth()}if(t.getHeadWidth){o=t.getHeadWidth();p-=o}if(t.getTailWidth){p-=t.getTailWidth()}var d=2+o+2;var c={text:n,fill:t.getTitleColor()||l.get("sapUiBaseText"),showEllipsis:true,truncateWidth:p-t.getTitleSpacing(),textAnchor:t.getHorizontalTextAlignment().toLowerCase(),verticalTextAlignment:t.getVerticalTextAlignment(),fontWeight:t.getFontWeight(),fontFamily:t.getFontFamily(),fontSize:t.getFontSize()||s};var f=i.getConfiguration().getRTL();if(t.getTitleSpacing()){if(c.textAnchor===g.End.toLowerCase()){c.titleSpacing=-t.getTitleSpacing()}else{c.titleSpacing=t.getTitleSpacing()}}var S=t.getGanttChartBase();var u=t.getParent(),x;var v=S&&S.getEnablePseudoShapes()&&u&&u.isPseudoShape;if(v){x=t.getParent().getButton()[0].getHeight()}c.x=this._calculateX(t,c.textAnchor,t.getX(),t.getWidth(),d,undefined,c,x,v);this.setVerticalAlignment(t,c);var m=r.getShapeBias(t);c.x=c.x+m.x;c.y=c.y+m.y;this.addTitleSpacing(c,f);var y=a(c).addStyleClass("sapGanttTextNoPointerEvents");y.setProperty("childElement",true,true);y.bPseudoShape=v;y.oTextElement=t;y.iIconHeight=x;var T=y._truncateText(y.getText(),v,x);var E,P=y.getTruncateWidth();if(u&&u.getAggregation("task")){u.getAggregation("task").truncatedTextWidth=P}if(v){if(T.ellipsis){E=y.measureTextWidth(T.truncatedText+"...")}else{E=y.measureTextWidth(T.truncatedText)}}var w=E+(2+x);if(!(w<=P)&&v){if(c.textAnchor===g.Dynamic.toLowerCase()){if(!f){y.setProperty("x",c.x-(2+x),true)}else{y.setProperty("x",c.x+(2+x+4),true)}}else if(c.textAnchor===g.Start.toLowerCase()){if(!f){y.setProperty("x",c.x-(2+x+4),true)}else{y.setProperty("x",c.x+(2+x+4),true)}}else if(c.textAnchor===g.Middle.toLowerCase()){if(!f){y.setProperty("x",c.x-(2+x)/2,true)}else{y.setProperty("x",c.x+(2+x)/2,true)}}else if(c.textAnchor===g.End.toLowerCase()){if(!f){y.setProperty("x",c.x+4,true)}else{y.setProperty("x",c.x-4,true)}}}y.renderElement(e,y)}},_calculateX:function(e,t,a,n,r,l,o,s,p){var h=i.getConfiguration().getRTL(),d,c;if(t===g.Start.toLowerCase()){d=p?a+r+(2+s):a+r;c=p?a+n-r-(2+s):a+n-r;a=h?c:d}else if(t===g.End.toLowerCase()){d=l?a+n-r-(2+s)-l:a+n-r;c=l?a+r+l+(2+s):a+r;a=h?c:d}else if(t===g.Middle.toLowerCase()){if(!l&&!p){a=a+n/2}else{d=l?a+n/2-(l+(2+s))/2:a+n/2+(2+s)/2;c=l?a+n/2+(l+(2+s))/2:a+n/2-(2+s)/2;a=h?c:d}}else if(t===g.Dynamic.toLowerCase()){if(l){this.renderDynamicText(e,o,r,null,a)}else{this.renderDynamicText(e,o,r)}if(p){if(h){o.x=o.x-r-(2+s)}else{o.x=o.x+(2+s)}a=o.x}else if(l){if(h){a=a+n-r}a=o.x?o.x:a}else{a=o.x}}return a},renderCalenderTitle:function(e,t,a,n){var r=t.title;var o=t.baseCalender;if(r){var p=0,h=0;if(a.width){p=a.width;h=a.width}var d={text:r,fill:o.getTitleColor()||l.get("sapUiBaseText"),showEllipsis:true,truncateWidth:p-o.getTitleSpacing(),textAnchor:o.getHorizontalTextAlignment(),verticalTextAlignment:o.getVerticalTextAlignment(),fontWeight:o.getFontWeight(),fontSize:o.getFontSize()||s,fontFamily:o.getFontFamily()};var c=i.getConfiguration().getRTL();if(o.getTitleSpacing()){if(d.textAnchor.toLowerCase()===g.End.toLowerCase()){d.titleSpacing=-o.getTitleSpacing()}else{d.titleSpacing=o.getTitleSpacing()}}if(d.textAnchor.toLowerCase()===g.Start.toLowerCase()){d.x=c?a.x+a.width:a.x}else if(d.textAnchor.toLowerCase()===g.End.toLowerCase()){d.x=c?a.x:a.x+a.width}else if(d.textAnchor.toLowerCase()===g.Middle.toLowerCase()){d.x=a.x+a.width/2}else if(d.textAnchor.toLowerCase()===g.Dynamic.toLowerCase()){this.renderDynamicText(o,d,0,a)}if(d.verticalTextAlignment==="Top"){d.y=a.height/2-1}else if(d.verticalTextAlignment==="Bottom"){d.y=a.height/2+d.fontSize-1}else{d.y=a.height/2+d.fontSize/2-1}this.addTitleSpacing(d,c);var f=n(d).addStyleClass("sapGanttTextNoPointerEvents");f.setProperty("childElement",true,true);f.renderElement(e,f)}},setVerticalAlignment:function(e,t){if(t.verticalTextAlignment==="Top"){t.y=e.getY()+t.fontSize-1}else if(t.verticalTextAlignment==="Bottom"){t.y=e.getY()+parseInt(e.getHeight(),10)-1}else{t.y=e.getY()+parseInt(e.getHeight()/2,10)+t.fontSize/2.5}},renderDynamicText:function(e,t,a,n,r){var l=i.getConfiguration().getRTL();var s=o.abapTimestampToDate(e.getAxisTime()._oZoomStrategy.getVisibleHorizon().getStartTime());var g;if(n){t.x=l?n.x+n.width-a:n.x+a;g=t.x;if(n.x<e.getAxisTime().timeToView(s)&&n.x+n.width>e.getAxisTime().timeToView(s)){t.x=l?e.getAxisTime().timeToView(s)-a:e.getAxisTime().timeToView(s)+a;t._shapeCropped=true;t._xBiassed=t.x-g}}else{if(!r){t.x=l?e.getX()+e.getWidth()-a:e.getX()+a;g=t.x}else{g=r}if(e.getTime()<s&&e.getEndTime()>s){t.x=l?e.getAxisTime().timeToView(s)-a:e.getAxisTime().timeToView(s)+a;t._shapeCropped=true;t._xBiassed=t.x-g;if(l&&r){t.x=t.x-2}}else if(r&&!l){t.x=g+a}}},renderInlineShapes:function(e,i,a){var n=i.getId()+"-top";var r=i.getId()+"-row";e.openStart("g",i);e.class(n);e.attr("data-sap-ui-related",i.getParent().getId());e.openEnd();e.openStart("g");e.attr(t.ROW_ID_DATASET_KEY,i.getRowId()||"");e.class(r);e.openEnd();this.renderMainRowAllShapes(e,i,a);e.close("g");e.close("g")},renderMainRowAllShapes:function(t,i,a){var n=a.getSyncedControl().getRowStates();var r=this.calcRowDomPosition(i,n),l=r.rowYCenter,o=r.rowHeight;var s=a&&a._aShapeRenderOrder?a._aShapeRenderOrder:Object.keys(e.getAllNonLazyAggregations(i));var g=s.filter(function(e){return e.indexOf("calendars")===-1&&e!=="relationships"}).map(function(e){return i.getAggregation(e)||[]}.bind(i));var h=i.getRowUid(),d=a.oSelection,c=a.oHighlight,f=a._oExpandModel,S=a.getAxisTime(),u=f.isRowExpanded(h),x=i.getParent().getIndex(),v=a.oOverlapShapeIds&&a.oOverlapShapeIds[x]&&a.oOverlapShapeIds[x].length>0;var m,y=[],T;var E=a._oExpandModel.mExpanded[h];if(E&&E[E.length-1]){for(var P=1;P<E.length;P++){y.push(E[P].scheme)}}m=y&&a.getShapeSchemes().filter(function(e){return y.indexOf(e.getKey())>-1});var w=a.oOverlapShapeIds&&a.oOverlapShapeIds[x]&&a.oOverlapShapeIds[x].length;g=g.concat(e._fetchOverlayAggregation(i,!u||w,true));g.forEach(function(e,n){Array.isArray(e)&&e.forEach(function(e){if(a.isShapeVisible(e)&&!e.isPartOfExpandedPseudoShape){if(a.getEnablePseudoShapes()){var n;if(e.isPseudoShape){n=e.aShapeIds.some(function(e){return a.oOverlapShapeIds&&a.oOverlapShapeIds[x]&&a.oOverlapShapeIds[x].includes(e)})}else{n=a.oOverlapShapeIds&&a.oOverlapShapeIds[x]&&a.oOverlapShapeIds[x].length>0?false:u}}p.renderMainRowShape(t,e,{expandModel:f,selectionModel:d,highlightModel:c,axisTime:S,rowSetting:i,rowUid:h,aExpandScheme:m,rowExpanded:a.getEnablePseudoShapes()?n:u,mainRowYCenter:l,rowHeight:o},a.getShowParentRowOnExpand()&&!a.getUseParentShapeOnExpand()||a._aExpandedIndices.indexOf(x)>-1&&v)}})})},renderMainRowShape:function(e,t,i,a){var n=t.getParent().getParent();var r=n&&n.isA("sap.gantt.overlays.GanttRowOverlay")?t.getParentRowSettings().getParent().getIndex():t.getParent().getParent().getIndex();this.setSpecialProperties(t,i,r);var l=t.getParentRowSettings().getParent().getParent(),o=l.getParent();var s=o.oOverlapShapeIds&&o.oOverlapShapeIds[r]&&o.oOverlapShapeIds[r].length>0;if(Object.keys(i.expandModel.mExpanded).indexOf(i.rowUid)==-1&&!i.rowExpanded||a&&(t.getScheme()==""||o.getPrimaryShapeScheme().getKey()==t.getScheme())||o._aExpandedIndices.indexOf(r)>-1&&s){t.renderElement(e,t,null)}if(i.rowExpanded){this.renderExpandShapesIfNecessary(e,t,i,a)}},setSpecialProperties:function(t,i,a){var n=i.expandModel,r=i.rowUid,l=i.rowSetting.getShapeUid(t),o=t.getParentRowSettings().getParent().getParent(),s=o.getParent();if(!t._iBaseRowHeight){t._iBaseRowHeight=n.getBaseRowHeight();var g=e.getNonLazyAggregations(t);Object.keys(g).filter(function(e){var t=g[e];if(t.appData!==null){return t.appData.sapGanttOrder===1}}).map(function(e){if(e==="utilizationBar"||e==="utilizationLine"){t._iBaseRowHeight=t._iBaseRowHeight-1}})}t.mAxisTime=i.axisTime;t.setProperty("shapeUid",l,true);if(t.getProperty("selectable")){t.setProperty("selected",i.selectionModel.isShapeSelected(l),true)}if(t.getProperty("highlightable")){t.setProperty("highlighted",i.highlightModel.existed(l),true)}var p=s.getUseParentShapeOnExpand()&&s.oOverlapShapeIds&&s.oOverlapShapeIds[a]&&s.oOverlapShapeIds[a].length>0?"":t.getScheme();t.setProperty("rowYCenter",n.getRowYCenterByUid(r,i.mainRowYCenter,p,0,s,a),true)},isValidD:function(e){return!!e&&e.indexOf("NaN")===-1&&e.indexOf("undefined")===-1&&e.indexOf("null")===-1},renderExpandShapesIfNecessary:function(i,a,n,r){var l;var o=a.getParentRowSettings().getParent().getParent(),s=o.getParent();var g=function(e){if(!e||e.length===0){return}var a=e;if(jQuery.isArray(e)===false){a=[e]}t.calculateLevelForShapes(a,"time","endTime");a.forEach(function(e,t){if(e._level){t=e._level-1}var a=r?n.expandModel.getRowYCenterByUid(n.rowUid,null,e.getScheme(),t,s):n.expandModel.getRowYCenterByUid(n.rowUid,null,e.getScheme(),t,s)-n.expandModel.getBaseRowHeight();e.setProperty("rowYCenter",a,true);e._iBaseRowHeight=n.expandModel.getExpandShapeHeightByUid(n.rowUid,e.getScheme(),n.iRowHeight);e.setProperty("shapeUid",n.rowSetting.getShapeUid(e),true);e.renderElement(i,e)})};a._isSubTasks=a.mBindingInfos.hasOwnProperty("subTasks")||typeof a.getSubTasks==="function"&&a.getSubTasks();var p=[];n.aExpandScheme.forEach(function(e){p.push(e.getKey())});var h=a.getParent().getParent();var d=h&&h.isA("sap.gantt.overlays.GanttRowOverlay")?a.getParentRowSettings().getParent().getIndex():h.getIndex();var c,f=a.getParentRowSettings();s.oExpandedShapesMap[d]=s.oExpandedShapesMap[d]?s.oExpandedShapesMap[d]:[];var S=s.oOverlapShapeIds&&s.oOverlapShapeIds[d]&&s.oOverlapShapeIds[d].length;var u=e._fetchOverlayAggregation(f,S);c=f.getAllExpandableShapes(s).concat(u);c.forEach(function(e,t){if(s.isShapeVisible(e)){l=t}});var x=c[l];var v=!s.oOverlapShapeIds||!Object.keys(s.oOverlapShapeIds).length;var m=a.getParentRowSettings().getParent().getIndex();var y=s.oOverlapShapeIds&&s.oOverlapShapeIds[m]&&s.oOverlapShapeIds[m].length>0;if(s.getUseParentShapeOnExpand()){if(v||!s.oOverlapShapeIds[m]||y){var T=function(i){var a=p.indexOf(i.getScheme())>-1||p.length==0?[i]:[];var n=i instanceof sap.gantt.simple.MultiActivityGroup?e.getNonLazyElementsByScheme(i,p):a;s.oExpandedShapesMap[d]=t._getExpandedChildArray(n,s,p,s.oExpandedShapesMap[d])};if(y){c.forEach(function(e){T(e)})}else{T(a)}if(s.oExpandedShapesMap[d].length!==0){s.oExpandedShapesMap[d].forEach(function(e){e.setProperty("childElement",false,true)})}}}else if(a._isSubTasks){if(v||y){var E=function(i){var a=p.indexOf(i.getScheme())>-1?[i]:[];var n=i instanceof sap.gantt.simple.MultiActivityGroup?e.getLazyElementsByScheme(i,p):a;s.oExpandedShapesMap[d]=t._getExpandedChildArray(n,s,p,s.oExpandedShapesMap[d])};if(y){c.forEach(function(e){E(e)})}else{E(a)}}}else if(!a._isSubTasks){if(a.getScheme()&&p.indexOf(a.getScheme())>-1){if(v||y){var P=function(e){var i=[e];s.oExpandedShapesMap[d]=t._getExpandedChildArray(i,s,p,s.oExpandedShapesMap[d])};if(y){c.forEach(function(e){P(e)})}else{P(a)}if(s.oExpandedShapesMap[d].length!==0){s.oExpandedShapesMap[d].forEach(function(e){e.setProperty("childElement",false,true)})}}}else{var w=e.getLazyAggregations(a);Object.keys(w).forEach(function(e){var t=a.getAggregation(e);g(t)})}}if(a===x||s.oOverlapShapeIds&&s.oOverlapShapeIds[a.getParentRowSettings().getParent().getIndex()]&&s.oOverlapShapeIds[a.getParentRowSettings().getParent().getIndex()].length>0){g(s.oExpandedShapesMap[d])}},calcRowDomPosition:function(e,t){var i=e._getRow(),a=i.getParent(),n=a.indexOfRow(i);var r=t[n];return{rowYCenter:r.rowYCenter,rowHeight:r.height}},pushOrUnshift:function(e,t,i){if(i===true){e.splice(0,0,t)}else{e.push(t)}},createOrderedListOfRenderFunctionsFromTemplate:function(e){var t=[];for(var i=0;i<e.length;i++){this.pushOrUnshift(t,e[i].fnCallback,e[i].bUnshift)}return t},renderElementAnimation:function(e,t){var i=t.getAnimationProperties(t.getAnimationSettings());if(i){e.openStart("animate");e.attr("attributeName","fill");e.attr("values",i.values);e.attr("dur",i.duration);e.attr("repeatCount",i.repeatCount);e.openEnd().close("animate")}}};return p},true);
//# sourceMappingURL=RenderUtils.js.map