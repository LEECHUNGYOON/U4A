/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/base/Log","sap/ui/Device","sap/ui/core/Core","sap/gantt/library","sap/ui/core/Element","sap/ui/core/CustomStyleClassSupport","sap/ui/base/ManagedObjectMetadata","./GanttUtils","./CoordinateUtils","./AggregationUtils","../misc/Format","sap/ui/core/date/UI5Date","sap/gantt/misc/Utility"],function(e,t,i,a,r,n,s,o,l,p,h,u,g){"use strict";var f=a.simple.verticalTextAlignment;var d=a.simple.horizontalTextAlignment;var m=a.simple.shapes.ShapeAlignment;var c=r.extend("sap.gantt.simple.BaseShape",{metadata:{library:"sap.gantt",abstract:true,properties:{shapeId:{type:"string"},time:{type:"object"},endTime:{type:"object"},scheme:{type:"string",defaultValue:null},xBias:{type:"float",defaultValue:0},yBias:{type:"float",defaultValue:0},fill:{type:"sap.gantt.ValueSVGPaintServer"},strokeOpacity:{type:"float",defaultValue:1},fillOpacity:{type:"float",defaultValue:1},opacity:{type:"float",defaultValue:1},stroke:{type:"sap.gantt.ValueSVGPaintServer"},strokeWidth:{type:"float",defaultValue:0},strokeDasharray:{type:"string"},transform:{type:"string"},filter:{type:"string"},expandable:{type:"boolean",defaultValue:false},selectable:{type:"boolean",defaultValue:false},selected:{type:"boolean",defaultValue:false},draggable:{type:"boolean",defaultValue:false},resizable:{type:"boolean",defaultValue:false},hoverable:{type:"boolean",defaultValue:false},connectable:{type:"boolean",defaultValue:false},rowYCenter:{type:"float"},countInBirdEye:{type:"boolean",defaultValue:false},childElement:{type:"boolean",defaultValue:false,visibility:"hidden"},shapeUid:{type:"string",visibility:"hidden"},visible:{type:"boolean",defaultValue:true},title:{type:"string",group:"Appearance",defaultValue:null},showTitle:{type:"boolean",group:"Appearance",defaultValue:true},enableChainSelection:{type:"boolean",defaultValue:false},selectableInChainSelection:{type:"boolean",defaultValue:true},verticalTextAlignment:{type:"sap.gantt.simple.verticalTextAlignment",defaultValue:f.Center},horizontalTextAlignment:{type:"sap.gantt.simple.horizontalTextAlignment",defaultValue:d.Start},animationSettings:{type:"object",defaultValue:null},showAnimation:{type:"boolean",defaultValue:false},titleColor:{type:"sap.gantt.ValueSVGPaintServer"},fontSize:{type:"int",defaultValue:13},fontWeight:{type:"string",defaultValue:"normal"},alignShape:{type:"sap.gantt.simple.shapes.ShapeAlignment",defaultValue:m.Middle},fontFamily:{type:"string",defaultValue:"Arial"},titleSpacing:{type:"int",defaultValue:0},selectedFill:{type:"sap.gantt.ValueSVGPaintServer"},selectedTitleColor:{type:"sap.gantt.ValueSVGPaintServer"},highlightable:{type:"boolean",defaultValue:false},highlighted:{type:"boolean",defaultValue:false},dragHighlightRows:{type:"string[]",defaultValue:[]}},designtime:"sap/ui/dt/designtime/notAdaptable.designtime"},renderer:{apiVersion:2}});var y={values:null,duration:"1s",repeatCount:"indefinite"};n.apply(c.prototype);c.prototype.init=function(){this.bPreventSingleClick=false;this._level=null};var v={};i.attachThemeChanged(function(){v={}});var S=/translate\((-?\d{1,}),?\s?(-?\d{1,})?\)/gi;c.prototype.setShapeUid=function(t){e.error('The control manages the shapeUid generation. The method "setShapeUid" cannot be used programmatically!',this)};c.prototype.getTransform=function(){var e=this.getProperty("transform");if(e){return e}return this._buildTransformByXYBias()};c.prototype.setTransform=function(e){this.setProperty("transform",e);this._updateBiasFromTransform(e);return this};c.prototype._buildTransformByXYBias=function(){var e=this.getXBias(),t=this.getYBias();if(e||t){e=e?e:0;e=i.getConfiguration().getRTL()?-e:e;t=t?t:0;return"translate("+e+" "+t+")"}return null};c.prototype._updateBiasFromTransform=function(e){if(e!=null){var t=this._parseBias(e);if(t.length>0){var i=t[0]||0,a=t[1]||0;this.setProperty("xBias",i,true);this.setProperty("yBias",a,true)}}};c.prototype._parseBias=function(e){var t=S.exec(e);var i=[];if(t&&t.length>0){t.forEach(function(e,t){if(t!==0&&e){i.push(parseFloat(e))}})}return i};c.prototype.getStyle=function(){var e={stroke:this.determineValueColor(this.getStroke()),"stroke-width":this.getStrokeWidth()};var t=this.getSelectable()||this.getHoverable()||this.getTooltip()!==null;if(this.getProperty("childElement")===false&&t===false){e["pointer-events"]="none"}return this.getInlineStyle(e)};c.prototype.getXByTime=function(t){var i=this.getAxisTime();var a=i&&i.timeToView(h.abapTimestampToDate(t));if(!g.isNumeric(a)){e.warning("Cannot convert time:"+t+" to an valid coordinate. Invalid coordinate might not get rendered at all, check the property value!");return 0}return a};c.prototype.getAxisTime=function(){if(this.mAxisTime){return this.mAxisTime}else{var e=this.getGanttChartBase();return e?e.getAxisTime():null}};c.prototype.getGanttChartBase=function(){var e=this.getParentRowSettings();return e?e.getParentGantt():null};c.prototype.getParentRowSettings=function(){return p.getParentControlOf("sap.gantt.simple.GanttRowSettings",this)};c.prototype.getInlineStyle=function(e){return Object.keys(e).reduce(function(t,i){if(e[i]!==undefined&&e[i]!==null&&e[i]!==""){t+=i+":"+e[i]+"; "}return t},"")};c.prototype.determineValueColor=function(e){var t=v[e];if(!t&&e){t=a.ValueSVGPaintServer.normalize(e);v[e]=t}return t};c.prototype.destroy=function(){return r.prototype.destroy.apply(this,["KeepDom"])};c.prototype.isVisible=function(){return false};c.prototype.renderElement=function(e,t){};c.prototype.writeElementData=function(e,t,i){if(this.getProperty("childElement")){var a=s.isGeneratedId(this.getId());if(!a){e.openStart(t,this.getId())}else{e.openStart(t)}if(i){e.class("baseShapeSelection")}return}if(this._shallWriteElementData(this)){e.openStart(t,this);if(this.getShapeId()){e.attr(o.SHAPE_ID_DATASET_KEY,this.getShapeId())}if(this.getConnectable()){e.attr(o.CONNECTABLE_DATASET_KEY,this.getConnectable())}}else{e.openStart(t)}if(i){e.class("baseShapeSelection")}};c.prototype._shallWriteElementData=function(e){var t=!e.getParent();if(t===false){var i=e.getParent().getParent();if(i&&i.isA("sap.gantt.overlays.GanttRowOverlay")){t=p.isParentRowSetting(i)}else{t=p.isParentRowSetting(e)}}if(t===false){t=p.isAdhocLine(e)}if(t===false){t=p.isDeltaLine(e)}if(t===false){t=p.isLazyAggregation(e)}if(t===false){t=this.getGanttChartBase()&&this.getGanttChartBase().getUseParentShapeOnExpand()&&!p.isLazyAggregation(e)}return t};c.prototype.ensureGanttChart=function(){if(!this.mChartInstance){this.mChartInstance=this.getGanttChartBase()}};c.prototype.setSelected=function(e,t){var i=this.getSelected();this.setProperty("selected",e,t);var a=this.getGanttChartBase(),r=this.getShapeUid();if(i!==e&&a&&r){a.getSelection().updateShape(r,{selected:e,ctrl:false,draggable:this.getDraggable(),time:this.getTime(),endTime:this.getEndTime()})}return this};c.prototype.setTime=function(e,t){if(h._getEnableDateTimezoneFormatter()){if(e){this.setProperty("time",o.getFormatedDateByTimeZone(e),t)}}else{this.setProperty("time",this._convertToJSDate(e),t)}};c.prototype.setEndTime=function(e,t){if(h._getEnableDateTimezoneFormatter()){if(e){this.setProperty("endTime",o.getFormatedDateByTimeZone(e),t)}}else{this.setProperty("endTime",this._convertToJSDate(e),t)}};c.prototype.setHighlighted=function(e,t){var i=this.getHighlighted();this.setProperty("highlighted",e,t);var a=this.getGanttChartBase(),r=this.getShapeUid();if(i!==e&&a&&r){a.getHighlight().updateShape(r,{highlighted:e,time:this.getTime(),endTime:this.getEndTime()})}return this};c.prototype.onclick=function(e){var t=function(){var t;if(this.bPreventSingleClick===false){t=this.getGanttChartBase();o.resetStrokeDasharray(t);if(!t.fireShapePress({popoverOffsetX:this._getPopoverOffsetX(e),rowSettings:this.getParentRowSettings(),shape:this,ctrlOrMeta:e.ctrlKey||e.metaKey})){return}if(!this.getEnableChainSelection()){t.handleShapePress({shape:this,ctrlOrMeta:e.ctrlKey||e.metaKey})}e.setMarked()}this.bPreventSingleClick=false}.bind(this);if(!this.getSelectable()){return}if(this._isDoubleClickEventDisabled()){t();return}this.iSingleClickTimer=window.setTimeout(t.bind(this),300)};c.prototype.ondblclick=function(e){if(this._isDoubleClickEventDisabled()){return}window.clearTimeout(this.iSingleClickTimer);this.bPreventSingleClick=true;this.getGanttChartBase().fireShapeDoubleClick({popoverOffsetX:this._getPopoverOffsetX(e),rowSettings:this.getParentRowSettings(),shape:this});e.stopImmediatePropagation()};c.prototype.oncontextmenu=function(e){e.preventDefault();e.stopImmediatePropagation();var t=l.getLatestCursorPosition();this.getGanttChartBase().fireShapeContextMenu({pageX:t.pageX,pageY:t.pageY,popoverOffsetX:this._getPopoverOffsetX(e),rowSettings:this.getParentRowSettings(),shape:this})};c.prototype.onmouseout=function(e){if(this.getHoverable()===false){return}if(this.isA("sap.gantt.simple.Relationship")&&this.bRelationshipMouseEnter){e.currentTarget.style["stroke-width"]=this.getStrokeWidth()||1;this.bRelationshipMouseEnter=false}var t=this.getGanttChartBase();if(this.iMouseOutTimer){window.clearTimeout(this.iMouseOutTimer)}this.iMouseOutTimer=window.setTimeout(function(){if(this.bShapeMouseEnterFired){t.fireShapeMouseLeave({shape:this});t.handleShapeMouseLeave({shape:this});this.bShapeMouseEnterFired=false}else if(this.iMouseOverTimer){window.clearTimeout(this.iMouseOverTimer)}}.bind(this),t.getShapeMouseLeaveDelay())};c.prototype.onmouseover=function(e){if(this.getHoverable()===false){return}if(this.isA("sap.gantt.simple.Relationship")&&!this.bRelationshipMouseEnter){e.currentTarget.style["stroke-width"]=this.getSelectedStrokeWidth();this.bRelationshipMouseEnter=true}var t=this.getGanttChartBase();if(this.iMouseOverTimer){window.clearTimeout(this.iMouseOverTimer)}this.iMouseOverTimer=window.setTimeout(function(){var e=l.getCursorElement();if(e===this){if(this.iMouseOutTimer){window.clearTimeout(this.iMouseOutTimer)}var i=l.getLatestCursorPosition();t.fireShapeMouseEnter({shape:this,pageX:i.pageX,pageY:i.pageY});this.bShapeMouseEnterFired=true;t.handleShapeMouseEnter({shape:this})}}.bind(this),t.getShapeMouseEnterDelay())};c.prototype.getShapeUid=function(){return this.getProperty("shapeUid")};c.prototype._getPopoverOffsetX=function(e){if(this.getTime()){var i=this.getDomRef().getBoundingClientRect().width;var a=typeof this.getX==="function"?this.getX():o.getValueX(this);var r=this.getEndTime()?this.getEndTime().getTime():this.getAxisTime().viewToTime(a+i).getTime();var n=new Date((this.getTime().getTime()+r)/2);var s=t.browser.mozilla?e.originalEvent.layerX:e.offsetX;var l=Math.round(s-this.getAxisTime().timeToView(n));return Math.abs(l)>i?0:l}};c.prototype._isDoubleClickEventDisabled=function(){var e=this.getGanttChartBase();return e&&e.getDisableShapeDoubleClickEvent()};c.prototype.getAnimationProperties=function(e){if(!this.mAnimationProperties){if(jQuery.isEmptyObject(e)||!e.values){return false}var t=jQuery.extend(true,{},y);for(var i in t){if(e[i]){t[i]=e[i]}}this.mAnimationProperties=t}return this.mAnimationProperties};c.prototype._convertToJSDate=function(e){if(e instanceof u){return new Date(e.getTime())}return e};return c},true);
//# sourceMappingURL=BaseShape.js.map