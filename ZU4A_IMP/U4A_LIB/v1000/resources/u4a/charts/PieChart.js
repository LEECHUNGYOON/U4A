sap.ui.define("u4a.charts.am5.PieChart",["u4a/charts/am5/PercentChart","sap/base/util/uid","u4a/charts/am5/am5Loader","u4a/charts/am5/am5percentLoader"],function(a,b){"use strict";function c(){return new Promise(a=>{function b(c){return"undefined"!=typeof window.am5&&"undefined"!=typeof window.am5percent?a():void setTimeout(function(){b(c)},100)}b()})}function d(a){return new Promise(function(b){am5.ready(async function(){-1===am5.registry.licenses.findIndex(b=>b===atob(a.licenceKey))&&am5.addLicense(atob(a.licenceKey));let c=a.getDomRef()||void 0;if("undefined"==typeof c)return console.error("\uCC28\uD2B8 dom \uC5C6\uC74C!!!"),b();if(-1!==am5.registry.rootElements.findIndex(a=>a?.dom===c))return b();let d=am5.Root.new(c);a.setChartTheme(d),a._drawChart(d),await a._oChart.oChartInstance.appear(),b()})})}function e(a){return new Promise(async function(b){await c(),await d(a),a.fireAfterRenderingFinish(),b()})}function f(a){let b=a.getPieChartContent();if(0!==b.length)for(let c=0,d=b.length;c<d;c++){let d=b[c],e=d._createPieSeries(a);a._oChart.oChartInstance.series.push(e),e.data.setAll(d._oChart.aData)}}let g=a.extend("u4a.charts.am5.PieChart",{metadata:{library:"u4a.charts.am5",aggregations:{pieChartContent:{type:"u4a.charts.am5.PieChartContent",multiple:!0,singularName:"pieChartContent"},background:{type:"u4a.charts.am5.Background",multiple:!1,singularName:"background"},legend:{type:"u4a.charts.am5.Legend",multiple:!1,singularName:"legend"},title:{type:"u4a.charts.am5.Title",multiple:!1}},events:{afterRenderingFinish:{visibility:"restricted",deprecated:!0},click:{},dblclick:{},rightclick:{}}},init:function(){a.prototype.init.apply(this,arguments),this._aExcludeProp=["visible","width","height"],sap.ui.getCore().attachThemeChanged(function(){this.setChartTheme(this._oChart.oRoot)}.bind(this))},onBeforeRendering:function(){this._removeChart()},renderer:function(a,b){a.openStart("div",b),a.class("u4aAM5PieChart"),a.style("width",b.getWidth()||"auto"),a.style("height",b.getHeight()||"100%"),a.openEnd(),a.close("div")},onAfterRendering:function(a){if("undefined"==typeof window?.oU4A?.taskPromiseStack)return void e(a.srcControl);let c=b(),d=new Promise(async function(b){await e(a.srcControl),b(c)});d.uKey=c,oU4A.taskPromiseStack.push(d)},exit:function(){this._removeChart()},_drawChart:function(a){this._oChart.oRoot=a;let b=this._getChartProperies(this._aExcludeProp),c=this.getDomRef()||void 0;return"undefined"==typeof c&&(b.width=this._convAm5CssSize(this.getWidth()||"100%"),b.height=this._convAm5CssSize(this.getHeight()||"100%"),b.visible=this.getVisible()),b.layout=this._oChart.oRoot.verticalLayout,this._oChart.oChartInstance=this._oChart.oRoot.container.children.push(am5percent.PieChart.new(this._oChart.oRoot,b)),this._setBackGround(),this._oChart.oChartInstance.events.on("click",function(a){this._fireEvent(a)}.bind(this)),this._oChart.oChartInstance.events.on("dblclick",function(a){this._fireEvent(a)}.bind(this)),this._oChart.oChartInstance.events.on("rightclick",function(a){this._fireEvent(a)}.bind(this)),this._getChartData(this),f(this),this._setNoDataChartContent(),this._createLegend(),this._setTitle(),this._oChart.oChartInstance},_setNoDataChartContent:function(){if("undefined"==typeof this?._oChart?.oChartInstance?.series?.values?.length)return void this._showNoDataChart();if(0===this?._oChart?.oChartInstance?.series?.values?.length)return void this._showNoDataChart();let a=!1;for(let b,c=0,d=this._oChart.oChartInstance.series.values.length;c<d;c++)if((b=this._oChart.oChartInstance.series.values[c],"undefined"!=typeof b?.data?.values?.length)&&0!==b?.data?.values?.length&&-1!==b?.data?.values.findIndex(a=>"undefined"!=typeof a.value&&null!==a.value)){a=!0;break}!0==a||this._showNoDataChart()},_showNoDataChart:function(){0===this._oChart.oChartInstance.series.values.length&&this._oChart.oChartInstance.series.push(am5percent.PieSeries.new(this._oChart.oRoot,{valueField:"value",categoryField:"index"}));let a=this._oChart.oChartInstance.series.values[0];a.data.setAll([{category:"",value:0}])},_fireEvent:function(a){if("undefined"==typeof a?.point)return;if("undefined"==typeof a?.type)return;let b=a.type,c=a.point,d={};d.pointX=c.x,d.pointY=c.y,this.fireEvent(b,d)},_getChartData:function(){let a=this.getPieChartContent();if(0!==a.length)for(let b,c=0,d=a.length;c<d;c++)b=a[c],b._getChartData()},_setTitle:function(){if("undefined"!=typeof this?._oChart?.oChartInstance){let a=this.getTitle()||void 0;if("undefined"!=typeof a?._createTitle){let b=a?._createTitle();"undefined"==typeof b||this._oChart.oChartInstance.children.moveValue(b,0)}}},_createLegend:function(){if("undefined"==typeof this?._oChart?.oChartInstance)return;let a=this.getLegend()||void 0;if("undefined"==typeof a?._createLegend)return;let b=a._createLegend();if("undefined"==typeof b)return;this._oChart.oChartInstance.children.push(b);let c=this._oChart.oChartInstance.series.values;if(0===c.length)return;let d=[];for(let a,b=0,e=c.length;b<e;b++)(a=c[b]?.dataItems,"undefined"!=typeof a)&&0!=a.length&&(d=d.concat(a));b.data.setAll(d)},_setBackGround:function(){if("undefined"!=typeof this?._oChart?.oChartInstance){this._oChart.oChartInstance.set("background");let a=this.getBackground()||void 0;if("undefined"!=typeof a?._createSprite){let b=a._createSprite();"undefined"==typeof b||this._oChart.oChartInstance.set("background",b)}}},_removeChart:function(){"undefined"==typeof this._oChart?.oRoot||(this._oChart.oRoot.dispose(),this._oChart={})},_setDomStyle:function(a,b){let c=this.getDomRef()||void 0;"undefined"==typeof c||(c.style[a]=b)},setParent:function(b){a.prototype.setParent.apply(this,arguments),null===b&&this._removeChart()},setLegend:function(a){this.setAggregation("legend",a,!0),this._createLegend(this)},setBackground:function(a){this.setAggregation("background",a,!0),this._setBackGround()}});return g});