sap.ui.define("u4a.charts.am5.MapChart",["u4a/charts/am5/SerialChart","sap/base/util/uid","u4a/charts/am5/am5Loader","u4a/charts/am5/am5mapLoader"],function(a,b){"use strict";function c(){return new Promise(a=>{function b(c){return"undefined"!=typeof window.am5&&"undefined"!=typeof window.am5map?a():void setTimeout(function(){b(c)},100)}b()})}function d(a){return new Promise(function(b){am5.ready(async function(){-1===am5.registry.licenses.findIndex(b=>b===atob(a.mapLicenceKey))&&am5.addLicense(atob(a.mapLicenceKey));let c=a.getDomRef()||void 0;if("undefined"==typeof c)return console.error("\uCC28\uD2B8 dom \uC5C6\uC74C!!!"),b();if(-1!==am5.registry.rootElements.findIndex(a=>a?.dom===c))return b();let d=am5.Root.new(c);a.setChartTheme(d),await a._drawChart(d),await a._oChart.oChartInstance.appear(),b()})})}function e(a){return new Promise(async function(b){let c=a.getMapPolygonSeries()||void 0;if("undefined"==typeof c?._createMapPolygonSeries)return b();let d=await c._createMapPolygonSeries(a);return a._oChart.oChartInstance.series.push(d),d.data.setAll([]),b()})}function f(a){let b=a.getLegend()||void 0;if("undefined"!=typeof b?._createLegend){let c=b._createLegend();"undefined"==typeof c||(a._oChart.oChartInstance.children.push(c),c.data.setAll(a._oChart.oChartInstance.series.values))}}function g(a){return new Promise(async function(b){await c(),await d(a),a.fireAfterRenderingFinish(),b()})}u4a.charts.am5.MapChartPanXType={none:"none",rotateX:"rotateX",translateX:"translateX"},sap.ui.base.DataType.registerEnum("u4a.charts.am5.MapChartPanXType",u4a.charts.am5.MapChartPanXType),u4a.charts.am5.MapChartPanYType={none:"none",rotateY:"rotateY",translateY:"translateY"},sap.ui.base.DataType.registerEnum("u4a.charts.am5.MapChartPanYType",u4a.charts.am5.MapChartPanYType),u4a.charts.am5.MapChartWheelType={none:"none",zoom:"zoom",rotateX:"rotateX",rotateY:"rotateY"},sap.ui.base.DataType.registerEnum("u4a.charts.am5.MapChartWheelType",u4a.charts.am5.MapChartWheelType),u4a.charts.am5.ProjectionType={geoEqualEarth:"geoEqualEarth",geoEquirectangular:"geoEquirectangular",geoMercator:"geoMercator",geoNaturalEarth1:"geoNaturalEarth1",geoOrthographic:"geoOrthographic"},sap.ui.base.DataType.registerEnum("u4a.charts.am5.ProjectionType",u4a.charts.am5.ProjectionType);let h=a.extend("u4a.charts.am5.MapChart",{metadata:{library:"u4a.charts.am5",properties:{animationDuration:{type:"int",defaultValue:0},projection:{type:"u4a.charts.am5.ProjectionType",defaultValue:"geoMercator"},homeGeoPointLongitude:{type:"float",defaultValue:0},homeGeoPointLatitude:{type:"float",defaultValue:0},homeZoomLevel:{type:"float",defaultValue:0},maxPanOut:{type:"float",defaultValue:0},maxZoomLevel:{type:"float",defaultValue:0},minZoomLevel:{type:"float",defaultValue:0},panX:{type:"u4a.charts.am5.MapChartPanXType",defaultValue:"translateX"},panY:{type:"u4a.charts.am5.MapChartPanYType",defaultValue:"translateY"},wheelY:{type:"u4a.charts.am5.MapChartWheelType",defaultValue:"zoom"},wheelX:{type:"u4a.charts.am5.MapChartWheelType",defaultValue:"zoom"}},aggregations:{mapPolygonSeries:{type:"u4a.charts.am5.MapPolygonSeries",multiple:!1,singularName:"mapPolygonSeries"},mapLineSeries:{type:"u4a.charts.am5.MapLineSeries",multiple:!0,singularName:"mapLineSeries"},mapPointSeries:{type:"u4a.charts.am5.MapPointSeries",multiple:!0,singularName:"mapPointSeries"},marker:{type:"u4a.charts.am5.Marker",multiple:!0,singularName:"marker"},chartContents:{type:"u4a.charts.am5.ChartContent",multiple:!0,singularName:"chartContent"},background:{type:"u4a.charts.am5.Background",multiple:!1,singularName:"background"},legend:{type:"u4a.charts.am5.Legend",multiple:!1,singularName:"legend"}},events:{afterRenderingFinish:{visibility:"restricted",deprecated:!0},click:{},dblclick:{},rightclick:{}}},init:function(){a.prototype.init.apply(this,arguments),this._oChart.aChartContentData=[],this._aExcludeProp=["visible","width","height","rotate"],sap.ui.getCore().attachThemeChanged(function(){this.setChartTheme(this._oChart.oRoot)}.bind(this))},onBeforeRendering:function(){this._removeChart()},renderer:function(a,b){a.openStart("div",b),a.class("u4aAM5MapChart"),a.style("width",b.getWidth()||"auto"),a.style("height",b.getHeight()||"100%"),a.openEnd(),a.close("div")},onAfterRendering:function(a){if("undefined"==typeof window?.oU4A?.taskPromiseStack)return void g(a.srcControl);let c=b(),d=new Promise(async function(b){await g(a.srcControl),b(c)});d.uKey=c,oU4A.taskPromiseStack.push(d)},exit:function(){this._removeChart()},_drawChart:function(a){return new Promise(async function(b){this._oChart.oRoot=a;let c=this._getChartProperies(this._aExcludeProp);c.layout=this._oChart.oRoot.verticalLayout;var d=this.getProjection();"undefined"==typeof d&&(d="geoMercator"),c.projection=am5map[d](),this._oChart.oChartInstance=this._oChart.oRoot.container.children.push(am5map.MapChart.new(this._oChart.oRoot,c)),this._homeGeoPoint(),this._setBackGround(),this._oChart.oChartInstance.events.on("click",function(a){this._fireEvent(a)}.bind(this)),this._oChart.oChartInstance.events.on("dblclick",function(a){this._fireEvent(a)}.bind(this)),this._oChart.oChartInstance.events.on("rightclick",function(a){this._fireEvent(a)}.bind(this)),await e(this),this._getChartData(),await this._createChartContent(),b()}.bind(this))},_fireEvent:function(a){if("undefined"==typeof a?.point)return;if("undefined"==typeof a?.type)return;let b=a.type,c=a.point,d={};d.pointX=c.x,d.pointY=c.y,this.fireEvent(b,d)},_getChartData:function(){this._getChartContentData()},_getChartContentData:function(){this._oChart.aChartContentData=[];let a=this.getChartContents();if(0!==a.length)for(let b,c=0,d=a.length;c<d;c++)b=a[c],this._oChart.aChartContentData.push(b._getChartData())},_createChartContent:async function(){let a=this.getChartContents();if(0!==a.length){this._oChart.oChartContent=am5map.MapPointSeries.new(this._oChart.oRoot,{}),this._oChart.oChartInstance.series.push(this._oChart.oChartContent),this._oChart.oChartContent.data.setAll(this._oChart.aChartContentData);var b=[];for(let c=0,d=a.length;c<d;c++){let d=a[c],e=d.getChart();"undefined"!=typeof e?._drawChart&&b.push(await e._drawChart(this._oChart.oRoot))}if(0!==b.length){var c=0;this._oChart.oChartContent.bullets.push(function(){let a=b[c];if("undefined"!=typeof a)return c++,am5.Bullet.new(this._oChart.oRoot,{sprite:a})}.bind(this))}}},_setBackGround:function(){if("undefined"!=typeof this?._oChart?.oChartInstance){this._oChart.oChartInstance.set("background");let a=this.getBackground()||void 0;if("undefined"!=typeof a?._createSprite){let b=a._createSprite();"undefined"==typeof b||this._oChart.oChartInstance.set("background",b)}}},_removeChart:function(){"undefined"==typeof this?._oChart?.oRoot||(this._oChart.oRoot.dispose(),this._oChart={})},_setDomStyle:function(a,b){let c=this.getDomRef()||void 0;"undefined"==typeof c||(c.style[a]=b)},_homeGeoPoint:function(){if("undefined"!=typeof this?._oChart?.oChartInstance){var a=this.getHomeGeoPointLongitude(),b=this.getHomeGeoPointLatitude();this._oChart.oChartInstance.set("homeGeoPoint",{longitude:a,latitude:b})}},setParent:function(b){a.prototype.setParent.apply(this,arguments),null===b&&this._removeChart()},setWidth:function(a){let b=this._setProperty("width",a);this._setDomStyle("width",b),this._chartRootResize()},setHeight:function(a){let b=this._setProperty("height",a);this._setDomStyle("height",b),this._chartRootResize()},setAnimationDuration:function(a){let b=this._setProperty("animationDuration",a);this._setChartSettings("animationDuration",b)},setProjection:function(a){let b=this._setProperty("projection",a);"undefined"==typeof this?._oChart?.oChartInstance||this._oChart.oChartInstance.set("projection",am5map[b]())},setHomeGeoPointLongitude:function(a){this._setProperty("homeGeoPointLongitude",a),this._homeGeoPoint()},setHomeGeoPointLatitude:function(a){this._setProperty("homeGeoPointLatitude",a),this._homeGeoPoint()},setHomeZoomLevel:function(a){let b=this._setProperty("homeZoomLevel",a);this._setChartSettings("homeZoomLevel",b)},setMaxPanOut:function(a){let b=this._setProperty("maxPanOut",a);this._setChartSettings("maxPanOut",b)},setMaxZoomLevel:function(a){let b=this._setProperty("maxZoomLevel",a);this._setChartSettings("maxZoomLevel",b)},setMinZoomLevel:function(a){let b=this._setProperty("minZoomLevel",a);this._setChartSettings("minZoomLevel",b)},setPanX:function(a){let b=this._setProperty("panX",a);this._setChartSettings("panX",b)},setPanY:function(a){let b=this._setProperty("panY",a);this._setChartSettings("panY",b)},setWheelY:function(a){let b=this._setProperty("wheelY",a);this._setChartSettings("wheelY",b)},setWheelX:function(a){let b=this._setProperty("wheelX",a);this._setChartSettings("wheelX",b)},setLegend:function(a){this.setAggregation("legend",a,!0),f(this)},setBackground:function(a){this.setAggregation("background",a,!0),this._setBackGround()}});return h});