sap.ui.define("u4a.util.PressTrigger",["sap/ui/core/Control"],(function(i){"use strict";return i.extend("u4a.util.PressTrigger",{metadata:{library:"u4a.util",properties:{second:{type:"int",defaultValue:0},immediateRun:{type:"boolean",defaultValue:!1}},events:{finished:{allowPreventDefault:!0}}},renderer:function(i,e){i.write("<div"),i.writeControlData(e),i.addStyle("display","none"),i.writeStyles(),i.write("></div>")},onAfterRendering:function(){this._detachBrowserEvents(),this._clearTriggerTimer(),this._unregisterVisibilityHandler(),this._registerVisibilityHandler(),this._isRunnable()&&(this._attachBrowserEvents(),this._startTriggerTimer())},_isRunnable:function(){return!0===this.getImmediateRun()&&this.getSecond()>0},_startTriggerTimer:function(){this._clearTriggerTimer();const i=this.getSecond();if(i<=0)return;const e=Date.now();this._triggerDeadline=e+1e3*i;const t=this._triggerDeadline-e;this._triggerTimer=setTimeout(function(){this._handleInactivityTimeout()}.bind(this),t)},_clearTriggerTimer:function(){this._triggerTimer&&(clearTimeout(this._triggerTimer),this._triggerTimer=null)},_restartTriggerTimer:function(){this._clearTriggerTimer(),this._isRunnable()&&this._startTriggerTimer()},_attachBrowserEvents:function(){const i=sap.ui.Device.os.name,e=".u4aPressTrigger_"+this.getId(),t=this._onUserAction.bind(this);this._eventNamespace=e,this._boundHandler=t,"win"===i?$(window).on("click"+e,t):$(window).on("touchstart"+e,t),$(document).on("keyup"+e,t)},_detachBrowserEvents:function(){this._eventNamespace&&($(window).off(this._eventNamespace),$(document).off(this._eventNamespace),this._eventNamespace=null,this._boundHandler=null)},_onUserAction:function(){this._isRunnable()&&this._restartTriggerTimer()},_registerVisibilityHandler:function(){this._fnVisibilityHandler&&document.removeEventListener("visibilitychange",this._fnVisibilityHandler),this._fnVisibilityHandler=this._onVisibilityChange.bind(this),document.addEventListener("visibilitychange",this._fnVisibilityHandler)},_unregisterVisibilityHandler:function(){this._fnVisibilityHandler&&(document.removeEventListener("visibilitychange",this._fnVisibilityHandler),this._fnVisibilityHandler=null)},_onVisibilityChange:function(){document.hidden||this._adjustRemainingTime()},_adjustRemainingTime:function(){if(!this._triggerDeadline||!this._isRunnable())return;const i=this._triggerDeadline-Date.now();i<=0?this._handleInactivityTimeout():(this._clearTriggerTimer(),this._triggerTimer=setTimeout(function(){this._handleInactivityTimeout()}.bind(this),i))},_handleInactivityTimeout:function(){this._detachBrowserEvents(),this._clearTriggerTimer(),this.setProperty("immediateRun",!1,!0),this.fireFinished()},setImmediateRun:function(i){const e=this.getProperty("immediateRun");return this.setProperty("immediateRun",i,!0),e===i||(!0===i&&this._isRunnable()?(this._attachBrowserEvents(),this._restartTriggerTimer()):(this._detachBrowserEvents(),this._clearTriggerTimer())),this},setSecond:function(i){return this.setProperty("second",i,!0),this._isRunnable()&&this._restartTriggerTimer(),this},exit:function(){this._detachBrowserEvents(),this._clearTriggerTimer(),this._unregisterVisibilityHandler()}})}));