sap.ui.define("u4a.m.ImageMarkArea",["sap/m/Image"],function(t){"use strict";return t.extend("u4a.m.ImageMarkArea",{metadata:{library:"u4a.m",defaultAggregation:"marks",aggregations:{marks:{type:"u4a.m.ImageMark",multiple:!0,singularName:"mark"}}},init:function(){void 0===$.fn.maphilight&&jQuery.ajax({url:"/zu4a_imp/publish/CommonJS/jquery.u4a.maphilights.js",dataType:"script",cache:!1,async:!1,success:function(t){console.log("maphilight load")},error:function(t){console.error("maphilight load fail")}})},renderer:function(t,e){t.write("<div"),t.writeControlData(e),t.write(">"),sap.m.ImageRenderer.render(t,e);var i=e,a=i.getUseMap(),r=i.getMarks();if((i.setDensityAware(!1),a)&&0!=r.length){t.write("<map");var s=a;"#"==s.slice(0,1)&&(s=s.slice(1)),t.writeAttribute("name",s),t.writeAttribute("id",s),t.write(">");for(var n=(r=i.getMarks()).length,o=0;o<n;o++)i._renderMarks(t,r[o]);t.write("</map>")}t.write("</div>")},_renderMarks:function(t,e){t.write("<area"),t.writeElementData(e),t.writeAttribute("shape",e.getShape()),t.writeAttribute("coords",e.getCoords());var i=e.getTooltip(),a=e.getText(),r=i;""!=a&&(null==r&&(r=""),r=r+" : "+a),t.writeAttribute("data-text",e.getText()),t.writeAttribute("title",null==r?"":r);var s=e.getStrokeColor();s="#"==s.slice(0,1)?s.slice(1):s;var n=e.getFillColor();n="#"==n.slice(0,1)?n.slice(1):n;var o=e.getFill(),h=e.getFillOpacity(),g=e.getAlwaysOn(),d=e.getStroke(),l=e.getStrokeOpacity(),m=e.getStrokeWidth(),c=e.getShadow(),u=e.getShadowX(),w=e.getShadowY(),p=e.getShadowRadius(),I=e.getShadowColor(),f='{"strokeColor":"'+s+'","alwaysOn":'+g+',"fill":'+o+',"fillColor":"'+n+'","fillOpacity":'+h+',"stroke":'+d+',"strokeOpacity":'+l+',"strokeWidth":'+m+',"shadow":'+c+',"shadowX":'+u+',"shadowY":'+w+',"shadowRadius":'+p+',"shadowColor":"'+(I="#"==I.slice(0,1)?I.slice(1):I)+'","shadowOpacity":'+e.getShadowOpacity()+"}";t.writeAttributeEscaped("data-maphilight",f),t.write(">"),t.write("</area>")},setSrc:function(t){return t===this.getSrc()||this.setProperty("src",t),this},onAfterRendering:function(t){var e=t.srcControl;this._setImageMarkId(e),this._applyImageDymanicEffect(),this._ImageMarkAreaResize(),this._attachMarkImageEvent(),this._attachMarkEvent(),$(window).resize(function(){this._ImageMarkAreaResize()}.bind(this))},_attachMarkImageEvent:function(){var t=this,e=document.getElementById(this.getId());null!=e&&(e.onclick=function(){t.firePress(t.mProperties)})},_attachMarkEvent:function(){var t=this.getMarks(),e=t.length;if(0!=e)for(var i=0;i<e;i++){var a=t[i],r=document.getElementById(a.getId());if(null==r)return;r.onclick=function(){sap.ui.getCore().byId(this.id).fireSelectMark()}}},_setImageMarkId:function(t){var e=$("#"+t.getId())[0].childNodes[0];e.setAttribute("id",t.getId()+"--ImageMark"),e.setAttribute("data-sap-ui",t.getId()+"--ImageMark"),this._domId=e.id},_applyImageDymanicEffect:function(){var t=document.getElementById(this._domId),e=sap.ui.Device.browser.name,i=this.getWidth(),a=this.getHeight();""==i&&("ie"==e&&this.getParent()instanceof sap.m.FlexBox?this.setWidth("100%"):t.style.maxWidth="100%");""==a&&("ie"==e&&this.getParent()instanceof sap.m.FlexBox?this.setHeight("100%"):t.style.maxHeight="100%")},_ImageMarkAreaResize:function(){var t=document.getElementById(this._domId);$(t).on("load",function(){this._ImageMarkAreaLoadComplete()}.bind(this)).attr("src",$(t).attr("src"))},_ImageMarkAreaLoadComplete:function(){var t=document.getElementById(this._domId),e=$(t),i=this._getImageMarkAreaSize();0!=i&&e.rwdImageMaps(e,i.width,i.height)},_getImageMarkAreaSize:function(){if(""==this.getSrc())return!1;this.getWidth(),this.getHeight();var t=this._getDummyImageSize(),e={};return e.width=t.width,e.height=t.height,e},_getDummyImageSize:function(){var t=$(".sapUiBody")[0],e=document.getElementById(this._domId),i=e.cloneNode();i.style.visibility="hidden",i.style.width=this.getWidth(),i.style.height=this.getHeight(),t.appendChild(i);var a=$(i).css("width"),r=$(i).css("height"),s=document.getElementById(this.getId());return s.style.width=e.style.width=a,s.style.height=e.style.height=r,$(i).remove(),{width:a,height:r}}})});