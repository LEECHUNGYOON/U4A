sap.ui.define("u4a.m.ImageMarkArea",["sap/m/Image"],function(a){"use strict";var b=a.extend("u4a.m.ImageMarkArea",{metadata:{library:"u4a.m",defaultAggregation:"marks",aggregations:{marks:{type:"u4a.m.ImageMark",multiple:!0,singularName:"mark"}}},_resizeHandler:void 0,init:function(){var a=$.fn.maphilight;"undefined"==typeof a&&jQuery.ajax({url:"/zu4a_imp/publish/CommonJS/jquery.u4a.maphilights.js",dataType:"script",cache:!1,async:!1,success:function(){console.log("maphilight load")}||jQuery.noop,error:function(){console.error("maphilight load fail")}})},renderer:function(a,b){a.write("<div"),a.writeControlData(b),a.write(">"),sap.m.ImageRenderer.render(a,b);var c=b,d=c.getUseMap(),e=c.getMarks();if(c.setDensityAware(!1),d){var f=e.length;if(0!=f){a.write("<map");var g=d;"#"==g.slice(0,1)&&(g=g.slice(1)),a.writeAttribute("name",g),a.writeAttribute("id",g),a.write(">");for(var e=c.getMarks(),h=e.length,j=0;j<h;j++)c._renderMarks(a,e[j]);a.write("</map>")}}a.write("</div>")},_renderMarks:function(a,b){a.write("<area"),a.writeElementData(b),a.writeAttribute("shape",b.getShape()),a.writeAttribute("coords",b.getCoords());var c=b.getTooltip(),d=b.getText(),e=c;""!=d&&(null==e&&(e=""),e=e+" : "+d),a.writeAttribute("data-text",b.getText()),a.writeAttribute("title",null==e?"":e);var f=b.getStrokeColor();f="#"==f.slice(0,1)?f.slice(1):f;var g=b.getFillColor();g="#"==g.slice(0,1)?g.slice(1):g;var h=b.getFill(),i=b.getFillOpacity(),j=b.getAlwaysOn(),k=b.getStroke(),l=b.getStrokeOpacity(),m=b.getStrokeWidth(),n=b.getShadow(),o=b.getShadowX(),p=b.getShadowY(),q=b.getShadowRadius(),r=b.getShadowColor();r="#"==r.slice(0,1)?r.slice(1):r;var s=b.getShadowOpacity(),t="{\"strokeColor\":\""+f+"\",\"alwaysOn\":"+j+",\"fill\":"+h+",\"fillColor\":\""+g+"\",\"fillOpacity\":"+i+",\"stroke\":"+k+",\"strokeOpacity\":"+l+",\"strokeWidth\":"+m+",\"shadow\":"+n+",\"shadowX\":"+o+",\"shadowY\":"+p+",\"shadowRadius\":"+q+",\"shadowColor\":\""+r+"\",\"shadowOpacity\":"+s+"}";a.writeAttributeEscaped("data-maphilight",t),a.write(">"),a.write("</area>")},setSrc:function(a){return a===this.getSrc()?this:(this.setProperty("src",a),this)},onAfterRendering:function(a){var b=a.srcControl;this._setImageMarkId(b),this._applyImageDymanicEffect(),this._ImageMarkAreaResize(),this._attachMarkImageEvent(),this._attachMarkEvent(),this._resizeHandler&&($(window).off("resize",this._resizeHandler),delete this._resizeHandler),this._resizeHandler=this._imageMarkResizeHandle.bind(this),$(window).on("resize",this._resizeHandler)},_attachMarkImageEvent:function(){var a=this,b=document.getElementById(this.getId());null==b||(b.onclick=function(){a.firePress(a.mProperties)})},_attachMarkEvent:function(){var a=this.getMarks(),b=a.length;if(0!=b)for(var c=0;c<b;c++){var d=a[c],e=document.getElementById(d.getId());if(null==e)return;e.onclick=function(){var a=sap.ui.getCore().byId(this.id);a.fireSelectMark()}}},_setImageMarkId:function(a){var b=$("#"+a.getId()),c=b[0].childNodes[0];c.setAttribute("id",a.getId()+"--ImageMark"),c.setAttribute("data-sap-ui",a.getId()+"--ImageMark"),this._domId=c.id},_applyImageDymanicEffect:function(){var a=document.getElementById(this._domId),b=sap.ui.Device.browser.name,c=this.getWidth(),d=this.getHeight();if(""==c)if("ie"==b){var e=this.getParent();e instanceof sap.m.FlexBox?this.setWidth("100%"):a.style.maxWidth="100%"}else a.style.maxWidth="100%";if(""==d)if("ie"==b){var e=this.getParent();e instanceof sap.m.FlexBox?this.setHeight("100%"):a.style.maxHeight="100%"}else a.style.maxHeight="100%"},_ImageMarkAreaResize:function(){var a=document.getElementById(this._domId);$(a).on("load",function(){this._ImageMarkAreaLoadComplete()}.bind(this)).attr("src",$(a).attr("src"))},_ImageMarkAreaLoadComplete:function(){var a=document.getElementById(this._domId),b=$(a),c=this._getImageMarkAreaSize();!1==c||b.rwdImageMaps(b,c.width,c.height)},_getImageMarkAreaSize:function(){if(""==this.getSrc())return!1;var a=this.getWidth(),b=this.getHeight(),c=this._getDummyImageSize(),d={};return d.width=c.width,d.height=c.height,d},_getDummyImageSize:function(){var a=$(".sapUiBody")[0],b=document.getElementById(this._domId),c=b.cloneNode();c.style.visibility="hidden",c.style.width=this.getWidth(),c.style.height=this.getHeight(),a.appendChild(c);var d=$(c).css("width"),e=$(c).css("height"),f=document.getElementById(this.getId());return f.style.width=b.style.width=d,f.style.height=b.style.height=e,$(c).remove(),{width:d,height:e}},exit:function(){this._resizeHandler&&($(window).off("resize",this._resizeHandler),delete this._resizeHandler)}});return b});