u4a.m.ImageMapShapeType={Rect:"rect",Poly:"poly"},sap&&sap.ui&&sap.ui.base&&sap.ui.base.DataType&&sap.ui.base.DataType.registerEnum&&"function"==typeof sap.ui.base.DataType.registerEnum&&sap.ui.base.DataType.registerEnum("u4a.m.ImageMapShapeType",u4a.m.ImageMapShapeType),sap.ui.define("u4a.m.ImageMapGenerator",["sap/ui/core/Control"],function(e){"use strict";return e.extend("u4a.m.ImageMapGenerator",{metadata:{library:"u4a.m",properties:{imgMapWidth:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},imgMapHeight:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},imgWidth:{type:"sap.ui.core.CSSSize",defaultValue:""},imgHeight:{type:"sap.ui.core.CSSSize",defaultValue:""},shape:{type:"u4a.m.ImageMapShapeType",defaultValue:u4a.m.ImageMapShapeType.Rect},maximumFileSize:{type:"float",defaultValue:1}},defaultAggregation:"contents",aggregations:{_container:{type:"sap.m.VBox",multiple:!1,visibility:"hidden"}},events:{coordDisplay:{allowPreventDefault:!0}}},init:function(){this._ImageMapInfo={}},onBeforeRendering:function(){var e=new sap.m.VBox({width:"auto",height:"100%",renderType:"Bare"}).addStyleClass("u4aMImageMapGeneratorContainer");this._createImageMapToolbar(e),this.setAggregation("_container",e,!0)},renderer:function(e,t){e.openStart("div",t),e.class("u4aMImageMapGenerator"),e.style("width",t.getImgMapWidth()),e.style("height",t.getImgMapHeight()),e.style("display","flex"),e.style("flex-direction","column"),e.openEnd();t=t.getAggregation("_container");null!=t&&sap.m.VBoxRenderer.render(e,t),e.close("div")},onAfterRendering:function(){this._createImageMapContainer();var t=this,e=this._ImageMapInfo,a=e.imageMapId,i=document.getElementById(a);i.oMapInfo||(i.oMapInfo={},i.oMapInfo.fileLoaded=!1,i.oMapInfo.mapntId=a+"--image-mapper-point",i.oMapInfo.mapShapeId=a+"--image-mapper-shape",i.oMapInfo.imageId=a+"-img",e.mapInfo=i.oMapInfo),void 0===jQuery.u4aImgMapGenerator&&jQuery.u4aJSloadAsync("/zu4a_imp/tools/imageMarkGenerator/jquery.u4a.imageMarkGenerator.js",function(){jQuery.u4aJSloadAsync("/zu4a_imp/tools/imageMarkGenerator/imageMarkGeneratorBootStrap.js",function(){})});a=e.imageMapId;$(document).trigger("ImageMapInit",{mapId:"#"+a}),this._setDefaultImageAreaSize();i=i.oMapInfo.imageId,i=document.getElementById(i);null!=i&&(""==i.src&&(i.src="/zu4a_imp/sample_img?obkey=NOIMGNOBACK"),i.onload=function(e){t._imageLoad(e)})},setImgMapWidth:function(e){this.setProperty("imgMapWidth",e,!0);var t=document.getElementById(this.getId());null!=t&&(t.style.width=e)},setImgMapHeight:function(e){this.setProperty("imgMapHeight",e,!0);var t=document.getElementById(this.getId());null!=t&&(t.style.height=e)},setImgWidth:function(e){this.setProperty("imgWidth",e,!0);e=this._ImageMapInfo.mapInfo;null!=e&&e.fileLoaded&&this._imageResize()},setImgHeight:function(e){this.setProperty("imgHeight",e,!0);e=this._ImageMapInfo.mapInfo;null!=e&&e.fileLoaded&&this._imageResize()},setShape:function(e){this.setProperty("shape",e,!0),this._oCombo.setSelectedKey(e),this._shapeTypeChange(e)},setMaximumFileSize:function(e){this.setProperty("maximumFileSize",e,!0)},_imageResize:function(){var e=this._ImageMapInfo,t=e.mapInfo,a=t.imageId,i=e.imageMapId,n=this.getImgWidth(),e=this.getImgHeight();t.fileLoaded&&(null==(t=document.getElementById(i))||null!=(i=document.getElementById(a))&&(a=i.naturalWidth+"px",i=i.naturalHeight+"px",t.style.width=""==n?a:n,t.style.height=""==e?i:e))},_createImageMapToolbar:function(e){var t,a,i,n,o,s;e&&(t=this,a=new sap.m.Toolbar,(i=new sap.ui.unified.FileUploader({buttonOnly:!0,buttonText:"찾아보기..",fileType:["jpg","jpeg","bmp","gif","png"],maximumFileSize:this.getMaximumFileSize()}).addStyleClass("sapUiTinyMarginEnd")).oBrowse.setType(sap.m.ButtonType.Emphasized),i.attachEvent("typeMissmatch",function(e){t._typeMissmatch(e)}),i.attachEvent("change",function(e){t._fileChange(e)}),i.attachEvent("fileSizeExceed",function(e){t._fileSizeExceed(e)}),(n=new sap.m.ComboBox({width:"100px",selectedKey:"rect"}).addStyleClass("sapUiTinyMarginEnd")).addItem(new sap.ui.core.Item({key:"rect",text:"Rect"})),n.addItem(new sap.ui.core.Item({key:"poly",text:"Poly"})),n.attachEvent("selectionChange",function(e){t._comboSelectChange(e)}),this._oCombo=n,this.setShape(n.getSelectedKey()),o=new sap.m.Button({text:"코드보기",type:sap.m.ButtonType.Ghost}).addStyleClass("sapUiTinyMarginEnd"),s=new sap.m.Button({text:"Clear",type:sap.m.ButtonType.Ghost}).addStyleClass("sapUiTinyMarginEnd"),o.attachEvent("press",function(e){t._coordsDisplay(e)}),s.attachEvent("press",function(e){t._clearBtnPress(e)}),a.addContent(new sap.m.ToolbarSpacer),a.addContent(i),a.addContent(n),a.addContent(o),a.addContent(s),e.addItem(a),this._oTool=a,this._oFileup=i,this._oCodeBtn=o,this._oClearBtn=s)},_createImageMapContainer:function(){var e,t,a,i=this.getAggregation("_container");i&&(a=this.getId(),e=i.getId(),null!=(t=document.getElementById(e))&&((i=document.createElement("div")).style.display="flex",i.style.flex="1 1 auto",i.style.minHeight="1px",i.classList.add("u4aMImageMapGeneratorWapper"),t.appendChild(i),(e=document.createElement("div")).id=a+"-ImageMapArea",e.style.display="flex",e.style.flex="1 1 auto",e.style.padding="1rem",e.style.boxSizing="border-box",e.classList.add("u4aMImageMapArea"),e.style.justifyContent="center",e.style.alignItems="center",e.style.overflow="auto",i.appendChild(e),(t=document.createElement("div")).id=a+"-ImageMapContent",t.style.boxSizing="border-box",t.style.position="relative",t.style.maxHeight="100%",t.classList.add("u4aMImageMapContent"),e.appendChild(t),(i=document.createElement("div")).id=this.getId()+"-ImageMap",i.classList.add("u4aMImageMap"),i.style.position="relative",i.style.flex="0 0 auto",i.style.overflow="hidden",i.style.display="inline-block",i.style.border="2px solid rgb(221, 221, 221)",i.style.padding="2px",i.style.borderRadius="3px",t.appendChild(i),this._oTool.getDomRef().style.flex="0 0 auto",(a=this._ImageMapInfo).imageMapId=i.id,a.imageMapAreaId=e.id,a.imageMapContentId=t.id))},_typeMissmatch:function(e){this._message("이미지파일을 선택해 주세요.")},_fileChange:function(e){var t,a,i,e=e.getParameter("files");0!=e.length&&(t=this._ImageMapInfo.imageMapId,a=e[0],e=new FileReader,i=this,e.onloadend=function(e){i._oClearBtn.firePress();e=i._btoa(e.target.result);$("#"+t).imageMapper("update",{src:"data:"+a.type+";base64,"+e,file:a.name}),i._ImageMapInfo.mapInfo.fileLoaded=!0},a?e.readAsArrayBuffer(a):$("#"+t).imageMapper("update",{src:"",file:""}))},_fileSizeExceed:function(e){this._message("파일 크기가 초과되었습니다.")},_btoa:function(e){for(var t="",a=new Uint8Array(e),i=a.byteLength,n=0;n<i;n++)t+=String.fromCharCode(a[n]);return window.btoa(t)},_clearBtnPress:function(e){this.setShape("rect"),this._oCombo.setSelectedKey("rect");var t=this._ImageMapInfo.imageMapId;$("#"+t).imageMapperRemove()},_coordsDisplay:function(e){var t=this._ImageMapInfo.imageMapId,t=$("#"+t).imageMapper("getData");0!=t.area[0].coords.length&&(t=this._getCoords(t),t={shapeType:this._oCombo.getSelectedKey(),coords:t},this.fireCoordDisplay(t))},_comboSelectChange:function(e){e=e.getSource().getSelectedKey();this._shapeTypeChange(e)},_shapeTypeChange:function(e){var t,a=this._ImageMapInfo.imageMapId;null==a||void 0!==(a=(t=$("#"+a)).data("imageMapper"))&&(a={markIdx:a,shapeType:e},t.imageMapperRemove(),t.imageMapperTypeChange(a),this.setProperty("shape",e,!0))},_getCoords:function(e){var t=e.area[0],e=t.coords,a=e.length,t=t.shape,i=[];if(0!=a&&(jQuery.each(e,function(e,t){i.push(t.naturalX,t.naturalY)}),"circle"==t&&(t=Math.round(Math.sqrt(Math.pow(i[2]-i[0],2)+Math.pow(i[3]-i[1],2))),(i=i.slice(0,2)).push(t)),0!=(a=i.length))){for(var n="",o=0;o<a;o++)n+=i[o]+",";return n.slice(0,-1)}},_message:function(e){sap.m.MessageToast.show(e,{width:"30%",my:"center center",at:"center center"})},_setDefaultImageAreaSize:function(){var e=this._ImageMapInfo.mapInfo,t=e.mapCls,e=e.mapSvg,t=$("."+t),e=$("."+e);t.css({"max-width":"100%","max-height":"100%",width:"100%",height:"100%"}),e.css({width:"100%",position:"absolute",top:"0",right:"0",bottom:"0",left:"0",height:"100%"})},_imageLoad:function(e){var t=this._ImageMapInfo;t.mapInfo.fileLoaded&&(t=t.imageMapAreaId,(t=document.getElementById(t)).style.justifyContent="flex-start",t.style.alignItems="",t.style.overflow="auto",this._imageResize())},exit:function(){delete this._ImageMapInfo,delete this._oClearBtn,delete this._oCodeBtn,delete this._oCombo,delete this._oFileup,delete this._oTool}})});