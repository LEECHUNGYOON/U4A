u4a.m.ImageMapShapeType={Rect:"rect",Poly:"poly"},sap&&sap.ui&&sap.ui.base&&sap.ui.base.DataType&&sap.ui.base.DataType.registerEnum&&"function"==typeof sap.ui.base.DataType.registerEnum&&sap.ui.base.DataType.registerEnum("u4a.m.ImageMapShapeType",u4a.m.ImageMapShapeType),sap.ui.define("u4a.m.ImageMapGenerator",["sap/ui/core/Control","sap/ui/unified/FileUploader"],function(a,b){"use strict";var c=a.extend("u4a.m.ImageMapGenerator",{metadata:{library:"u4a.m",properties:{imgMapWidth:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},imgMapHeight:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},imgWidth:{type:"sap.ui.core.CSSSize",defaultValue:""},imgHeight:{type:"sap.ui.core.CSSSize",defaultValue:""},shape:{type:"u4a.m.ImageMapShapeType",defaultValue:u4a.m.ImageMapShapeType.Rect},maximumFileSize:{type:"float",defaultValue:1}},defaultAggregation:"contents",aggregations:{_container:{type:"sap.m.VBox",multiple:!1,visibility:"hidden"}},events:{coordDisplay:{allowPreventDefault:!0}}},init:function(){this._ImageMapInfo={}},onBeforeRendering:function(){var a=new sap.m.VBox({width:"auto",height:"100%",renderType:"Bare"}).addStyleClass("u4aMImageMapGeneratorContainer");this._createImageMapToolbar(a),this.setAggregation("_container",a,!0)},renderer:function(a,b){a.openStart("div",b),a.class("u4aMImageMapGenerator"),a.style("width",b.getImgMapWidth()),a.style("height",b.getImgMapHeight()),a.style("display","flex"),a.style("flex-direction","column"),a.openEnd();var c=b.getAggregation("_container");null!=c&&sap.m.VBoxRenderer.render(a,c),a.close("div")},onAfterRendering:function(){this._createImageMapContainer();var a=this,b=this._ImageMapInfo,c=b.imageMapId,d=document.getElementById(c);d.oMapInfo||(d.oMapInfo={},d.oMapInfo.fileLoaded=!1,d.oMapInfo.mapntId=c+"--image-mapper-point",d.oMapInfo.mapShapeId=c+"--image-mapper-shape",d.oMapInfo.imageId=c+"-img",b.mapInfo=d.oMapInfo),"undefined"==typeof jQuery.u4aImgMapGenerator&&jQuery.u4aJSloadAsync("/zu4a_imp/tools/imageMarkGenerator/jquery.u4a.imageMarkGenerator.js",function(){jQuery.u4aJSloadAsync("/zu4a_imp/tools/imageMarkGenerator/imageMarkGeneratorBootStrap.js",function(){})});var c=b.imageMapId;$(document).trigger("ImageMapInit",{mapId:"#"+c}),this._setDefaultImageAreaSize();var e=d.oMapInfo.imageId,f=document.getElementById(e);null==f||(""==f.src&&(f.src="/zu4a_imp/sample_img?obkey=NOIMGNOBACK"),f.onload=function(b){a._imageLoad(b)})},setImgMapWidth:function(a){this.setProperty("imgMapWidth",a,!0);var b=document.getElementById(this.getId());null==b||(b.style.width=a)},setImgMapHeight:function(a){this.setProperty("imgMapHeight",a,!0);var b=document.getElementById(this.getId());null==b||(b.style.height=a)},setImgWidth:function(a){this.setProperty("imgWidth",a,!0);var b=this._ImageMapInfo.mapInfo;if(null!=b){var c=b.fileLoaded;c&&this._imageResize()}},setImgHeight:function(a){this.setProperty("imgHeight",a,!0);var b=this._ImageMapInfo.mapInfo;if(null!=b){var c=b.fileLoaded;c&&this._imageResize()}},setShape:function(a){this.setProperty("shape",a,!0),this._oCombo.setSelectedKey(a),this._shapeTypeChange(a)},setMaximumFileSize:function(a){this.setProperty("maximumFileSize",a,!0)},_imageResize:function(){var a=this._ImageMapInfo,b=a.mapInfo,c=b.imageId,d=a.imageMapId,e=this.getImgWidth(),f=this.getImgHeight();if(b.fileLoaded){var g=document.getElementById(d);if(null!=g){var h=document.getElementById(c);if(null!=h){var i=h.naturalWidth+"px",j=h.naturalHeight+"px";g.style.width=""==e?i:e,g.style.height=""==f?j:f}}}},_createImageMapToolbar:function(a){if(a){var c=this,d=new sap.m.Toolbar,e=new b({buttonOnly:!0,buttonText:"\uCC3E\uC544\uBCF4\uAE30..",fileType:["jpg","jpeg","bmp","gif","png"],maximumFileSize:this.getMaximumFileSize()}).addStyleClass("sapUiTinyMarginEnd");e.oBrowse.setType(sap.m.ButtonType.Emphasized),e.attachEvent("typeMissmatch",function(a){c._typeMissmatch(a)}),e.attachEvent("change",function(a){c._fileChange(a)}),e.attachEvent("fileSizeExceed",function(a){c._fileSizeExceed(a)});var f=new sap.m.ComboBox({width:"100px",selectedKey:"rect"}).addStyleClass("sapUiTinyMarginEnd");f.addItem(new sap.ui.core.Item({key:"rect",text:"Rect"})),f.addItem(new sap.ui.core.Item({key:"poly",text:"Poly"})),f.attachEvent("selectionChange",function(a){c._comboSelectChange(a)}),this._oCombo=f,this.setShape(f.getSelectedKey());var g=new sap.m.Button({text:"\uCF54\uB4DC\uBCF4\uAE30",type:sap.m.ButtonType.Ghost}).addStyleClass("sapUiTinyMarginEnd"),h=new sap.m.Button({text:"Clear",type:sap.m.ButtonType.Ghost}).addStyleClass("sapUiTinyMarginEnd");g.attachEvent("press",function(a){c._coordsDisplay(a)}),h.attachEvent("press",function(a){c._clearBtnPress(a)}),d.addContent(new sap.m.ToolbarSpacer),d.addContent(e),d.addContent(f),d.addContent(g),d.addContent(h),a.addItem(d),this._oTool=d,this._oFileup=e,this._oCodeBtn=g,this._oClearBtn=h}},_createImageMapContainer:function(){var a=this.getAggregation("_container");if(a){var b=this.getId(),c=a.getId(),d=document.getElementById(c);if(null!=d){var e=document.createElement("div");e.style.display="flex",e.style.flex="1 1 auto",e.style.minHeight="1px",e.classList.add("u4aMImageMapGeneratorWapper"),d.appendChild(e);var f=document.createElement("div");f.id=b+"-ImageMapArea",f.style.display="flex",f.style.flex="1 1 auto",f.style.padding="1rem",f.style.boxSizing="border-box",f.classList.add("u4aMImageMapArea"),f.style.justifyContent="center",f.style.alignItems="center",f.style.overflow="auto",e.appendChild(f);var g=document.createElement("div");g.id=b+"-ImageMapContent",g.style.boxSizing="border-box",g.style.position="relative",g.style.maxHeight="100%",g.classList.add("u4aMImageMapContent"),f.appendChild(g);var h=document.createElement("div");h.id=this.getId()+"-ImageMap",h.classList.add("u4aMImageMap"),h.style.position="relative",h.style.flex="0 0 auto",h.style.overflow="hidden",h.style.display="inline-block",h.style.border="2px solid rgb(221, 221, 221)",h.style.padding="2px",h.style.borderRadius="3px",g.appendChild(h);var i=this._oTool,j=i.getDomRef();j.style.flex="0 0 auto";var k=this._ImageMapInfo;k.imageMapId=h.id,k.imageMapAreaId=f.id,k.imageMapContentId=g.id}}},_typeMissmatch:function(){this._message("\uC774\uBBF8\uC9C0\uD30C\uC77C\uC744 \uC120\uD0DD\uD574 \uC8FC\uC138\uC694.")},_fileChange:function(a){var b=a.getParameter("files"),c=b.length;if(0!=c){var d=this._ImageMapInfo,f=d.imageMapId,g=b[0],h=new FileReader,i=this;h.onloadend=function(a){i._oClearBtn.firePress();var b=i._btoa(a.target.result);$("#"+f).imageMapper("update",{src:"data:"+g.type+";base64,"+b,file:g.name});var c=i._ImageMapInfo.mapInfo;c.fileLoaded=!0},g?h.readAsArrayBuffer(g):$("#"+f).imageMapper("update",{src:"",file:""})}},_fileSizeExceed:function(){this._message("\uD30C\uC77C \uD06C\uAE30\uAC00 \uCD08\uACFC\uB418\uC5C8\uC2B5\uB2C8\uB2E4.")},_btoa:function(f){for(var a="",g=new Uint8Array(f),c=g.byteLength,d=0;c>d;d++)a+=String.fromCharCode(g[d]);return window.btoa(a)},_clearBtnPress:function(){this.setShape("rect"),this._oCombo.setSelectedKey("rect");var a=this._ImageMapInfo,b=a.imageMapId,c=$("#"+b);c.imageMapperRemove()},_coordsDisplay:function(){var a=this._ImageMapInfo,b=a.imageMapId,c=$("#"+b),d=c.imageMapper("getData"),e=d.area[0].coords.length;if(0!=e){var f=this._getCoords(d),g={shapeType:this._oCombo.getSelectedKey(),coords:f};this.fireCoordDisplay(g)}},_comboSelectChange:function(a){var b=a.getSource().getSelectedKey();this._shapeTypeChange(b)},_shapeTypeChange:function(a){var b=this._ImageMapInfo,c=b.imageMapId;if(null!=c){var d=$("#"+c),e=d.data("imageMapper");if("undefined"!=typeof e){d.imageMapperRemove(),d.imageMapperTypeChange({markIdx:e,shapeType:a}),this.setProperty("shape",a,!0)}}},_getCoords:function(a){var b=a.area[0],c=b.coords,d=c.length,e=b.shape,f=[];if(0!=d){if(jQuery.each(c,function(c,a){f.push(a.naturalX,a.naturalY)}),"circle"==e){var g=Math.round(Math.sqrt(Math.pow(f[2]-f[0],2)+Math.pow(f[3]-f[1],2)));f=f.slice(0,2),f.push(g)}if(d=f.length,0!=d){for(var h="",j=0;j<d;j++)h+=f[j]+",";return h.slice(0,-1)}}},_message:function(a){sap.m.MessageToast.show(a,{width:"30%",my:"center center",at:"center center"})},_setDefaultImageAreaSize:function(){var a=this._ImageMapInfo.mapInfo,b=a.mapCls,c=a.mapSvg,d=$("."+b),e=$("."+c);d.css({"max-width":"100%","max-height":"100%",width:"100%",height:"100%"}),e.css({width:"100%",position:"absolute",top:"0",right:"0",bottom:"0",left:"0",height:"100%"})},_imageLoad:function(){var a=this._ImageMapInfo,b=a.mapInfo;if(b.fileLoaded){var c=a.imageMapAreaId,d=document.getElementById(c);d.style.justifyContent="flex-start",d.style.alignItems="",d.style.overflow="auto",this._imageResize()}},exit:function(){delete this._ImageMapInfo,delete this._oClearBtn,delete this._oCodeBtn,delete this._oCombo,delete this._oFileup,delete this._oTool}});return c});