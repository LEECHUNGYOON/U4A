jQuery.sap.require("sap.ui.core.Control"),jQuery.sap.require("sap.m.TabContainer"),jQuery.sap.declare("u4a.m.TabContainer"),sap.m.TabContainer.extend("u4a.m.TabContainer",{metadata:{library:"u4a.m",properties:{selectedKey:{type:"string",group:"Data",defaultValue:""}}},_OldItemKeys:[],_bisRemoveCalled:!1,_iKey:null,constructor:function(e,t){var r=[];t||"object"!=typeof e||(t=e),t&&Array.isArray(t.items)&&(r=t.items,delete t.items),sap.ui.core.Control.prototype.constructor.apply(this,arguments);var i=new sap.m.TabStrip(this.getId()+"--tabstrip",{hasSelect:!0,itemSelect:function(e){var t=e.getParameter("item"),t=this._fromTabStripItem(t);this.setSelectedItem(t,e),this.setProperty("selectedKey",t.getKey(),!0)}.bind(this),itemClose:function(e){var t=e.getParameter("item"),t=this._fromTabStripItem(t);e.preventDefault(),this.fireItemClose({item:t})&&this.removeItem(t)}.bind(this)});this.setAggregation("_tabStrip",i,!0),t&&t.showAddNewButton&&this.setShowAddNewButton(!0),r.forEach(function(e){this.addItem(e)},this)},renderer:function(e,t){"use strict";sap.m.TabContainerRenderer.render(e,t)},removeItem:function(e){if(null==e)return null;this._bisRemoveCalled=!0;var t=this.getItems(),r=t.length;if(0==this._OldItemKeys.length)for(var i=0;i<r;i++){var s=t[i];this._OldItemKeys.push(s.getProperty("key"))}for(i=0;i<r;i++){var o=(s=t[i]).getKey();if(this.getSelectedKey()==o){this._iKey=o;break}}return(e=this.removeAggregation("items",e)).getId(),this.getSelectedItem(),this._getTabStrip().removeItem(this._toTabStripItem(e)),e},_getItemIndex:function(e,t){for(var r=e.length,i=0;i<r;i++)if(e[i].getProperty("key")==t)return i;return-1},onBeforeRendering:function(){"use strict";try{var e=this.getItems(),t=e.length;if(0==t)return this.setAssociation("selectedItem",null),void this.setProperty("selectedKey","",!0);var r=this.getSelectedKey();if(""==r)return this.setProperty("selectedKey",e[0].getKey(),!0),void this.setSelectedItem(e[0]);if(0==this._bisRemoveCalled){for(var i=0;i<t;i++){var s=e[i],o=s.getKey();if(""==o)return;if(r==o){if(r===o)return;if(s.getId()!=this.getSelectedItem()){this.setSelectedItem(s);break}}}return}var a=this._getItemIndex(e,r);if(-1==a){for(var n=this._OldItemKeys.length,i=0;i<n&&this._OldItemKeys[i]!=this._iKey;i++);for(var l=i;l<n;l++)for(var h=0;h<t;h++){var m=e[h];if(this._OldItemKeys[l]==m.getProperty("key"))return this.setSelectedItem(m),void this.setProperty("selectedKey",this._OldItemKeys[l],!0)}return this.setSelectedItem(e[t-1]),void this.setProperty("selectedKey",e[t-1].getProperty("key"),!0)}this.setProperty("selectedKey",e[a].getProperty("key"),!0),this.setAssociation("selectedItem",e[a],!0)}catch(e){return void console.error(e)}finally{this._bisRemoveCalled=!1,this._OldItemKeys=[],this._iKey=null}}});